{"version":3,"sources":["node_modules/browser-pack/_prelude.js","build/css.js","builtins/amp-img.js","builtins/amp-pixel.js","builtins/amp-video.js","node_modules/document-register-element/build/document-register-element.node.js","node_modules/promise-pjs/promise.js","src/ampdoc.js","src/base-element.js","src/config.js","src/cookies.js","src/custom-element.js","src/document-state.js","src/dom.js","src/element-stub.js","src/error.js","src/event-helper.js","src/experiments.js","src/exponential-backoff.js","src/extensions.js","src/iframe-helper.js","src/intersection-observer-polyfill.js","src/layout-rect.js","src/layout.js","src/loader.js","src/log.js","src/mode-object.js","src/mode.js","src/observable.js","src/performance.js","src/platform.js","src/polyfills.js","src/polyfills/document-contains.js","src/polyfills/math-sign.js","src/polyfills/object-assign.js","src/polyfills/promise.js","src/preconnect.js","src/render-delaying-services.js","src/resources.js","src/service-worker/shell.js","src/service.js","src/service/extensions-impl.js","src/size-list.js","src/srcset.js","src/string.js","src/style-installer.js","src/style.js","src/timer.js","src/types.js","src/url-replacements.js","src/url.js","src/utils/array.js","src/video-interface.js","src/video-manager.js","src/viewer.js","src/viewport.js","src/vsync.js","third_party/css-escape/css-escape.js"],"names":[],"mappings":"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AAM,CAAC,IAAI,EAAE,CAAC;KACpB;;;;;;AAzHG,YAAQ,WA8HZ,KAAK,GAAA,iBAAG;AACN,UAAI,CAAC,MAAM,CAAC,KAAK,EAAE,CAAC;KACrB;;;;;;AAhIG,YAAQ,WAqIZ,IAAI,GAAA,gBAAG;AACL,UAAI,CAAC,MAAM,CAAC,KAAK,GAAG,IAAI,CAAC;KAC1B;;;;;;AAvIG,YAAQ,WA4IZ,MAAM,GAAA,kBAAG;AACP,UAAI,CAAC,MAAM,CAAC,KAAK,GAAG,KAAK,CAAC;KAC3B;;;;;;AA9IG,YAAQ,WAmJZ,YAAY,GAAA,wBAAG;AACb,UAAI,CAAC,MAAM,CAAC,QAAQ,GAAG,IAAI,CAAC;KAC7B;;;;;;AArJG,YAAQ,WA0JZ,YAAY,GAAA,wBAAG;AACb,UAAI,CAAC,MAAM,CAAC,QAAQ,GAAG,KAAK,CAAC;KAC9B;;WA5JG,QAAQ;;;AA+Jd,oCAAgB,GAAG,EAAE,WAAW,EAAE,QAAQ,CAAC,CAAC;CAC7C;;;;ACnMD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;ACt4CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAC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","file":"sw.max.js","sourceRoot":"/source/","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","export const cssText = \"html{overflow-x:hidden!important}body,html{height:auto!important}body{margin:0!important;-webkit-text-size-adjust:100%;-moz-text-size-adjust:100%;-ms-text-size-adjust:100%;text-size-adjust:100%}html.-amp-ios-embed{position:static}#i-amp-html-wrapper,html.-amp-ios-embed{overflow-y:auto!important;-webkit-overflow-scrolling:touch!important}#i-amp-html-wrapper{overflow-x:hidden!important;position:absolute!important;top:0!important;left:0!important;right:0!important;bottom:0!important;margin:0!important;display:block!important}#i-amp-html-wrapper>body{position:relative!important;display:block!important;border-top:1px solid transparent!important}.-amp-make-body-block body{display:block!important}.-amp-element{display:inline-block}.-amp-layout-fixed{display:inline-block;position:relative}.-amp-layout-container,.-amp-layout-fixed-height,.-amp-layout-responsive{display:block;position:relative}.-amp-layout-fill{display:block;overflow:hidden!important;position:absolute;top:0;left:0;bottom:0;right:0}.-amp-layout-flex-item{display:block;position:relative;-webkit-box-flex:1;-webkit-flex:1 1 auto;-ms-flex:1 1 auto;flex:1 1 auto}.-amp-layout-size-defined{overflow:hidden!important}i-amp-sizer{display:block!important}.-amp-fill-content{display:block;width:1px;min-width:100%;height:100%;margin:auto}.-amp-layout-size-defined .-amp-fill-content{position:absolute;top:0;left:0;bottom:0;right:0}.-amp-replaced-content,.-amp-screen-reader{padding:0!important;border:none!important}.-amp-screen-reader{position:fixed!important;top:0px!important;left:0px!important;width:2px!important;height:2px!important;opacity:0!important;overflow:hidden!important;margin:0!important;display:block!important;visibility:visible!important}.-amp-unresolved{position:relative;overflow:hidden!important}.-amp-notbuilt{position:relative;overflow:hidden!important;color:transparent!important}.-amp-notbuilt>*{display:none}.-amp-ghost{visibility:hidden!important}.-amp-element>[placeholder]{display:block}.-amp-element>[placeholder].amp-hidden,.-amp-element>[placeholder].hidden{visibility:hidden}.-amp-element:not(.amp-notsupported)>[fallback]{display:none}.-amp-layout-size-defined>[fallback],.-amp-layout-size-defined>[placeholder]{position:absolute!important;top:0!important;left:0!important;right:0!important;bottom:0!important;z-index:1!important}.-amp-notbuilt>[placeholder]{display:block!important}.-amp-hidden-by-media-query{display:none}.-amp-element-error{background:red!important;color:#fff!important;position:relative!important}.-amp-element-error:before{content:attr(error-message)}i-amp-scroll-container{position:absolute;top:0;left:0;right:0;bottom:0;display:block}i-amp-scroll-container.amp-active{overflow:auto}.-amp-loading-container{display:block!important;z-index:1}.-amp-notbuilt>.-amp-loading-container{display:block!important}.-amp-loading-container.amp-hidden{visibility:hidden}.-amp-loader{position:absolute;display:block;height:10px;top:50%;left:50%;-webkit-transform:translateX(-50%) translateY(-50%);transform:translateX(-50%) translateY(-50%);-webkit-transform-origin:50% 50%;transform-origin:50% 50%;white-space:nowrap}.-amp-loader.amp-active .-amp-loader-dot{-webkit-animation:-amp-loader-dots 2s infinite;animation:-amp-loader-dots 2s infinite}.-amp-loader-dot{position:relative;display:inline-block;height:10px;width:10px;margin:2px;border-radius:100%;background-color:rgba(0,0,0,.3);box-shadow:2px 2px 2px 1px rgba(0,0,0,.2);will-change:transform}.-amp-loader .-amp-loader-dot:nth-child(1){-webkit-animation-delay:0s;animation-delay:0s}.-amp-loader .-amp-loader-dot:nth-child(2){-webkit-animation-delay:.1s;animation-delay:.1s}.-amp-loader .-amp-loader-dot:nth-child(3){-webkit-animation-delay:.2s;animation-delay:.2s}@-webkit-keyframes -amp-loader-dots{0%,to{-webkit-transform:scale(.7);transform:scale(.7);background-color:rgba(0,0,0,.3)}50%{-webkit-transform:scale(.8);transform:scale(.8);background-color:rgba(0,0,0,.5)}}@keyframes -amp-loader-dots{0%,to{-webkit-transform:scale(.7);transform:scale(.7);background-color:rgba(0,0,0,.3)}50%{-webkit-transform:scale(.8);transform:scale(.8);background-color:rgba(0,0,0,.5)}}.-amp-element>[overflow]{cursor:pointer;z-index:2;visibility:hidden}.-amp-element>[overflow].amp-visible{visibility:visible}template{display:none!important}.amp-border-box,.amp-border-box *,.amp-border-box :after,.amp-border-box :before{box-sizing:border-box}amp-pixel{position:fixed!important;top:0!important;width:1px!important;height:1px!important;overflow:hidden!important;visibility:hidden}amp-instagram{padding:48px 8px!important;background-color:#fff}amp-analytics{position:fixed!important;top:0!important;width:1px!important;height:1px!important;overflow:hidden!important;visibility:hidden}amp-iframe iframe{box-sizing:border-box!important}[amp-access][amp-access-hide],amp-experiment,amp-live-list>[update],amp-share-tracking,form [submit-error],form [submit-success]{display:none}amp-fresh{visibility:hidden}.amp-video-eq{-webkit-box-align:end;-webkit-align-items:flex-end;-ms-flex-align:end;align-items:flex-end;bottom:7px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:12px;opacity:0.8;overflow:hidden;position:absolute;right:7px;width:20px}.amp-video-eq .amp-video-eq-col{-webkit-box-flex:1;-webkit-flex:1;-ms-flex:1;flex:1;height:100%;margin-right:1px;position:relative}.amp-video-eq .amp-video-eq-col div{-webkit-animation-name:amp-video-eq-animation;animation-name:amp-video-eq-animation;-webkit-animation-timing-function:linear;animation-timing-function:linear;-webkit-animation-iteration-count:infinite;animation-iteration-count:infinite;-webkit-animation-direction:alternate;animation-direction:alternate;background-color:#fafafa;height:100%;position:absolute;width:100%;will-change:transform;-webkit-animation-play-state:paused;animation-play-state:paused}.amp-video-eq[unpausable] .amp-video-eq-col div{-webkit-animation-name:none;animation-name:none}.amp-video-eq[unpausable].amp-video-eq-play .amp-video-eq-col div{-webkit-animation-name:amp-video-eq-animation;animation-name:amp-video-eq-animation}.amp-video-eq.amp-video-eq-play .amp-video-eq-col div{-webkit-animation-play-state:running;animation-play-state:running}.amp-video-eq-1-1{-webkit-animation-duration:0.3s;animation-duration:0.3s}.amp-video-eq-1-1,.amp-video-eq-1-2{-webkit-transform:translateY(60%);transform:translateY(60%)}.amp-video-eq-1-2{-webkit-animation-duration:0.45s;animation-duration:0.45s}.amp-video-eq-2-1{-webkit-animation-duration:0.5s;animation-duration:0.5s}.amp-video-eq-2-1,.amp-video-eq-2-2{-webkit-transform:translateY(30%);transform:translateY(30%)}.amp-video-eq-2-2{-webkit-animation-duration:0.4s;animation-duration:0.4s}.amp-video-eq-3-1{-webkit-animation-duration:0.3s;animation-duration:0.3s}.amp-video-eq-3-1,.amp-video-eq-3-2{-webkit-transform:translateY(70%);transform:translateY(70%)}.amp-video-eq-3-2{-webkit-animation-duration:0.35s;animation-duration:0.35s}.amp-video-eq-4-1{-webkit-animation-duration:0.4s;animation-duration:0.4s}.amp-video-eq-4-1,.amp-video-eq-4-2{-webkit-transform:translateY(50%);transform:translateY(50%)}.amp-video-eq-4-2{-webkit-animation-duration:0.25s;animation-duration:0.25s}@-webkit-keyframes amp-video-eq-animation{0%{-webkit-transform:translateY(100%);transform:translateY(100%)}to{-webkit-transform:translateY(0);transform:translateY(0)}}@keyframes amp-video-eq-animation{0%{-webkit-transform:translateY(100%);transform:translateY(100%)}to{-webkit-transform:translateY(0);transform:translateY(0)}}\\n/*# sourceURL=/css/amp.css*/\"","/**\n * Copyright 2015 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {BaseElement} from '../src/base-element';\nimport {isLayoutSizeDefined} from '../src/layout';\nimport {registerElement} from '../src/custom-element';\nimport {srcsetFromElement} from '../src/srcset';\nimport {user} from '../src/log';\n\n\nexport class AmpImg extends BaseElement {\n\n  /** @param {!AmpElement} element */\n  constructor(element) {\n    super(element);\n\n    /** @private {boolean} */\n    this.allowImgLoadFallback_ = true;\n\n    /** @private {boolean} */\n    this.isPrerenderAllowed_ = true;\n\n    /** @private {?Element} */\n    this.img_ = null;\n\n    /** @private {?../src/srcset.Srcset} */\n    this.srcset_ = null;\n  }\n\n  /** @override */\n  buildCallback() {\n    this.isPrerenderAllowed_ = !this.element.hasAttribute('noprerender');\n\n    this.srcset_ = srcsetFromElement(this.element);\n  }\n\n  /** @override */\n  isLayoutSupported(layout) {\n    return isLayoutSizeDefined(layout);\n  }\n\n  /**\n   * Create the actual image element and set up instance variables.\n   * Called lazily in the first `#layoutCallback`.\n   */\n  initialize_() {\n    if (this.img_) {\n      return;\n    }\n    this.allowImgLoadFallback_ = true;\n    // If this amp-img IS the fallback then don't allow it to have its own\n    // fallback to stop from nested fallback abuse.\n    if (this.element.hasAttribute('fallback')) {\n      this.allowImgLoadFallback_ = false;\n    }\n\n    this.img_ = new Image();\n    if (this.element.id) {\n      this.img_.setAttribute('amp-img-id', this.element.id);\n    }\n\n    // Remove role=img otherwise this breaks screen-readers focus and\n    // only read \"Graphic\" when using only 'alt'.\n    if (this.element.getAttribute('role') == 'img') {\n      this.element.removeAttribute('role');\n      user().error('AMP-IMG', 'Setting role=img on amp-img elements breaks ' +\n        'screen readers please just set alt or ARIA attributes, they will ' +\n        'be correctly propagated for the underlying <img> element.');\n    }\n\n    this.propagateAttributes(['alt', 'referrerpolicy', 'aria-label',\n      'aria-describedby', 'aria-labelledby'], this.img_);\n    this.applyFillContent(this.img_, true);\n\n    this.element.appendChild(this.img_);\n  }\n\n  /** @override */\n  prerenderAllowed() {\n    return this.isPrerenderAllowed_;\n  }\n\n  /** @override */\n  isRelayoutNeeded() {\n    return true;\n  }\n\n  /** @override */\n  layoutCallback() {\n    this.initialize_();\n    let promise = this.updateImageSrc_();\n\n    // We only allow to fallback on error on the initial layoutCallback\n    // or else this would be pretty expensive.\n    if (this.allowImgLoadFallback_) {\n      promise = promise.catch(e => {\n        this.onImgLoadingError_();\n        throw e;\n      });\n      this.allowImgLoadFallback_ = false;\n    }\n    return promise;\n  }\n\n  /**\n   * @return {!Promise}\n   * @private\n   */\n  updateImageSrc_() {\n    if (this.getLayoutWidth() <= 0) {\n      return Promise.resolve();\n    }\n    const src = this.srcset_.select(this.getLayoutWidth(), this.getDpr()).url;\n    if (src == this.img_.getAttribute('src')) {\n      return Promise.resolve();\n    }\n\n    this.img_.setAttribute('src', src);\n\n    return this.loadPromise(this.img_).then(() => {\n      // Clean up the fallback if the src has changed.\n      if (!this.allowImgLoadFallback_ &&\n          this.img_.classList.contains('-amp-ghost')) {\n        this.getVsync().mutate(() => {\n          this.img_.classList.remove('-amp-ghost');\n          this.toggleFallback(false);\n        });\n      }\n    });\n  }\n\n  onImgLoadingError_() {\n    this.getVsync().mutate(() => {\n      this.img_.classList.add('-amp-ghost');\n      this.toggleFallback(true);\n    });\n  }\n};\n\n/**\n * @param {!Window} win Destination window for the new element.\n * @this {undefined}  // Make linter happy\n * @return {undefined}\n */\nexport function installImg(win) {\n  registerElement(win, 'amp-img', AmpImg);\n}\n","/**\n * Copyright 2015 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {BaseElement} from '../src/base-element';\nimport {Layout} from '../src/layout';\nimport {urlReplacementsForDoc} from '../src/url-replacements';\nimport {registerElement} from '../src/custom-element';\nimport {toggle} from '../src/style';\nimport {user} from '../src/log';\n\n/**\n * @param {!Window} win Destination window for the new element.\n * @this {undefined}  // Make linter happy\n * @return {undefined}\n */\nexport function installPixel(win) {\n  class AmpPixel extends BaseElement {\n\n    /** @override */\n    getPriority() {\n      // Loads after other content.\n      return 1;\n    }\n\n    /** @override */\n    isLayoutSupported(layout) {\n      return layout == Layout.FIXED;\n    }\n\n    /** @override */\n    buildCallback() {\n      // Consider the element invisible.\n      this.element.setAttribute('aria-hidden', 'true');\n    }\n\n    /** @override */\n    layoutCallback() {\n      // Now that we are rendered, stop rendering the element to reduce\n      // resource consumption.\n      toggle(this.element, false);\n      const src = this.element.getAttribute('src');\n      return urlReplacementsForDoc(this.getAmpDoc())\n          .expandAsync(this.assertSource(src))\n          .then(src => {\n            const image = new Image();\n            image.src = src;\n            this.element.appendChild(image);\n          });\n    }\n\n    assertSource(src) {\n      user().assert(\n          /^(https\\:\\/\\/|\\/\\/)/i.test(src),\n          'The <amp-pixel> src attribute must start with ' +\n          '\"https://\" or \"//\". Invalid value: ' + src);\n      return src;\n    }\n  };\n\n  registerElement(win, 'amp-pixel', AmpPixel);\n}\n","/**\n * Copyright 2015 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {BaseElement} from '../src/base-element';\nimport {assertHttpsUrl} from '../src/url';\nimport {isLayoutSizeDefined} from '../src/layout';\nimport {registerElement} from '../src/custom-element';\nimport {getMode} from '../src/mode';\nimport {dev} from '../src/log';\nimport {VideoEvents} from '../src/video-interface';\nimport {videoManagerForDoc} from '../src/video-manager';\n\n/**\n * @param {!Window} win Destination window for the new element.\n * @this {undefined}  // Make linter happy\n * @return {undefined}\n */\nexport function installVideo(win) {\n\n  /**\n   * @implements {../src/video-interface.VideoInterface}\n   */\n  class AmpVideo extends BaseElement {\n\n    /** @param {!AmpElement} element */\n    constructor(element) {\n      super(element);\n\n      /** @private {?Element} */\n      this.video_ = null;\n    }\n\n    /** @override */\n    isLayoutSupported(layout) {\n      return isLayoutSizeDefined(layout);\n    }\n\n    /** @override */\n    buildCallback() {\n      this.video_ = this.element.ownerDocument.createElement('video');\n\n      const posterAttr = this.element.getAttribute('poster');\n      if (!posterAttr && getMode().development) {\n        console/*OK*/.error(\n            'No \"poster\" attribute has been provided for amp-video.');\n      }\n\n      // Enable inline play for iOS.\n      this.video_.setAttribute('playsinline', '');\n      this.video_.setAttribute('webkit-playsinline', '');\n      // Disable video preload in prerender mode.\n      this.video_.setAttribute('preload', 'none');\n      this.propagateAttributes(['poster', 'controls', 'aria-label',\n          'aria-describedby', 'aria-labelledby'], this.video_);\n      this.forwardEvents([VideoEvents.PLAY, VideoEvents.PAUSE], this.video_);\n      this.applyFillContent(this.video_, true);\n      this.element.appendChild(this.video_);\n\n      videoManagerForDoc(this.win.document).register(this);\n    }\n\n    /** @override */\n    viewportCallback(visible) {\n      this.element.dispatchCustomEvent(VideoEvents.VISIBILITY, {visible});\n    }\n\n    /** @override */\n    layoutCallback() {\n      this.video_ = dev().assertElement(this.video_);\n\n      if (!this.isVideoSupported_()) {\n        this.toggleFallback(true);\n        return Promise.resolve();\n      }\n\n      if (this.element.getAttribute('src')) {\n        assertHttpsUrl(this.element.getAttribute('src'), this.element);\n      }\n\n      // Do not propagate `autoplay`. Autoplay behaviour is managed by\n      // video manager since amp-video implements the VideoInterface\n      this.propagateAttributes(\n          ['src', 'loop'],\n          this.video_);\n\n      if (this.element.hasAttribute('preload')) {\n        this.video_.setAttribute(\n            'preload', this.element.getAttribute('preload'));\n      } else {\n        this.video_.removeAttribute('preload');\n      }\n\n      this.getRealChildNodes().forEach(child => {\n        // Skip the video we already added to the element.\n        if (this.video_ === child) {\n          return;\n        }\n        if (child.getAttribute && child.getAttribute('src')) {\n          assertHttpsUrl(child.getAttribute('src'),\n              dev().assertElement(child));\n        }\n        this.video_.appendChild(child);\n      });\n\n      // loadPromise for media elements listens to `loadstart`\n      return this.loadPromise(this.video_).then(() => {\n        this.element.dispatchCustomEvent(VideoEvents.LOAD);\n      });\n    }\n\n    /** @override */\n    pauseCallback() {\n      if (this.video_) {\n        this.video_.pause();\n      }\n    }\n\n    /** @private */\n    isVideoSupported_() {\n      return !!this.video_.play;\n    }\n\n    // VideoInterface Implementation. See ../src/video-interface.VideoInterface\n\n    /**\n     * @override\n     */\n    supportsPlatform() {\n      return this.isVideoSupported_();\n    }\n\n    /**\n     * @override\n     */\n    isInteractive() {\n      return this.element.hasAttribute('controls');\n    }\n\n    /**\n     * @override\n     */\n    play(unusedIsAutoplay) {\n      this.video_.play();\n    }\n\n    /**\n     * @override\n     */\n    pause() {\n      this.video_.pause();\n    }\n\n    /**\n     * @override\n     */\n    mute() {\n      this.video_.muted = true;\n    }\n\n    /**\n     * @override\n     */\n    unmute() {\n      this.video_.muted = false;\n    }\n\n    /**\n     * @override\n     */\n    showControls() {\n      this.video_.controls = true;\n    }\n\n    /**\n     * @override\n     */\n    hideControls() {\n      this.video_.controls = false;\n    }\n  }\n\n  registerElement(win, 'amp-video', AmpVideo);\n}\n","/*!\n\nCopyright (C) 2014-2016 by Andrea Giammarchi - @WebReflection\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in\nall copies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\nTHE SOFTWARE.\n\n*/\nfunction installCustomElements(window) {'use strict';\n\n  // DO NOT USE THIS FILE DIRECTLY, IT WON'T WORK\n  // THIS IS A PROJECT BASED ON A BUILD SYSTEM\n  // THIS FILE IS JUST WRAPPED UP RESULTING IN\n  // build/document-register-element.node.js\n\n  var\n    document = window.document,\n    Object = window.Object\n  ;\n\n  var htmlClass = (function (info) {\n    // (C) Andrea Giammarchi - @WebReflection - MIT Style\n    var\n      catchClass = /^[A-Z]+[a-z]/,\n      filterBy = function (re) {\n        var arr = [], tag;\n        for (tag in register) {\n          if (re.test(tag)) arr.push(tag);\n        }\n        return arr;\n      },\n      add = function (Class, tag) {\n        tag = tag.toLowerCase();\n        if (!(tag in register)) {\n          register[Class] = (register[Class] || []).concat(tag);\n          register[tag] = (register[tag.toUpperCase()] = Class);\n        }\n      },\n      register = (Object.create || Object)(null),\n      htmlClass = {},\n      i, section, tags, Class\n    ;\n    for (section in info) {\n      for (Class in info[section]) {\n        tags = info[section][Class];\n        register[Class] = tags;\n        for (i = 0; i < tags.length; i++) {\n          register[tags[i].toLowerCase()] =\n          register[tags[i].toUpperCase()] = Class;\n        }\n      }\n    }\n    htmlClass.get = function get(tagOrClass) {\n      return typeof tagOrClass === 'string' ?\n        (register[tagOrClass] || (catchClass.test(tagOrClass) ? [] : '')) :\n        filterBy(tagOrClass);\n    };\n    htmlClass.set = function set(tag, Class) {\n      return (catchClass.test(tag) ?\n        add(tag, Class) :\n        add(Class, tag)\n      ), htmlClass;\n    };\n    return htmlClass;\n  }({\n    \"collections\": {\n      \"HTMLAllCollection\": [\n        \"all\"\n      ],\n      \"HTMLCollection\": [\n        \"forms\"\n      ],\n      \"HTMLFormControlsCollection\": [\n        \"elements\"\n      ],\n      \"HTMLOptionsCollection\": [\n        \"options\"\n      ]\n    },\n    \"elements\": {\n      \"Element\": [\n        \"element\"\n      ],\n      \"HTMLAnchorElement\": [\n        \"a\"\n      ],\n      \"HTMLAppletElement\": [\n        \"applet\"\n      ],\n      \"HTMLAreaElement\": [\n        \"area\"\n      ],\n      \"HTMLAttachmentElement\": [\n        \"attachment\"\n      ],\n      \"HTMLAudioElement\": [\n        \"audio\"\n      ],\n      \"HTMLBRElement\": [\n        \"br\"\n      ],\n      \"HTMLBaseElement\": [\n        \"base\"\n      ],\n      \"HTMLBodyElement\": [\n        \"body\"\n      ],\n      \"HTMLButtonElement\": [\n        \"button\"\n      ],\n      \"HTMLCanvasElement\": [\n        \"canvas\"\n      ],\n      \"HTMLContentElement\": [\n        \"content\"\n      ],\n      \"HTMLDListElement\": [\n        \"dl\"\n      ],\n      \"HTMLDataElement\": [\n        \"data\"\n      ],\n      \"HTMLDataListElement\": [\n        \"datalist\"\n      ],\n      \"HTMLDetailsElement\": [\n        \"details\"\n      ],\n      \"HTMLDialogElement\": [\n        \"dialog\"\n      ],\n      \"HTMLDirectoryElement\": [\n        \"dir\"\n      ],\n      \"HTMLDivElement\": [\n        \"div\"\n      ],\n      \"HTMLDocument\": [\n        \"document\"\n      ],\n      \"HTMLElement\": [\n        \"element\",\n        \"abbr\",\n        \"address\",\n        \"article\",\n        \"aside\",\n        \"b\",\n        \"bdi\",\n        \"bdo\",\n        \"cite\",\n        \"code\",\n        \"command\",\n        \"dd\",\n        \"dfn\",\n        \"dt\",\n        \"em\",\n        \"figcaption\",\n        \"figure\",\n        \"footer\",\n        \"header\",\n        \"i\",\n        \"kbd\",\n        \"mark\",\n        \"nav\",\n        \"noscript\",\n        \"rp\",\n        \"rt\",\n        \"ruby\",\n        \"s\",\n        \"samp\",\n        \"section\",\n        \"small\",\n        \"strong\",\n        \"sub\",\n        \"summary\",\n        \"sup\",\n        \"u\",\n        \"var\",\n        \"wbr\"\n      ],\n      \"HTMLEmbedElement\": [\n        \"embed\"\n      ],\n      \"HTMLFieldSetElement\": [\n        \"fieldset\"\n      ],\n      \"HTMLFontElement\": [\n        \"font\"\n      ],\n      \"HTMLFormElement\": [\n        \"form\"\n      ],\n      \"HTMLFrameElement\": [\n        \"frame\"\n      ],\n      \"HTMLFrameSetElement\": [\n        \"frameset\"\n      ],\n      \"HTMLHRElement\": [\n        \"hr\"\n      ],\n      \"HTMLHeadElement\": [\n        \"head\"\n      ],\n      \"HTMLHeadingElement\": [\n        \"h1\",\n        \"h2\",\n        \"h3\",\n        \"h4\",\n        \"h5\",\n        \"h6\"\n      ],\n      \"HTMLHtmlElement\": [\n        \"html\"\n      ],\n      \"HTMLIFrameElement\": [\n        \"iframe\"\n      ],\n      \"HTMLImageElement\": [\n        \"img\"\n      ],\n      \"HTMLInputElement\": [\n        \"input\"\n      ],\n      \"HTMLKeygenElement\": [\n        \"keygen\"\n      ],\n      \"HTMLLIElement\": [\n        \"li\"\n      ],\n      \"HTMLLabelElement\": [\n        \"label\"\n      ],\n      \"HTMLLegendElement\": [\n        \"legend\"\n      ],\n      \"HTMLLinkElement\": [\n        \"link\"\n      ],\n      \"HTMLMapElement\": [\n        \"map\"\n      ],\n      \"HTMLMarqueeElement\": [\n        \"marquee\"\n      ],\n      \"HTMLMediaElement\": [\n        \"media\"\n      ],\n      \"HTMLMenuElement\": [\n        \"menu\"\n      ],\n      \"HTMLMenuItemElement\": [\n        \"menuitem\"\n      ],\n      \"HTMLMetaElement\": [\n        \"meta\"\n      ],\n      \"HTMLMeterElement\": [\n        \"meter\"\n      ],\n      \"HTMLModElement\": [\n        \"del\",\n        \"ins\"\n      ],\n      \"HTMLOListElement\": [\n        \"ol\"\n      ],\n      \"HTMLObjectElement\": [\n        \"object\"\n      ],\n      \"HTMLOptGroupElement\": [\n        \"optgroup\"\n      ],\n      \"HTMLOptionElement\": [\n        \"option\"\n      ],\n      \"HTMLOutputElement\": [\n        \"output\"\n      ],\n      \"HTMLParagraphElement\": [\n        \"p\"\n      ],\n      \"HTMLParamElement\": [\n        \"param\"\n      ],\n      \"HTMLPictureElement\": [\n        \"picture\"\n      ],\n      \"HTMLPreElement\": [\n        \"pre\"\n      ],\n      \"HTMLProgressElement\": [\n        \"progress\"\n      ],\n      \"HTMLQuoteElement\": [\n        \"blockquote\",\n        \"q\",\n        \"quote\"\n      ],\n      \"HTMLScriptElement\": [\n        \"script\"\n      ],\n      \"HTMLSelectElement\": [\n        \"select\"\n      ],\n      \"HTMLShadowElement\": [\n        \"shadow\"\n      ],\n      \"HTMLSlotElement\": [\n        \"slot\"\n      ],\n      \"HTMLSourceElement\": [\n        \"source\"\n      ],\n      \"HTMLSpanElement\": [\n        \"span\"\n      ],\n      \"HTMLStyleElement\": [\n        \"style\"\n      ],\n      \"HTMLTableCaptionElement\": [\n        \"caption\"\n      ],\n      \"HTMLTableCellElement\": [\n        \"td\",\n        \"th\"\n      ],\n      \"HTMLTableColElement\": [\n        \"col\",\n        \"colgroup\"\n      ],\n      \"HTMLTableElement\": [\n        \"table\"\n      ],\n      \"HTMLTableRowElement\": [\n        \"tr\"\n      ],\n      \"HTMLTableSectionElement\": [\n        \"thead\",\n        \"tbody\",\n        \"tfoot\"\n      ],\n      \"HTMLTemplateElement\": [\n        \"template\"\n      ],\n      \"HTMLTextAreaElement\": [\n        \"textarea\"\n      ],\n      \"HTMLTimeElement\": [\n        \"time\"\n      ],\n      \"HTMLTitleElement\": [\n        \"title\"\n      ],\n      \"HTMLTrackElement\": [\n        \"track\"\n      ],\n      \"HTMLUListElement\": [\n        \"ul\"\n      ],\n      \"HTMLUnknownElement\": [\n        \"unknown\",\n        \"vhgroupv\",\n        \"vkeygen\"\n      ],\n      \"HTMLVideoElement\": [\n        \"video\"\n      ]\n    },\n    \"nodes\": {\n      \"Attr\": [\n        \"node\"\n      ],\n      \"Audio\": [\n        \"audio\"\n      ],\n      \"CDATASection\": [\n        \"node\"\n      ],\n      \"CharacterData\": [\n        \"node\"\n      ],\n      \"Comment\": [\n        \"#comment\"\n      ],\n      \"Document\": [\n        \"#document\"\n      ],\n      \"DocumentFragment\": [\n        \"#document-fragment\"\n      ],\n      \"DocumentType\": [\n        \"node\"\n      ],\n      \"HTMLDocument\": [\n        \"#document\"\n      ],\n      \"Image\": [\n        \"img\"\n      ],\n      \"Option\": [\n        \"option\"\n      ],\n      \"ProcessingInstruction\": [\n        \"node\"\n      ],\n      \"ShadowRoot\": [\n        \"#shadow-root\"\n      ],\n      \"Text\": [\n        \"#text\"\n      ],\n      \"XMLDocument\": [\n        \"xml\"\n      ]\n    }\n  }));\n  \n  \n    var\n    // V0 polyfill entry\n    REGISTER_ELEMENT = 'registerElement',\n  \n    // IE < 11 only + old WebKit for attributes + feature detection\n    EXPANDO_UID = '__' + REGISTER_ELEMENT + (window.Math.random() * 10e4 >> 0),\n  \n    // shortcuts and costants\n    ADD_EVENT_LISTENER = 'addEventListener',\n    ATTACHED = 'attached',\n    CALLBACK = 'Callback',\n    DETACHED = 'detached',\n    EXTENDS = 'extends',\n  \n    ATTRIBUTE_CHANGED_CALLBACK = 'attributeChanged' + CALLBACK,\n    ATTACHED_CALLBACK = ATTACHED + CALLBACK,\n    CONNECTED_CALLBACK = 'connected' + CALLBACK,\n    DISCONNECTED_CALLBACK = 'disconnected' + CALLBACK,\n    CREATED_CALLBACK = 'created' + CALLBACK,\n    DETACHED_CALLBACK = DETACHED + CALLBACK,\n  \n    ADDITION = 'ADDITION',\n    MODIFICATION = 'MODIFICATION',\n    REMOVAL = 'REMOVAL',\n  \n    DOM_ATTR_MODIFIED = 'DOMAttrModified',\n    DOM_CONTENT_LOADED = 'DOMContentLoaded',\n    DOM_SUBTREE_MODIFIED = 'DOMSubtreeModified',\n  \n    PREFIX_TAG = '<',\n    PREFIX_IS = '=',\n  \n    // valid and invalid node names\n    validName = /^[A-Z][A-Z0-9]*(?:-[A-Z0-9]+)+$/,\n    invalidNames = [\n      'ANNOTATION-XML',\n      'COLOR-PROFILE',\n      'FONT-FACE',\n      'FONT-FACE-SRC',\n      'FONT-FACE-URI',\n      'FONT-FACE-FORMAT',\n      'FONT-FACE-NAME',\n      'MISSING-GLYPH'\n    ],\n  \n    // registered types and their prototypes\n    types = [],\n    protos = [],\n  \n    // to query subnodes\n    query = '',\n  \n    // html shortcut used to feature detect\n    documentElement = document.documentElement,\n  \n    // ES5 inline helpers || basic patches\n    indexOf = types.indexOf || function (v) {\n      for(var i = this.length; i-- && this[i] !== v;){}\n      return i;\n    },\n  \n    // other helpers / shortcuts\n    OP = Object.prototype,\n    hOP = OP.hasOwnProperty,\n    iPO = OP.isPrototypeOf,\n  \n    defineProperty = Object.defineProperty,\n    empty = [],\n    gOPD = Object.getOwnPropertyDescriptor,\n    gOPN = Object.getOwnPropertyNames,\n    gPO = Object.getPrototypeOf,\n    sPO = Object.setPrototypeOf,\n  \n    // jshint proto: true\n    hasProto = !!Object.__proto__,\n  \n    // V1 helpers\n    fixGetClass = false,\n    DRECEV1 = '__dreCEv1',\n    customElements = window.customElements,\n    usableCustomElements = !!(\n      customElements &&\n      customElements.define &&\n      customElements.get &&\n      customElements.whenDefined\n    ),\n    Dict = Object.create || Object,\n    Map = window.Map || function Map() {\n      var K = [], V = [], i;\n      return {\n        get: function (k) {\n          return V[indexOf.call(K, k)];\n        },\n        set: function (k, v) {\n          i = indexOf.call(K, k);\n          if (i < 0) V[K.push(k) - 1] = v;\n          else V[i] = v;\n        }\n      };\n    },\n    Promise = window.Promise || function (fn) {\n      var\n        notify = [],\n        done = false,\n        p = {\n          'catch': function () {\n            return p;\n          },\n          'then': function (cb) {\n            notify.push(cb);\n            if (done) setTimeout(resolve, 1);\n            return p;\n          }\n        }\n      ;\n      function resolve(value) {\n        done = true;\n        while (notify.length) notify.shift()(value);\n      }\n      fn(resolve);\n      return p;\n    },\n    justCreated = false,\n    constructors = Dict(null),\n    waitingList = Dict(null),\n    nodeNames = new Map(),\n    secondArgument = String,\n  \n    // used to create unique instances\n    create = Object.create || function Bridge(proto) {\n      // silly broken polyfill probably ever used but short enough to work\n      return proto ? ((Bridge.prototype = proto), new Bridge()) : this;\n    },\n  \n    // will set the prototype if possible\n    // or copy over all properties\n    setPrototype = sPO || (\n      hasProto ?\n        function (o, p) {\n          o.__proto__ = p;\n          return o;\n        } : (\n      (gOPN && gOPD) ?\n        (function(){\n          function setProperties(o, p) {\n            for (var\n              key,\n              names = gOPN(p),\n              i = 0, length = names.length;\n              i < length; i++\n            ) {\n              key = names[i];\n              if (!hOP.call(o, key)) {\n                defineProperty(o, key, gOPD(p, key));\n              }\n            }\n          }\n          return function (o, p) {\n            do {\n              setProperties(o, p);\n            } while ((p = gPO(p)) && !iPO.call(p, o));\n            return o;\n          };\n        }()) :\n        function (o, p) {\n          for (var key in p) {\n            o[key] = p[key];\n          }\n          return o;\n        }\n    )),\n  \n    // DOM shortcuts and helpers, if any\n  \n    MutationObserver = window.MutationObserver ||\n                       window.WebKitMutationObserver,\n  \n    HTMLElementPrototype = (\n      window.HTMLElement ||\n      window.Element ||\n      window.Node\n    ).prototype,\n  \n    IE8 = !iPO.call(HTMLElementPrototype, documentElement),\n  \n    safeProperty = IE8 ? function (o, k, d) {\n      o[k] = d.value;\n      return o;\n    } : defineProperty,\n  \n    isValidNode = IE8 ?\n      function (node) {\n        return node.nodeType === 1;\n      } :\n      function (node) {\n        return iPO.call(HTMLElementPrototype, node);\n      },\n  \n    targets = IE8 && [],\n  \n    cloneNode = HTMLElementPrototype.cloneNode,\n    dispatchEvent = HTMLElementPrototype.dispatchEvent,\n    getAttribute = HTMLElementPrototype.getAttribute,\n    hasAttribute = HTMLElementPrototype.hasAttribute,\n    removeAttribute = HTMLElementPrototype.removeAttribute,\n    setAttribute = HTMLElementPrototype.setAttribute,\n  \n    // replaced later on\n    createElement = document.createElement,\n    patchedCreateElement = createElement,\n  \n    // shared observer for all attributes\n    attributesObserver = MutationObserver && {\n      attributes: true,\n      characterData: true,\n      attributeOldValue: true\n    },\n  \n    // useful to detect only if there's no MutationObserver\n    DOMAttrModified = MutationObserver || function(e) {\n      doesNotSupportDOMAttrModified = false;\n      documentElement.removeEventListener(\n        DOM_ATTR_MODIFIED,\n        DOMAttrModified\n      );\n    },\n  \n    // will both be used to make DOMNodeInserted asynchronous\n    asapQueue,\n    asapTimer = 0,\n  \n    // internal flags\n    setListener = false,\n    doesNotSupportDOMAttrModified = true,\n    dropDomContentLoaded = true,\n  \n    // needed for the innerHTML helper\n    notFromInnerHTMLHelper = true,\n  \n    // optionally defined later on\n    onSubtreeModified,\n    callDOMAttrModified,\n    getAttributesMirror,\n    observer,\n  \n    // based on setting prototype capability\n    // will check proto or the expando attribute\n    // in order to setup the node once\n    patchIfNotAlready,\n    patch\n  ;\n  \n  // only if needed\n  if (!(REGISTER_ELEMENT in document)) {\n  \n    if (sPO || hasProto) {\n        patchIfNotAlready = function (node, proto) {\n          if (!iPO.call(proto, node)) {\n            setupNode(node, proto);\n          }\n        };\n        patch = setupNode;\n    } else {\n        patchIfNotAlready = function (node, proto) {\n          if (!node[EXPANDO_UID]) {\n            node[EXPANDO_UID] = Object(true);\n            setupNode(node, proto);\n          }\n        };\n        patch = patchIfNotAlready;\n    }\n  \n    if (IE8) {\n      doesNotSupportDOMAttrModified = false;\n      (function (){\n        var\n          descriptor = gOPD(HTMLElementPrototype, ADD_EVENT_LISTENER),\n          addEventListener = descriptor.value,\n          patchedRemoveAttribute = function (name) {\n            var e = new CustomEvent(DOM_ATTR_MODIFIED, {bubbles: true});\n            e.attrName = name;\n            e.prevValue = getAttribute.call(this, name);\n            e.newValue = null;\n            e[REMOVAL] = e.attrChange = 2;\n            removeAttribute.call(this, name);\n            dispatchEvent.call(this, e);\n          },\n          patchedSetAttribute = function (name, value) {\n            var\n              had = hasAttribute.call(this, name),\n              old = had && getAttribute.call(this, name),\n              e = new CustomEvent(DOM_ATTR_MODIFIED, {bubbles: true})\n            ;\n            setAttribute.call(this, name, value);\n            e.attrName = name;\n            e.prevValue = had ? old : null;\n            e.newValue = value;\n            if (had) {\n              e[MODIFICATION] = e.attrChange = 1;\n            } else {\n              e[ADDITION] = e.attrChange = 0;\n            }\n            dispatchEvent.call(this, e);\n          },\n          onPropertyChange = function (e) {\n            // jshint eqnull:true\n            var\n              node = e.currentTarget,\n              superSecret = node[EXPANDO_UID],\n              propertyName = e.propertyName,\n              event\n            ;\n            if (superSecret.hasOwnProperty(propertyName)) {\n              superSecret = superSecret[propertyName];\n              event = new CustomEvent(DOM_ATTR_MODIFIED, {bubbles: true});\n              event.attrName = superSecret.name;\n              event.prevValue = superSecret.value || null;\n              event.newValue = (superSecret.value = node[propertyName] || null);\n              if (event.prevValue == null) {\n                event[ADDITION] = event.attrChange = 0;\n              } else {\n                event[MODIFICATION] = event.attrChange = 1;\n              }\n              dispatchEvent.call(node, event);\n            }\n          }\n        ;\n        descriptor.value = function (type, handler, capture) {\n          if (\n            type === DOM_ATTR_MODIFIED &&\n            this[ATTRIBUTE_CHANGED_CALLBACK] &&\n            this.setAttribute !== patchedSetAttribute\n          ) {\n            this[EXPANDO_UID] = {\n              className: {\n                name: 'class',\n                value: this.className\n              }\n            };\n            this.setAttribute = patchedSetAttribute;\n            this.removeAttribute = patchedRemoveAttribute;\n            addEventListener.call(this, 'propertychange', onPropertyChange);\n          }\n          addEventListener.call(this, type, handler, capture);\n        };\n        defineProperty(HTMLElementPrototype, ADD_EVENT_LISTENER, descriptor);\n      }());\n    } else if (!MutationObserver) {\n      documentElement[ADD_EVENT_LISTENER](DOM_ATTR_MODIFIED, DOMAttrModified);\n      documentElement.setAttribute(EXPANDO_UID, 1);\n      documentElement.removeAttribute(EXPANDO_UID);\n      if (doesNotSupportDOMAttrModified) {\n        onSubtreeModified = function (e) {\n          var\n            node = this,\n            oldAttributes,\n            newAttributes,\n            key\n          ;\n          if (node === e.target) {\n            oldAttributes = node[EXPANDO_UID];\n            node[EXPANDO_UID] = (newAttributes = getAttributesMirror(node));\n            for (key in newAttributes) {\n              if (!(key in oldAttributes)) {\n                // attribute was added\n                return callDOMAttrModified(\n                  0,\n                  node,\n                  key,\n                  oldAttributes[key],\n                  newAttributes[key],\n                  ADDITION\n                );\n              } else if (newAttributes[key] !== oldAttributes[key]) {\n                // attribute was changed\n                return callDOMAttrModified(\n                  1,\n                  node,\n                  key,\n                  oldAttributes[key],\n                  newAttributes[key],\n                  MODIFICATION\n                );\n              }\n            }\n            // checking if it has been removed\n            for (key in oldAttributes) {\n              if (!(key in newAttributes)) {\n                // attribute removed\n                return callDOMAttrModified(\n                  2,\n                  node,\n                  key,\n                  oldAttributes[key],\n                  newAttributes[key],\n                  REMOVAL\n                );\n              }\n            }\n          }\n        };\n        callDOMAttrModified = function (\n          attrChange,\n          currentTarget,\n          attrName,\n          prevValue,\n          newValue,\n          action\n        ) {\n          var e = {\n            attrChange: attrChange,\n            currentTarget: currentTarget,\n            attrName: attrName,\n            prevValue: prevValue,\n            newValue: newValue\n          };\n          e[action] = attrChange;\n          onDOMAttrModified(e);\n        };\n        getAttributesMirror = function (node) {\n          for (var\n            attr, name,\n            result = {},\n            attributes = node.attributes,\n            i = 0, length = attributes.length;\n            i < length; i++\n          ) {\n            attr = attributes[i];\n            name = attr.name;\n            if (name !== 'setAttribute') {\n              result[name] = attr.value;\n            }\n          }\n          return result;\n        };\n      }\n    }\n  \n    // set as enumerable, writable and configurable\n    document[REGISTER_ELEMENT] = function registerElement(type, options) {\n      upperType = type.toUpperCase();\n      if (!setListener) {\n        // only first time document.registerElement is used\n        // we need to set this listener\n        // setting it by default might slow down for no reason\n        setListener = true;\n        if (MutationObserver) {\n          observer = (function(attached, detached){\n            function checkEmAll(list, callback) {\n              for (var i = 0, length = list.length; i < length; callback(list[i++])){}\n            }\n            return new MutationObserver(function (records) {\n              for (var\n                current, node, newValue,\n                i = 0, length = records.length; i < length; i++\n              ) {\n                current = records[i];\n                if (current.type === 'childList') {\n                  checkEmAll(current.addedNodes, attached);\n                  checkEmAll(current.removedNodes, detached);\n                } else {\n                  node = current.target;\n                  if (notFromInnerHTMLHelper &&\n                      node[ATTRIBUTE_CHANGED_CALLBACK] &&\n                      current.attributeName !== 'style') {\n                    newValue = getAttribute.call(node, current.attributeName);\n                    if (newValue !== current.oldValue) {\n                      node[ATTRIBUTE_CHANGED_CALLBACK](\n                        current.attributeName,\n                        current.oldValue,\n                        newValue\n                      );\n                    }\n                  }\n                }\n              }\n            });\n          }(executeAction(ATTACHED), executeAction(DETACHED)));\n          observer.observe(\n            document,\n            {\n              childList: true,\n              subtree: true\n            }\n          );\n        } else {\n          asapQueue = [];\n          document[ADD_EVENT_LISTENER]('DOMNodeInserted', onDOMNode(ATTACHED));\n          document[ADD_EVENT_LISTENER]('DOMNodeRemoved', onDOMNode(DETACHED));\n        }\n  \n        document[ADD_EVENT_LISTENER](DOM_CONTENT_LOADED, onReadyStateChange);\n        document[ADD_EVENT_LISTENER]('readystatechange', onReadyStateChange);\n  \n        HTMLElementPrototype.cloneNode = function (deep) {\n          var\n            node = cloneNode.call(this, !!deep),\n            i = getTypeIndex(node)\n          ;\n          if (-1 < i) patch(node, protos[i]);\n          if (deep) loopAndSetup(node.querySelectorAll(query));\n          return node;\n        };\n      }\n  \n      if (-2 < (\n        indexOf.call(types, PREFIX_IS + upperType) +\n        indexOf.call(types, PREFIX_TAG + upperType)\n      )) {\n        throwTypeError(type);\n      }\n  \n      if (!validName.test(upperType) || -1 < indexOf.call(invalidNames, upperType)) {\n        throw new Error('The type ' + type + ' is invalid');\n      }\n  \n      var\n        constructor = function () {\n          return extending ?\n            document.createElement(nodeName, upperType) :\n            document.createElement(nodeName);\n        },\n        opt = options || OP,\n        extending = hOP.call(opt, EXTENDS),\n        nodeName = extending ? options[EXTENDS].toUpperCase() : upperType,\n        upperType,\n        i\n      ;\n  \n      if (extending && -1 < (\n        indexOf.call(types, PREFIX_TAG + nodeName)\n      )) {\n        throwTypeError(nodeName);\n      }\n  \n      i = types.push((extending ? PREFIX_IS : PREFIX_TAG) + upperType) - 1;\n  \n      query = query.concat(\n        query.length ? ',' : '',\n        extending ? nodeName + '[is=\"' + type.toLowerCase() + '\"]' : nodeName\n      );\n  \n      constructor.prototype = (\n        protos[i] = hOP.call(opt, 'prototype') ?\n          opt.prototype :\n          create(HTMLElementPrototype)\n      );\n  \n      loopAndVerify(\n        document.querySelectorAll(query),\n        ATTACHED\n      );\n  \n      return constructor;\n    };\n  \n    document.createElement = (patchedCreateElement = function (localName, typeExtension) {\n      var\n        is = getIs(typeExtension),\n        node = is ?\n          createElement.call(document, localName, secondArgument(is)) :\n          createElement.call(document, localName),\n        name = '' + localName,\n        i = indexOf.call(\n          types,\n          (is ? PREFIX_IS : PREFIX_TAG) +\n          (is || name).toUpperCase()\n        ),\n        setup = -1 < i\n      ;\n      if (is) {\n        node.setAttribute('is', is = is.toLowerCase());\n        if (setup) {\n          setup = isInQSA(name.toUpperCase(), is);\n        }\n      }\n      notFromInnerHTMLHelper = !document.createElement.innerHTMLHelper;\n      if (setup) patch(node, protos[i]);\n      return node;\n    });\n  \n  }\n  \n  function ASAP() {\n    var queue = asapQueue.splice(0, asapQueue.length);\n    asapTimer = 0;\n    while (queue.length) {\n      queue.shift().call(\n        null, queue.shift()\n      );\n    }\n  }\n  \n  function loopAndVerify(list, action) {\n    for (var i = 0, length = list.length; i < length; i++) {\n      verifyAndSetupAndAction(list[i], action);\n    }\n  }\n  \n  function loopAndSetup(list) {\n    for (var i = 0, length = list.length, node; i < length; i++) {\n      node = list[i];\n      patch(node, protos[getTypeIndex(node)]);\n    }\n  }\n  \n  function executeAction(action) {\n    return function (node) {\n      if (isValidNode(node)) {\n        verifyAndSetupAndAction(node, action);\n        loopAndVerify(\n          node.querySelectorAll(query),\n          action\n        );\n      }\n    };\n  }\n  \n  function getTypeIndex(target) {\n    var\n      is = getAttribute.call(target, 'is'),\n      nodeName = target.nodeName.toUpperCase(),\n      i = indexOf.call(\n        types,\n        is ?\n            PREFIX_IS + is.toUpperCase() :\n            PREFIX_TAG + nodeName\n      )\n    ;\n    return is && -1 < i && !isInQSA(nodeName, is) ? -1 : i;\n  }\n  \n  function isInQSA(name, type) {\n    return -1 < query.indexOf(name + '[is=\"' + type + '\"]');\n  }\n  \n  function onDOMAttrModified(e) {\n    var\n      node = e.currentTarget,\n      attrChange = e.attrChange,\n      attrName = e.attrName,\n      target = e.target,\n      addition = e[ADDITION] || 2,\n      removal = e[REMOVAL] || 3\n    ;\n    if (notFromInnerHTMLHelper &&\n        (!target || target === node) &&\n        node[ATTRIBUTE_CHANGED_CALLBACK] &&\n        attrName !== 'style' && (\n          e.prevValue !== e.newValue ||\n          // IE9, IE10, and Opera 12 gotcha\n          e.newValue === '' && (\n            attrChange === addition ||\n            attrChange === removal\n          )\n    )) {\n      node[ATTRIBUTE_CHANGED_CALLBACK](\n        attrName,\n        attrChange === addition ? null : e.prevValue,\n        attrChange === removal ? null : e.newValue\n      );\n    }\n  }\n  \n  function onDOMNode(action) {\n    var executor = executeAction(action);\n    return function (e) {\n      asapQueue.push(executor, e.target);\n      if (asapTimer) clearTimeout(asapTimer);\n      asapTimer = setTimeout(ASAP, 1);\n    };\n  }\n  \n  function onReadyStateChange(e) {\n    if (dropDomContentLoaded) {\n      dropDomContentLoaded = false;\n      e.currentTarget.removeEventListener(DOM_CONTENT_LOADED, onReadyStateChange);\n    }\n    loopAndVerify(\n      (e.target || document).querySelectorAll(query),\n      e.detail === DETACHED ? DETACHED : ATTACHED\n    );\n    if (IE8) purge();\n  }\n  \n  function patchedSetAttribute(name, value) {\n    // jshint validthis:true\n    var self = this;\n    setAttribute.call(self, name, value);\n    onSubtreeModified.call(self, {target: self});\n  }\n  \n  function setupNode(node, proto) {\n    setPrototype(node, proto);\n    if (observer) {\n      observer.observe(node, attributesObserver);\n    } else {\n      if (doesNotSupportDOMAttrModified) {\n        node.setAttribute = patchedSetAttribute;\n        node[EXPANDO_UID] = getAttributesMirror(node);\n        node[ADD_EVENT_LISTENER](DOM_SUBTREE_MODIFIED, onSubtreeModified);\n      }\n      node[ADD_EVENT_LISTENER](DOM_ATTR_MODIFIED, onDOMAttrModified);\n    }\n    if (node[CREATED_CALLBACK] && notFromInnerHTMLHelper) {\n      node.created = true;\n      node[CREATED_CALLBACK]();\n      node.created = false;\n    }\n  }\n  \n  function purge() {\n    for (var\n      node,\n      i = 0,\n      length = targets.length;\n      i < length; i++\n    ) {\n      node = targets[i];\n      if (!documentElement.contains(node)) {\n        length--;\n        targets.splice(i--, 1);\n        verifyAndSetupAndAction(node, DETACHED);\n      }\n    }\n  }\n  \n  function throwTypeError(type) {\n    throw new Error('A ' + type + ' type is already registered');\n  }\n  \n  function verifyAndSetupAndAction(node, action) {\n    var\n      fn,\n      i = getTypeIndex(node)\n    ;\n    if (-1 < i) {\n      patchIfNotAlready(node, protos[i]);\n      i = 0;\n      if (action === ATTACHED && !node[ATTACHED]) {\n        node[DETACHED] = false;\n        node[ATTACHED] = true;\n        i = 1;\n        if (IE8 && indexOf.call(targets, node) < 0) {\n          targets.push(node);\n        }\n      } else if (action === DETACHED && !node[DETACHED]) {\n        node[ATTACHED] = false;\n        node[DETACHED] = true;\n        i = 1;\n      }\n      if (i && (fn = node[action + CALLBACK])) fn.call(node);\n    }\n  }\n  \n  \n  \n  // V1 in da House!\n  function CustomElementRegistry() {}\n  \n  CustomElementRegistry.prototype = {\n    constructor: CustomElementRegistry,\n    // a workaround for the stubborn WebKit\n    define: usableCustomElements ?\n      function (name, Class, options) {\n        if (options) {\n          CERDefine(name, Class, options);\n        } else {\n          var NAME = name.toUpperCase();\n          constructors[NAME] = {\n            constructor: Class,\n            create: [NAME]\n          };\n          nodeNames.set(Class, NAME);\n          customElements.define(name, Class);\n        }\n      } :\n      CERDefine,\n    get: usableCustomElements ?\n      function (name) {\n        return customElements.get(name) || get(name);\n      } :\n      get,\n    whenDefined: usableCustomElements ?\n      function (name) {\n        return Promise.race([\n          customElements.whenDefined(name),\n          whenDefined(name)\n        ]);\n      } :\n      whenDefined\n  };\n  \n  function CERDefine(name, Class, options) {\n    var\n      is = options && options[EXTENDS] || '',\n      CProto = Class.prototype,\n      proto = create(CProto),\n      attributes = Class.observedAttributes || empty,\n      definition = {prototype: proto}\n    ;\n    // TODO: is this needed at all since it's inherited?\n    // defineProperty(proto, 'constructor', {value: Class});\n    safeProperty(proto, CREATED_CALLBACK, {\n        value: function () {\n          if (justCreated) justCreated = false;\n          else if (!this[DRECEV1]) {\n            this[DRECEV1] = true;\n            new Class(this);\n            if (CProto[CREATED_CALLBACK])\n              CProto[CREATED_CALLBACK].call(this);\n            var info = constructors[nodeNames.get(Class)];\n            if (!usableCustomElements || info.create.length > 1) {\n              notifyAttributes(this);\n            }\n          }\n      }\n    });\n    safeProperty(proto, ATTRIBUTE_CHANGED_CALLBACK, {\n      value: function (name) {\n        if (-1 < indexOf.call(attributes, name))\n          CProto[ATTRIBUTE_CHANGED_CALLBACK].apply(this, arguments);\n      }\n    });\n    if (CProto[CONNECTED_CALLBACK]) {\n      safeProperty(proto, ATTACHED_CALLBACK, {\n        value: CProto[CONNECTED_CALLBACK]\n      });\n    }\n    if (CProto[DISCONNECTED_CALLBACK]) {\n      safeProperty(proto, DETACHED_CALLBACK, {\n        value: CProto[DISCONNECTED_CALLBACK]\n      });\n    }\n    if (is) definition[EXTENDS] = is;\n    name = name.toUpperCase();\n    constructors[name] = {\n      constructor: Class,\n      create: is ? [is, secondArgument(name)] : [name]\n    };\n    nodeNames.set(Class, name);\n    document[REGISTER_ELEMENT](name.toLowerCase(), definition);\n    whenDefined(name);\n    waitingList[name].r();\n  }\n  \n  function get(name) {\n    var info = constructors[name.toUpperCase()];\n    return info && info.constructor;\n  }\n  \n  function getIs(options) {\n    return typeof options === 'string' ?\n        options : (options && options.is || '');\n  }\n  \n  function notifyAttributes(self) {\n    var\n      callback = self[ATTRIBUTE_CHANGED_CALLBACK],\n      attributes = callback ? self.attributes : empty,\n      i = attributes.length,\n      attribute\n    ;\n    while (i--) {\n      attribute =  attributes[i]; // || attributes.item(i);\n      callback.call(\n        self,\n        attribute.name || attribute.nodeName,\n        null,\n        attribute.value || attribute.nodeValue\n      );\n    }\n  }\n  \n  function whenDefined(name) {\n    name = name.toUpperCase();\n    if (!(name in waitingList)) {\n      waitingList[name] = {};\n      waitingList[name].p = new Promise(function (resolve) {\n        waitingList[name].r = resolve;\n      });\n    }\n    return waitingList[name].p;\n  }\n  \n  function polyfillV1() {\n    if (customElements) delete window.customElements;\n    defineProperty(window, 'customElements', {\n      configurable: true,\n      value: new CustomElementRegistry()\n    });\n    defineProperty(window, 'CustomElementRegistry', {\n      configurable: true,\n      value: CustomElementRegistry\n    });\n    for (var\n      patchClass = function (name) {\n        var Class = window[name];\n        if (Class) {\n          window[name] = function CustomElementsV1(self) {\n            var info, isNative;\n            if (!self) self = this;\n            if (!self[DRECEV1]) {\n              justCreated = true;\n              info = constructors[nodeNames.get(self.constructor)];\n              isNative = usableCustomElements && info.create.length === 1;\n              self = isNative ?\n                Reflect.construct(Class, empty, info.constructor) :\n                document.createElement.apply(document, info.create);\n              self[DRECEV1] = true;\n              justCreated = false;\n              if (!isNative) notifyAttributes(self);\n            }\n            return self;\n          };\n          window[name].prototype = Class.prototype;\n          try {\n            Class.prototype.constructor = window[name];\n          } catch(WebKit) {\n            fixGetClass = true;\n            defineProperty(Class, DRECEV1, {value: window[name]});\n          }\n        }\n      },\n      Classes = htmlClass.get(/^HTML[A-Z]*[a-z]/),\n      i = Classes.length;\n      i--;\n      patchClass(Classes[i])\n    ) {}\n    (document.createElement = function (name, options) {\n      var is = getIs(options);\n      return is ?\n        patchedCreateElement.call(this, name, secondArgument(is)) :\n        patchedCreateElement.call(this, name);\n    });\n  }\n  \n  // if customElements is not there at all\n  if (!customElements) polyfillV1();\n  else {\n    // if available test extends work as expected\n    try {\n      (function (DRE, options, name) {\n        options[EXTENDS] = 'a';\n        DRE.prototype = create(HTMLAnchorElement.prototype);\n        DRE.prototype.constructor = DRE;\n        window.customElements.define(name, DRE, options);\n        if (\n          getAttribute.call(document.createElement('a', {is: name}), 'is') !== name ||\n          (usableCustomElements && getAttribute.call(new DRE(), 'is') !== name)\n        ) {\n          throw options;\n        }\n      }(\n        function DRE() {\n          return Reflect.construct(HTMLAnchorElement, [], DRE);\n        },\n        {},\n        'document-register-element-a'\n      ));\n    } catch(o_O) {\n      // or force the polyfill if not\n      // and keep internal original reference\n      polyfillV1();\n    }\n  }\n  \n  try {\n    createElement.call(document, 'a', 'a');\n  } catch(FireFox) {\n    secondArgument = function (is) {\n      return {is: is};\n    };\n  }\n  \n}\n\ninstallCustomElements(global);\n\nmodule.exports = installCustomElements;\n","'use strict';\n\n/**\n * Constructs a ES6/Promises A+ Promise instance.\n *\n * @constructor\n * @param {function(function(*=), function (*=))} resolver\n */\nfunction Promise(resolver) {\n  if (!(this instanceof Promise)) {\n    throw new TypeError('Constructor Promise requires `new`');\n  }\n  if (!isFunction(resolver)) {\n    throw new TypeError('Must pass resolver function');\n  }\n\n  /**\n   * @param {function(this:Promise,*=,function(*=),function(*=),Deferred):!Promise} state\n   * @private\n   */\n  this._state = PendingPromise;\n\n  /**\n   * @type {*}\n   * @private\n   */\n  this._value = [];\n\n  /**\n   * @type {boolean}\n   * @private\n   */\n  this._isChainEnd = true;\n\n  doResolve(\n    this,\n    adopter(this, FulfilledPromise),\n    adopter(this, RejectedPromise),\n    { then: resolver }\n  );\n}\n\n/****************************\n  Public Instance Methods\n ****************************/\n\n/**\n * Creates a new promise instance that will receive the result of this promise\n * as inputs to the onFulfilled or onRejected callbacks.\n *\n * @param {function(*)} onFulfilled\n * @param {function(*)} onRejected\n */\nPromise.prototype.then = function(onFulfilled, onRejected) {\n  onFulfilled = isFunction(onFulfilled) ? onFulfilled : void 0;\n  onRejected = isFunction(onRejected) ? onRejected : void 0;\n\n  if (onFulfilled || onRejected) {\n    this._isChainEnd = false;\n  }\n\n  return this._state(\n    this._value,\n    onFulfilled,\n    onRejected\n  );\n};\n\n/**\n * Creates a new promise that will handle the rejected state of this promise.\n *\n * @param {function(*)} onRejected\n * @returns {!Promise}\n */\nPromise.prototype.catch = function(onRejected) {\n  return this.then(void 0, onRejected);\n};\n\n/****************************\n  Public Static Methods\n ****************************/\n\n/**\n * Creates a fulfilled Promise of value. If value is itself a then-able,\n * resolves with the then-able's value.\n *\n * @this {!Promise}\n * @param {*=} value\n * @returns {!Promise}\n */\nPromise.resolve = function(value) {\n  var Constructor = this;\n  var promise;\n\n  if (isObject(value) && value instanceof this) {\n    promise = value;\n  } else {\n    promise = new Constructor(function(resolve) {\n      resolve(value);\n    });\n  }\n\n  return /** @type {!Promise} */(promise);\n};\n\n/**\n * Creates a rejected Promise of reason.\n *\n * @this {!Promise}\n * @param {*=} reason\n * @returns {!Promise}\n */\nPromise.reject = function(reason) {\n  var Constructor = this;\n  var promise = new Constructor(function(_, reject) {\n    reject(reason);\n  });\n\n  return /** @type {!Promise} */(promise);\n};\n\n/**\n * Creates a Promise that will resolve with an array of the values of the\n * passed in promises. If any promise rejects, the returned promise will\n * reject.\n *\n * @this {!Promise}\n * @param {!Array<Promise|*>} promises\n * @returns {!Promise}\n */\nPromise.all = function(promises) {\n  var Constructor = this;\n  var promise = new Constructor(function(resolve, reject) {\n    var length = promises.length;\n    var values = new Array(length);\n\n    if (length === 0) {\n      return resolve(values);\n    }\n\n    each(promises, function(promise, index) {\n      Constructor.resolve(promise).then(function(value) {\n        values[index] = value;\n        if (--length === 0) {\n          resolve(values);\n        }\n      }, reject);\n    });\n  });\n\n  return /** @type {!Promise} */(promise);\n};\n\n/**\n * Creates a Promise that will resolve or reject based on the first\n * resolved or rejected promise.\n *\n * @this {!Promise}\n * @param {!Array<Promise|*>} promises\n * @returns {!Promise}\n */\nPromise.race = function(promises) {\n  var Constructor = this;\n  var promise = new Constructor(function(resolve, reject) {\n    for (var i = 0, l = promises.length; i < l; i++) {\n      Constructor.resolve(promises[i]).then(resolve, reject);\n    }\n  });\n\n  return /** @type {!Promise} */(promise);\n};\n\n/**\n * An internal use static function.\n */\nPromise._overrideUnhandledExceptionHandler = function(handler) {\n  onPossiblyUnhandledRejection = handler;\n};\n\n/****************************\n  Private functions\n ****************************/\n\n/**\n * The Fulfilled Promise state. Calls onFulfilled with the resolved value of\n * this promise, creating a new promise.\n *\n * If there is no onFulfilled, returns the current promise to avoid an promise\n * instance.\n *\n * @this {!Promise} The current promise\n * @param {*=} value The current promise's resolved value.\n * @param {function(*=)=} onFulfilled\n * @param {function(*=)=} unused\n * @param {Deferred} deferred A deferred object that holds a promise and its\n *     resolve and reject functions. It IS NOT passed when called from\n *     Promise#then to save an object instance (since we may return the current\n *     promise). It IS passed in when adopting the Fulfilled state from the\n *     Pending state.\n * @returns {!Promise}\n */\nfunction FulfilledPromise(value, onFulfilled, unused, deferred) {\n  if (!onFulfilled) { return this; }\n  if (!deferred) {\n    deferred = new Deferred(this.constructor);\n  }\n  defer(tryCatchDeferred(deferred, onFulfilled, value));\n  return deferred.promise;\n}\n\n/**\n * The Rejected Promise state. Calls onRejected with the resolved value of\n * this promise, creating a new promise.\n *\n * If there is no onRejected, returns the current promise to avoid an promise\n * instance.\n *\n * @this {!Promise} The current promise\n * @param {*=} reason The current promise's rejection reason.\n * @param {function(*=)=} unused\n * @param {function(*=)=} onRejected\n * @param {Deferred} deferred A deferred object that holds a promise and its\n *     resolve and reject functions. It IS NOT passed when called from\n *     Promise#then to save an object instance (since we may return the current\n *     promise). It IS passed in when adopting the Rejected state from the\n *     Pending state.\n * @returns {!Promise}\n */\nfunction RejectedPromise(reason, unused, onRejected, deferred) {\n  if (!onRejected) { return this; }\n  if (!deferred) {\n    deferred = new Deferred(this.constructor);\n  }\n  defer(tryCatchDeferred(deferred, onRejected, reason));\n  return deferred.promise;\n}\n\n/**\n * The Pending Promise state. Eventually calls onFulfilled once the promise has\n * resolved, or onRejected once the promise rejects.\n *\n * If there is no onFulfilled and no onRejected, returns the current promise to\n * avoid an promise instance.\n *\n * @this {!Promise} The current promise\n * @param {*=} queue The current promise's pending promises queue.\n * @param {function(*=)=} onFulfilled\n * @param {function(*=)=} onRejected\n * @param {Deferred} deferred A deferred object that holds a promise and its\n *     resolve and reject functions. It IS NOT passed when called from\n *     Promise#then to save an object instance (since we may return the current\n *     promise). It IS passed in when adopting the Pending state from the\n *     Pending state of another promise.\n * @returns {!Promise}\n */\nfunction PendingPromise(queue, onFulfilled, onRejected, deferred) {\n  if (!onFulfilled && !onRejected) { return this; }\n  if (!deferred) {\n    deferred = new Deferred(this.constructor);\n  }\n  queue.push({\n    deferred: deferred,\n    onFulfilled: onFulfilled || deferred.resolve,\n    onRejected: onRejected || deferred.reject\n  });\n  return deferred.promise;\n}\n\n/**\n * Constructs a deferred instance that holds a promise and its resolve and\n * reject functions.\n *\n * @constructor\n */\nfunction Deferred(Promise) {\n  var deferred = this;\n  /** @type {!Promise} */\n  this.promise = new Promise(function(resolve, reject) {\n    /** @type {function(*=)} */\n    deferred.resolve = resolve;\n\n    /** @type {function(*=)} */\n    deferred.reject = reject;\n  });\n  return deferred;\n}\n\n/**\n * Transitions the state of promise to another state. This is only ever called\n * on with a promise that is currently in the Pending state.\n *\n * @param {!Promise} promise\n * @param {function(this:Promise,*=,function(*=),function(*=),Deferred):!Promise} state\n * @param {*=} value\n */\nfunction adopt(promise, state, value) {\n  var queue = promise._value;\n  promise._state = state;\n  promise._value = value;\n\n  for (var i = 0; i < queue.length; i++) {\n    var next = queue[i];\n    promise._state(\n      value,\n      next.onFulfilled,\n      next.onRejected,\n      next.deferred\n    );\n  }\n\n  // Determine if this rejected promise will be \"handled\".\n  if (state === RejectedPromise && promise._isChainEnd) {\n    setTimeout(function() {\n      if (promise._isChainEnd) {\n        onPossiblyUnhandledRejection(value, promise);\n      }\n    }, 0);\n  }\n}\n/**\n * A partial application of adopt.\n *\n * @param {!Promise} promise\n * @param {function(this:Promise,*=,function(*=),function(*=),Deferred):!Promise} state\n * @returns {function(*=)}\n */\nfunction adopter(promise, state) {\n  return function(value) {\n    adopt(promise, state, value);\n  };\n}\n\n/**\n * A no-op function to prevent double resolving.\n */\nfunction noop() {}\n\n/**\n * Tests if fn is a Function\n *\n * @param {*} fn\n * @returns {boolean}\n */\nfunction isFunction(fn) {\n  return typeof fn === 'function';\n}\n\n/**\n * Tests if fn is an Object\n *\n * @param {*} obj\n * @returns {boolean}\n */\nfunction isObject(obj) {\n  return obj === Object(obj);\n}\n\nvar onPossiblyUnhandledRejection = function(reason, promise) {\n  throw reason;\n}\n\n/**\n * Iterates over each element of an array, calling the iterator with the\n * element and its index.\n *\n * @param {!Array} collection\n * @param {function(*=,number)} iterator\n */\nfunction each(collection, iterator) {\n  for (var i = 0; i < collection.length; i++) {\n    iterator(collection[i], i);\n  }\n}\n\n/**\n * Creates a function that will attempt to resolve the deferred with the return\n * of fn. If any error is raised, rejects instead.\n *\n * @param {!Deferred} deferred\n * @param {function(*=)} fn\n * @param {*} arg\n * @returns {function()}\n */\nfunction tryCatchDeferred(deferred, fn, arg) {\n  var promise = deferred.promise;\n  var resolve = deferred.resolve;\n  var reject = deferred.reject;\n  return function() {\n    try {\n      var result = fn(arg);\n      if (resolve === fn || reject === fn) {\n        return;\n      }\n      doResolve(promise, resolve, reject, result, result);\n    } catch (e) {\n      reject(e);\n    }\n  };\n}\n\n/**\n * Queues and executes multiple deferred functions on another run loop.\n */\nvar defer = (function() {\n  /**\n   * Defers fn to another run loop.\n   */\n  var scheduleFlush;\n  if (typeof window !== 'undefined' && window.postMessage) {\n    window.addEventListener('message', flush);\n    scheduleFlush = function() {\n      window.postMessage('macro-task', '*');\n    };\n  } else {\n    scheduleFlush = function() {\n      setTimeout(flush, 0);\n    };\n  }\n\n  var queue = new Array(16);\n  var length = 0;\n\n  function flush() {\n    for (var i = 0; i < length; i++) {\n      var fn = queue[i];\n      queue[i] = null;\n      fn();\n    }\n    length = 0;\n  }\n\n  /**\n   * @param {function()} fn\n   */\n  function defer(fn) {\n    if (length === 0) { scheduleFlush(); }\n    queue[length++] = fn;\n  };\n\n  return defer;\n})();\n\n/**\n * The Promise resolution procedure.\n * https://github.com/promises-aplus/promises-spec#the-promise-resolution-procedure\n *\n * @param {!Promise} promise\n * @param {function(*=)} resolve\n * @param {function(*=)} reject\n * @param {*} value\n * @param {*=} context\n */\nfunction doResolve(promise, resolve, reject, value, context) {\n  var _reject = reject;\n  var then;\n  var _resolve;\n  try {\n    if (value === promise) {\n      throw new TypeError('Cannot fulfill promise with itself');\n    }\n    var isObj = isObject(value);\n    if (isObj && value instanceof promise.constructor) {\n      adopt(promise, value._state, value._value);\n    } else if (isObj && (then = value.then) && isFunction(then)) {\n      _resolve = function(value) {\n        _resolve = _reject = noop;\n        doResolve(promise, resolve, reject, value, value);\n      };\n      _reject = function(reason) {\n        _resolve = _reject = noop;\n        reject(reason);\n      };\n      then.call(\n        context,\n        function(value) { _resolve(value); },\n        function(reason) { _reject(reason); }\n      );\n    } else {\n      resolve(value);\n    }\n  } catch (e) {\n    _reject(e);\n  }\n}\n\nmodule.exports = Promise;\n","/**\n * Copyright 2016 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {getExistingServiceForWindow} from './service';\n\n/**\n * Returns the global instance of the `AmpDocService` service that can be\n * used to resolve an ampdoc for any node: either in the single-doc or\n * shadow-doc environment.\n * @param {!Window} window\n * @return {!./service/ampdoc-impl.AmpDocService}\n */\nexport function ampdocServiceFor(window) {\n  return /** @type {!./service/ampdoc-impl.AmpDocService} */ (\n      getExistingServiceForWindow(window, 'ampdoc'));\n}\n","/**\n * Copyright 2015 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {Layout} from './layout';\nimport {loadPromise} from './event-helper';\nimport {preconnectForElement} from './preconnect';\nimport {isArray} from './types';\nimport {viewportForDoc} from './viewport';\nimport {vsyncFor} from './vsync';\nimport {user} from './log';\n\n\n/**\n * Base class for all custom element implementations. Instead of inheriting\n * from Element this class has an Element. Among other things this allows\n * switching the element implementation when going from a stub to the full\n * implementation.\n *\n * The base class implements a set of lifecycle methods that are called by\n * the runtime as appropriate. These are mostly based on the custom element\n * lifecycle (See\n * http://www.html5rocks.com/en/tutorials/webcomponents/customelements/)\n * and adding AMP style late loading to the mix.\n *\n * The complete lifecycle of custom DOM element is:\n *\n *           ||\n *           || createdCallback\n *           ||\n *           \\/\n *    State: <NOT BUILT> <NOT UPGRADED> <NOT ATTACHED>\n *           ||\n *           || upgrade\n *           ||\n *           \\/\n *    State: <NOT BUILT> <NOT ATTACHED>\n *           ||\n *           || firstAttachedCallback\n *           ||\n *           \\/\n *    State: <NOT BUILT>\n *           ||\n *           || buildCallback\n *           || !getPlaceholder() => createPlaceholderCallback\n *           || preconnectCallback may be called N times after this, but only\n *           || after the doc becomes visible.\n *           || pauseCallback may be called N times after this.\n *           || resumeCallback may be called N times after this.\n *           ||\n *           \\/\n *    State: <BUILT>\n *           ||\n *           || layoutCallback        <==\n *           || (firstLayoutCompleted)  ||\n *           ||                         ||\n *           \\/                         || isRelayoutNeeded?\n *    State: <LAID OUT>                 ||\n *           ||                         ||\n *           ||                 =========\n *           ||\n *           || viewportCallback\n *           || unlayoutCallback may be called N times after this.\n *           ||\n *           \\/\n *    State: <IN VIEWPORT>\n *\n * The preconnectCallback is called when the systems thinks it is good\n * to preconnect to hosts needed by an element. It will never be called\n * before buildCallback and it might be called multiple times including\n * after layoutCallback.\n *\n * The pauseCallback is called when when the document becomes inactive, e.g.\n * when the user swipes away from the document, or when the element is no\n * longer being displayed, e.g. when the carousel slide slides out of view.\n * In these situations, any actively playing media should pause.\n *\n * The resumeCallback is called when when the document becomes active again\n * after becoming inactive, e.g. when the user swipes away from the document\n * and swipes back. In these situations, any paused media may begin playing\n * again, if user interaction is not required.\n * TODO(jridgewell) slide slides into view\n *\n * The createPlaceholderCallback is called if AMP didn't detect a provided\n * placeholder for the element, subclasses can override this to build and\n * return a dynamically created placeholder that AMP would append to the\n * element.\n *\n * The unlayoutCallback is called when the document becomes inactive, e.g.\n * when the user swipes away from the document, or another tab is focused.\n * In these situations, expensive memory and CPU resources should be freed.\n *\n * Additionally whenever the dimensions of an element might have changed\n * AMP remeasures its dimensions and calls `onLayoutMeasure` on the\n * element instance. This can be used to do additional style calculations\n * without triggering style recalculations.\n *\n * For more details, see {@link custom-element.js}.\n *\n * Each method is called exactly once and overriding them in subclasses\n * is optional.\n */\nexport class BaseElement {\n  /** @param {!AmpElement} element */\n  constructor(element) {\n    /** @public @const {!Element} */\n    this.element = element;\n    /*\n    \\   \\  /  \\  /   / /   \\     |   _  \\     |  \\ |  | |  | |  \\ |  |  /  _____|\n     \\   \\/    \\/   / /  ^  \\    |  |_)  |    |   \\|  | |  | |   \\|  | |  |  __\n      \\            / /  /_\\  \\   |      /     |  . `  | |  | |  . `  | |  | |_ |\n       \\    /\\    / /  _____  \\  |  |\\  \\----.|  |\\   | |  | |  |\\   | |  |__| |\n        \\__/  \\__/ /__/     \\__\\ | _| `._____||__| \\__| |__| |__| \\__|  \\______|\n\n    Any private property for BaseElement should be declared in\n    build-system/amp.extern.js, this is so closure compiler doesn't reuse the\n    same symbol it would use in the core compilation unit for the private\n    property in the extensions compilation unit's private properties.\n     */\n\n    /** @package {!Layout} */\n    this.layout_ = Layout.NODISPLAY;\n\n    /** @package {number} */\n    this.layoutWidth_ = -1;\n\n    /** @package {boolean} */\n    this.inViewport_ = false;\n\n    /** @public @const {!Window} */\n    this.win = element.ownerDocument.defaultView;\n\n    /** @private {?Object<string, function(!./service/action-impl.ActionInvocation)>} */\n    this.actionMap_ = null;\n\n    /** @public {!./preconnect.Preconnect} */\n    this.preconnect = preconnectForElement(this.element);\n\n    /** @public {?Object} For use by sub classes */\n    this.config = null;\n  }\n\n  /**\n  * This is the priority of loading elements (layoutCallback).\n  * The lower the number, the higher the priority.\n  * The default priority for base elements is 0.\n  * @return {number}\n  */\n  getPriority() {\n    return 0;\n  }\n\n  /** @return {!Layout} */\n  getLayout() {\n    return this.layout_;\n  }\n\n  /**\n   * Returns a previously measured layout box of the element.\n   * @return {!./layout-rect.LayoutRectDef}\n   */\n  getLayoutBox() {\n    return this.element.getLayoutBox();\n  }\n\n  /**\n   * DO NOT CALL. Retained for backward compat during rollout.\n   * @public @return {!Window}\n   */\n  getWin() {\n    return this.win;\n  }\n\n  /**\n   * Returns the associated ampdoc. Only available when `buildCallback` and\n   * going forward. It throws an exception before `buildCallback`.\n   * @return {!./service/ampdoc-impl.AmpDoc}\n   */\n  getAmpDoc() {\n    return this.element.getAmpDoc();\n  }\n\n  /** @public @return {!./service/vsync-impl.Vsync} */\n  getVsync() {\n    return vsyncFor(this.win);\n  }\n\n  /**\n   * Returns the layout width for this element. A `-1` value indicates that the\n   * layout is not yet known. A `0` value indicates that the element is not\n   * visible.\n   * @return {number}\n   * @public\n   */\n  getLayoutWidth() {\n    return this.layoutWidth_;\n  }\n\n  /**\n   * Intended to be implemented by subclasses. Tests whether the element\n   * supports the specified layout. By default only Layout.NODISPLAY is\n   * supported.\n   * @param {!Layout} layout\n   * @return {boolean}\n   * @public\n   */\n  isLayoutSupported(layout) {\n    return layout == Layout.NODISPLAY;\n  }\n\n  /**\n   * Intended to be implemented by subclasses. Tests whether the element\n   * requires fixed positioning.\n   * @return {boolean}\n   * @public\n   */\n  isAlwaysFixed() {\n    return false;\n  }\n\n  /**\n   * @return {boolean}\n   */\n  isInViewport() {\n    return this.inViewport_;\n  }\n\n  /**\n   * This method is called when the element is added to DOM for the first time\n   * and before `buildCallback` to give the element a chance to redirect its\n   * implementation to another `BaseElement` implementation. The returned\n   * value can be either `null` or `undefined` to indicate that no redirection\n   * will take place; `BaseElement` instance to upgrade immediately; or a\n   * promise to upgrade with the resolved `BaseElement` instance.\n   *\n   * Notice that calls to `upgradeCallback` are not recursive. I.e. this\n   * callback will not be called on the returned instance again.\n   *\n   * @return {!BaseElement|!Promise<!BaseElement>|null}\n   */\n  upgradeCallback() {\n    // Subclasses may override.\n    return null;\n  }\n\n  /**\n   * Called when the element is first created. Note that for element created\n   * using createElement this may be before any children are added.\n   */\n  createdCallback() {\n    // Subclasses may override.\n  }\n\n  /**\n   * Override in subclass to adjust the element when it is being added to the\n   * DOM. Could e.g. be used to insert a fallback. Should not typically start\n   * loading a resource.\n   */\n  firstAttachedCallback() {\n    // Subclasses may override.\n  }\n\n  /**\n   * Override in subclass if the element needs to rebuilt its DOM content.\n   * Until the element has been rebuilt its content are not shown with an only\n   * exception of [placeholder] elements. From the moment the element is created\n   * and until the building phase is complete it will have \"amp-notbuilt\" CSS\n   * class set on it.\n   *\n   * This callback is executed early after the element has been attached to DOM.\n   */\n  buildCallback() {\n    // Subclasses may override.\n  }\n\n  /**\n   * Called by the framework to give the element a chance to preconnect to\n   * hosts and prefetch resources it is likely to need. May be called\n   * multiple times because connections can time out.\n   * @param {boolean=} opt_onLayout\n   */\n  preconnectCallback(opt_onLayout) {\n    // Subclasses may override.\n  }\n\n  /**\n   * Override in subclass to adjust the element when it is being removed from\n   * the DOM. Could e.g. be used to remove a listener.\n   */\n  detachedCallback() {\n    // Subclasses may override.\n  }\n\n  /**\n   * Sets this element as the owner of the specified element. By setting itself\n   * as an owner, the element declares that it will manage the lifecycle of\n   * the owned element itself. This element, as an owner, will have to call\n   * {@link scheduleLayout}, {@link schedulePreload}, {@link updateInViewport}\n   * and similar methods.\n   * @param {!Element} element\n   */\n  setAsOwner(element) {\n    this.element.getResources().setOwner(element, this.element);\n  }\n\n  /**\n   * Subclasses can override this method to opt-in into being called to\n   * prerender when document itself is not yet visible (pre-render mode).\n   * @return {boolean}\n   */\n  prerenderAllowed() {\n    return false;\n  }\n\n  /**\n   * Subclasses can override this method to create a dynamic placeholder\n   * element and return it to be appended to the element. This will only\n   * be called if the element doesn't already have a placeholder.\n   * @returns {?Element}\n   */\n  createPlaceholderCallback() {\n    return null;\n  }\n\n  /**\n   * Subclasses can override this method to opt-out of rendering the element\n   * when it is not currently visible.\n   * Returning a boolean allows or prevents rendering outside the viewport at\n   * any distance, while returning a positive number allows rendering only when\n   * the element is within X viewports of the current viewport. Returning a\n   * zero causes the element to only render inside the viewport.\n   * @return {boolean|number}\n   */\n  renderOutsideViewport() {\n    return 3;\n  }\n\n  /**\n   * Subclasses can override this method to opt-in into receiving additional\n   * {@link layoutCallback} calls. Note that this method is not consulted for\n   * the first layout given that each element must be laid out at least once.\n   * @return {boolean}\n   */\n  isRelayoutNeeded() {\n    return false;\n  }\n\n  /**\n   * Called when the element should perform layout. At this point the element\n   * should load/reload resources associated with it. This method is called\n   * by the runtime and cannot be called manually. Returns promise that will\n   * complete when loading is considered to be complete.\n   *\n   * The first layout call is always called. If the subclass is interested in\n   * receiving additional callbacks, it has to opt in to do so using\n   * {@link isRelayoutNeeded} method.\n   *\n   * @return {!Promise}\n   */\n  layoutCallback() {\n    return Promise.resolve();\n  }\n\n  /**\n   * Called to notify the element that the first layout has been successfully\n   * completed.\n   *\n   * The default behavior of this method is to hide the placeholder. However,\n   * a subclass may choose to hide placeholder earlier or not hide it at all.\n   *\n   * @public\n   */\n  firstLayoutCompleted() {\n    this.togglePlaceholder(false);\n  }\n\n  /**\n   * Instructs the resource that it has either entered or exited the visible\n   * viewport. Intended to be implemented by actual components.\n   * @param {boolean} unusedInViewport\n   */\n  viewportCallback(unusedInViewport) {\n  }\n\n  /**\n   * Requests the element to stop its activity when the document goes into\n   * inactive state. The scope is up to the actual component. Among other\n   * things the active playback of video or audio content must be stopped.\n   */\n  pauseCallback() {\n  }\n\n  /**\n   * Requests the element to resume its activity when the document returns from\n   * an inactive state. The scope is up to the actual component. Among other\n   * things the active playback of video or audio content may be resumed.\n   */\n  resumeCallback() {\n  }\n\n  /**\n   * Requests the element to unload any expensive resources when the element\n   * goes into non-visible state. The scope is up to the actual component.\n   * The component must return `true` if it'd like to later receive\n   * {@link layoutCallback} in case document becomes active again.\n   *\n   * @return {boolean}\n   */\n  unlayoutCallback() {\n    return false;\n  }\n\n  /**\n   * Subclasses can override this method to opt-in into calling\n   * {@link unlayoutCallback} when paused.\n   * @return {boolean}\n   */\n  unlayoutOnPause() {\n    return false;\n  }\n\n  /**\n   * Instructs the element that its activation is requested based on some\n   * user event. Intended to be implemented by actual components.\n   * @param {!./service/action-impl.ActionInvocation} unusedInvocation\n   */\n  activate(unusedInvocation) {\n  }\n\n  /**\n   * Returns a promise that will resolve or fail based on the element's 'load'\n   * and 'error' events. Optionally this method takes a timeout, which will reject\n   * the promise if the resource has not loaded by then.\n   * @param {T} element\n   * @param {number=} opt_timeout\n   * @return {!Promise<T>}\n   * @template T\n   * @final\n   */\n  loadPromise(element, opt_timeout) {\n    return loadPromise(element, opt_timeout);\n  }\n\n  initActionMap_() {\n    if (!this.actionMap_) {\n      this.actionMap_ = this.win.Object.create(null);\n    }\n  }\n\n  /**\n   * Registers the action handler for the method with the specified name.\n   * @param {string} method\n   * @param {function(!./service/action-impl.ActionInvocation)} handler\n   * @public\n   */\n  registerAction(method, handler) {\n    this.initActionMap_();\n    this.actionMap_[method] = handler;\n  }\n\n  /**\n   * Requests the element to execute the specified method. If method must have\n   * been previously registered using {@link registerAction}, otherwise an\n   * error is thrown.\n   * @param {!./service/action-impl.ActionInvocation} invocation The invocation data.\n   * @param {boolean} unusedDeferred Whether the invocation has had to wait any time\n   *   for the element to be resolved, upgraded and built.\n   * @final\n   * @package\n   */\n  executeAction(invocation, unusedDeferred) {\n    if (invocation.method == 'activate') {\n      this.activate(invocation);\n    } else {\n      this.initActionMap_();\n      const handler = this.actionMap_[invocation.method];\n      user().assert(handler, `Method not found: ${invocation.method} in %s`,\n          this);\n      handler(invocation);\n    }\n  }\n\n  /**\n   * Returns the maximum DPR available on this device.\n   * @return {number}\n   */\n  getMaxDpr() {\n    return this.element.getResources().getMaxDpr();\n  }\n\n  /**\n   * Returns the most optimal DPR currently recommended.\n   * @return {number}\n   */\n  getDpr() {\n    return this.element.getResources().getDpr();\n  }\n\n  /**\n   * Utility method that propagates attributes from this element\n   * to the given element.\n   * @param  {string|!Array<string>} attributes\n   * @param  {!Element} element\n   * @public @final\n   */\n  propagateAttributes(attributes, element) {\n    attributes = isArray(attributes) ? attributes : [attributes];\n    for (let i = 0; i < attributes.length; i++) {\n      const attr = attributes[i];\n      if (!this.element.hasAttribute(attr)) {\n        continue;\n      }\n      element.setAttribute(attr, this.element.getAttribute(attr));\n    }\n  }\n\n  /**\n   * Utility method that forwards the given list of non-bubbling events\n   * from the given element to this element as custom events with the same name.\n   * @param  {string|!Array<string>} events\n   * @param  {!Element} element\n   * @public @final\n   */\n  forwardEvents(events, element) {\n    events = isArray(events) ? events : [events];\n    for (let i = 0; i < events.length; i++) {\n      element.addEventListener(events[i], event => {\n        this.element.dispatchCustomEvent(events[i], event.data || {});\n      });\n    }\n  }\n\n  /**\n   * Returns an optional placeholder element for this custom element.\n   * @return {?Element}\n   * @public @final\n   */\n  getPlaceholder() {\n    return this.element.getPlaceholder();\n  }\n\n  /**\n   * Hides or shows the placeholder, if available.\n   * @param {boolean} state\n   * @public @final\n   */\n  togglePlaceholder(state) {\n    this.element.togglePlaceholder(state);\n  }\n\n  /**\n   * Returns an optional fallback element for this custom element.\n   * @return {?Element}\n   * @public @final\n   */\n  getFallback() {\n    return this.element.getFallback();\n  }\n\n  /**\n   * Hides or shows the fallback, if available. This function must only\n   * be called inside a mutate context.\n   * @param {boolean} state\n   * @public @final\n   */\n  toggleFallback(state) {\n    this.element.toggleFallback(state);\n  }\n\n  /**\n   * Returns an optional overflow element for this custom element.\n   * @return {?Element}\n   * @public @final\n   */\n  getOverflowElement() {\n    return this.element.getOverflowElement();\n  }\n\n  /**\n   * Returns the original nodes of the custom element without any service nodes\n   * that could have been added for markup. These nodes can include Text,\n   * Comment and other child nodes.\n   * @return {!Array<!Node>}\n   * @public @final\n   */\n  getRealChildNodes() {\n    return this.element.getRealChildNodes();\n  }\n\n  /**\n   * Returns the original children of the custom element without any service\n   * nodes that could have been added for markup.\n   * @return {!Array<!Element>}\n   * @public @final\n   */\n  getRealChildren() {\n    return this.element.getRealChildren();\n  }\n\n  /**\n   * Configures the supplied element to have a \"fill content\" layout. The\n   * exact interpretation of \"fill content\" depends on the element's layout.\n   *\n   * If `opt_replacedContent` is specified, it indicates whether the \"replaced\n   * content\" styling should be applied. Replaced content is not allowed to\n   * have its own paddings or border.\n   *\n   * @param {!Element} element\n   * @param {boolean=} opt_replacedContent\n   * @public @final\n   */\n  applyFillContent(element, opt_replacedContent) {\n    element.classList.add('-amp-fill-content');\n    if (opt_replacedContent) {\n      element.classList.add('-amp-replaced-content');\n    }\n  }\n\n  /**\n   * Returns the viewport within which the element operates.\n   * @return {!./service/viewport-impl.Viewport}\n   */\n  getViewport() {\n    return viewportForDoc(this.getAmpDoc());\n  }\n\n  /**\n   * Returns the layout rectangle of the element used for reporting this\n   * element's intersection with the viewport.\n   * @return {!./layout-rect.LayoutRectDef}\n   */\n  getIntersectionElementLayoutBox() {\n    return this.getLayoutBox();\n  }\n\n  /**\n   * Schedule the layout request for the children element or elements\n   * specified. Resource manager will perform the actual layout based on the\n   * priority of this element and its children.\n   * @param {!Element|!Array<!Element>} elements\n   * @public\n   */\n  scheduleLayout(elements) {\n    this.element.getResources().scheduleLayout(this.element, elements);\n  }\n\n  /**\n   * @param {!Element|!Array<!Element>} elements\n   * @public\n   */\n  schedulePause(elements) {\n    this.element.getResources().schedulePause(this.element, elements);\n  }\n\n  /**\n   * @param {!Element|!Array<!Element>} elements\n   * @public\n   */\n  scheduleResume(elements) {\n    this.element.getResources().scheduleResume(this.element, elements);\n  }\n\n  /**\n   * Schedule the preload request for the children element or elements\n   * specified. Resource manager will perform the actual preload based on the\n   * priority of this element and its children.\n   * @param {!Element|!Array<!Element>} elements\n   * @public\n   */\n  schedulePreload(elements) {\n    this.element.getResources().schedulePreload(this.element, elements);\n  }\n\n  /**\n   * @param {!Element|!Array<!Element>} elements\n   * @public\n   */\n  scheduleUnlayout(elements) {\n    this.element.getResources()./*OK*/scheduleUnlayout(this.element, elements);\n  }\n\n  /**\n   * Update inViewport state of the specified children element or elements.\n   * Resource manager will perform the actual changes to the inViewport state\n   * based on the state of these elements and their parent subtree.\n   * @param {!Element|!Array<!Element>} elements\n   * @param {boolean} inLocalViewport\n   * @public\n   */\n  updateInViewport(elements, inLocalViewport) {\n    this.element.getResources().updateInViewport(\n        this.element, elements, inLocalViewport);\n  }\n\n  /**\n   * Requests the runtime to update the height of this element to the specified\n   * value. The runtime will schedule this request and attempt to process it\n   * as soon as possible.\n   * @param {number} newHeight\n   * @public\n   */\n  changeHeight(newHeight) {\n    this.element.getResources()./*OK*/changeSize(\n        this.element, newHeight, /* newWidth */ undefined);\n  }\n\n  /**\n   * Return a promise that requests the runtime to update\n   * the height of this element to the specified value.\n   * The runtime will schedule this request and attempt to process it\n   * as soon as possible. However, unlike in {@link changeHeight}, the runtime\n   * may refuse to make a change in which case it will show the element's\n   * overflow element if provided, which is supposed to provide the reader with\n   * the necessary user action. (The overflow element is shown only if the\n   * requested height is greater than 0.)\n   * The promise is resolved if the height is successfully updated.\n   * @param {number} newHeight\n   * @return {!Promise}\n   * @public\n   */\n  attemptChangeHeight(newHeight) {\n    return this.element.getResources().attemptChangeSize(\n        this.element, newHeight, /* newWidth */ undefined);\n  }\n\n /**\n  * Return a promise that requests the runtime to update\n  * the size of this element to the specified value.\n  * The runtime will schedule this request and attempt to process it\n  * as soon as possible. However, unlike in {@link changeSize}, the runtime\n  * may refuse to make a change in which case it will show the element's\n  * overflow element if provided, which is supposed to provide the reader with\n  * the necessary user action. (The overflow element is shown only if the\n  * requested height is greater than 0.)\n  * The promise is resolved if the height is successfully updated.\n  * @param {number|undefined} newHeight\n  * @param {number|undefined} newWidth\n  * @return {!Promise}\n  * @public\n  */\n  attemptChangeSize(newHeight, newWidth) {\n    return this.element.getResources().attemptChangeSize(\n        this.element, newHeight, newWidth);\n  }\n\n /**\n  * Runs the specified mutation on the element and ensures that measures\n  * and layouts performed for the affected elements.\n  *\n  * This method should be called whenever a significant mutations are done\n  * on the DOM that could affect layout of elements inside this subtree or\n  * its siblings. The top-most affected element should be specified as the\n  * first argument to this method and all the mutation work should be done\n  * in the mutator callback which is called in the \"mutation\" vsync phase.\n  *\n  * @param {function()} mutator\n  * @param {Element=} opt_element\n  * @return {!Promise}\n  */\n  mutateElement(mutator, opt_element) {\n    return this.element.getResources().mutateElement(\n        opt_element || this.element, mutator);\n  }\n\n  /**\n   * Schedules callback to be complete within the next batch. This call is\n   * intended for heavy DOM mutations that typically cause re-layouts.\n   * @param {!Function} callback\n   */\n  deferMutate(callback) {\n    this.element.getResources().deferMutate(this.element, callback);\n  }\n\n  /**\n   * Collapses the element, setting it to `display: none`, and notifies its\n   * owner (if there is one) through {@link collapsedCallback} that the element\n   * is no longer visible.\n   */\n  collapse() {\n    this.element.getResources().collapseElement(this.element);\n  }\n\n  /**\n   * Called every time an owned AmpElement collapses itself.\n   * See {@link collapse}.\n   * @param {!AmpElement} unusedElement\n   */\n  collapsedCallback(unusedElement) {\n    // Subclasses may override.\n  }\n\n  /**\n   * Called when we just measured the layout rect of this element. Doing\n   * more expensive style reads should now be cheap.\n   * This may currently not work with extended elements. Please file\n   * an issue if that is required.\n   * @public\n   */\n  onLayoutMeasure() {}\n};\n","/**\n * Copyright 2016 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * Allows for runtime configuration. Internally, the runtime should\n * use the src/config.js module for various constants. We can use the\n * AMP_CONFIG global to translate user-defined configurations to this\n * module.\n * @type {!Object<string, string>}\n */\nconst env = self.AMP_CONFIG || {};\n\nconst thirdPartyFrameRegex = typeof env['thirdPartyFrameRegex'] == 'string' ?\n    new RegExp(env['thirdPartyFrameRegex']) : env['thirdPartyFrameRegex'];\n\n/** @type {!Object<string, string|boolean|RegExp>} */\nexport const urls = {\n  thirdParty: env['thirdPartyUrl'] || 'https://3p.ampproject.net',\n  thirdPartyFrameHost: env['thirdPartyFrameHost'] || 'ampproject.net',\n  thirdPartyFrameRegex: thirdPartyFrameRegex || /^d-\\d+\\.ampproject\\.net$/,\n  cdn: env['cdnUrl'] || 'https://cdn.ampproject.org',\n  cdnProxyRegex: /^https:\\/\\/([a-zA-Z0-9_-]+\\.)?cdn\\.ampproject\\.org/,\n  localhostRegex: /^https?:\\/\\/localhost(:\\d+)?$/,\n  errorReporting: env['errorReportingUrl'] ||\n      'https://amp-error-reporting.appspot.com/r',\n  localDev: env['localDev'] || false,\n};\n","/**\n * Copyright 2015 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n\n/**\n * Returns the value of the cookie. The cookie access is restricted and must\n * go through the privacy review. Before using this method please file a\n * GitHub issue with \"Privacy Review\" label.\n *\n * Returns the cookie's value or `null`.\n *\n * @param {!Window} win\n * @param {string} name\n * @return {?string}\n */\nexport function getCookie(win, name) {\n  const cookieString = tryGetDocumentCookieNoInline(win);\n  if (!cookieString) {\n    return null;\n  }\n  const cookies = cookieString.split(';');\n  for (let i = 0; i < cookies.length; i++) {\n    const cookie = cookies[i].trim();\n    const eq = cookie.indexOf('=');\n    if (eq == -1) {\n      continue;\n    }\n    if (decodeURIComponent(cookie.substring(0, eq).trim()) == name) {\n      return decodeURIComponent(cookie.substring(eq + 1).trim());\n    }\n  }\n  return null;\n}\n\n/**\n * This method should not be inlined to prevent TryCatch deoptimization.\n * NoInline keyword at the end of function name also prevents Closure compiler\n * from inlining the function.\n * @private\n */\nfunction tryGetDocumentCookieNoInline(win) {\n  try {\n    return win.document.cookie;\n  } catch (e) {\n    // Act as if no cookie is available. Exceptions can be thrown when\n    // AMP docs are opened on origins that do not allow setting\n    // cookies such as null origins.\n  }\n}\n\n/**\n * Sets the value of the cookie. The cookie access is restricted and must\n * go through the privacy review. Before using this method please file a\n * GitHub issue with \"Privacy Review\" label.\n *\n * @param {!Window} win\n * @param {string} name\n * @param {string} value\n * @param {time} expirationTime\n * @param {{highestAvailableDomain:boolean}=} opt_options\n *     - highestAvailableDomain: If true, set the cookie at the widest domain\n *       scope allowed by the browser. E.g. on example.com if we are currently\n *       on www.example.com.\n */\nexport function setCookie(win, name, value, expirationTime, opt_options) {\n  if (opt_options && opt_options.highestAvailableDomain) {\n    const parts = win.location.hostname.split('.');\n    let domain = parts[parts.length - 1];\n    for (let i = parts.length - 2; i >= 0; i--) {\n      domain = parts[i] + '.' + domain;\n      trySetCookie(win, name, value, expirationTime, domain);\n      if (getCookie(win, name) == value) {\n        return;\n      }\n    }\n  }\n  trySetCookie(win, name, value, expirationTime, undefined);\n}\n\n/**\n * Attempt to set a cookie with the given params.\n *\n * @param {!Window} win\n * @param {string} name\n * @param {string} value\n * @param {time} expirationTime\n * @param {string|undefined} domain\n */\nfunction trySetCookie(win, name, value, expirationTime, domain) {\n  // We do not allow setting cookies on the domain that contains both\n  // the cdn. and www. hosts.\n  if (domain == 'ampproject.org') {\n    // Actively delete them.\n    value = 'delete';\n    expirationTime = 0;\n  }\n  const cookie = encodeURIComponent(name) + '=' +\n      encodeURIComponent(value) +\n      '; path=/' +\n      (domain ? '; domain=' + domain : '') +\n      '; expires=' + new Date(expirationTime).toUTCString();\n  try {\n    win.document.cookie = cookie;\n  } catch (ignore) {\n    // Do not throw if setting the cookie failed Exceptions can be thrown\n    // when AMP docs are opened on origins that do not allow setting\n    // cookies such as null origins.\n  };\n}\n","/**\n * Copyright 2015 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {Layout, getLayoutClass, getLengthNumeral, getLengthUnits,\n    isInternalElement, isLayoutSizeDefined, isLoadingAllowed,\n    parseLayout, parseLength, getNaturalDimensions,\n    hasNaturalDimensions} from './layout';\nimport {ElementStub, stubbedElements} from './element-stub';\nimport {ampdocServiceFor} from './ampdoc';\nimport {createLoaderElement} from '../src/loader';\nimport {dev, rethrowAsync, user} from './log';\nimport {documentStateFor} from './document-state';\nimport {\n  getIntersectionChangeEntry,\n} from '../src/intersection-observer-polyfill';\nimport {getMode} from './mode';\nimport {parseSizeList} from './size-list';\nimport {reportError} from './error';\nimport {resourcesForDoc} from './resources';\nimport {timerFor} from './timer';\nimport {vsyncFor} from './vsync';\nimport * as dom from './dom';\nimport {setStyle, setStyles} from './style';\n\n\nconst TAG_ = 'CustomElement';\n\n/**\n * This is the minimum width of the element needed to trigger `loading`\n * animation. This value is justified as about 1/3 of a smallish mobile\n * device viewport. Trying to put a loading indicator into a small element\n * is meaningless.\n * @private @const {number}\n */\nconst MIN_WIDTH_FOR_LOADING_ = 100;\n\n\n/**\n * The elements positioned ahead of this threshold may have their loading\n * indicator initialized faster. This is benefitial to avoid relayout during\n * render phase or scrolling.\n * @private @const {number}\n */\nconst PREPARE_LOADING_THRESHOLD_ = 1000;\n\n\n/**\n * Map from element name to implementation class.\n * @const {Object}\n */\nconst knownElements = {};\n\n\n/**\n * Caches whether the template tag is supported to avoid memory allocations.\n * @type {boolean|undefined}\n */\nlet templateTagSupported;\n\n/**\n * Whether this platform supports template tags.\n * @return {boolean}\n */\nfunction isTemplateTagSupported() {\n  if (templateTagSupported === undefined) {\n    const template = self.document.createElement('template');\n    templateTagSupported = 'content' in template;\n  }\n  return templateTagSupported;\n}\n\n\n/**\n * @enum {number}\n */\nconst UpgradeState = {\n  NOT_UPGRADED: 1,\n  UPGRADED: 2,\n  UPGRADE_FAILED: 3,\n  UPGRADE_IN_PROGRESS: 4,\n};\n\n\n/**\n * Registers an element. Upgrades it if has previously been stubbed.\n * @param {!Window} win\n * @param {string} name\n * @param {function(!Function)} toClass\n */\nexport function upgradeOrRegisterElement(win, name, toClass) {\n  if (!knownElements[name]) {\n    registerElement(win, name, /** @type {!Function} */ (toClass));\n    return;\n  }\n  user().assert(knownElements[name] == ElementStub,\n      '%s is already registered. The script tag for ' +\n      '%s is likely included twice in the page.', name, name);\n  knownElements[name] = toClass;\n  for (let i = 0; i < stubbedElements.length; i++) {\n    const stub = stubbedElements[i];\n    // There are 3 possible states here:\n    // 1. We never made the stub because the extended impl. loaded first.\n    //    In that case the element won't be in the array.\n    // 2. We made a stub but the browser didn't attach it yet. In\n    //    that case we don't need to upgrade but simply switch to the new\n    //    implementation.\n    // 3. A stub was attached. We upgrade which means we replay the\n    //    implementation.\n    const element = stub.element;\n    if (element.tagName.toLowerCase() == name) {\n      tryUpgradeElementNoInline(element, toClass);\n      // Remove element from array.\n      stubbedElements.splice(i--, 1);\n    }\n  }\n}\n\n/**\n * This method should not be inlined to prevent TryCatch deoptimization.\n * NoInline keyword at the end of function name also prevents Closure compiler\n * from inlining the function.\n * @private\n */\nfunction tryUpgradeElementNoInline(element, toClass) {\n  try {\n    element.upgrade(toClass);\n  } catch (e) {\n    reportError(e, element);\n  }\n}\n\n/**\n * Stub extended elements missing an implementation.\n * @param {!Window} win\n */\nexport function stubElements(win) {\n  if (!win.ampExtendedElements) {\n    win.ampExtendedElements = {};\n    // If amp-ad and amp-embed haven't been registered, manually register them\n    // with ElementStub, in case the script to the element is not included.\n    if (!knownElements['amp-ad'] && !knownElements['amp-embed']) {\n      stubLegacyElements(win);\n    }\n  }\n  const list = win.document.querySelectorAll('[custom-element]');\n  for (let i = 0; i < list.length; i++) {\n    const name = list[i].getAttribute('custom-element');\n    win.ampExtendedElements[name] = true;\n    if (knownElements[name]) {\n      continue;\n    }\n    registerElement(win, name, ElementStub);\n  }\n  // Repeat stubbing when HEAD is complete.\n  if (!win.document.body) {\n    const docState = documentStateFor(win);\n    docState.onBodyAvailable(() => stubElements(win));\n  }\n}\n\n/**\n * @param {!Window} win\n */\nfunction stubLegacyElements(win) {\n  win.ampExtendedElements['amp-ad'] = true;\n  registerElement(win, 'amp-ad', ElementStub);\n  win.ampExtendedElements['amp-embed'] = true;\n  registerElement(win, 'amp-embed', ElementStub);\n}\n\n/**\n * Stub element if not yet known.\n * @param {!Window} win\n * @param {string} name\n */\nexport function stubElementIfNotKnown(win, name) {\n  if (knownElements[name]) {\n    return;\n  }\n  if (!win.ampExtendedElements) {\n    win.ampExtendedElements = {};\n  }\n  win.ampExtendedElements[name] = true;\n  registerElement(win, name, ElementStub);\n}\n\n/**\n * Copies the specified element to child window (friendly iframe). This way\n * all implementations of the AMP elements are shared between all friendly\n * frames.\n * @param {!Window} childWin\n * @param {string} name\n */\nexport function copyElementToChildWindow(childWin, name) {\n  if (!childWin.ampExtendedElements) {\n    childWin.ampExtendedElements = {};\n    stubLegacyElements(childWin);\n  }\n  childWin.ampExtendedElements[name] = true;\n  registerElement(childWin, name, knownElements[name] || ElementStub);\n}\n\n\n/**\n * Applies layout to the element. Visible for testing only.\n * @param {!Element} element\n */\nexport function applyLayout_(element) {\n  const layoutAttr = element.getAttribute('layout');\n  const widthAttr = element.getAttribute('width');\n  const heightAttr = element.getAttribute('height');\n  const sizesAttr = element.getAttribute('sizes');\n  const heightsAttr = element.getAttribute('heights');\n\n  // Input layout attributes.\n  const inputLayout = layoutAttr ? parseLayout(layoutAttr) : null;\n  user().assert(inputLayout !== undefined, 'Unknown layout: %s', layoutAttr);\n  const inputWidth = (widthAttr && widthAttr != 'auto') ?\n      parseLength(widthAttr) : widthAttr;\n  user().assert(inputWidth !== undefined, 'Invalid width value: %s', widthAttr);\n  const inputHeight = heightAttr ? parseLength(heightAttr) : null;\n  user().assert(inputHeight !== undefined, 'Invalid height value: %s',\n      heightAttr);\n\n  // Effective layout attributes. These are effectively constants.\n  let width;\n  let height;\n  let layout;\n\n  // Calculate effective width and height.\n  if ((!inputLayout || inputLayout == Layout.FIXED ||\n      inputLayout == Layout.FIXED_HEIGHT) &&\n      (!inputWidth || !inputHeight) && hasNaturalDimensions(element.tagName)) {\n    // Default width and height: handle elements that do not specify a\n    // width/height and are defined to have natural browser dimensions.\n    const dimensions = getNaturalDimensions(element);\n    width = (inputWidth || inputLayout == Layout.FIXED_HEIGHT) ? inputWidth :\n        dimensions.width;\n    height = inputHeight || dimensions.height;\n  } else {\n    width = inputWidth;\n    height = inputHeight;\n  }\n\n  // Calculate effective layout.\n  if (inputLayout) {\n    layout = inputLayout;\n  } else if (!width && !height) {\n    layout = Layout.CONTAINER;\n  } else if (height && (!width || width == 'auto')) {\n    layout = Layout.FIXED_HEIGHT;\n  } else if (height && width && (sizesAttr || heightsAttr)) {\n    layout = Layout.RESPONSIVE;\n  } else {\n    layout = Layout.FIXED;\n  }\n\n  // Verify layout attributes.\n  if (layout == Layout.FIXED || layout == Layout.FIXED_HEIGHT ||\n      layout == Layout.RESPONSIVE) {\n    user().assert(height, 'Expected height to be available: %s', heightAttr);\n  }\n  if (layout == Layout.FIXED_HEIGHT) {\n    user().assert(!width || width == 'auto',\n        'Expected width to be either absent or equal \"auto\" ' +\n        'for fixed-height layout: %s', widthAttr);\n  }\n  if (layout == Layout.FIXED || layout == Layout.RESPONSIVE) {\n    user().assert(width && width != 'auto',\n        'Expected width to be available and not equal to \"auto\": %s',\n        widthAttr);\n  }\n  if (layout == Layout.RESPONSIVE) {\n    user().assert(getLengthUnits(width) == getLengthUnits(height),\n        'Length units should be the same for width and height: %s, %s',\n        widthAttr, heightAttr);\n  } else {\n    user().assert(heightsAttr === null,\n        'Unexpected \"heights\" attribute for none-responsive layout');\n  }\n\n  // Apply UI.\n  element.classList.add(getLayoutClass(layout));\n  if (isLayoutSizeDefined(layout)) {\n    element.classList.add('-amp-layout-size-defined');\n  }\n  if (layout == Layout.NODISPLAY) {\n    setStyle(element, 'display', 'none');\n  } else if (layout == Layout.FIXED) {\n    setStyles(element, {\n      width: dev().assertString(width),\n      height: dev().assertString(height),\n    });\n  } else if (layout == Layout.FIXED_HEIGHT) {\n    setStyle(element, 'height', dev().assertString(height));\n  } else if (layout == Layout.RESPONSIVE) {\n    const sizer = element.ownerDocument.createElement('i-amp-sizer');\n    setStyles(sizer, {\n      display: 'block',\n      paddingTop:\n        ((getLengthNumeral(height) / getLengthNumeral(width)) * 100) + '%',\n    });\n    element.insertBefore(sizer, element.firstChild);\n    element.sizerElement_ = sizer;\n  } else if (layout == Layout.FILL) {\n    // Do nothing.\n  } else if (layout == Layout.CONTAINER) {\n    // Do nothing. Elements themselves will check whether the supplied\n    // layout value is acceptable. In particular container is only OK\n    // sometimes.\n  } else if (layout == Layout.FLEX_ITEM) {\n    // Set height and width to a flex item if they exist.\n    // The size set to a flex item could be overridden by `display: flex` later.\n    if (width) {\n      setStyle(element, 'width', width);\n    }\n    if (height) {\n      setStyle(element, 'height', height);\n    }\n  }\n  return layout;\n}\n\n\n/**\n * Returns \"true\" for internal AMP nodes or for placeholder elements.\n * @param {!Node} node\n * @return {boolean}\n */\nfunction isInternalOrServiceNode(node) {\n  if (isInternalElement(node)) {\n    return true;\n  }\n  if (node.tagName && (node.hasAttribute('placeholder') ||\n      node.hasAttribute('fallback') ||\n      node.hasAttribute('overflow'))) {\n    return true;\n  }\n  return false;\n}\n\n/**\n * Creates a new custom element class prototype.\n *\n * Visible for testing only.\n *\n * @param {!Window} win The window in which to register the custom element.\n * @param {string} name The name of the custom element.\n * @param {function(new:./base-element.BaseElement, !Element)=} opt_implementationClass For\n *     testing only.\n * @return {!Object} Prototype of element.\n */\nexport function createAmpElementProto(win, name, opt_implementationClass) {\n  const ElementProto = createCustomElementClass(win, name).prototype;\n  if (getMode().test && opt_implementationClass) {\n    ElementProto.implementationClassForTesting = opt_implementationClass;\n  }\n  return ElementProto;\n}\n\n/**\n * Creates a named custom element class.\n *\n * @param {!Window} win The window in which to register the custom element.\n * @param {string} name The name of the custom element.\n * @return {!Function} The custom element class.\n */\nfunction createCustomElementClass(win, name) {\n  const baseCustomElement = createBaseCustomElementClass(win);\n  /** @extends {HTMLElement} */\n  class CustomAmpElement extends baseCustomElement {\n    /**\n     * @see https://github.com/WebReflection/document-register-element#v1-caveat\n     */\n    constructor(self) {\n      return super(self);\n    }\n    elementName() {\n      return name;\n    }\n  }\n  return CustomAmpElement;\n}\n\n/**\n * Creates a base custom element class.\n *\n * @param {!Window} win The window in which to register the custom element.\n * @return {!Function}\n */\nfunction createBaseCustomElementClass(win) {\n  if (win.BaseCustomElementClass) {\n    return win.BaseCustomElementClass;\n  }\n  const htmlElement = win.HTMLElement;\n  /** @abstract @extends {HTMLElement} */\n  class BaseCustomElement extends htmlElement {\n    /**\n     * @see https://github.com/WebReflection/document-register-element#v1-caveat\n     * @suppress {checkTypes}\n     */\n    constructor(self) {\n      self = super(self);\n      self.createdCallback();\n      return self;\n    }\n\n    /**\n     * Called when elements is created. Sets instance vars since there is no\n     * constructor.\n     * @final @this {!Element}\n     */\n    createdCallback() {\n      // Flag \"notbuilt\" is removed by Resource manager when the resource is\n      // considered to be built. See \"setBuilt\" method.\n      /** @private {boolean} */\n      this.built_ = false;\n\n      /** @type {string} */\n      this.readyState = 'loading';\n\n      /** @type {boolean} */\n      this.everAttached = false;\n\n      /**\n       * Ampdoc can only be looked up when an element is attached.\n       * @private {?./service/ampdoc-impl.AmpDoc}\n       */\n      this.ampdoc_ = null;\n\n      /**\n       * Resources can only be looked up when an element is attached.\n       * @private {?./service/resources-impl.Resources}\n       */\n      this.resources_ = null;\n\n      /** @private {!Layout} */\n      this.layout_ = Layout.NODISPLAY;\n\n      /** @private {number} */\n      this.layoutWidth_ = -1;\n\n      /** @private {number} */\n      this.layoutCount_ = 0;\n\n      /** @private {boolean} */\n      this.isFirstLayoutCompleted_ = false;\n\n      /** @private {boolean} */\n      this.isInViewport_ = false;\n\n      /** @private {string|null|undefined} */\n      this.mediaQuery_ = undefined;\n\n      /** @private {!./size-list.SizeList|null|undefined} */\n      this.sizeList_ = undefined;\n\n      /** @private {!./size-list.SizeList|null|undefined} */\n      this.heightsList_ = undefined;\n\n      /**\n       * This element can be assigned by the {@link applyLayout_} to a child\n       * element that will be used to size this element.\n       * @private {?Element}\n       */\n      this.sizerElement_ = null;\n\n      /** @private {boolean|undefined} */\n      this.loadingDisabled_ = undefined;\n\n      /** @private {boolean|undefined} */\n      this.loadingState_ = undefined;\n\n      /** @private {?Element} */\n      this.loadingContainer_ = null;\n\n      /** @private {?Element} */\n      this.loadingElement_ = null;\n\n      /** @private {?Element|undefined} */\n      this.overflowElement_ = undefined;\n\n      // `opt_implementationClass` is only used for tests.\n      let Ctor = knownElements[this.elementName()];\n      if (getMode().test && this.implementationClassForTesting) {\n        Ctor = this.implementationClassForTesting;\n      }\n      /** @private {!./base-element.BaseElement} */\n      this.implementation_ = new Ctor(this);\n\n      /**\n       * An element always starts in a unupgraded state until it's added to DOM\n       * for the first time in which case it can be upgraded immediately or wait\n       * for script download or `upgradeCallback`.\n       * @private {!UpgradeState}\n       */\n      this.upgradeState_ = UpgradeState.NOT_UPGRADED;\n\n      /**\n       * Action queue is initially created and kept around until the element\n       * is ready to send actions directly to the implementation.\n       * @private {?Array<!./service/action-impl.ActionInvocation>}\n       */\n      this.actionQueue_ = [];\n\n      /**\n       * Whether the element is in the template.\n       * @private {boolean|undefined}\n       */\n      this.isInTemplate_ = undefined;\n    }\n\n    /**\n     * The name of the custom element.\n     * @abstract\n     * @return {string}\n     */\n    elementName() {\n    }\n\n    /**\n     * Returns the associated ampdoc. Only available after attachment. It throws\n     * exception before the element is attached.\n     * @return {!./service/ampdoc-impl.AmpDoc}\n     * @final @this {!Element}\n     * @package\n     */\n    getAmpDoc() {\n      return /** @type {!./service/ampdoc-impl.AmpDoc} */ (\n        dev().assert(this.ampdoc_,\n          'no ampdoc yet, since element is not attached'));\n    }\n\n    /**\n     * Returns Resources manager. Only available after attachment. It throws\n     * exception before the element is attached.\n     * @return {!./service/resources-impl.Resources}\n     * @final @this {!Element}\n     * @package\n     */\n    getResources() {\n      return /** @type {!./service/resources-impl.Resources} */ (\n        dev().assert(this.resources_,\n          'no resources yet, since element is not attached'));\n    }\n\n    /**\n     * Whether the element has been upgraded yet. Always returns false when\n     * the element has not yet been added to DOM. After the element has been\n     * added to DOM, the value depends on the `BaseElement` implementation and\n     * its `upgradeElement` callback.\n     * @return {boolean}\n     * @final @this {!Element}\n     */\n    isUpgraded() {\n      return this.upgradeState_ == UpgradeState.UPGRADED;\n    }\n\n    /**\n     * Upgrades the element to the provided new implementation. If element\n     * has already been attached, it's layout validation and attachment flows\n     * are repeated for the new implementation.\n     * @param {function(new:./base-element.BaseElement, !Element)} newImplClass\n     * @final @package @this {!Element}\n     */\n    upgrade(newImplClass) {\n      if (this.isInTemplate_) {\n        return;\n      }\n      if (this.upgradeState_ != UpgradeState.NOT_UPGRADED) {\n        // Already upgraded or in progress or failed.\n        return;\n      }\n      this.implementation_ = new newImplClass(this);\n      if (this.everAttached) {\n        this.tryUpgrade_();\n      }\n    }\n\n    /**\n     * Completes the upgrade of the element with the provided implementation.\n     * @param {!./base-element.BaseElement} newImpl\n     * @final @private @this {!Element}\n     */\n    completeUpgrade_(newImpl) {\n      this.upgradeState_ = UpgradeState.UPGRADED;\n      this.implementation_ = newImpl;\n      this.classList.remove('amp-unresolved');\n      this.classList.remove('-amp-unresolved');\n      this.implementation_.createdCallback();\n      if (this.layout_ != Layout.NODISPLAY &&\n        !this.implementation_.isLayoutSupported(this.layout_)) {\n        throw user().createError('Layout not supported: ' + this.layout_);\n      }\n      this.implementation_.layout_ = this.layout_;\n      this.implementation_.layoutWidth_ = this.layoutWidth_;\n      if (this.everAttached) {\n        this.implementation_.firstAttachedCallback();\n        this.dispatchCustomEventForTesting('amp:attached');\n        // For a never-added resource, the build will be done automatically\n        // via `resources.add` on the first attach.\n        this.getResources().upgraded(this);\n      }\n    }\n\n    /**\n     * Whether the element has been built. A built element had its\n     * {@link buildCallback} method successfully invoked.\n     * @return {boolean}\n     * @final @this {!Element}\n     */\n    isBuilt() {\n      return this.built_;\n    }\n\n    /**\n     * Get the priority to load the element.\n     * @return {number} @this {!Element}\n     */\n    getPriority() {\n      dev().assert(\n        this.isUpgraded(), 'Cannot get priority of unupgraded element');\n      return this.implementation_.getPriority();\n    }\n\n    /**\n     * Requests or requires the element to be built. The build is done by\n     * invoking {@link BaseElement.buildCallback} method.\n     *\n     * This method can only be called on a upgraded element.\n     *\n     * @final @this {!Element}\n     */\n    build() {\n      assertNotTemplate(this);\n      if (this.isBuilt()) {\n        return;\n      }\n      dev().assert(this.isUpgraded(), 'Cannot build unupgraded element');\n      try {\n        this.implementation_.buildCallback();\n        this.preconnect(/* onLayout */false);\n        this.built_ = true;\n        this.classList.remove('-amp-notbuilt');\n        this.classList.remove('amp-notbuilt');\n      } catch (e) {\n        reportError(e, this);\n        throw e;\n      }\n      if (this.built_ && this.isInViewport_) {\n        this.updateInViewport_(true);\n      }\n      if (this.actionQueue_) {\n        if (this.actionQueue_.length > 0) {\n          // Only schedule when the queue is not empty, which should be\n          // the case 99% of the time.\n          timerFor(this.ownerDocument.defaultView)\n            .delay(this.dequeueActions_.bind(this), 1);\n        } else {\n          this.actionQueue_ = null;\n        }\n      }\n      if (!this.getPlaceholder()) {\n        const placeholder = this.createPlaceholder();\n        if (placeholder) {\n          this.appendChild(placeholder);\n        }\n      }\n    }\n\n    /**\n     * Called to instruct the element to preconnect to hosts it uses during\n     * layout.\n     * @param {boolean} onLayout Whether this was called after a layout.\n     * @this {!Element}\n     */\n    preconnect(onLayout) {\n      if (onLayout) {\n        this.implementation_.preconnectCallback(onLayout);\n      } else {\n        // If we do early preconnects we delay them a bit. This is kind of\n        // an unfortunate trade off, but it seems faster, because the DOM\n        // operations themselves are not free and might delay\n        timerFor(this.ownerDocument.defaultView).delay(() => {\n          this.implementation_.preconnectCallback(onLayout);\n        }, 1);\n      }\n    }\n\n    /**\n     * Whether the custom element declares that it has to be fixed.\n     * @return {boolean}\n     * @this {!Element}\n     */\n    isAlwaysFixed() {\n      return this.implementation_.isAlwaysFixed();\n    }\n\n    /**\n     * Updates the layout box of the element.\n     * See {@link BaseElement.getLayoutWidth} for details.\n     * @param {!./layout-rect.LayoutRectDef} layoutBox\n     * @this {!Element}\n     */\n    updateLayoutBox(layoutBox) {\n      this.layoutWidth_ = layoutBox.width;\n      if (this.isUpgraded()) {\n        this.implementation_.layoutWidth_ = this.layoutWidth_;\n      }\n      // TODO(malteubl): Forward for stubbed elements.\n      // TODO(jridgewell): We should pass the layoutBox down.\n      this.implementation_.onLayoutMeasure();\n\n      if (this.isLoadingEnabled_()) {\n        if (this.isInViewport_) {\n          // Already in viewport - start showing loading.\n          this.toggleLoading_(true);\n        } else if (layoutBox.top < PREPARE_LOADING_THRESHOLD_ &&\n          layoutBox.top >= 0) {\n          // Few top elements will also be pre-initialized with a loading\n          // element.\n          getVsync(this).mutate(() => {\n            // Repeat \"loading enabled\" check because it could have changed while\n            // waiting for vsync.\n            if (this.isLoadingEnabled_()) {\n              this.prepareLoading_();\n            }\n          });\n        }\n      }\n    }\n\n    /**\n     * If the element has a media attribute, evaluates the value as a media\n     * query and based on the result adds or removes the class\n     * `-amp-hidden-by-media-query`. The class adds display:none to the element\n     * which in turn prevents any of the resource loading to happen for the\n     * element.\n     *\n     * This method is called by Resources and shouldn't be called by anyone else.\n     *\n     * @final\n     * @package @this {!Element}\n     */\n    applySizesAndMediaQuery() {\n      assertNotTemplate(this);\n\n      // Media query.\n      if (this.mediaQuery_ === undefined) {\n        this.mediaQuery_ = this.getAttribute('media') || null;\n      }\n      if (this.mediaQuery_) {\n        const defaultView = this.ownerDocument.defaultView;\n        this.classList.toggle('-amp-hidden-by-media-query',\n            !defaultView.matchMedia(this.mediaQuery_).matches);\n      }\n\n      // Sizes.\n      if (this.sizeList_ === undefined) {\n        const sizesAttr = this.getAttribute('sizes');\n        this.sizeList_ = sizesAttr ? parseSizeList(sizesAttr) : null;\n      }\n      if (this.sizeList_) {\n        setStyle(this, 'width', this.sizeList_.select(\n            this.ownerDocument.defaultView));\n      }\n      // Heights.\n      if (this.heightsList_ === undefined) {\n        const heightsAttr = this.getAttribute('heights');\n        this.heightsList_ = heightsAttr ?\n          parseSizeList(heightsAttr, /* allowPercent */ true) : null;\n      }\n\n      if (this.heightsList_ && this.layout_ ===\n        Layout.RESPONSIVE && this.sizerElement_) {\n        setStyle(this.sizerElement_, 'paddingTop', this.heightsList_.select(\n            this.ownerDocument.defaultView));\n      }\n    }\n\n    /**\n     * Changes the size of the element.\n     *\n     * This method is called by Resources and shouldn't be called by anyone else.\n     * This method must always be called in the mutation context.\n     *\n     * @param {number|undefined} newHeight\n     * @param {number|undefined} newWidth\n     * @final\n     * @package @this {!Element}\n     */\n    changeSize(newHeight, newWidth) {\n      if (this.sizerElement_) {\n        // From the moment height is changed the element becomes fully\n        // responsible for managing its height. Aspect ratio is no longer\n        // preserved.\n        const sizer = this.sizerElement_;\n        this.sizerElement_ = null;\n        setStyle(sizer, 'paddingTop', '0');\n        if (this.resources_) {\n          this.resources_.deferMutate(this, () => {\n            dom.removeElement(sizer);\n          });\n        }\n      }\n      if (newHeight !== undefined) {\n        setStyle(this, 'height', newHeight, 'px');\n      }\n      if (newWidth !== undefined) {\n        setStyle(this, 'width', newWidth, 'px');\n      }\n    }\n\n    /**\n     * Called when the element is first connected to the DOM. Calls\n     * {@link firstAttachedCallback} if this is the first attachment.\n     * @final @this {!Element}\n     */\n    connectedCallback() {\n      if (!this.everAttached) {\n        this.classList.add('-amp-element');\n        this.classList.add('-amp-notbuilt');\n        this.classList.add('amp-notbuilt');\n      }\n\n      if (!isTemplateTagSupported() && this.isInTemplate_ === undefined) {\n        this.isInTemplate_ = !!dom.closestByTag(this, 'template');\n      }\n      if (this.isInTemplate_) {\n        return;\n      }\n      if (!this.ampdoc_) {\n        // Ampdoc can now be initialized.\n        const ampdocService = ampdocServiceFor(this.ownerDocument.defaultView);\n        this.ampdoc_ = ampdocService.getAmpDoc(this);\n      }\n      if (!this.resources_) {\n        // Resources can now be initialized since the ampdoc is now available.\n        this.resources_ = resourcesForDoc(this.ampdoc_);\n      }\n      if (!this.everAttached) {\n        if (!isStub(this.implementation_)) {\n          this.tryUpgrade_();\n        }\n        if (!this.isUpgraded()) {\n          this.classList.add('amp-unresolved');\n          this.classList.add('-amp-unresolved');\n        }\n        try {\n          this.layout_ = applyLayout_(this);\n          if (this.layout_ != Layout.NODISPLAY &&\n            !this.implementation_.isLayoutSupported(this.layout_)) {\n            throw user().createError('Layout not supported: ' +\n                this.layout_);\n          }\n          this.implementation_.layout_ = this.layout_;\n          this.implementation_.firstAttachedCallback();\n          if (!this.isUpgraded()) {\n            // amp:attached is dispatched from the ElementStub class when it\n            // replayed the firstAttachedCallback call.\n            this.dispatchCustomEventForTesting('amp:stubbed');\n          } else {\n            this.dispatchCustomEventForTesting('amp:attached');\n          }\n        } catch (e) {\n          reportError(e, this);\n        }\n\n        // It's important to have this flag set in the end to avoid\n        // `resources.add` called twice if upgrade happens immediately.\n        this.everAttached = true;\n      }\n      this.getResources().add(this);\n    }\n\n    /** The Custom Elements V0 sibling to `connectedCallback`. */\n    attachedCallback() {\n      this.connectedCallback();\n    }\n\n    /**\n     * Try to upgrade the element with the provided implementation.\n     * @private @final @this {!Element}\n     */\n    tryUpgrade_() {\n      const impl = this.implementation_;\n      dev().assert(!isStub(impl), 'Implementation must not be a stub');\n      if (this.upgradeState_ != UpgradeState.NOT_UPGRADED) {\n        // Already upgraded or in progress or failed.\n        return;\n      }\n\n      // The `upgradeCallback` only allows redirect once for the top-level\n      // non-stub class. We may allow nested upgrades later, but they will\n      // certainly be bad for performance.\n      this.upgradeState_ = UpgradeState.UPGRADE_IN_PROGRESS;\n      const res = impl.upgradeCallback();\n      if (!res) {\n        // Nothing returned: the current object is the upgraded version.\n        this.completeUpgrade_(impl);\n      } else if (typeof res.then == 'function') {\n        // It's a promise: wait until it's done.\n        res.then(impl => this.completeUpgrade_(impl)).catch(reason => {\n          this.upgradeState_ = UpgradeState.UPGRADE_FAILED;\n          rethrowAsync(reason);\n        });\n      } else {\n        // It's an actual instance: upgrade immediately.\n        this.completeUpgrade_(/** @type {!./base-element.BaseElement} */(res));\n      }\n    }\n\n    /**\n     * Called when the element is disconnected from the DOM.\n     * @final @this {!Element}\n     */\n    disconnectedCallback() {\n      if (this.isInTemplate_) {\n        return;\n      }\n      this.getResources().remove(this);\n      this.implementation_.detachedCallback();\n    }\n\n    /** The Custom Elements V0 sibling to `disconnectedCallback`. */\n    detachedCallback() {\n      this.disconnectedCallback();\n    }\n\n    /**\n     * Dispatches a custom event.\n     *\n     * @param {string} name\n     * @param {!Object=} opt_data Event data.\n     * @final @this {!Element}\n     */\n    dispatchCustomEvent(name, opt_data) {\n      const data = opt_data || {};\n      // Constructors of events need to come from the correct window. Sigh.\n      const win = this.ownerDocument.defaultView;\n      const event = win.document.createEvent('Event');\n      event.data = data;\n      event.initEvent(name, true, true);\n      this.dispatchEvent(event);\n    }\n\n    /**\n     * Dispatches a custom event only in testing environment.\n     *\n     * @param {string} name\n     * @param {!Object=} opt_data Event data.\n     * @final @this {!Element}\n     */\n    dispatchCustomEventForTesting(name, opt_data) {\n      if (!getMode().test) {\n        return;\n      }\n      this.dispatchCustomEvent(name, opt_data);\n    }\n\n    /**\n     * Whether the element can pre-render.\n     * @return {boolean}\n     * @final @this {!Element}\n     */\n    prerenderAllowed() {\n      return this.implementation_.prerenderAllowed();\n    }\n\n    /**\n     * Creates a placeholder for the element.\n     * @returns {?Element}\n     * @final @this {!Element}\n     */\n    createPlaceholder() {\n      return this.implementation_.createPlaceholderCallback();\n    }\n\n    /**\n     * Whether the element should ever render when it is not in viewport.\n     * @return {boolean|number}\n     * @final @this {!Element}\n     */\n    renderOutsideViewport() {\n      return this.implementation_.renderOutsideViewport();\n    }\n\n    /**\n     * @return {!./layout-rect.LayoutRectDef}\n     * @final @this {!Element}\n     */\n    getLayoutBox() {\n      return this.getResources().getResourceForElement(this).getLayoutBox();\n    }\n\n    /**\n     * @return {?Element}\n     * @final @this {!Element}\n     */\n    getOwner() {\n      return this.getResources().getResourceForElement(this).getOwner();\n    }\n\n    /**\n     * Returns a change entry for that should be compatible with\n     * IntersectionObserverEntry.\n     * @return {!IntersectionObserverEntry} A change entry.\n     * @final @this {!Element}\n     */\n    getIntersectionChangeEntry() {\n      const box = this.implementation_.getIntersectionElementLayoutBox();\n      const owner = this.getResources().getResourceForElement(this).getOwner();\n      const viewportBox = this.implementation_.getViewport().getRect();\n      // TODO(jridgewell, #4826): We may need to make this recursive.\n      const ownerBox = owner && owner.getLayoutBox();\n      return getIntersectionChangeEntry(box, ownerBox, viewportBox);\n    }\n\n    /**\n     * Returns the resource ID of the element.\n     * @return {number}\n     */\n    getResourceId() {\n      return this.getResources().getResourceForElement(this).getId();\n    }\n\n    /**\n     * The runtime calls this method to determine if {@link layoutCallback}\n     * should be called again when layout changes.\n     * @return {boolean}\n     * @package @final @this {!Element}\n     */\n    isRelayoutNeeded() {\n      return this.implementation_.isRelayoutNeeded();\n    }\n\n    /**\n     * Instructs the element to layout its content and load its resources if\n     * necessary by calling the {@link BaseElement.layoutCallback} method that\n     * should be implemented by BaseElement subclasses. Must return a promise\n     * that will yield when the layout and associated loadings are complete.\n     *\n     * This method is always called for the first layout, but for subsequent\n     * layouts the runtime consults {@link isRelayoutNeeded} method.\n     *\n     * Can only be called on a upgraded and built element.\n     *\n     * @return {!Promise}\n     * @package @final @this {!Element}\n     */\n    layoutCallback() {\n      assertNotTemplate(this);\n      dev().assert(this.isBuilt(),\n        'Must be built to receive viewport events');\n      this.dispatchCustomEventForTesting('amp:load:start');\n      const promise = this.implementation_.layoutCallback();\n      this.preconnect(/* onLayout */true);\n      this.classList.add('-amp-layout');\n      return promise.then(() => {\n        this.readyState = 'complete';\n        this.layoutCount_++;\n        this.toggleLoading_(false, /* cleanup */ true);\n        // Check if this is the first success layout that needs\n        // to call firstLayoutCompleted.\n        if (!this.isFirstLayoutCompleted_) {\n          this.implementation_.firstLayoutCompleted();\n          this.isFirstLayoutCompleted_ = true;\n          this.dispatchCustomEvent('amp:load:end');\n        }\n      }, reason => {\n        // add layoutCount_ by 1 despite load fails or not\n        this.layoutCount_++;\n        this.toggleLoading_(false, /* cleanup */ true);\n        throw reason;\n      });\n    }\n\n    /**\n     * Instructs the resource that it entered or exited the visible viewport.\n     *\n     * Can only be called on a upgraded and built element.\n     *\n     * @param {boolean} inViewport Whether the element has entered or exited\n     *   the visible viewport.\n     * @final @package @this {!Element}\n     */\n    viewportCallback(inViewport) {\n      assertNotTemplate(this);\n      this.isInViewport_ = inViewport;\n      if (this.layoutCount_ == 0) {\n        if (!inViewport) {\n          this.toggleLoading_(false);\n        } else {\n          // Set a minimum delay in case the element loads very fast or if it\n          // leaves the viewport.\n          timerFor(this.ownerDocument.defaultView).delay(() => {\n            if (this.layoutCount_ == 0 && this.isInViewport_) {\n              this.toggleLoading_(true);\n            }\n          }, 100);\n        }\n      }\n      if (this.isBuilt()) {\n        this.updateInViewport_(inViewport);\n      }\n    }\n\n    /**\n     * @param {boolean} inViewport\n     * @private @this {!Element}\n     */\n    updateInViewport_(inViewport) {\n      this.implementation_.inViewport_ = inViewport;\n      this.implementation_.viewportCallback(inViewport);\n    }\n\n    /**\n     * Requests the resource to stop its activity when the document goes into\n     * inactive state. The scope is up to the actual component. Among other\n     * things the active playback of video or audio content must be stopped.\n     *\n     * @package @final @this {!Element}\n     */\n    pauseCallback() {\n      assertNotTemplate(this);\n      if (!this.isBuilt()) {\n        return;\n      }\n      this.implementation_.pauseCallback();\n    }\n\n    /**\n     * Requests the resource to resume its activity when the document returns from\n     * an inactive state. The scope is up to the actual component. Among other\n     * things the active playback of video or audio content may be resumed.\n     *\n     * @package @final @this {!Element}\n     */\n    resumeCallback() {\n      assertNotTemplate(this);\n      if (!this.isBuilt()) {\n        return;\n      }\n      this.implementation_.resumeCallback();\n    }\n\n    /**\n     * Requests the element to unload any expensive resources when the element\n     * goes into non-visible state. The scope is up to the actual component.\n     *\n     * Calling this method on unbuilt ot unupgraded element has no effect.\n     *\n     * @return {boolean}\n     * @package @final @this {!Element}\n     */\n    unlayoutCallback() {\n      assertNotTemplate(this);\n      if (!this.isBuilt()) {\n        return false;\n      }\n      const isReLayoutNeeded = this.implementation_.unlayoutCallback();\n      if (isReLayoutNeeded) {\n        this.layoutCount_ = 0;\n        this.isFirstLayoutCompleted_ = false;\n      }\n      return isReLayoutNeeded;\n    }\n\n    /**\n     * Whether to call {@link unlayoutCallback} when pausing the element.\n     * Certain elements cannot properly pause (like amp-iframes with unknown\n     * video content), and so we must unlayout to stop playback.\n     *\n     * @return {boolean}\n     * @package @final @this {!Element}\n     */\n    unlayoutOnPause() {\n      return this.implementation_.unlayoutOnPause();\n    }\n\n    /**\n     * Collapses the element, and notifies its owner (if there is one) that the\n     * element is no longer present.\n     * @suppress {missingProperties}\n     */\n    collapse() {\n      this.implementation_./*OK*/collapse();\n    }\n\n    /**\n     * Called every time an owned AmpElement collapses itself.\n     * @param {!AmpElement} element\n     * @suppress {missingProperties}\n     */\n    collapsedCallback(element) {\n      this.implementation_.collapsedCallback(element);\n    }\n\n    /**\n     * Enqueues the action with the element. If element has been upgraded and\n     * built, the action is dispatched to the implementation right away.\n     * Otherwise the invocation is enqueued until the implementation is ready\n     * to receive actions.\n     * @param {!./service/action-impl.ActionInvocation} invocation\n     * @final @this {!Element}\n     */\n    enqueAction(invocation) {\n      assertNotTemplate(this);\n      if (!this.isBuilt()) {\n        dev().assert(this.actionQueue_).push(invocation);\n      } else {\n        this.executionAction_(invocation, false);\n      }\n    }\n\n    /**\n     * Dequeues events from the queue and dispatches them to the implementation\n     * with \"deferred\" flag.\n     * @private @this {!Element}\n     */\n    dequeueActions_() {\n      if (!this.actionQueue_) {\n        return;\n      }\n\n      const actionQueue = dev().assert(this.actionQueue_);\n      this.actionQueue_ = null;\n\n      // TODO(dvoytenko, #1260): dedupe actions.\n      actionQueue.forEach(invocation => {\n        this.executionAction_(invocation, true);\n      });\n    }\n\n    /**\n     * Executes the action immediately. All errors are consumed and reported.\n     * @param {!./service/action-impl.ActionInvocation} invocation\n     * @param {boolean} deferred\n     * @final\n     * @private @this {!Element}\n     */\n    executionAction_(invocation, deferred) {\n      try {\n        this.implementation_.executeAction(invocation, deferred);\n      } catch (e) {\n        rethrowAsync('Action execution failed:', e,\n          invocation.target.tagName, invocation.method);\n      }\n    }\n\n    /**\n     * Returns the original nodes of the custom element without any service nodes\n     * that could have been added for markup. These nodes can include Text,\n     * Comment and other child nodes.\n     * @return {!Array<!Node>}\n     * @package @final @this {!Element}\n     */\n    getRealChildNodes() {\n      return dom.childNodes(this, node => !isInternalOrServiceNode(node));\n    }\n\n    /**\n     * Returns the original children of the custom element without any service\n     * nodes that could have been added for markup.\n     * @return {!Array<!Element>}\n     * @package @final @this {!Element}\n     */\n    getRealChildren() {\n      return dom.childElements(this, element =>\n        !isInternalOrServiceNode(element));\n    }\n\n    /**\n     * Returns an optional placeholder element for this custom element.\n     * @return {?Element}\n     * @package @final @this {!Element}\n     */\n    getPlaceholder() {\n      return dom.lastChildElement(this, el => {\n        return el.hasAttribute('placeholder') &&\n          // Blacklist elements that has a native placeholder property\n          // like input and textarea. These are not allowed to be AMP\n          // placeholders.\n          !('placeholder' in el);\n      });\n    }\n\n    /**\n     * Hides or shows the placeholder, if available.\n     * @param {boolean} show\n     * @package @final @this {!Element}\n     */\n    togglePlaceholder(show) {\n      assertNotTemplate(this);\n      if (show) {\n        const placeholder = this.getPlaceholder();\n        if (placeholder) {\n          placeholder.classList.remove('amp-hidden');\n        }\n      } else {\n        const placeholders = dom.childElementsByAttr(this, 'placeholder');\n        for (let i = 0; i < placeholders.length; i++) {\n          placeholders[i].classList.add('amp-hidden');\n        }\n      }\n    }\n\n    /**\n     * Returns an optional fallback element for this custom element.\n     * @return {?Element}\n     * @package @final @this {!Element}\n     */\n    getFallback() {\n      return dom.childElementByAttr(this, 'fallback');\n    }\n\n    /**\n     * Hides or shows the fallback, if available. This function must only\n     * be called inside a mutate context.\n     * @param {boolean} state\n     * @package @final @this {!Element}\n     */\n    toggleFallback(state) {\n      assertNotTemplate(this);\n      // This implementation is notably less efficient then placeholder toggling.\n      // The reasons for this are: (a) \"not supported\" is the state of the whole\n      // element, (b) some realyout is expected and (c) fallback condition would\n      // be rare.\n      this.classList.toggle('amp-notsupported', state);\n      if (state == true) {\n        const fallbackElement = this.getFallback();\n        if (fallbackElement) {\n          this.getResources().scheduleLayout(this, fallbackElement);\n        }\n      }\n    }\n\n    /**\n     * Whether the loading can be shown for this element.\n     * @return {boolean}\n     * @private @this {!Element}\n     */\n    isLoadingEnabled_() {\n      // No loading indicator will be shown if either one of these\n      // conditions true:\n      // 1. `noloading` attribute is specified;\n      // 2. The element has not been whitelisted;\n      // 3. The element is too small or has not yet been measured;\n      // 4. The element has already been laid out (include having loading error);\n      // 5. The element is a `placeholder` or a `fallback`;\n      // 6. The element's layout is not a size-defining layout.\n      if (this.loadingDisabled_ === undefined) {\n        this.loadingDisabled_ = this.hasAttribute('noloading');\n      }\n      if (this.loadingDisabled_ || !isLoadingAllowed(this) ||\n        this.layoutWidth_ < MIN_WIDTH_FOR_LOADING_ ||\n        this.layoutCount_ > 0 ||\n        isInternalOrServiceNode(this) || !isLayoutSizeDefined(this.layout_)) {\n        return false;\n      }\n      return true;\n    }\n\n    /**\n     * Creates a loading object. The caller must ensure that loading can\n     * actually be shown. This method must also be called in the mutate\n     * context.\n     * @private @this {!Element}\n     */\n    prepareLoading_() {\n      if (!this.loadingContainer_) {\n        const doc = this.ownerDocument;\n\n        const container = doc.createElement('div');\n        container.classList.add('-amp-loading-container');\n        container.classList.add('-amp-fill-content');\n        container.classList.add('amp-hidden');\n\n        const element = createLoaderElement(doc);\n        container.appendChild(element);\n\n        this.appendChild(container);\n        this.loadingContainer_ = container;\n        this.loadingElement_ = element;\n      }\n    }\n\n    /**\n     * Turns the loading indicator on or off.\n     * @param {boolean} state\n     * @param {boolean=} opt_cleanup\n     * @private @final @this {!Element}\n     */\n    toggleLoading_(state, opt_cleanup) {\n      assertNotTemplate(this);\n      this.loadingState_ = state;\n      if (!state && !this.loadingContainer_) {\n        return;\n      }\n\n      // Check if loading should be shown.\n      if (state && !this.isLoadingEnabled_()) {\n        this.loadingState_ = false;\n        return;\n      }\n\n      getVsync(this).mutate(() => {\n        let state = this.loadingState_;\n        // Repeat \"loading enabled\" check because it could have changed while\n        // waiting for vsync.\n        if (state && !this.isLoadingEnabled_()) {\n          state = false;\n        }\n        if (state) {\n          this.prepareLoading_();\n        }\n        if (!this.loadingContainer_) {\n          return;\n        }\n\n        this.loadingContainer_.classList.toggle('amp-hidden', !state);\n        this.loadingElement_.classList.toggle('amp-active', state);\n\n        if (!state && opt_cleanup) {\n          const loadingContainer = this.loadingContainer_;\n          this.loadingContainer_ = null;\n          this.loadingElement_ = null;\n          this.getResources().deferMutate(this, () => {\n            dom.removeElement(loadingContainer);\n          });\n        }\n      });\n    }\n\n    /**\n     * Returns an optional overflow element for this custom element.\n     * @return {?Element}\n     * @this {!Element}\n     */\n    getOverflowElement() {\n      if (this.overflowElement_ === undefined) {\n        this.overflowElement_ = dom.childElementByAttr(this, 'overflow');\n        if (this.overflowElement_) {\n          if (!this.overflowElement_.hasAttribute('tabindex')) {\n            this.overflowElement_.setAttribute('tabindex', '0');\n          }\n          if (!this.overflowElement_.hasAttribute('role')) {\n            this.overflowElement_.setAttribute('role', 'button');\n          }\n        }\n      }\n      return this.overflowElement_;\n    }\n\n    /**\n     * Hides or shows the overflow, if available. This function must only\n     * be called inside a mutate context.\n     * @param {boolean} overflown\n     * @param {number|undefined} requestedHeight\n     * @param {number|undefined} requestedWidth\n     * @package @final @this {!Element}\n     */\n    overflowCallback(overflown, requestedHeight, requestedWidth) {\n      this.getOverflowElement();\n      if (!this.overflowElement_) {\n        if (overflown) {\n          user().warn(TAG_,\n            'Cannot resize element and overflow is not available', this);\n        }\n      } else {\n        this.overflowElement_.classList.toggle('amp-visible', overflown);\n\n        if (overflown) {\n          this.overflowElement_.onclick = () => {\n            this.getResources(). /*OK*/ changeSize(\n              this, requestedHeight, requestedWidth);\n            getVsync(this).mutate(() => {\n              this.overflowCallback(\n                /* overflown */ false, requestedHeight, requestedWidth);\n            });\n          };\n        } else {\n          this.overflowElement_.onclick = null;\n        }\n      }\n    }\n  };\n  win.BaseCustomElementClass = BaseCustomElement;\n  return win.BaseCustomElementClass;\n}\n\n/**\n * Registers a new custom element with its implementation class.\n * @param {!Window} win The window in which to register the elements.\n * @param {string} name Name of the custom element\n * @param {function(new:./base-element.BaseElement, !Element)} implementationClass\n */\nexport function registerElement(win, name, implementationClass) {\n  knownElements[name] = implementationClass;\n  const klass = createCustomElementClass(win, name);\n\n  const supportsCustomElementsV1 = 'customElements' in win;\n  if (supportsCustomElementsV1) {\n    win['customElements'].define(name, klass);\n  } else {\n    win.document.registerElement(name, {\n      prototype: klass.prototype,\n    });\n  }\n}\n\n/**\n * Registers a new alias for an existing custom element.\n * @param {!Window} win The window in which to register the elements.\n * @param {string} aliasName Additional name for an existing custom element.\n * @param {string} sourceName Name of an existing custom element\n */\nexport function registerElementAlias(win, aliasName, sourceName) {\n  const implementationClass = knownElements[sourceName];\n  if (implementationClass) {\n    // Update on the knownElements to prevent register again.\n    registerElement(win, aliasName, implementationClass);\n  } else {\n    throw new Error(`Element name is unknown: ${sourceName}.` +\n                     `Alias ${aliasName} was not registered.`);\n  }\n}\n\n/**\n * In order to provide better error messages we only allow to retrieve\n * services from other elements if those elements are loaded in the page.\n * This makes it possible to mark an element as loaded in a test.\n * @param {!Window} win\n * @param {string} elementName Name of an extended custom element.\n * @visibleForTesting\n */\nexport function markElementScheduledForTesting(win, elementName) {\n  if (!win.ampExtendedElements) {\n    win.ampExtendedElements = {};\n  }\n  win.ampExtendedElements[elementName] = true;\n}\n\n/**\n * Resets our scheduled elements.\n * @param {!Window} win\n * @param {string} elementName Name of an extended custom element.\n * @visibleForTesting\n */\nexport function resetScheduledElementForTesting(win, elementName) {\n  if (win.ampExtendedElements) {\n    win.ampExtendedElements[elementName] = null;\n  }\n  delete knownElements[elementName];\n}\n\n/**\n * Returns a currently registered element class.\n * @param {string} elementName Name of an extended custom element.\n * @return {?function()}\n * @visibleForTesting\n */\nexport function getElementClassForTesting(elementName) {\n  return knownElements[elementName] || null;\n}\n\n/** @param {!Element} element */\nfunction assertNotTemplate(element) {\n  dev().assert(!element.isInTemplate_, 'Must never be called in template');\n};\n\n/**\n * @param {!Element} element\n * @return {!./service/vsync-impl.Vsync}\n */\nfunction getVsync(element) {\n  return vsyncFor(element.ownerDocument.defaultView);\n};\n\n/**\n * Whether the implementation is a stub.\n * @param {?./base-element.BaseElement} impl\n * @return {boolean}\n */\nfunction isStub(impl) {\n  return (impl instanceof ElementStub);\n};\n","/**\n * Copyright 2015 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {Observable} from './observable';\nimport {fromClass} from './service';\nimport {getVendorJsPropertyName} from './style';\nimport {waitForChild} from './dom';\n\n\n/**\n */\nexport class DocumentState {\n  /**\n   * @param {!Window} win\n   */\n  constructor(win) {\n    /** @const {!Window} */\n    this.win = win;\n\n    /** @private @const {!Document} */\n    this.document_ = win.document;\n\n    /** @private {string|null} */\n    this.hiddenProp_ = getVendorJsPropertyName(this.document_, 'hidden', true);\n    if (this.document_[this.hiddenProp_] === undefined) {\n      this.hiddenProp_ = null;\n    }\n\n    /** @private {string|null} */\n    this.visibilityStateProp_ = getVendorJsPropertyName(this.document_,\n        'visibilityState', true);\n    if (this.document_[this.visibilityStateProp_] === undefined) {\n      this.visibilityStateProp_ = null;\n    }\n\n    /** @private @const {!Observable} */\n    this.visibilityObservable_ = new Observable();\n\n    /** @private {string|null} */\n    this.visibilityChangeEvent_ = null;\n    if (this.hiddenProp_) {\n      this.visibilityChangeEvent_ = 'visibilitychange';\n      const vendorStop = this.hiddenProp_.indexOf('Hidden');\n      if (vendorStop != -1) {\n        this.visibilityChangeEvent_ =\n            this.hiddenProp_.substring(0, vendorStop) + 'Visibilitychange';\n      }\n    }\n\n    /** @private @const {!Function} */\n    this.boundOnVisibilityChanged_ = this.onVisibilityChanged_.bind(this);\n    if (this.visibilityChangeEvent_) {\n      this.document_.addEventListener(this.visibilityChangeEvent_,\n          this.boundOnVisibilityChanged_);\n    }\n\n    /** @private {?Observable} */\n    this.bodyAvailableObservable_ = null;\n  }\n\n  /** @private */\n  cleanup_() {\n    if (this.visibilityChangeEvent_) {\n      this.document_.removeEventListener(this.visibilityChangeEvent_,\n          this.boundOnVisibilityChanged_);\n    }\n  }\n\n  /**\n   * Returns the value of \"document.hidden\" property. The reasons why it may\n   * not be visible include document in a non-active tab or when the document\n   * is being pre-rendered via link with rel=\"prerender\".\n   * @return {boolean}\n   */\n  isHidden() {\n    if (!this.hiddenProp_) {\n      return false;\n    }\n    return this.document_[this.hiddenProp_];\n  }\n\n  /**\n   * Returns the value of \"document.visibilityState\" property. Possible values\n   * are: 'hidden', 'visible', 'prerender', and 'unloaded'.\n   * @return {string}\n   */\n  getVisibilityState() {\n    if (!this.visibilityStateProp_) {\n      return this.isHidden() ? 'hidden' : 'visible';\n    }\n    return this.document_[this.visibilityStateProp_];\n  }\n\n  /**\n   * @param {function()} handler\n   * @return {!UnlistenDef}\n   */\n  onVisibilityChanged(handler) {\n    return this.visibilityObservable_.add(handler);\n  }\n\n  /** @private */\n  onVisibilityChanged_() {\n    this.visibilityObservable_.fire();\n  }\n\n  /**\n   * If body is already available, callback is called synchronously and null\n   * is returned.\n   * @param {function()} handler\n   * @return {?UnlistenDef}\n   */\n  onBodyAvailable(handler) {\n    const doc = this.document_;\n    if (doc.body) {\n      handler();\n      return null;\n    }\n    if (!this.bodyAvailableObservable_) {\n      this.bodyAvailableObservable_ = new Observable();\n      waitForChild(doc.documentElement, () => !!doc.body,\n          this.onBodyAvailable_.bind(this));\n    }\n    return this.bodyAvailableObservable_.add(handler);\n  }\n\n  /** @private */\n  onBodyAvailable_() {\n    this.bodyAvailableObservable_.fire();\n    this.bodyAvailableObservable_.removeAll();\n    this.bodyAvailableObservable_ = null;\n  }\n}\n\n\n/**\n * @param {!Window} window\n * @return {!DocumentState}\n */\nexport function documentStateFor(window) {\n  return fromClass(window, 'documentState', DocumentState);\n}\n","/**\n * Copyright 2015 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {dev} from './log';\nimport {cssEscape} from '../third_party/css-escape/css-escape';\nimport {toArray} from './types';\n\nconst HTML_ESCAPE_CHARS = {\n  '&': '&amp;',\n  '<': '&lt;',\n  '>': '&gt;',\n  '\"': '&quot;',\n  \"'\": '&#x27;',\n  '`': '&#x60;',\n};\nconst HTML_ESCAPE_REGEX = /(&|<|>|\"|'|`)/g;\n\n\n/**\n * Waits until the child element is constructed. Once the child is found, the\n * callback is executed.\n * @param {!Element} parent\n * @param {function(!Element):boolean} checkFunc\n * @param {function()} callback\n */\nexport function waitForChild(parent, checkFunc, callback) {\n  if (checkFunc(parent)) {\n    callback();\n    return;\n  }\n  /** @const {!Window} */\n  const win = parent.ownerDocument.defaultView;\n  if (win.MutationObserver) {\n    /** @const {MutationObserver} */\n    const observer = new win.MutationObserver(() => {\n      if (checkFunc(parent)) {\n        observer.disconnect();\n        callback();\n      }\n    });\n    observer.observe(parent, {childList: true});\n  } else {\n    /** @const {number} */\n    const interval = win.setInterval(() => {\n      if (checkFunc(parent)) {\n        win.clearInterval(interval);\n        callback();\n      }\n    }, /* milliseconds */ 5);\n  }\n}\n\n/**\n * Waits until the child element is constructed. Once the child is found, the\n * promise is resolved.\n * @param {!Element} parent\n * @param {function(!Element):boolean} checkFunc\n * @return {!Promise}\n */\nexport function waitForChildPromise(parent, checkFunc) {\n  return new Promise(resolve => {\n    waitForChild(parent, checkFunc, resolve);\n  });\n}\n\n/**\n * Waits for document's body to be available.\n * Will be deprecated soon; use {@link AmpDoc#whenBodyAvailable} or\n * @{link DocumentState#onBodyAvailable} instead.\n * @param {!Document} doc\n * @param {function()} callback\n */\nexport function waitForBody(doc, callback) {\n  waitForChild(doc.documentElement, () => !!doc.body, callback);\n}\n\n\n/**\n * Waits for document's body to be available.\n * @param {!Document} doc\n * @return {!Promise}\n */\nexport function waitForBodyPromise(doc) {\n  return new Promise(resolve => {\n    waitForBody(doc, resolve);\n  });\n}\n\n\n/**\n * Removes the element.\n * @param {!Element} element\n */\nexport function removeElement(element) {\n  if (element.parentElement) {\n    element.parentElement.removeChild(element);\n  }\n}\n\n\n/**\n * Removes all child nodes of the specified element.\n * @param {!Element} parent\n */\nexport function removeChildren(parent) {\n  while (parent.firstChild) {\n    parent.removeChild(parent.firstChild);\n  }\n}\n\n\n/**\n * Copies all children nodes of element \"from\" to element \"to\". Child nodes\n * are deeply cloned. Notice, that this method should be used with care and\n * preferably on smaller subtrees.\n * @param {!Element} from\n * @param {!Element} to\n */\nexport function copyChildren(from, to) {\n  const frag = to.ownerDocument.createDocumentFragment();\n  for (let n = from.firstChild; n; n = n.nextSibling) {\n    frag.appendChild(n.cloneNode(true));\n  }\n  to.appendChild(frag);\n}\n\n/**\n * Create a new element on document with specified tagName and attributes.\n * @param {!Document} doc\n * @param {string} tagName\n * @param {!Object<string, string>} attributes\n * @return {!Element} created element\n */\nexport function createElementWithAttributes(doc, tagName, attributes) {\n  const element = doc.createElement(tagName);\n  for (const attr in attributes) {\n    element.setAttribute(attr, attributes[attr]);\n  }\n  return element;\n}\n\n\n/**\n * Finds the closest element that satisfies the callback from this element\n * up the DOM subtree.\n * @param {!Element} element\n * @param {function(!Element):boolean} callback\n * @param {Element=} opt_stopAt optional elemnt to stop the search at.\n * @return {?Element}\n */\nexport function closest(element, callback, opt_stopAt) {\n  for (let el = element; el && el !== opt_stopAt; el = el.parentElement) {\n    if (callback(el)) {\n      return el;\n    }\n  }\n  return null;\n}\n\n\n/**\n * Finds the closest node that satisfies the callback from this node\n * up the DOM subtree.\n * @param {!Node} node\n * @param {function(!Node):boolean} callback\n * @return {?Node}\n */\nexport function closestNode(node, callback) {\n  for (let n = node; n; n = n.parentNode) {\n    if (callback(n)) {\n      return n;\n    }\n  }\n  return null;\n}\n\n\n/**\n * Finds the closest element with the specified name from this element\n * up the DOM subtree.\n * @param {!Element} element\n * @param {string} tagName\n * @return {?Element}\n */\nexport function closestByTag(element, tagName) {\n  if (element.closest) {\n    return element.closest(tagName);\n  }\n  tagName = tagName.toUpperCase();\n  return closest(element, el => {\n    return el.tagName == tagName;\n  });\n}\n\n/**\n * Finds the closest element with the specified selector from this element\n * @param {!Element} element\n * @param {string} selector\n * @return {?Element} closest ancestor if found.\n */\nexport function closestBySelector(element, selector) {\n  if (element.closest) {\n    return element.closest(selector);\n  }\n\n  return closest(element, el => {\n    return matches(el, selector);\n  });\n}\n\n/**\n * Checks if the given element matches the selector\n * @param  {!Element} el The element to verify\n * @param  {!string} selector The selector to check against\ny * @return {boolean} True if the element matched the selector. False otherwise\n */\nexport function matches(el, selector) {\n  const matcher = el.matches ||\n      el.webkitMatchesSelector ||\n      el.mozMatchesSelector ||\n      el.msMatchesSelector ||\n      el.oMatchesSelector;\n  if (matcher) {\n    return matcher.call(el, selector);\n  }\n  return false;  // IE8 always returns false.\n}\n\n/**\n * Finds the first descendant element with the specified name.\n * @param {!Element} element\n * @param {string} tagName\n * @return {?Element}\n */\nexport function elementByTag(element, tagName) {\n  const elements = element.getElementsByTagName(tagName);\n  return elements[0] || null;\n}\n\n\n/**\n * Finds the first child element that satisfies the callback.\n * @param {!Element} parent\n * @param {function(!Element):boolean} callback\n * @return {?Element}\n */\nexport function childElement(parent, callback) {\n  for (let child = parent.firstElementChild; child;\n      child = child.nextElementSibling) {\n    if (callback(child)) {\n      return child;\n    }\n  }\n  return null;\n}\n\n\n/**\n * Finds all child elements that satisfy the callback.\n * @param {!Element} parent\n * @param {function(!Element):boolean} callback\n * @return {!Array<!Element>}\n */\nexport function childElements(parent, callback) {\n  const children = [];\n  for (let child = parent.firstElementChild; child;\n       child = child.nextElementSibling) {\n    if (callback(child)) {\n      children.push(child);\n    }\n  }\n  return children;\n}\n\n\n/**\n * Finds the last child element that satisfies the callback.\n * @param {!Element} parent\n * @param {function(!Element):boolean} callback\n * @return {?Element}\n */\nexport function lastChildElement(parent, callback) {\n  for (let child = parent.lastElementChild; child;\n       child = child.previousElementSibling) {\n    if (callback(child)) {\n      return child;\n    }\n  }\n  return null;\n}\n\n/**\n * Finds all child nodes that satisfy the callback.\n * These nodes can include Text, Comment and other child nodes.\n * @param {!Node} parent\n * @param {function(!Node):boolean} callback\n * @return {!Array<!Node>}\n */\nexport function childNodes(parent, callback) {\n  const nodes = [];\n  for (let child = parent.firstChild; child;\n       child = child.nextSibling) {\n    if (callback(child)) {\n      nodes.push(child);\n    }\n  }\n  return nodes;\n}\n\n/**\n * @type {boolean|undefined}\n * @visibleForTesting\n */\nlet scopeSelectorSupported;\n\n/**\n * @param {boolean|undefined} val\n * @visibleForTesting\n */\nexport function setScopeSelectorSupportedForTesting(val) {\n  scopeSelectorSupported = val;\n}\n\n/**\n * @param {!Element} parent\n * @return {boolean}\n */\nfunction isScopeSelectorSupported(parent) {\n  try {\n    parent.ownerDocument.querySelector(':scope');\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\n\n/**\n * Finds the first child element that has the specified attribute.\n * @param {!Element} parent\n * @param {string} attr\n * @return {?Element}\n */\nexport function childElementByAttr(parent, attr) {\n  if (scopeSelectorSupported == null) {\n    scopeSelectorSupported = isScopeSelectorSupported(parent);\n  }\n  if (scopeSelectorSupported) {\n    return parent.querySelector(':scope > [' + attr + ']');\n  }\n  return childElement(parent, el => {\n    return el.hasAttribute(attr);\n  });\n}\n\n\n/**\n * Finds the last child element that has the specified attribute.\n * @param {!Element} parent\n * @param {string} attr\n * @return {?Element}\n */\nexport function lastChildElementByAttr(parent, attr) {\n  return lastChildElement(parent, el => {\n    return el.hasAttribute(attr);\n  });\n}\n\n\n/**\n * Finds all child elements that has the specified attribute.\n * @param {!Element} parent\n * @param {string} attr\n * @return {!Array<!Element>}\n */\nexport function childElementsByAttr(parent, attr) {\n  if (scopeSelectorSupported == null) {\n    scopeSelectorSupported = isScopeSelectorSupported(parent);\n  }\n  if (scopeSelectorSupported) {\n    return toArray(parent.querySelectorAll(':scope > [' + attr + ']'));\n  }\n  return childElements(parent, el => {\n    return el.hasAttribute(attr);\n  });\n}\n\n\n/**\n * Finds the first child element that has the specified tag name.\n * @param {!Element} parent\n * @param {string} tagName\n * @return {?Element}\n */\nexport function childElementByTag(parent, tagName) {\n  if (scopeSelectorSupported == null) {\n    scopeSelectorSupported = isScopeSelectorSupported(parent);\n  }\n  if (scopeSelectorSupported) {\n    return parent.querySelector(':scope > ' + tagName);\n  }\n  tagName = tagName.toUpperCase();\n  return childElement(parent, el => {\n    return el.tagName == tagName;\n  });\n}\n\n\n/**\n * Finds all child elements with the specified tag name.\n * @param {!Element} parent\n * @param {string} tagName\n * @return {!Array<!Element>}\n */\nexport function childElementsByTag(parent, tagName) {\n  if (scopeSelectorSupported == null) {\n    scopeSelectorSupported = isScopeSelectorSupported(parent);\n  }\n  if (scopeSelectorSupported) {\n    return toArray(parent.querySelectorAll(':scope > ' + tagName));\n  }\n  tagName = tagName.toUpperCase();\n  return childElements(parent, el => {\n    return el.tagName == tagName;\n  });\n}\n\n\n/**\n * Returns element data-param- attributes as url parameters key-value pairs.\n * e.g. data-param-some-attr=value -> {someAttr: value}.\n * @param {!Element} element\n * @param {function(string):string=} opt_computeParamNameFunc to compute the parameter\n *    name, get passed the camel-case parameter name.\n * @param {!RegExp=} opt_paramPattern Regex pattern to match data attributes.\n * @return {!Object<string, string>}\n */\nexport function getDataParamsFromAttributes(element, opt_computeParamNameFunc,\n  opt_paramPattern) {\n  const computeParamNameFunc = opt_computeParamNameFunc || (key => key);\n  const dataset = element.dataset;\n  const params = Object.create(null);\n  const paramPattern = opt_paramPattern ? opt_paramPattern : /^param(.+)/;\n  for (const key in dataset) {\n    const matches = key.match(paramPattern);\n    if (matches) {\n      const param = matches[1][0].toLowerCase() + matches[1].substr(1);\n      params[computeParamNameFunc(param)] = dataset[key];\n    }\n  }\n  return params;\n}\n\n/**\n * Whether the element have a next node in the document order.\n * This means either:\n *  a. The element itself has a nextSibling.\n *  b. Any of the element ancestors has a nextSibling.\n * @param {!Element} element\n * @return {boolean}\n */\nexport function hasNextNodeInDocumentOrder(element) {\n  let currentElement = element;\n  do {\n    if (currentElement.nextSibling) {\n      return true;\n    }\n  } while (currentElement = currentElement.parentNode);\n  return false;\n}\n\n\n/**\n * Finds all ancestor elements that satisfy predicate.\n * @param {!Element} child\n * @param {function(!Element):boolean} predicate\n * @return {!Array<!Element>}\n */\nexport function ancestorElements(child, predicate) {\n  const ancestors = [];\n  for (let ancestor = child.parentElement; ancestor;\n       ancestor = ancestor.parentElement) {\n    if (predicate(ancestor)) {\n      ancestors.push(ancestor);\n    }\n  }\n  return ancestors;\n}\n\n\n/**\n * Finds all ancestor elements that has the specified tag name.\n * @param {!Element} child\n * @param {string} tagName\n * @return {!Array<!Element>}\n */\nexport function ancestorElementsByTag(child, tagName) {\n  tagName = tagName.toUpperCase();\n  return ancestorElements(child, el => {\n    return el.tagName == tagName;\n  });\n}\n\n\n/**\n * This method wraps around window's open method. It first tries to execute\n * `open` call with the provided target and if it fails, it retries the call\n * with the `_top` target. This is necessary given that in some embedding\n * scenarios, such as iOS' WKWebView, navigation to `_blank` and other targets\n * is blocked by default.\n *\n * @param {!Window} win\n * @param {string} url\n * @param {string} target\n * @param {string=} opt_features\n * @return {?Window}\n */\nexport function openWindowDialog(win, url, target, opt_features) {\n  // Try first with the specified target. If we're inside the WKWebView or\n  // a similar environments, this method is expected to fail by default for\n  // all targets except `_top`.\n  let res;\n  try {\n    res = win.open(url, target, opt_features);\n  } catch (e) {\n    dev().error('DOM', 'Failed to open url on target: ', target, e);\n  }\n\n  // Then try with `_top` target.\n  if (!res && target != '_top') {\n    res = win.open(url, '_top');\n  }\n  return res;\n}\n\n/**\n * Whether the element is a script tag with application/json type.\n * @param {!Element} element\n * @return {boolean}\n */\nexport function isJsonScriptTag(element) {\n  return element.tagName == 'SCRIPT' &&\n            element.getAttribute('type').toUpperCase() == 'APPLICATION/JSON';\n}\n\n\n/**\n * Escapes an ident (ID or a class name) to be used as a CSS selector.\n *\n * See https://drafts.csswg.org/cssom/#serialize-an-identifier.\n *\n * @param {!Window} win\n * @param {string} ident\n * @return {string}\n */\nexport function escapeCssSelectorIdent(win, ident) {\n  if (win.CSS && win.CSS.escape) {\n    return win.CSS.escape(ident);\n  }\n  // Polyfill.\n  return cssEscape(ident);\n}\n\n\n/**\n * Escapes `<`, `>` and other HTML charcaters with their escaped forms.\n * @param {string} text\n * @return {string}\n */\nexport function escapeHtml(text) {\n  if (!text) {\n    return text;\n  }\n  return text.replace(HTML_ESCAPE_REGEX, escapeHtmlChar);\n}\n\n/**\n * @param {string} c\n * @return string\n */\nfunction escapeHtmlChar(c) {\n  return HTML_ESCAPE_CHARS[c];\n}\n\n/**\n * Tries to focus on the given element; fails silently if browser throws an\n * exception.\n * @param {!Element} element\n */\nexport function tryFocus(element) {\n  try {\n    element./*OK*/focus();\n  } catch (e) {\n    // IE <= 7 may throw exceptions when focusing on hidden items.\n  }\n}\n","/**\n * Copyright 2015 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {BaseElement} from './base-element';\nimport {dev} from './log';\nimport {extensionsFor} from './extensions';\n\n/** @type {!Array} */\nexport const stubbedElements = [];\n\n/** @type {!Object<string, boolean>} */\nconst loadingChecked = {};\n\n\nexport class ElementStub extends BaseElement {\n  constructor(element) {\n    super(element);\n    // Fetch amp-ad script if it is not present.\n    const name = element.tagName.toLowerCase();\n    if (!loadingChecked[name]) {\n      loadingChecked[name] = true;\n      extensionsFor(this.win).loadExtension(name, /* stubElement */ false);\n    }\n    stubbedElements.push(this);\n  }\n\n  /** @override */\n  getPriority() {\n    return dev().assert(0, 'Cannot get priority of stubbed element');\n  }\n\n  /** @override */\n  isLayoutSupported(unusedLayout) {\n    // Always returns true and will eventually call this method on the actual\n    // element.\n    return true;\n  }\n}\n\n\n/**\n * @visibleForTesting\n */\nexport function resetLoadingCheckForTests() {\n  const keys = Object.keys(loadingChecked);\n  for (let i = 0; i < keys.length; i++) {\n    const key = keys[i];\n    if (loadingChecked.hasOwnProperty(key)) {\n      delete loadingChecked[key];\n    }\n  }\n}\n","/**\n * Copyright 2015 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n\nimport {getMode} from './mode';\nimport {exponentialBackoff} from './exponential-backoff';\nimport {isLoadErrorMessage} from './event-helper';\nimport {USER_ERROR_SENTINEL, isUserErrorMessage} from './log';\nimport {makeBodyVisible} from './style-installer';\nimport {urls} from './config';\nimport {isProxyOrigin} from './url';\n\nconst CANCELLED = 'CANCELLED';\n\n/**\n * Collects error messages, so they can be included in subsequent reports.\n * That allows identifying errors that might be caused by previous errors.\n */\nlet accumulatedErrorMessages = self.AMPErrors || [];\n// Use a true global, to avoid multi-module inclusion issues.\nself.AMPErrors = accumulatedErrorMessages;\n\n/**\n * A wrapper around our exponentialBackoff, to lazy initialize it to avoid an\n * un-DCE'able side-effect.\n * @param {function()} work the function to execute after backoff\n * @return {number} the setTimeout id\n */\nlet globalExponentialBackoff = function(work) {\n  // Set globalExponentialBackoff as the lazy-created function. JS Vooodoooo.\n  globalExponentialBackoff = exponentialBackoff(1.5);\n  return globalExponentialBackoff(work);\n};\n\n/**\n * Reports an error. If the error has an \"associatedElement\" property\n * the element is marked with the -amp-element-error and displays\n * the message itself. The message is always send to the console.\n * If the error has a \"messageArray\" property, that array is logged.\n * This way one gets the native fidelity of the console for things like\n * elements instead of stringification.\n * @param {*} error\n * @param {!Element=} opt_associatedElement\n */\nexport function reportError(error, opt_associatedElement) {\n  if (!self.console) {\n    return;\n  }\n  if (!error) {\n    error = new Error('no error supplied');\n  }\n  if (error.reported) {\n    return;\n  }\n  error.reported = true;\n  const element = opt_associatedElement || error.associatedElement;\n  if (element && element.classList) {\n    element.classList.add('-amp-error');\n    if (getMode().development) {\n      element.classList.add('-amp-element-error');\n      element.setAttribute('error-message', error.message);\n    }\n  }\n  if (error.messageArray) {\n    (console.error || console.log).apply(console,\n        error.messageArray);\n  } else {\n    if (element) {\n      (console.error || console.log).call(console,\n          element.tagName + '#' + element.id, error.message);\n    } else if (!getMode().minified) {\n      (console.error || console.log).call(console, error.stack);\n    } else {\n      (console.error || console.log).call(console, error.message);\n    }\n\n  }\n  if (element && element.dispatchCustomEventForTesting) {\n    element.dispatchCustomEventForTesting('amp:error', error.message);\n  }\n  // 'call' to make linter happy. And .call to make compiler happy\n  // that expects some @this.\n  reportErrorToServer['call'](undefined, undefined, undefined, undefined,\n      undefined, error);\n}\n\n/**\n * Returns an error for a cancellation of a promise.\n * @return {!Error}\n */\nexport function cancellation() {\n  return new Error(CANCELLED);\n}\n\n/**\n * Install handling of global unhandled exceptions.\n * @param {!Window} win\n */\nexport function installErrorReporting(win) {\n  win.onerror = /** @type {!Function} */ (reportErrorToServer);\n  win.addEventListener('unhandledrejection', event => {\n    reportError(event.reason || new Error('rejected promise ' + event));\n  });\n}\n\n/**\n * Signature designed, so it can work with window.onerror\n * @param {string|undefined} message\n * @param {string|undefined} filename\n * @param {string|undefined} line\n * @param {string|undefined} col\n * @param {*|undefined} error\n * @this {!Window|undefined}\n */\nfunction reportErrorToServer(message, filename, line, col, error) {\n  // Make an attempt to unhide the body.\n  if (this && this.document) {\n    makeBodyVisible(this.document);\n  }\n  if (getMode().localDev || getMode().development || getMode().test) {\n    return;\n  }\n  let hasNonAmpJs = false;\n  try {\n    hasNonAmpJs = detectNonAmpJs(self);\n  } catch (ignore) {\n    // Ignore errors during error report generation.\n  }\n  if (hasNonAmpJs && Math.random() > 0.01) {\n    // Only report 1% of errors on pages with non-AMP JS.\n    // These errors can almost never be acted upon, but spikes such as\n    // due to buggy browser extensions may be helpful to notify authors.\n    return;\n  }\n  const url = getErrorReportUrl(message, filename, line, col, error,\n      hasNonAmpJs);\n  globalExponentialBackoff(() => {\n    if (url) {\n      new Image().src = url;\n    }\n  });\n}\n\n/**\n * Signature designed, so it can work with window.onerror\n * @param {string|undefined} message\n * @param {string|undefined} filename\n * @param {string|undefined} line\n * @param {string|undefined} col\n * @param {*|undefined} error\n * @param {boolean} hasNonAmpJs\n * @return {string|undefined} The URL\n * visibleForTesting\n */\nexport function getErrorReportUrl(message, filename, line, col, error,\n    hasNonAmpJs) {\n  message = error && error.message ? error.message : message;\n  if (/_reported_/.test(message)) {\n    return;\n  }\n  if (message == CANCELLED) {\n    return;\n  }\n  if (!message) {\n    message = 'Unknown error';\n  }\n  if (isLoadErrorMessage(message)) {\n    return;\n  }\n\n  // This is the App Engine app in\n  // ../tools/errortracker\n  // It stores error reports via https://cloud.google.com/error-reporting/\n  // for analyzing production issues.\n  let url = urls.errorReporting +\n      '?v=' + encodeURIComponent('$internalRuntimeVersion$') +\n      '&noAmp=' + (hasNonAmpJs ? 1 : 0) +\n      '&m=' + encodeURIComponent(message.replace(USER_ERROR_SENTINEL, '')) +\n      '&a=' + (isUserErrorMessage(message) ? 1 : 0);\n  if (self.context && self.context.location) {\n    url += '&3p=1';\n  }\n  if (self.AMP_CONFIG && self.AMP_CONFIG.canary) {\n    url += '&ca=1';\n  }\n  if (self.location.ancestorOrigins && self.location.ancestorOrigins[0]) {\n    url += '&or=' + encodeURIComponent(self.location.ancestorOrigins[0]);\n  }\n  if (self.viewerState) {\n    url += '&vs=' + encodeURIComponent(self.viewerState);\n  }\n  // Is embedded?\n  if (self.parent && self.parent != self) {\n    url += '&iem=1';\n  }\n\n  if (self.AMP.viewer) {\n    const resolvedViewerUrl = self.AMP.viewer.getResolvedViewerUrl();\n    const messagingOrigin = self.AMP.viewer.maybeGetMessagingOrigin();\n    if (resolvedViewerUrl) {\n      url += `&rvu=${encodeURIComponent(resolvedViewerUrl)}`;\n    }\n    if (messagingOrigin) {\n      url += `&mso=${encodeURIComponent(messagingOrigin)}`;\n    }\n  }\n\n  if (error) {\n    const tagName = error && error.associatedElement\n      ? error.associatedElement.tagName\n      : 'u';  // Unknown\n    url += '&el=' + encodeURIComponent(tagName) +\n        '&s=' + encodeURIComponent(error.stack || '');\n    error.message += ' _reported_';\n  } else {\n    url += '&f=' + encodeURIComponent(filename || '') +\n        '&l=' + encodeURIComponent(line || '') +\n        '&c=' + encodeURIComponent(col || '');\n  }\n  url += '&r=' + encodeURIComponent(self.document.referrer);\n  url += '&ae=' + encodeURIComponent(accumulatedErrorMessages.join(','));\n  accumulatedErrorMessages.push(message);\n  url += '&fr=' + encodeURIComponent(self.location.originalHash\n      || self.location.hash);\n\n  return url;\n}\n\n/**\n * Returns true if it appears like there is non-AMP JS on the\n * current page.\n * @param {!Window} win\n * @visibleForTesting\n */\nexport function detectNonAmpJs(win) {\n  const scripts = win.document.querySelectorAll('script[src]');\n  for (let i = 0; i < scripts.length; i++) {\n    if (!isProxyOrigin(scripts[i].src.toLowerCase())) {\n      return true;\n    }\n  }\n  return false;\n}\n\nexport function resetAccumulatedErrorMessagesForTesting() {\n  accumulatedErrorMessages = [];\n}\n","/**\n * Copyright 2015 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {timerFor} from './timer';\nimport {user} from './log';\n\n/** @const {string}  */\nconst LOAD_FAILURE_PREFIX = 'Failed to load:';\n\n\n/**\n * Listens for the specified event on the element.\n * @param {?EventTarget} element\n * @param {string} eventType\n * @param {?function(Event)} listener\n * @param {boolean=} opt_capture\n * @return {!UnlistenDef}\n */\nexport function listen(element, eventType, listener, opt_capture) {\n  const capture = opt_capture || false;\n  element.addEventListener(eventType, listener, capture);\n  return () => {\n    if (element) {\n      element.removeEventListener(eventType, listener, capture);\n    }\n    listener = null;\n    element = null;\n  };\n}\n\n\n/**\n * Listens for the specified event on the element and removes the listener\n * as soon as event has been received.\n * @param {?EventTarget} element\n * @param {string} eventType\n * @param {?function(Event)} listener\n * @param {boolean=} opt_capture\n * @return {!UnlistenDef}\n */\nexport function listenOnce(element, eventType, listener, opt_capture) {\n  const capture = opt_capture || false;\n  let unlisten;\n  let proxy = event => {\n    listener(event);\n    unlisten();\n  };\n  unlisten = () => {\n    if (element) {\n      element.removeEventListener(eventType, proxy, capture);\n    }\n    element = null;\n    proxy = null;\n    listener = null;\n  };\n  element.addEventListener(eventType, proxy, capture);\n  return unlisten;\n}\n\n\n/**\n * Returns  a promise that will resolve as soon as the specified event has\n * fired on the element. Optionally, opt_timeout can be specified that will\n * reject the promise if the event has not fired by then.\n * @param {!EventTarget} element\n * @param {string} eventType\n * @param {boolean=} opt_capture\n * @param {number=} opt_timeout\n * @return {!Promise<!Event>}\n */\nexport function listenOncePromise(element, eventType, opt_capture,\n    opt_timeout) {\n  let unlisten;\n  const eventPromise = new Promise((resolve, unusedReject) => {\n    unlisten = listenOnce(element, eventType, resolve, opt_capture);\n  });\n  return racePromise_(eventPromise, unlisten, undefined, opt_timeout);\n}\n\n\n/**\n * Whether the specified element/window has been loaded already.\n * @param {!Element|!Window} eleOrWindow\n * @return {boolean}\n */\nexport function isLoaded(eleOrWindow) {\n  return !!(eleOrWindow.complete || eleOrWindow.readyState == 'complete'\n      // If the passed in thing is a Window, infer loaded state from\n      //\n      || (eleOrWindow.document\n          && eleOrWindow.document.readyState == 'complete'));\n}\n\n/**\n * Returns a promise that will resolve or fail based on the eleOrWindow's 'load'\n * and 'error' events. Optionally this method takes a timeout, which will reject\n * the promise if the resource has not loaded by then.\n * @param {T} eleOrWindow Supports both Elements and as a special case Windows.\n * @param {number=} opt_timeout\n * @return {!Promise<T>}\n * @template T\n */\nexport function loadPromise(eleOrWindow, opt_timeout) {\n  let unlistenLoad;\n  let unlistenError;\n  if (isLoaded(eleOrWindow)) {\n    return Promise.resolve(eleOrWindow);\n  }\n  let loadingPromise = new Promise((resolve, reject) => {\n    // Listen once since IE 5/6/7 fire the onload event continuously for\n    // animated GIFs.\n    const tagName = eleOrWindow.tagName;\n    if (tagName === 'AUDIO' || tagName === 'VIDEO') {\n      unlistenLoad = listenOnce(eleOrWindow, 'loadstart', resolve);\n    } else {\n      unlistenLoad = listenOnce(eleOrWindow, 'load', resolve);\n    }\n    // For elements, unlisten on error (don't for Windows).\n    if (tagName) {\n      unlistenError = listenOnce(eleOrWindow, 'error', reject);\n    }\n  });\n  loadingPromise = loadingPromise.then(() => eleOrWindow, failedToLoad);\n  return racePromise_(loadingPromise, unlistenLoad, unlistenError,\n      opt_timeout);\n}\n\n/**\n * Emit error on load failure.\n * @param {*} event\n */\nfunction failedToLoad(event) {\n  // Report failed loads as user errors so that they automatically go\n  // into the \"document error\" bucket.\n  let target = event.target;\n  if (target && target.src) {\n    target = target.src;\n  }\n  throw user().createError(LOAD_FAILURE_PREFIX, target);\n}\n\n/**\n * Returns true if this error message is was created for a load error.\n * @param {string} message An error message\n * @return {boolean}\n */\nexport function isLoadErrorMessage(message) {\n  return message.indexOf(LOAD_FAILURE_PREFIX) != -1;\n}\n\n/**\n * @param {!Promise<TYPE>} promise\n * @param {UnlistenDef|undefined} unlisten1\n * @param {UnlistenDef|undefined} unlisten2\n * @param {number|undefined} timeout\n * @return {!Promise<TYPE>}\n * @template TYPE\n */\nfunction racePromise_(promise, unlisten1, unlisten2, timeout) {\n  let racePromise;\n  if (timeout === undefined) {\n    // Timeout is not specified: return promise.\n    racePromise = promise;\n  } else {\n    // Timeout has been specified: add a timeout condition.\n    racePromise = timerFor(self).timeoutPromise(timeout || 0, promise);\n  }\n  if (unlisten1) {\n    racePromise.then(unlisten1, unlisten1);\n  }\n  if (unlisten2) {\n    racePromise.then(unlisten2, unlisten2);\n  }\n  return racePromise;\n}\n","/**\n * Copyright 2015 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * @fileoverview Experiments system allows a developer to opt-in to test\n * features that are not yet fully tested.\n *\n * Experiments page: https://cdn.ampproject.org/experiments.html *\n */\n\nimport {getCookie, setCookie} from './cookies';\nimport {parseQueryString} from './url';\n\n\n/** @const {string} */\nconst COOKIE_NAME = 'AMP_EXP';\n\n/** @const {number} */\nconst COOKIE_MAX_AGE_DAYS = 180;  // 6 month\n\n/** @const {time} */\nconst COOKIE_EXPIRATION_INTERVAL = COOKIE_MAX_AGE_DAYS * 24 * 60 * 60 * 1000;\n\n/** @const {string} */\nconst CANARY_EXPERIMENT_ID = 'dev-channel';\n\n/** @type {Object<string, boolean>|undefined} */\nlet toggles_;\n\n/**\n * A wrapper to avoid a static side-effect.\n * @return {!Object<string, boolean>}\n */\nfunction experimentToggles() {\n  return toggles_ || (toggles_ = Object.create(null));\n}\n\n\n/**\n * Whether the scripts come from a dev channel.\n * @param {!Window} win\n * @return {boolean}\n */\nexport function isDevChannel(win) {\n  if (isExperimentOn(win, CANARY_EXPERIMENT_ID)) {\n    return true;\n  }\n  if (isDevChannelVersionDoNotUse_(win)) {\n    return true;\n  }\n  return false;\n}\n\n\n/**\n * Whether the version corresponds to the dev-channel binary.\n * @param {!Window} win\n * @return {boolean}\n * @private Visible for testing only!\n */\nexport function isDevChannelVersionDoNotUse_(win) {\n  return !!win.AMP_CONFIG && win.AMP_CONFIG.canary;\n}\n\n\n/**\n * Whether the specified experiment is on or off.\n * @param {!Window} win\n * @param {string} experimentId\n * @return {boolean}\n */\nexport function isExperimentOn(win, experimentId) {\n  const toggles = experimentToggles();\n  if (experimentId in toggles) {\n    return toggles[experimentId];\n  }\n  return toggles[experimentId] = calcExperimentOn(win, experimentId);\n}\n\n/**\n * Check whether an experiment is on while allowing viewers to force\n * the experiment state via a viewer URL param of the form:\n * `e-$experimentId=1` (on) or `e-$experimentId=0` (off).\n * NOTE: This should only be used if it is needed and if turning the\n * experiment on or off does not have security implications.\n * @param {!Window} win\n * @param {string} experimentId\n * @return {boolean}\n */\nexport function isExperimentOnAllowUrlOverride(win, experimentId) {\n  const hash = win.location.originalHash || win.location.hash;\n  if (hash) {\n    // Note: If this is used a lot, this should be optimized to only\n    // parse once per page load.\n    const param = parseQueryString(hash)['e-' + experimentId];\n    if (param == '1') {\n      return true;\n    }\n    if (param == '0') {\n      return false;\n    }\n  }\n  return isExperimentOn(win, experimentId);\n}\n\n/**\n * Calculate whether the specified experiment is on or off based off of the\n * cookieFlag or the global config frequency given.\n * @param {!Window} win\n * @param {string} experimentId\n * @return {boolean}\n */\nfunction calcExperimentOn(win, experimentId) {\n  const cookieFlag = getExperimentIds(win).indexOf(experimentId) != -1;\n  if (cookieFlag) {\n    return true;\n  }\n\n  if (win.AMP_CONFIG && win.AMP_CONFIG.hasOwnProperty(experimentId)) {\n    const frequency = win.AMP_CONFIG[experimentId];\n    return Math.random() < frequency;\n  }\n  return false;\n}\n\n\n/**\n * Toggles the experiment on or off. Returns the actual value of the experiment\n * after toggling is done.\n * @param {!Window} win\n * @param {string} experimentId\n * @param {boolean=} opt_on\n * @param {boolean=} opt_transientExperiment  Whether to toggle the\n *     experiment state \"transiently\" (i.e., for this page load only) or\n *     durably (by saving the experiment IDs to the cookie after toggling).\n *     Default: false (save durably).\n * @return {boolean} New state for experimentId.\n */\nexport function toggleExperiment(win, experimentId, opt_on,\n    opt_transientExperiment) {\n  const toggles = experimentToggles();\n  const experimentIds = getExperimentIds(win);\n  const currentlyOn = (experimentIds.indexOf(experimentId) != -1) ||\n      (experimentId in toggles && toggles[experimentId]);\n  const on = opt_on !== undefined ? opt_on : !currentlyOn;\n  if (on != currentlyOn) {\n    if (on) {\n      experimentIds.push(experimentId);\n      toggles[experimentId] = true;\n    } else {\n      experimentIds.splice(experimentIds.indexOf(experimentId), 1);\n      toggles[experimentId] = false;\n    }\n    if (!opt_transientExperiment) {\n      saveExperimentIds(win, experimentIds);\n    }\n  }\n  return on;\n}\n\n\n/**\n * Returns a set of experiment IDs currently on.\n * @param {!Window} win\n * @return {!Array<string>}\n */\nfunction getExperimentIds(win) {\n  if (win._experimentCookie) {\n    return win._experimentCookie;\n  }\n  const experimentCookie = getCookie(win, COOKIE_NAME);\n  return win._experimentCookie = (\n      experimentCookie ? experimentCookie.split(/\\s*,\\s*/g) : []);\n}\n\n\n/**\n * Saves a set of experiment IDs currently on.\n * @param {!Window} win\n * @param {!Array<string>} experimentIds\n */\nfunction saveExperimentIds(win, experimentIds) {\n  win._experimentCookie = null;\n  setCookie(win, COOKIE_NAME, experimentIds.join(','),\n      Date.now() + COOKIE_EXPIRATION_INTERVAL);\n}\n\n/**\n * Resets the experimentsToggle cache for testing purposes.\n * @visibleForTesting\n */\nexport function resetExperimentToggles_() {\n  toggles_ = undefined;\n}\n","/**\n * Copyright 2015 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n\n/**\n * @param {number=} opt_base Exponential base. Defaults to 2.\n * @return {function(function()): number} Function that when invoked will\n *     call the passed in function. On every invocation the next\n *     invocation of the passed in function will be exponentially\n *     later. Returned function returns timeout id.\n */\nexport function exponentialBackoff(opt_base) {\n  const getTimeout = exponentialBackoffClock(opt_base);\n  return work => {\n    return setTimeout(work, getTimeout());\n  };\n}\n\n/**\n * @param {number=} opt_base Exponential base. Defaults to 2.\n * @return {function(): number} Function that when invoked will return\n *    a number that exponentially grows per invocation.\n */\nexport function exponentialBackoffClock(opt_base) {\n  const base = opt_base || 2;\n  let count = 0;\n  return () => {\n    let wait = Math.pow(base, count++);\n    wait += getJitter(wait);\n    return wait * 1000;\n  };\n}\n\n/**\n * Add jitter to avoid the thundering herd. This can e.g. happen when\n * we poll a backend and it fails for everyone at the same time.\n * We add up to 30% (default) longer or shorter than the given time.\n *\n * @param {number} wait the amount if base milliseconds\n * @param {number=} opt_perc the min/max percentage to add or sutract\n * @return {number}\n */\nexport function getJitter(wait, opt_perc) {\n  opt_perc = opt_perc || .3;\n  let jitter = wait * opt_perc * Math.random();\n  if (Math.random() > .5) {\n    jitter *= -1;\n  }\n  return jitter;\n}\n","/**\n * Copyright 2016 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {getExistingServiceForWindow} from './service';\n\n\n/**\n * @param {!Window} window\n * @return {!./service/extensions-impl.Extensions}\n */\nexport function extensionsFor(window) {\n  return /** @type {!./service/extensions-impl.Extensions} */ (\n      getExistingServiceForWindow(window, 'extensions'));\n};\n","/**\n * Copyright 2015 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {dev} from './log';\nimport {parseUrl} from './url';\nimport {filterSplice} from './utils/array';\n\n/**\n * Sentinel used to force unlistening after a iframe is detached.\n * @type {string}\n */\nconst UNLISTEN_SENTINEL = 'unlisten';\n\n/**\n * @typedef {{\n *   frame: !Element,\n *   events: !Object<string, !Array<function(!Object)>>\n * }}\n */\nlet WindowEventsDef;\n\n/**\n * Returns a mapping from a URL's origin to an array of windows and their listenFor listeners.\n * @param {!Window} parentWin the window that created the iframe\n * @param {boolean=} opt_create create the mapping if it does not exist\n * @return {?Object<string, !Array<!WindowEventsDef>>}\n */\nfunction getListenFors(parentWin, opt_create) {\n  let listeningFors = parentWin.listeningFors;\n\n  if (!listeningFors && opt_create) {\n    listeningFors = parentWin.listeningFors = Object.create(null);\n  }\n  return listeningFors || null;\n}\n\n/**\n * Returns an array of WindowEventsDef that have had any listenFor listeners registered for this sentinel.\n * @param {!Window} parentWin the window that created the iframe\n * @param {string} sentinel the sentinel of the message\n * @param {boolean=} opt_create create the array if it does not exist\n * @return {?Array<!WindowEventsDef>}\n */\nfunction getListenForSentinel(parentWin, sentinel, opt_create) {\n  const listeningFors = getListenFors(parentWin, opt_create);\n  if (!listeningFors) {\n    return listeningFors;\n  }\n\n  let listenSentinel = listeningFors[sentinel];\n  if (!listenSentinel && opt_create) {\n    listenSentinel = listeningFors[sentinel] = [];\n  }\n  return listenSentinel || null;\n}\n\n/**\n * Returns an mapping of event names to listenFor listeners.\n * @param {!Window} parentWin the window that created the iframe\n * @param {!Element} iframe the iframe element who's context will trigger the\n *     event\n * @param {boolean=} opt_is3P set to true if the iframe is 3p.\n * @return {?Object<string, !Array<function(!Object, !Window, string)>>}\n */\nfunction getOrCreateListenForEvents(parentWin, iframe, opt_is3P) {\n  const origin = parseUrl(iframe.src).origin;\n  const sentinel = getSentinel_(iframe, opt_is3P);\n  const listenSentinel = getListenForSentinel(parentWin, sentinel, true);\n\n  let windowEvents;\n  for (let i = 0; i < listenSentinel.length; i++) {\n    const we = listenSentinel[i];\n    if (we.frame === iframe) {\n      windowEvents = we;\n      break;\n    }\n  }\n\n  if (!windowEvents) {\n    windowEvents = {\n      frame: iframe,\n      origin,\n      events: Object.create(null),\n    };\n    listenSentinel.push(windowEvents);\n  }\n\n  return windowEvents.events;\n}\n\n/**\n * Returns an mapping of event names to listenFor listeners.\n * @param {!Window} parentWin the window that created the iframe\n * @param {string} sentinel the sentinel of the message\n * @param {string} origin the source window's origin\n * @param {!Window} triggerWin the window that triggered the event\n * @return {?Object<string, !Array<function(!Object, !Window, string)>>}\n */\nfunction getListenForEvents(parentWin, sentinel, origin, triggerWin) {\n  const listenSentinel = getListenForSentinel(parentWin, sentinel);\n\n  if (!listenSentinel) {\n    return listenSentinel;\n  }\n\n  // Find the entry for the frame.\n  // TODO(@nekodo): Add a WeakMap<Window, WindowEventsDef> cache to\n  //     speed up this process.\n  let windowEvents;\n  for (let i = 0; i < listenSentinel.length; i++) {\n    const we = listenSentinel[i];\n    const contentWindow = we.frame.contentWindow;\n    if (!contentWindow) {\n      setTimeout(dropListenSentinel, 0, listenSentinel);\n    } else if (sentinel === 'amp') {\n      // A non-3P code path, origin must match.\n      if (we.origin === origin && contentWindow == triggerWin) {\n        windowEvents = we;\n        break;\n      }\n    } else if (triggerWin == contentWindow ||\n               isDescendantWindow(contentWindow, triggerWin)) {\n      // 3P code path, we may accept messages from nested frames.\n      windowEvents = we;\n      break;\n    }\n  }\n\n  return windowEvents ? windowEvents.events : null;\n}\n\n/**\n * Checks whether one window is a descendant of another by climbing\n * the parent chain.\n * @param {!Window} ancestor potential ancestor window\n * @param {!Window} descendant potential descendant window\n * @return {boolean}\n */\nfunction isDescendantWindow(ancestor, descendant) {\n  for (let win = descendant; win && win != win.parent; win = win.parent) {\n    if (win == ancestor) {\n      return true;\n    }\n  }\n  return false;\n}\n\n/**\n * Removes any listenFors registed on listenSentinel that do not have\n * a contentWindow (the frame was removed from the DOM tree).\n * @param {!Array<!WindowEventsDef>} listenSentinel\n */\nfunction dropListenSentinel(listenSentinel) {\n  const noopData = {sentinel: UNLISTEN_SENTINEL};\n\n  for (let i = listenSentinel.length - 1; i >= 0; i--) {\n    const windowEvents = listenSentinel[i];\n\n    if (!windowEvents.frame.contentWindow) {\n      listenSentinel.splice(i, 1);\n\n      const events = windowEvents.events;\n      for (const name in events) {\n        // Splice here, so that each unlisten does not shift the array\n        events[name].splice(0, Infinity).forEach(event => {\n          event(noopData);\n        });\n      }\n    }\n  }\n}\n\n/**\n * Registers the global listenFor event listener if it has yet to be.\n * @param {!Window} parentWin\n */\nfunction registerGlobalListenerIfNeeded(parentWin) {\n  if (parentWin.listeningFors) {\n    return;\n  }\n  const listenForListener = function(event) {\n    if (!event.data) {\n      return;\n    }\n    const data = parseIfNeeded(event.data);\n    if (!data.sentinel) {\n      return;\n    }\n\n    const listenForEvents = getListenForEvents(\n      parentWin,\n      data.sentinel,\n      event.origin,\n      event.source\n    );\n    if (!listenForEvents) {\n      return;\n    }\n\n    let listeners = listenForEvents[data.type];\n    if (!listeners) {\n      return;\n    }\n\n    // We slice to avoid issues with adding another listener or unlistening\n    // during iteration. We could move to a Doubly Linked List with\n    // backtracking, but that's overly complicated.\n    listeners = listeners.slice();\n    for (let i = 0; i < listeners.length; i++) {\n      const listener = listeners[i];\n      listener(data, event.source, event.origin);\n    }\n  };\n\n  parentWin.addEventListener('message', listenForListener);\n}\n\n/**\n * Allows listening for message from the iframe. Returns an unlisten\n * function to remove the listener.\n *\n * @param {!Element} iframe.\n * @param {string} typeOfMessage.\n * @param {?function(!Object, !Window, string)} callback Called when a message of\n *     this type arrives for this iframe.\n * @param {boolean=} opt_is3P set to true if the iframe is 3p.\n * @param {boolean=} opt_includingNestedWindows set to true if a messages from\n *     nested frames should also be accepted.\n * @return {!UnlistenDef}\n */\nexport function listenFor(\n    iframe, typeOfMessage, callback, opt_is3P, opt_includingNestedWindows) {\n  dev().assert(iframe.src, 'only iframes with src supported');\n  dev().assert(!iframe.parentNode, 'cannot register events on an attached ' +\n      'iframe. It will cause hair-pulling bugs like #2942');\n  dev().assert(callback);\n  const parentWin = iframe.ownerDocument.defaultView;\n\n  registerGlobalListenerIfNeeded(parentWin);\n\n  const listenForEvents = getOrCreateListenForEvents(\n    parentWin,\n    iframe,\n    opt_is3P\n  );\n\n\n  let events = listenForEvents[typeOfMessage] ||\n    (listenForEvents[typeOfMessage] = []);\n\n  let unlisten;\n  let listener = function(data, source, origin) {\n    // Exclude nested frames if necessary.\n    // Note that the source was already verified to be either the contentWindow\n    // of the iframe itself or a descendant window within it.\n    if (!opt_includingNestedWindows && source != iframe.contentWindow) {\n      return;\n    }\n\n    if (data.sentinel == UNLISTEN_SENTINEL) {\n      unlisten();\n      return;\n    }\n    callback(data, source, origin);\n  };\n\n  events.push(listener);\n\n  return unlisten = function() {\n    if (listener) {\n      const index = events.indexOf(listener);\n      if (index > -1) {\n        events.splice(index, 1);\n      }\n      // Make sure references to the unlisten function do not keep\n      // alive too much.\n      listener = null;\n      events = null;\n      callback = null;\n    }\n  };\n}\n\n/**\n * Returns a promise that resolves when one of given messages has been observed\n * for the first time. And remove listener for all other messages.\n * @param {!Element} iframe\n * @param {string|!Array<string>} typeOfMessages\n * @param {boolean=} opt_is3P\n * @return {!Promise<!{data, source, origin}>}\n */\nexport function listenForOncePromise(iframe, typeOfMessages, opt_is3P) {\n  const unlistenList = [];\n  if (typeof typeOfMessages == 'string') {\n    typeOfMessages = [typeOfMessages];\n  }\n  return new Promise(resolve => {\n    for (let i = 0; i < typeOfMessages.length; i++) {\n      const message = typeOfMessages[i];\n      const unlisten = listenFor(iframe, message, (data, source, origin) => {\n        for (let i = 0; i < unlistenList.length; i++) {\n          unlistenList[i]();\n        }\n        resolve({data, source, origin});\n      }, opt_is3P);\n      unlistenList.push(unlisten);\n    }\n  });\n}\n\n/**\n * Posts a message to the iframe.\n * @param {!Element} iframe The iframe.\n * @param {string} type Type of the message.\n * @param {!Object} object Message payload.\n * @param {string} targetOrigin origin of the target.\n * @param {boolean=} opt_is3P set to true if the iframe is 3p.\n */\nexport function postMessage(iframe, type, object, targetOrigin, opt_is3P) {\n  postMessageToWindows(iframe,\n      [{win: iframe.contentWindow, origin: targetOrigin}], type, object,\n      opt_is3P);\n}\n\n/**\n * Posts an identical message to multiple target windows with the same\n * sentinel.\n * The message is serialized only once.\n * @param {!Element} iframe The iframe.\n * @param {!Array<{win: !Window, origin: string}>} targets to send the message\n *     to, pairs of window and its origin.\n * @param {string} type Type of the message.\n * @param {!Object} object Message payload.\n * @param {boolean=} opt_is3P set to true if the iframe is 3p.\n */\nexport function postMessageToWindows(iframe, targets, type, object, opt_is3P) {\n  if (!iframe.contentWindow) {\n    return;\n  }\n  object.type = type;\n  object.sentinel = getSentinel_(iframe, opt_is3P);\n  let payload = object;\n  if (opt_is3P) {\n    // Serialize ourselves because that is much faster in Chrome.\n    payload = 'amp-' + JSON.stringify(object);\n  }\n  for (let i = 0; i < targets.length; i++) {\n    const target = targets[i];\n    target.win./*OK*/postMessage(payload, target.origin);\n  }\n}\n\n/**\n * Gets the sentinel string.\n * @param {!Element} iframe The iframe.\n * @param {boolean=} opt_is3P set to true if the iframe is 3p.\n * @returns {string} Sentinel string.\n * @private\n */\nfunction getSentinel_(iframe, opt_is3P) {\n  return opt_is3P ? iframe.getAttribute('data-amp-3p-sentinel') : 'amp';\n}\n\n/**\n * Json parses event.data if it needs to be\n * @returns {!Object} object message\n * @private\n */\nfunction parseIfNeeded(data) {\n  const shouldBeParsed = typeof data === 'string'\n      && data.charAt(0) === '{';\n  if (shouldBeParsed) {\n    try {\n      data = JSON.parse(data);\n    } catch (e) {\n      dev().warn('IFRAME-HELPER', 'Postmessage could not be parsed. ' +\n          'Is it in a valid JSON format?', e);\n    }\n  }\n  return /** @type {!Object} */ (data);\n}\n\n\n\n/**\n * Manages a postMessage API for an iframe with a subscription message and\n * a way to broadcast messages to all subscribed windows, which\n * in turn must all be descendants of the contentWindow of the iframe.\n */\nexport class SubscriptionApi {\n  /**\n   * @param {!Element} iframe The iframe.\n   * @param {string} type Type of the subscription message.\n   * @param {boolean} is3p set to true if the iframe is 3p.\n   * @param {function(!Object, !Window, string)} requestCallback Callback\n   *     invoked whenever a new window subscribes.\n   */\n  constructor(iframe, type, is3p, requestCallback) {\n    /** @private @const {!Element} */\n    this.iframe_ = iframe;\n    /** @private @const {boolean} */\n    this.is3p_ = is3p;\n    /** @private @const {!Array<{win: !Window, origin: string}>} */\n    this.clientWindows_ = [];\n\n    /** @private @const {!UnlistenDef} */\n    this.unlisten_ = listenFor(this.iframe_, type, (data, source, origin) => {\n      // This message might be from any window within the iframe, we need\n      // to keep track of which windows want to be sent updates.\n      if (!this.clientWindows_.some(entry => entry.win == source)) {\n        this.clientWindows_.push({win: source, origin});\n      }\n      requestCallback(data, source, origin);\n    }, this.is3p_,\n        // For 3P frames we also allow nested frames within them to subscribe..\n        this.is3p_ /* opt_includingNestedWindows */);\n  }\n\n  /**\n   * Sends a message to all subscribed windows.\n   * @param {string} type Type of the message.\n   * @param {!Object} data Message payload.\n   */\n  send(type, data) {\n    // Remove clients that have been removed from the DOM.\n    filterSplice(this.clientWindows_, client => !!client.win.parent);\n    postMessageToWindows(\n        this.iframe_,\n        this.clientWindows_,\n        type,\n        data,\n        this.is3p_);\n  }\n\n  destroy() {\n    this.unlisten_();\n    this.clientWindows_.length = 0;\n  }\n}\n","/**\n * Copyright 2016 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {dev} from './log';\nimport {layoutRectLtwh, rectIntersection, moveLayoutRect} from './layout-rect';\nimport {SubscriptionApi} from './iframe-helper';\n\n/**\n * The structure that defines the rectangle used in intersection observers.\n *\n * @typedef {{\n *   top: number,\n *   bottom: number,\n *   left: number,\n *   right: number,\n *   width: number,\n *   height: number,\n *   x: number,\n *   y: number,\n * }}\n */\nexport let DOMRect;\n\nexport const DEFAULT_THRESHOLD =\n    [0, 0.05, 0.1, 0.15, 0.2, 0.25, 0.3, 0.35, 0.4,\n    0.45, 0.5, 0.55, 0.6, 0.65, 0.7, 0.75, 0.8, 0.85, 0.9, 0.95, 1];\n\nconst INIT_TIME = Date.now();\n\n/**\n * A function to get the element's current IntersectionObserverEntry\n * regardless of the intersetion ratio. Only available when element is not\n * nested in a container iframe.\n * TODO: support opt_iframe if there's valid use cases.\n * @param {!./layout-rect.LayoutRectDef} element element's rect\n * @param {?./layout-rect.LayoutRectDef} owner element's owner rect\n * @param {!./layout-rect.LayoutRectDef} hostViewport hostViewport's rect\n * @return {!IntersectionObserverEntry} A change entry.\n */\nexport function getIntersectionChangeEntry(\n    element, owner, hostViewport) {\n  const intersection = rectIntersection(element, owner, hostViewport) ||\n      layoutRectLtwh(0, 0, 0, 0);\n  const ratio = intersectionRatio(intersection, element);\n  return calculateChangeEntry(\n      element, hostViewport, intersection, ratio);\n}\n\n/**\n * A class to help amp-iframe and amp-ad nested iframe listen to intersection\n * change.\n */\nexport class IntersectionObserverApi {\n  /**\n   * @param {!AMP.BaseElement} baseElement\n   * @param {!Element} iframe\n   * @param {boolean=} opt_is3p\n   */\n  constructor(baseElement, iframe, opt_is3p) {\n    /** @private @const {!AMP.BaseElement} */\n    this.baseElement_ = baseElement;\n\n    /** @private {?IntersectionObserverPolyfill} */\n    this.intersectionObserver_ = null;\n\n    /** @private {!boolean} */\n    this.shouldObserve_ = false;\n\n    /** @private {!boolean} */\n    this.isInViewport_ = false;\n\n    /** @private {?function()} */\n    this.unlistenOnDestroy_ = null;\n\n    /** @private @const {!./service/viewport-impl.Viewport} */\n    this.viewport_ = baseElement.getViewport();\n\n    /** @private {?SubscriptionApi} */\n    this.subscriptionApi_ = new SubscriptionApi(\n        iframe, 'send-intersections', opt_is3p || false, () => {\n          this.startSendingIntersection_();\n        });\n\n    this.intersectionObserver_ = new IntersectionObserverPolyfill(change => {\n      this.subscriptionApi_.send('intersection', {changes: [change]});\n    }, {threshold: DEFAULT_THRESHOLD});\n\n    /** @const {function()} */\n    this.fire = () => {\n      if (!this.shouldObserve_ || !this.isInViewport_) {\n        return;\n      }\n      this.intersectionObserver_.tick(this.viewport_.getRect());\n    };\n  }\n\n  /**\n   * Function to start listening to viewport event. and observer intersection\n   * change on the element.\n   */\n  startSendingIntersection_() {\n    this.shouldObserve_ = true;\n    this.intersectionObserver_.observe(this.baseElement_.element);\n    this.baseElement_.getVsync().measure(() => {\n      this.isInViewport_ = this.baseElement_.isInViewport();\n      this.fire();\n    });\n\n    const unlistenViewportScroll = this.viewport_.onScroll(this.fire);\n    const unlistenViewportChange = this.viewport_.onChanged(this.fire);\n    this.unlistenOnDestroy_ = () => {\n      unlistenViewportScroll();\n      unlistenViewportChange();\n    };\n  }\n\n  /**\n   * Enable to the PositionObserver to listen to viewport events\n   * @param {!boolean} inViewport\n   */\n  onViewportCallback(inViewport) {\n    this.isInViewport_ = inViewport;\n  }\n\n  /**\n   * Clean all listenrs\n   */\n  destroy() {\n    this.shouldObserve_ = false;\n    this.intersectionObserver_ = null;\n    if (this.unlistenOnDestroy_) {\n      this.unlistenOnDestroy_();\n      this.unlistenOnDestroy_ = null;\n    }\n    this.subscriptionApi_.destroy();\n    this.subscriptionApi_ = null;\n  }\n}\n\n\n/**\n * The IntersectionObserverPolyfill class lets any element receive its\n * intersection data with the viewport. It acts like native browser supported\n * IntersectionObserver.\n * The IntersectionObserver receives a callback function and an optional option\n * as params. Whenever the element intersection ratio cross a threshold value,\n * IntersectionObserverPolyfill will call the provided callback function with\n * the change entry.\n * @visibleForTesting\n */\nexport class IntersectionObserverPolyfill {\n  /**\n   * @param {!function(?IntersectionObserverEntry)} callback.\n   * @param {Object=} opt_option\n   */\n  constructor(callback, opt_option) {\n    /** @private @const {function(?IntersectionObserverEntry)} */\n    this.callback_ = callback;\n\n    /**\n     * A list of threshold, sorted in increasing numeric order\n     * @private @const {!Array}\n     */\n    const threshold = opt_option && opt_option.threshold || [0];\n    this.threshold_ = threshold.sort();\n    dev().assert(this.threshold_[0] >= 0 &&\n        this.threshold_[this.threshold_.length - 1] <= 1,\n        'Threshold should be in the range from \"[0, 1]\"');\n\n    /** @private {?Element} */\n    this.element_ = null;\n\n    /**\n     * The prev threshold slot which the previous ratio fills\n     * Range [0, this.threshold_.length]\n     * TODO: Do we always want to call callback at the first tick?\n     * @private {number}\n     */\n    this.prevThresholdSlot_ = 0;\n\n    // TODO: create the PositionObserver class, or create listener for position\n    // info if inside an iframe\n\n    // TODO: Add the postMessageApi logic outside IntersectionObserverPolyfill.\n  }\n\n  /**\n   * Provide a way to observer the intersection change for a specific element\n   * Please note that the IntersectionObserverPolyfill only allow to observe one\n   * element at a time.\n   * TODO: Support observing multiple elements.\n   * TODO: Support non AMP element\n   * @param {!Element} element\n   */\n  observe(element) {\n    // Check the element is an AMP element\n    dev().assert(element.isBuilt && element.isBuilt());\n    // Reset cached value for a new element\n\n    this.prevThresholdSlot_ = 0;\n    this.element_ = element;\n  }\n\n  // TODO: Support unobserve() function\n\n  /**\n   * Tick function that update the DOMRect of the root of observed element.\n   * Caller needs to make sure to pass in the correct container.\n   * Note: the opt_iframe param is the iframe position relative to the host doc,\n   * The iframe must be a non-scrollable iframe.\n   * @param {!./layout-rect.LayoutRectDef} hostViewport.\n   * @param {./layout-rect.LayoutRectDef=} opt_iframe\n   */\n  tick(hostViewport, opt_iframe) {\n    if (opt_iframe) {\n      // If element inside an iframe. Adjust origin to the iframe.left/top.\n      hostViewport =\n          moveLayoutRect(hostViewport, -opt_iframe.left, -opt_iframe.top);\n      opt_iframe =\n          moveLayoutRect(opt_iframe, -opt_iframe.left, -opt_iframe.top);\n    }\n\n    // Normalize container LayoutRect to be relative to page\n    let elementRect;\n    let ownerRect = null;\n\n    // If opt_iframe is provided, all LayoutRect has position relative to\n    // the iframe.\n    // If opt_iframe is not provided, all LayoutRect has position relative to\n    // the host document.\n    elementRect = this.element_.getLayoutBox();\n    const owner = this.element_.getOwner();\n    ownerRect = owner && owner.getLayoutBox();\n\n    const changeEntry = this.getValidIntersectionChangeEntry_(\n        elementRect, ownerRect, hostViewport, opt_iframe);\n    if (changeEntry) {\n      this.callback_(changeEntry);\n    }\n  }\n\n  /**\n   * Return a change entry for that should be compatible with\n   * IntersectionObserverEntry if it's valid with current config.\n   * When the new intersection ratio doesn't cross one of a threshold value,\n   * the function will return null.\n   *\n   * Mutates passed in rootBounds to have x and y according to spec.\n   *\n   * @param {!./layout-rect.LayoutRectDef} element element's rect\n   * @param {?./layout-rect.LayoutRectDef} owner element's owner rect\n   * @param {!./layout-rect.LayoutRectDef} hostViewport hostViewport's rect\n   * @param {./layout-rect.LayoutRectDef=} opt_iframe. iframe container rect\n   * @return {?IntersectionObserverEntry} A valid change entry or null if ratio\n   * does not fill in a new threshold bucket.\n   * @private\n   */\n  getValidIntersectionChangeEntry_(element, owner, hostViewport, opt_iframe) {\n    // calculate intersectionRect. that the element intersects with hostViewport\n    // and intersects with owner element and container iframe if exists.\n    const intersectionRect =\n        rectIntersection(element, owner, hostViewport, opt_iframe) ||\n        layoutRectLtwh(0, 0, 0, 0);\n\n    // calculate ratio, call callback based on new ratio value.\n    const ratio = intersectionRatio(intersectionRect, element);\n    const newThresholdSlot = getThresholdSlot(this.threshold_, ratio);\n    if (newThresholdSlot == this.prevThresholdSlot_) {\n      return null;\n    }\n    this.prevThresholdSlot_ = newThresholdSlot;\n\n    // To get same behavior as native IntersectionObserver set hostViewport null\n    // if inside an iframe\n    return calculateChangeEntry(\n        element, (opt_iframe ? null : hostViewport), intersectionRect, ratio);\n  }\n}\n\n/**\n * Transforms a LayoutRect into a DOMRect for use in intersection observers.\n * @param {!./layout-rect.LayoutRectDef} rect\n * @return {!DOMRect}\n */\nfunction DomRectFromLayoutRect(rect) {\n  return {\n    left: rect.left,\n    top: rect.top,\n    width: rect.width,\n    height: rect.height,\n    bottom: rect.bottom,\n    right: rect.right,\n    x: rect.left,\n    y: rect.top,\n  };\n}\n\n/**\n * Returns the ratio of the smaller box's area to the larger box's area.\n * @param {!./layout-rect.LayoutRectDef} smaller\n * @param {!./layout-rect.LayoutRectDef} larger\n * @return {number}\n */\nfunction intersectionRatio(smaller, larger) {\n  return (smaller.width * smaller.height) / (larger.width * larger.height);\n}\n\n/**\n * Returns the slot number that the current ratio fills in.\n * @param {!Array} sortedThreshold valid sorted IoB threshold\n * @param {number} ratio Range from [0, 1]\n * @return {number} Range from [0, threshold.length]\n * @visibleForTesting\n */\nexport function getThresholdSlot(sortedThreshold, ratio) {\n  let startIdx = 0;\n  let endIdx = sortedThreshold.length;\n  // 0 is a special case that does not fit into [small, large) range\n  if (ratio == 0) {\n    return 0;\n  }\n  let mid = ((startIdx + endIdx) / 2) | 0;\n  while (startIdx < mid) {\n    const midValue = sortedThreshold[mid];\n    // In the range of [small, large)\n    if (ratio < midValue) {\n      endIdx = mid;\n    } else {\n      startIdx = mid;\n    }\n    mid = ((startIdx + endIdx) / 2) | 0;\n  }\n  return endIdx;\n}\n\n/**\n * Helper function to calculate the IntersectionObserver change entry.\n * @param {!./layout-rect.LayoutRectDef} element element's rect\n * @param {?./layout-rect.LayoutRectDef} hostViewport hostViewport's rect\n * @param {!./layout-rect.LayoutRectDef} intersection\n * @param {number} ratio\n * @return {!IntersectionObserverEntry}}\n */\nfunction calculateChangeEntry(\n    element, hostViewport, intersection, ratio) {\n  // If element not in an iframe.\n  // adjust all LayoutRect to hostViewport Origin.\n  let boundingClientRect = element;\n  let rootBounds = hostViewport;\n  // If no hostViewport is provided, element is inside an non-scrollable iframe.\n  // Every Layoutrect has already adjust their origin according to iframe\n  // rect origin. LayoutRect position is relative to iframe origin,\n  // thus relative to iframe's viewport origin because the viewport is at the\n  // iframe origin. No need to adjust position here.\n\n  if (hostViewport) {\n    // If element not in an iframe.\n    // adjust all LayoutRect to hostViewport Origin.\n    rootBounds = /** @type {!./layout-rect.LayoutRectDef} */ (rootBounds);\n    intersection = moveLayoutRect(intersection, -hostViewport.left,\n        -hostViewport.top);\n    // The element is relative to (0, 0), while the viewport moves. So, we must\n    // adjust.\n    boundingClientRect = moveLayoutRect(boundingClientRect,\n        -hostViewport.left, -hostViewport.top);\n    // Now, move the viewport to (0, 0)\n    rootBounds = moveLayoutRect(rootBounds,\n        -hostViewport.left, -hostViewport.top);\n  }\n\n  return /** @type {!IntersectionObserverEntry} */ ({\n    time: (typeof performance !== 'undefined' && performance.now) ?\n        performance.now() : Date.now() - INIT_TIME,\n    rootBounds: rootBounds && DomRectFromLayoutRect(rootBounds),\n    boundingClientRect: DomRectFromLayoutRect(boundingClientRect),\n    intersectionRect: DomRectFromLayoutRect(intersection),\n    intersectionRatio: ratio,\n  });\n}\n","/**\n * Copyright 2015 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n\n/**\n * The structure that combines position and size for an element. The exact\n * interpretation of position and size depends on the use case.\n *\n * @typedef {{\n *   top: number,\n *   bottom: number,\n *   left: number,\n *   right: number,\n *   width: number,\n *   height: number\n * }}\n */\nexport let LayoutRectDef;\n\n\n/**\n * Creates a layout rect based on the left, top, width and height parameters\n * in that order.\n * @param {number} left\n * @param {number} top\n * @param {number} width\n * @param {number} height\n * @return {!LayoutRectDef}\n */\nexport function layoutRectLtwh(left, top, width, height) {\n  return {\n    left,\n    top,\n    width,\n    height,\n    bottom: top + height,\n    right: left + width,\n  };\n}\n\n\n/**\n * Creates a layout rect based on the DOMRect, e.g. obtained from calling\n * getBoundingClientRect.\n * @param {!ClientRect} rect\n * @return {!LayoutRectDef}\n */\nexport function layoutRectFromDomRect(rect) {\n  return layoutRectLtwh(Number(rect.left), Number(rect.top),\n      Number(rect.width), Number(rect.height));\n}\n\n/**\n * Returns true if the specified two rects overlap by a single pixel.\n * @param {!LayoutRectDef} r1\n * @param {!LayoutRectDef} r2\n * @return {boolean}\n */\nexport function layoutRectsOverlap(r1, r2) {\n  return (r1.top <= r2.bottom && r2.top <= r1.bottom &&\n      r1.left <= r2.right && r2.left <= r1.right);\n}\n\n\n/**\n * Returns the intersection between a, b or null if there is none.\n * @param {...?LayoutRectDef|undefined} var_args\n * @return {?LayoutRectDef}\n */\nexport function rectIntersection(var_args) {\n  let x0 = -Infinity;\n  let x1 = Infinity;\n  let y0 = -Infinity;\n  let y1 = Infinity;\n  for (let i = 0; i < arguments.length; i++) {\n    const current = arguments[i];\n    if (!current) {\n      continue;\n    }\n    x0 = Math.max(x0, current.left);\n    x1 = Math.min(x1, current.left + current.width);\n    y0 = Math.max(y0, current.top);\n    y1 = Math.min(y1, current.top + current.height);\n    if (x1 < x0 || y1 < y0) {\n      return null;\n    }\n  }\n  if (x1 == Infinity) {\n    return null;\n  }\n  return layoutRectLtwh(x0, y0, x1 - x0, y1 - y0);\n}\n\n\n/**\n * Expand the layout rect using multiples of width and height.\n * @param {!LayoutRectDef} rect Original rect.\n * @param {number} dw Expansion in width, specified as a multiple of width.\n * @param {number} dh Expansion in height, specified as a multiple of height.\n * @return {!LayoutRectDef}\n */\nexport function expandLayoutRect(rect, dw, dh) {\n  return {\n    top: rect.top - rect.height * dh,\n    bottom: rect.bottom + rect.height * dh,\n    left: rect.left - rect.width * dw,\n    right: rect.right + rect.width * dw,\n    width: rect.width * (1 + dw * 2),\n    height: rect.height * (1 + dh * 2),\n  };\n}\n\n\n/**\n * Moves the layout rect using dx and dy.\n * @param {!LayoutRectDef} rect Original rect.\n * @param {number} dx Move horizontally with this value.\n * @param {number} dy Move vertically with this value.\n * @return {!LayoutRectDef}\n */\nexport function moveLayoutRect(rect, dx, dy) {\n  if ((dx == 0 && dy == 0) ||\n      (rect.width == 0 && rect.height == 0)) {\n    return rect;\n  }\n  return layoutRectLtwh(rect.left + dx, rect.top + dy,\n      rect.width, rect.height);\n}\n","/**\n * Copyright 2015 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * @fileoverview Implements element layout. See https://goo.gl/9avXuT for\n * details.\n */\n\nimport {dev, user} from './log';\nimport {isFiniteNumber} from './types';\nimport {setStyles} from './style';\nimport {isExperimentOn} from './experiments';\n\n/** @const {string} */\nexport const UX_EXPERIMENT = 'amp-ad-loading-ux';\n\n/**\n * @enum {string}\n */\nexport const Layout = {\n  NODISPLAY: 'nodisplay',\n  FIXED: 'fixed',\n  FIXED_HEIGHT: 'fixed-height',\n  RESPONSIVE: 'responsive',\n  CONTAINER: 'container',\n  FILL: 'fill',\n  FLEX_ITEM: 'flex-item',\n};\n\n\n/**\n * CSS Length type. E.g. \"1px\" or \"20vh\".\n * @typedef {string}\n */\nexport let LengthDef;\n\n\n/**\n * @typedef {{\n *   width: string,\n *   height: string\n * }}\n */\nlet DimensionsDef;\n\n\n/**\n * The set of elements with natural dimensions, that is, elements\n * which have a known dimension either based on their value specified here,\n * or, if the value is null, a dimension specific to the browser.\n * `hasNaturalDimensions` checks for membership in this set.\n * `getNaturalDimensions` determines the dimensions for an element in the\n *    set and caches it.\n * @type {!Object<string, ?DimensionsDef>}\n * @private  Visible for testing only!\n */\nexport const naturalDimensions_ = {\n  'AMP-PIXEL': {width: '1px', height: '1px'},\n  'AMP-ANALYTICS': {width: '1px', height: '1px'},\n  // TODO(dvoytenko): audio should have width:auto.\n  'AMP-AUDIO': null,\n  'AMP-SOCIAL-SHARE': {width: '60px', height: '44px'},\n};\n\n\n/**\n * Elements that the progess can be shown for. This set has to be externalized\n * since the element's implementation may not be downloaded yet.\n * @enum {boolean}\n * @private  Visible for testing only!\n */\nexport const LOADING_ELEMENTS_ = {\n  'AMP-ANIM': true,\n  'AMP-BRIGHTCOVE': true,\n  'AMP-EMBED': true,\n  'AMP-IFRAME': true,\n  'AMP-IMG': true,\n  'AMP-INSTAGRAM': true,\n  'AMP-LIST': true,\n  'AMP-PINTEREST': true,\n  'AMP-VIDEO': true,\n  'AMP-YOUTUBE': true,\n};\n\n\n/**\n * @param {string} s\n * @return {Layout|undefined} Returns undefined in case of failure to parse\n *   the layout string.\n */\nexport function parseLayout(s) {\n  for (const k in Layout) {\n    if (Layout[k] == s) {\n      return Layout[k];\n    }\n  }\n  return undefined;\n}\n\n\n/**\n * @param {!Layout} layout\n * @return {string}\n */\nexport function getLayoutClass(layout) {\n  return '-amp-layout-' + layout;\n}\n\n\n/**\n * Whether an element with this layout inherently defines the size.\n * @param {!Layout} layout\n * @return {boolean}\n */\nexport function isLayoutSizeDefined(layout) {\n  return (layout == Layout.FIXED ||\n      layout == Layout.FIXED_HEIGHT ||\n      layout == Layout.RESPONSIVE ||\n      layout == Layout.FILL ||\n      layout == Layout.FLEX_ITEM);\n}\n\n\n/**\n * Whether the tag is an internal (service) AMP tag.\n * @param {!Node|string} tag\n * @return {boolean}\n */\nexport function isInternalElement(tag) {\n  const tagName = (typeof tag == 'string') ? tag : tag.tagName;\n  return tagName && tagName.toLowerCase().indexOf('i-') == 0;\n}\n\n\n/**\n * Parses the CSS length value. If no units specified, the assumed value is\n * \"px\". Returns undefined in case of parsing error.\n * @param {string|undefined} s\n * @return {!LengthDef|undefined}\n */\nexport function parseLength(s) {\n  if (typeof s == 'number') {\n    return s + 'px';\n  }\n  if (!s) {\n    return undefined;\n  }\n  if (!/^\\d+(\\.\\d+)?(px|em|rem|vh|vw|vmin|vmax|cm|mm|q|in|pc|pt)?$/.test(s)) {\n    return undefined;\n  }\n  if (/^\\d+(\\.\\d+)?$/.test(s)) {\n    return s + 'px';\n  }\n  return s;\n}\n\n\n\n/**\n * Asserts that the supplied value is a non-percent CSS Length value.\n * @param {!LengthDef|string|null|undefined} length\n * @return {!LengthDef}\n */\nexport function assertLength(length) {\n  user().assert(\n      /^\\d+(\\.\\d+)?(px|em|rem|vh|vw|vmin|vmax|cm|mm|q|in|pc|pt)$/.test(length),\n      'Invalid length value: %s', length);\n  return /** @type {!LengthDef} */ (length);\n}\n\n\n\n\n/**\n * Asserts that the supplied value is a CSS Length value\n * (including percent unit).\n * @param {!LengthDef|string} length\n * @return {!LengthDef}\n */\nexport function assertLengthOrPercent(length) {\n  user().assert(/^\\d+(\\.\\d+)?(px|em|rem|vh|vw|vmin|vmax|%)$/.test(length),\n      'Invalid length or percent value: %s', length);\n  return length;\n}\n\n\n/**\n * Returns units from the CSS length value.\n * @param {!LengthDef|string|null|undefined} length\n * @return {string}\n */\nexport function getLengthUnits(length) {\n  assertLength(length);\n  dev().assertString(length);\n  const m = user().assert(length.match(/[a-z]+/i),\n      'Failed to read units from %s', length);\n  return m[0];\n}\n\n\n/**\n * Returns the numeric value of a CSS length value.\n * @param {!LengthDef|string|null|undefined} length\n * @return {number|undefined}\n */\nexport function getLengthNumeral(length) {\n  const res = parseFloat(length);\n  return !isFiniteNumber(res) ? undefined : res;\n}\n\n\n/**\n * Determines whether the tagName is a known element that has natural dimensions\n * in our runtime or the browser.\n * @param {string} tagName The element tag name.\n * @return {boolean}\n */\nexport function hasNaturalDimensions(tagName) {\n  tagName = tagName.toUpperCase();\n  return naturalDimensions_[tagName] !== undefined;\n}\n\n\n/**\n * Determines the default dimensions for an element which could vary across\n * different browser implementations, like <audio> for instance.\n * This operation can only be completed for an element whitelisted by\n * `hasNaturalDimensions`.\n * @param {!Element} element\n * @return {DimensionsDef}\n */\nexport function getNaturalDimensions(element) {\n  const tagName = element.tagName.toUpperCase();\n  dev().assert(naturalDimensions_[tagName] !== undefined);\n  if (!naturalDimensions_[tagName]) {\n    const doc = element.ownerDocument;\n    const naturalTagName = tagName.replace(/^AMP\\-/, '');\n    const temp = doc.createElement(naturalTagName);\n    // For audio, should no-op elsewhere.\n    temp.controls = true;\n    setStyles(temp, {\n      position: 'absolute',\n      visibility: 'hidden',\n    });\n    doc.body.appendChild(temp);\n    naturalDimensions_[tagName] = {\n      width: (temp./*OK*/offsetWidth || 1) + 'px',\n      height: (temp./*OK*/offsetHeight || 1) + 'px',\n    };\n    doc.body.removeChild(temp);\n  }\n  return /** @type {DimensionsDef} */ (naturalDimensions_[tagName]);\n}\n\n\n/**\n * Whether the loading can be shown for the specified elemeent. This set has\n * to be externalized since the element's implementation may not be\n * downloaded yet.\n * @param {!Element} element.\n * @return {boolean}\n */\nexport function isLoadingAllowed(element) {\n  const tagName = element.tagName.toUpperCase();\n  if (tagName == 'AMP-AD' || tagName == 'AMP-EMBED') {\n    const win = element.ownerDocument.defaultView;\n    if (isExperimentOn(win, UX_EXPERIMENT)) {\n      return true;\n    }\n  }\n  return LOADING_ELEMENTS_[tagName] || false;\n}\n","/**\n * Copyright 2015 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n\n/**\n * Creates a default \"loading indicator\" element. This element accepts\n * `amp-active` class in which case it may choose to run an animation.\n * @param {!Document} doc\n * @return {!Element}\n */\nexport function createLoaderElement(doc) {\n  const loader = doc.createElement('div');\n  loader.classList.add('-amp-loader');\n  for (let i = 0; i < 3; i++) {\n    const dot = doc.createElement('div');\n    dot.classList.add('-amp-loader-dot');\n    loader.appendChild(dot);\n  }\n  return loader;\n}\n","/**\n * Copyright 2015 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {getMode} from './mode';\nimport {getModeObject} from './mode-object';\n\n\n/** @const Time when this JS loaded.  */\nconst start = Date.now();\n\n/**\n * Triple zero width space.\n *\n * This is added to user error messages, so that we can later identify\n * them, when the only thing that we have is the message. This is the\n * case in many browsers when the global exception handler is invoked.\n *\n * @const {string}\n */\nexport const USER_ERROR_SENTINEL = '\\u200B\\u200B\\u200B';\n\n\n/**\n * @return {boolean} Whether this message was a user error.\n */\nexport function isUserErrorMessage(message) {\n  return message.indexOf(USER_ERROR_SENTINEL) >= 0;\n}\n\n\n/**\n * @enum {number}\n * @private Visible for testing only.\n */\nexport const LogLevel = {\n  OFF: 0,\n  ERROR: 1,\n  WARN: 2,\n  INFO: 3,\n  FINE: 4,\n};\n\n\n/**\n * Logging class.\n * @final\n * @private Visible for testing only.\n */\nexport class Log {\n  /**\n   * @param {!Window} win\n   * @param {function(!./mode.ModeDef):!LogLevel} levelFunc\n   * @param {string=} opt_suffix\n   */\n  constructor(win, levelFunc, opt_suffix) {\n    /**\n     * In tests we use the main test window instead of the iframe where\n     * the tests runs because only the former is relayed to the console.\n     * @const {!Window}\n     */\n    this.win = (getMode().test && win.AMP_TEST_IFRAME) ? win.parent : win;\n\n    /** @private @const {function(!./mode.ModeDef):!LogLevel} */\n    this.levelFunc_ = levelFunc;\n\n    /** @private @const {!LogLevel} */\n    this.level_ = this.calcLevel_();\n\n    /** @private @const {string} */\n    this.suffix_ = opt_suffix || '';\n  }\n\n  /**\n   * @return {!LogLevel}\n   * @private\n   */\n  calcLevel_() {\n    // No console - can't enable logging.\n    if (!this.win.console || !this.win.console.log) {\n      return LogLevel.OFF;\n    }\n\n    // Logging has been explicitly disabled.\n    if (getMode().log == '0') {\n      return LogLevel.OFF;\n    }\n\n    // Logging is enabled for tests directly.\n    if (getMode().test && this.win.ENABLE_LOG) {\n      return LogLevel.FINE;\n    }\n\n    // LocalDev by default allows INFO level, unless overriden by `#log`.\n    if (getMode().localDev && !getMode().log) {\n      return LogLevel.INFO;\n    }\n\n    // Delegate to the specific resolver.\n    return this.levelFunc_(getModeObject());\n  }\n\n  /**\n   * @param {string} tag\n   * @param {string} level\n   * @param {!Array} messages\n   */\n  msg_(tag, level, messages) {\n    if (this.level_ != LogLevel.OFF) {\n      let fn = this.win.console.log;\n      if (level == 'ERROR') {\n        fn = this.win.console.error || fn;\n      } else if (level == 'INFO') {\n        fn = this.win.console.info || fn;\n      } else if (level == 'WARN') {\n        fn = this.win.console.warn || fn;\n      }\n      messages.unshift(Date.now() - start, '[' + tag + ']');\n      fn.apply(this.win.console, messages);\n    }\n  }\n\n  /**\n   * Whether the logging is enabled.\n   * @return {boolean}\n   */\n  isEnabled() {\n    return this.level_ != LogLevel.OFF;\n  }\n\n  /**\n   * Reports a fine-grained message.\n   * @param {string} tag\n   * @param {...*} var_args\n   */\n  fine(tag, var_args) {\n    if (this.level_ >= LogLevel.FINE) {\n      this.msg_(tag, 'FINE', Array.prototype.slice.call(arguments, 1));\n    }\n  }\n\n  /**\n   * Reports a informational message.\n   * @param {string} tag\n   * @param {...*} var_args\n   */\n  info(tag, var_args) {\n    if (this.level_ >= LogLevel.INFO) {\n      this.msg_(tag, 'INFO', Array.prototype.slice.call(arguments, 1));\n    }\n  }\n\n  /**\n   * Reports a warning message.\n   * @param {string} tag\n   * @param {...*} var_args\n   */\n  warn(tag, var_args) {\n    if (this.level_ >= LogLevel.WARN) {\n      this.msg_(tag, 'WARN', Array.prototype.slice.call(arguments, 1));\n    }\n  }\n\n  /**\n   * Reports an error message. If the logging is disabled, the error is rethrown\n   * asynchronously.\n   * @param {string} tag\n   * @param {...*} var_args\n   */\n  error(tag, var_args) {\n    if (this.level_ >= LogLevel.ERROR) {\n      this.msg_(tag, 'ERROR', Array.prototype.slice.call(arguments, 1));\n    } else {\n      const error = createErrorVargs.apply(null,\n          Array.prototype.slice.call(arguments, 1));\n      this.prepareError_(error);\n      this.win.setTimeout(() => {throw error;});\n    }\n  }\n\n  /**\n   * Creates an error object.\n   * @param {...*} var_args\n   * @return {!Error}\n   */\n  createError(var_args) {\n    const error = createErrorVargs.apply(null, arguments);\n    this.prepareError_(error);\n    return error;\n  }\n\n  /**\n   * Throws an error if the first argument isn't trueish.\n   *\n   * Supports argument substitution into the message via %s placeholders.\n   *\n   * Throws an error object that has two extra properties:\n   * - associatedElement: This is the first element provided in the var args.\n   *   It can be used for improved display of error messages.\n   * - messageArray: The elements of the substituted message as non-stringified\n   *   elements in an array. When e.g. passed to console.error this yields\n   *   native displays of things like HTML elements.\n   *\n   * @param {T} shouldBeTrueish The value to assert. The assert fails if it does\n   *     not evaluate to true.\n   * @param {string=} opt_message The assertion message\n   * @param {...*} var_args Arguments substituted into %s in the message.\n   * @return {T} The value of shouldBeTrueish.\n   * @template T\n   */\n  /*eslint \"google-camelcase/google-camelcase\": 0*/\n  assert(shouldBeTrueish, opt_message, var_args) {\n    let firstElement;\n    if (!shouldBeTrueish) {\n      const message = opt_message || 'Assertion failed';\n      const splitMessage = message.split('%s');\n      const first = splitMessage.shift();\n      let formatted = first;\n      const messageArray = [];\n      pushIfNonEmpty(messageArray, first);\n      for (let i = 2; i < arguments.length; i++) {\n        const val = arguments[i];\n        if (val && val.tagName) {\n          firstElement = val;\n        }\n        const nextConstant = splitMessage.shift();\n        messageArray.push(val);\n        pushIfNonEmpty(messageArray, nextConstant.trim());\n        formatted += toString(val) + nextConstant;\n      }\n      const e = new Error(formatted);\n      e.fromAssert = true;\n      e.associatedElement = firstElement;\n      e.messageArray = messageArray;\n      this.prepareError_(e);\n      throw e;\n    }\n    return shouldBeTrueish;\n  }\n\n  /**\n   * Throws an error if the first argument isn't an Element\n   *\n   * Otherwise see `assert` for usage\n   *\n   * @param {*} shouldBeElement\n   * @param {string=} opt_message The assertion message\n   * @return {!Element} The value of shouldBeTrueish.\n   * @template T\n   */\n  /*eslint \"google-camelcase/google-camelcase\": 2*/\n  assertElement(shouldBeElement, opt_message) {\n    const shouldBeTrueish = shouldBeElement && shouldBeElement.nodeType == 1;\n    this.assert(shouldBeTrueish, (opt_message || 'Element expected') + ': %s',\n        shouldBeElement);\n    return /** @type {!Element} */ (shouldBeElement);\n  }\n\n  /**\n   * Throws an error if the first argument isn't a string.\n   *\n   * Otherwise see `assert` for usage\n   *\n   * @param {*} shouldBeString\n   * @param {string=} opt_message The assertion message\n   * @return {string} The value of shouldBeTrueish.\n   * @template T\n   */\n  /*eslint \"google-camelcase/google-camelcase\": 2*/\n  assertString(shouldBeString, opt_message) {\n    this.assert(typeof shouldBeString == 'string',\n        (opt_message || 'String expected') + ': %s', shouldBeString);\n    return /** @type {string} */ (shouldBeString);\n  }\n\n  /**\n   * Throws an error if the first argument isn't a number.\n   *\n   * Otherwise see `assert` for usage\n   *\n   * @param {*} shouldBeNumber\n   * @param {string=} opt_message The assertion message\n   * @return {number} The value of shouldBeTrueish.\n   */\n  assertNumber(shouldBeNumber, opt_message) {\n    this.assert(typeof shouldBeNumber == 'number',\n        (opt_message || 'Number expected') + ': %s', shouldBeNumber);\n    return /** @type {number} */ (shouldBeNumber);\n  }\n\n  /**\n   * Asserts and returns the enum value. If the enum doesn't contain such a value,\n   * the error is thrown.\n   *\n   * @param {!Object<T>} enumObj\n   * @param {string} s\n   * @param {string=} opt_enumName\n   * @return T\n   * @template T\n   */\n  /*eslint \"google-camelcase/google-camelcase\": 2*/\n  assertEnumValue(enumObj, s, opt_enumName) {\n    for (const k in enumObj) {\n      if (enumObj[k] == s) {\n        return enumObj[k];\n      }\n    }\n    this.assert(false,\n        'Unknown %s value: \"%s\"',\n        opt_enumName || 'enum', s);\n  }\n\n  /**\n   * @param {!Error} error\n   * @private\n   */\n  prepareError_(error) {\n    if (this.suffix_) {\n      if (!error.message) {\n        error.message = this.suffix_;\n      } else if (error.message.indexOf(this.suffix_) == -1) {\n        error.message += this.suffix_;\n      }\n    }\n  }\n}\n\n\n/**\n * @param {string|!Element} val\n * @return {string}\n */\nfunction toString(val) {\n  if (val instanceof Element) {\n    return val.tagName.toLowerCase() + (val.id ? '#' + val.id : '');\n  }\n  return val;\n}\n\n\n/**\n * @param {!Array} array\n * @param {*} val\n */\nfunction pushIfNonEmpty(array, val) {\n  if (val != '') {\n    array.push(val);\n  }\n}\n\n\n/**\n * @param {...*} var_args\n * @return {!Error}\n * @private\n */\nfunction createErrorVargs(var_args) {\n  let error = null;\n  let message = '';\n  for (let i = 0; i < arguments.length; i++) {\n    const arg = arguments[i];\n    if (arg instanceof Error && !error) {\n      error = arg;\n    } else {\n      if (message) {\n        message += ' ';\n      }\n      message += arg;\n    }\n  }\n  if (!error) {\n    error = new Error(message);\n  } else if (message) {\n    error.message = message + ': ' + error.message;\n  }\n  return error;\n}\n\n\n/**\n * Rethrows the error without terminating the current context. This preserves\n * whether the original error designation is a user error or a dev error.\n * @param {...*} var_args\n */\nexport function rethrowAsync(var_args) {\n  const error = createErrorVargs.apply(null, arguments);\n  setTimeout(() => {throw error;});\n}\n\n\n/**\n * Cache for logs. We do not use a Service since the service module depends\n * on Log and closure literally can't even.\n * @type {{user: ?Log, dev: ?Log}}\n */\nself.log = (self.log || {\n  user: null,\n  dev: null,\n});\n\nconst logs = self.log;\n\n/**\n * Eventually holds a constructor for Log objects. Lazily initialized, so we\n * can avoid ever referencing the real constructor except in JS binaries\n * that actually want to include the implementation.\n * @type {?Function}\n */\nlet logConstructor = null;\n\n\nexport function initLogConstructor() {\n  logConstructor = Log;\n  // Initialize instances for use. If a binary (an extension for example) that\n  // does not call `initLogConstructor` invokes `dev()` or `user()` earlier\n  // than the binary that does call `initLogConstructor` (amp.js), the extension\n  // will throw an error as that extension will never be able to initialize\n  // the log instances and we also don't want it to call `initLogConstructor`\n  // either (since that will cause the Log implementation to be bundled into that\n  // binary). So we must initialize the instances eagerly so that they are\n  // ready for use (stored globally) after the main binary calls\n  // `initLogConstructor`.\n  dev();\n  user();\n}\n\nexport function resetLogConstructorForTesting() {\n  logConstructor = null;\n}\n\n\n/**\n * Publisher level log.\n *\n * Enabled in the following conditions:\n *  1. Not disabled using `#log=0`.\n *  2. Development mode is enabled via `#development=1` or logging is explicitly\n *     enabled via `#log=D` where D >= 1.\n *\n * @return {!Log}\n */\nexport function user() {\n  if (logs.user) {\n    return logs.user;\n  }\n  if (!logConstructor) {\n    throw new Error('failed to call initLogConstructor');\n  }\n  return logs.user = new logConstructor(self, mode => {\n    const logNum = parseInt(mode.log, 10);\n    if (mode.development || logNum >= 1) {\n      return LogLevel.FINE;\n    }\n    return LogLevel.OFF;\n  }, USER_ERROR_SENTINEL);\n}\n\n\n/**\n * AMP development log. Calls to `devLog().assert` and `dev.fine` are stripped in\n * the PROD binary. However, `devLog().assert` result is preserved in either case.\n *\n * Enabled in the following conditions:\n *  1. Not disabled using `#log=0`.\n *  2. Logging is explicitly enabled via `#log=D`, where D >= 2.\n *\n * @return {!Log}\n */\nexport function dev() {\n  if (logs.dev) {\n    return logs.dev;\n  }\n  if (!logConstructor) {\n    throw new Error('failed to call initLogConstructor');\n  }\n  return logs.dev = new logConstructor(self, mode => {\n    const logNum = parseInt(mode.log, 10);\n    if (logNum >= 3) {\n      return LogLevel.FINE;\n    }\n    if (logNum >= 2) {\n      return LogLevel.INFO;\n    }\n    return LogLevel.OFF;\n  });\n}\n","/**\n * Copyright 2016 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {getMode} from './mode';\n\n/**\n * Provides info about the current app. This return value may be cached and\n * passed around as it will always be DCE'd.\n * @param {?Window=} opt_win\n * @return {!./mode.ModeDef}\n */\nexport function getModeObject(opt_win) {\n  return {\n    localDev: getMode(opt_win).localDev,\n    development: getMode(opt_win).development,\n    filter: getMode(opt_win).filter,\n    minified: getMode(opt_win).minified,\n    lite: getMode(opt_win).lite,\n    test: getMode(opt_win).test,\n    log: getMode(opt_win).log,\n    version: getMode(opt_win).version,\n    rtvVersion: getMode(opt_win).rtvVersion,\n  };\n}\n","/**\n * Copyright 2015 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n\n/**\n * @typedef {{\n *   localDev: boolean,\n *   development: boolean,\n *   filter: (string|undefined),\n *   minified: boolean,\n *   lite: boolean,\n *   test: boolean,\n *   log: (string|undefined),\n *   version: string,\n *   rtvVersion: string,\n * }}\n */\nexport let ModeDef;\n\n/** @type {string} */\nconst version = '$internalRuntimeVersion$';\n\n/**\n * `rtvVersion` is the prefixed version we serve off of the cdn.\n * The prefix denotes canary(00) or prod(01) or an experiment version ( > 01).\n * @type {string}\n */\nlet rtvVersion = '';\n\n/**\n * A #querySelector query to see if we have any scripts with development paths.\n * @type {string}\n */\nconst developmentScriptQuery = 'script[src*=\"/dist/\"],script[src*=\"/base/\"]';\n\n/**\n * Provides info about the current app.\n * @param {?Window=} opt_win\n * @return {!ModeDef}\n */\nexport function getMode(opt_win) {\n  const win = opt_win || self;\n  if (win.AMP_MODE) {\n    return win.AMP_MODE;\n  }\n  return win.AMP_MODE = getMode_(win);\n}\n\n/**\n * Provides info about the current app.\n * @param {!Window} win\n * @return {!ModeDef}\n */\nfunction getMode_(win) {\n  // For 3p integration code\n  if (win.context && win.context.mode) {\n    return win.context.mode;\n  }\n\n  // Magic constants that are replaced by closure compiler.\n  // IS_MINIFIED is always replaced with true when closure compiler is used\n  // while IS_DEV is only replaced when the --fortesting flag is NOT used.\n  const IS_DEV = true;\n  const IS_MINIFIED = false;\n  const FORCE_LOCALDEV = !!(self.AMP_CONFIG && self.AMP_CONFIG.localDev);\n  const AMP_CONFIG_3P_FRAME_HOST = self.AMP_CONFIG &&\n      self.AMP_CONFIG.thirdPartyFrameHost;\n\n  const isLocalDev = IS_DEV && !!(win.location.hostname == 'localhost' ||\n      (FORCE_LOCALDEV && win.location.hostname == AMP_CONFIG_3P_FRAME_HOST) ||\n      (win.location.ancestorOrigins && win.location.ancestorOrigins[0] &&\n        win.location.ancestorOrigins[0].indexOf('http://localhost:') == 0)) &&\n      // Filter out localhost running against a prod script.\n      // Because all allowed scripts are ours, we know that these can only\n      // occur during local dev.\n      (!win.document || !!win.document.querySelector(developmentScriptQuery));\n\n  const hashQuery = parseQueryString_(\n      // location.originalHash is set by the viewer when it removes the fragment\n      // from the URL.\n      win.location.originalHash || win.location.hash);\n\n  const searchQuery = parseQueryString_(win.location.search);\n\n  if (!rtvVersion) {\n    rtvVersion = getRtvVersion(win, isLocalDev);\n  }\n\n  // The `minified`, `test` and `localDev` properties are replaced\n  // as boolean literals when we run `gulp dist` without the `--fortesting`\n  // flags. This improved DCE on the production file we deploy as the code\n  // paths for localhost/testing/development are eliminated.\n  return {\n    localDev: isLocalDev,\n    // Triggers validation\n    development: !!(hashQuery['development'] == '1' ||\n        win.AMP_DEV_MODE),\n    // Allows filtering validation errors by error category. For the\n    // available categories, see ErrorCategory in validator/validator.proto.\n    filter: hashQuery['filter'],\n    minified: IS_MINIFIED,\n    // Whether document is in an amp-lite viewer. It signal that the user\n    // would prefer to use less bandwidth.\n    lite: searchQuery['amp_lite'] != undefined,\n    test: IS_DEV && !!(win.AMP_TEST || win.__karma__),\n    log: hashQuery['log'],\n    version,\n    rtvVersion,\n  };\n}\n\n/**\n * Parses the query string of an URL. This method returns a simple key/value\n * map. If there are duplicate keys the latest value is returned.\n * @param {string} queryString\n * @return {!Object<string, string>}\n * TODO(dvoytenko): dedupe with `url.js:parseQueryString`. This is currently\n * necessary here because `url.js` itself inderectly depends on `mode.js`.\n */\nfunction parseQueryString_(queryString) {\n  const params = Object.create(null);\n  if (!queryString) {\n    return params;\n  }\n  if (queryString.indexOf('?') == 0 || queryString.indexOf('#') == 0) {\n    queryString = queryString.substr(1);\n  }\n  const pairs = queryString.split('&');\n  for (let i = 0; i < pairs.length; i++) {\n    const pair = pairs[i];\n    const eqIndex = pair.indexOf('=');\n    let name;\n    let value;\n    if (eqIndex != -1) {\n      name = decodeURIComponent(pair.substring(0, eqIndex)).trim();\n      value = decodeURIComponent(pair.substring(eqIndex + 1)).trim();\n    } else {\n      name = decodeURIComponent(pair).trim();\n      value = '';\n    }\n    if (name) {\n      params[name] = value;\n    }\n  }\n  return params;\n}\n\n\n/**\n * Retrieve the `rtvVersion` which will have a numeric prefix\n * denoting canary/prod/experiment.\n *\n * @param {!Window} win\n * @param {boolean} isLocalDev\n * @return {string}\n */\nfunction getRtvVersion(win, isLocalDev) {\n  // If it's local dev then we won't actually have a full version so\n  // just use the version.\n  if (isLocalDev) {\n    return version;\n  }\n\n  if (win.AMP_CONFIG && win.AMP_CONFIG.v) {\n    return win.AMP_CONFIG.v;\n  }\n\n  // Currently `$internalRuntimeVersion$` and thus `mode.version` contain only\n  // major version. The full version however must also carry the minor version.\n  // We will default to production default `01` minor version for now.\n  // TODO(erwinmombay): decide whether $internalRuntimeVersion$ should contain\n  // minor version.\n  return `01${version}`;\n}\n\n\n/**\n * @param {!Window} win\n * @param {boolean} isLocalDev\n * @return {string}\n * @visibleForTesting\n */\nexport function getRtvVersionForTesting(win, isLocalDev) {\n  return getRtvVersion(win, isLocalDev);\n}\n\n\n/** @visibleForTesting */\nexport function resetRtvVersionForTesting() {\n  rtvVersion = '';\n}\n","/**\n * Copyright 2015 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n\n\n/**\n * This class helps to manage observers. Observers can be added, removed or\n * fired through and instance of this class.\n * @template TYPE\n */\nexport class Observable {\n\n  constructor() {\n    /** @const {!Array<function(TYPE)>} */\n    this.handlers_ = [];\n  }\n\n  /**\n   * Adds the observer to this instance.\n   * @param {function(TYPE)} handler Observer's handler.\n   * @return {!UnlistenDef}\n   */\n  add(handler) {\n    this.handlers_.push(handler);\n    return () => {\n      this.remove(handler);\n    };\n  }\n\n  /**\n   * Removes the observer from this instance.\n   * @param {function(TYPE)} handler Observer's instance.\n   */\n  remove(handler) {\n    const index = this.handlers_.indexOf(handler);\n    if (index > -1) {\n      this.handlers_.splice(index, 1);\n    }\n  }\n\n  /**\n   * Removes all observers.\n   */\n  removeAll() {\n    this.handlers_.length = 0;\n  }\n\n  /**\n   * Fires an event. All observers are called.\n   * @param {TYPE=} opt_event\n   */\n  fire(opt_event) {\n    const handlers = this.handlers_;\n    for (let i = 0; i < handlers.length; i++) {\n      const handler = handlers[i];\n      handler(opt_event);\n    }\n  }\n\n  /**\n   * Returns number of handlers. Mostly needed for tests.\n   * @return {number}\n   */\n  getHandlerCount() {\n    return this.handlers_.length;\n  }\n}\n","/**\n * Copyright 2015 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {getExistingServiceForWindow} from './service';\n\n/**\n * @param {!Window} window\n * @return {!./service/performance-impl.Performance}\n */\nexport function performanceFor(window) {\n  return /** @type {!./service/performance-impl.Performance}*/ (\n      getExistingServiceForWindow(window, 'performance'));\n};\n","/**\n * Copyright 2015 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {getExistingServiceForWindow} from './service';\n\n\n/**\n * @param {!Window} window\n * @return {!./service/platform-impl.Platform}\n */\nexport function platformFor(window) {\n  return /** @type {!./service/platform-impl.Platform} */ (\n      getExistingServiceForWindow(window, 'platform'));\n};\n","/**\n * Copyright 2015 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n// Importing the document-register-element module has the side effect\n// of installing the custom elements polyfill if necessary.\nimport installCustomElements from\n    'document-register-element/build/document-register-element.node';\nimport {install as installDocContains} from './polyfills/document-contains';\nimport {install as installMathSign} from './polyfills/math-sign';\nimport {install as installObjectAssign} from './polyfills/object-assign';\nimport {install as installPromise} from './polyfills/promise';\nimport {getMode} from './mode';\n\n/**\n  Only install in closure binary and not in babel/browserify binary, since in\n  the closure binary we strip out the `document-register-element` install side\n  effect so we can tree shake the dependency correctly and we have to make\n  sure to not `install` it during dev since the `install` is done as a side\n  effect in importing the module.\n*/\nif (!getMode().localDev) {\n  installCustomElements(self);\n}\ninstallMathSign(self);\ninstallObjectAssign(self);\ninstallPromise(self);\ninstallDocContains(self);\n","/**\n * Copyright 2016 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n\n/**\n * Polyfill for `document.contains()` method. Notice that according to spec\n * `document.contains` is inclusionary.\n * See https://developer.mozilla.org/en-US/docs/Web/API/Node/contains\n * @param {?Node} node\n * @return {boolean}\n * @this {Node}\n */\nfunction documentContainsPolyfill(node) {\n  // Per spec, \"contains\" method is inclusionary\n  // i.e. `node.contains(node) == true`. However, we still need to test\n  // equality to the document itself.\n  return node == this || this.documentElement.contains(node);\n}\n\n\n/**\n * Polyfills `HTMLDocument.contains` API.\n * @param {!Window} win\n */\nexport function install(win) {\n  if (!win.HTMLDocument.prototype.contains) {\n    win.HTMLDocument.prototype.contains = documentContainsPolyfill;\n  }\n}\n","/**\n * Copyright 2016 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * Parses the number x and returns its sign. For positive x returns 1, for\n * negative, -1. For 0 and -0, returns 0 and -0 respectively. For any number\n * that parses to NaN, returns NaN.\n *\n * @param {number} x\n * @returns {number}\n */\nexport function sign(x) {\n  x = Number(x);\n\n  // If x is 0, -0, or NaN, return it.\n  if (!x) {\n    return x;\n  }\n\n  return x > 0 ? 1 : -1;\n};\n\n\n/**\n * Sets the Math.sign polyfill if it does not exist.\n * @param {!Window} win\n */\nexport function install(win) {\n  if (!win.Math.sign) {\n    win.Math.sign = sign;\n  }\n}\n","/**\n * Copyright 2016 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * Copies values of all enumerable own properties from one or more source\n * objects (provided as extended arguments to the function) to a target object.\n *\n * @param {!Object} target\n * @returns {!Object}\n */\n\nconst hasOwnProperty = Object.prototype.hasOwnProperty;\n\nexport function assign(target) {\n  if (target == null) {\n    throw new TypeError('Cannot convert undefined or null to object');\n  }\n\n  const output = Object(target);\n  for (let i = 1; i < arguments.length; i++) {\n    const source = arguments[i];\n    if (source != null) {\n      for (const key in source) {\n        if (hasOwnProperty.call(source, key)) {\n          output[key] = source[key];\n        }\n      }\n    }\n  }\n  return output;\n}\n\n\n/**\n * Sets the Object.assign polyfill if it does not exist.\n * @param {!Window} win\n */\nexport function install(win) {\n  if (!win.Object.assign) {\n    win.Object.assign = assign;\n  }\n}\n","/**\n * Copyright 2016 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n\nimport * as Promise from 'promise-pjs/promise';\n\n/**\n * Sets the Promise polyfill if it does not exist.\n * @param {!Window} win\n */\nexport function install(win) {\n  if (!win.Promise) {\n    win.Promise = /** @type {?} */ (Promise);\n    // In babel the * export is an Object with a default property.\n    // In closure compiler it is the Promise function itself.\n    if (Promise.default) {\n      win.Promise = Promise.default;\n    }\n    // We copy the individual static methods, because closure\n    // compiler flattens the polyfill namespace.\n    win.Promise.resolve = Promise.resolve;\n    win.Promise.reject = Promise.reject;\n    win.Promise.all = Promise.all;\n    win.Promise.race = Promise.race;\n  }\n}\n","/**\n * Copyright 2015 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * @fileoverview Provides a services to preconnect to a url to warm up the\n * connection before the real request can be made.\n */\n\n\nimport {fromClass} from './service';\nimport {parseUrl} from './url';\nimport {timerFor} from './timer';\nimport {platformFor} from './platform';\nimport {viewerForDoc} from './viewer';\nimport {dev} from './log';\n\nconst ACTIVE_CONNECTION_TIMEOUT_MS = 180 * 1000;\nconst PRECONNECT_TIMEOUT_MS = 10 * 1000;\n\n\n/**\n * @typedef {{\n *   preload: (boolean|undefined),\n *   preconnect: (boolean|undefined)\n * }}\n */\nlet PreconnectFeaturesDef;\n\n/** @private {?PreconnectFeaturesDef} */\nlet preconnectFeatures = null;\n\n/**\n * Detect related features if feature detection is supported by the\n * browser. Even if this fails, the browser may support the feature.\n * @param {!Window} win\n * @return {!PreconnectFeaturesDef}\n */\nfunction getPreconnectFeatures(win) {\n  if (!preconnectFeatures) {\n    const tokenList = win.document.createElement('link')['relList'];\n    if (!tokenList || !tokenList.supports) {\n      return {};\n    }\n    preconnectFeatures = {\n      preconnect: tokenList.supports('preconnect'),\n      preload: tokenList.supports('preload'),\n    };\n  }\n  return preconnectFeatures;\n}\n\n\n/**\n * @param {?PreconnectFeaturesDef} features\n */\nexport function setPreconnectFeaturesForTesting(features) {\n  preconnectFeatures = features;\n}\n\n\nclass PreconnectService {\n\n  /**\n   * @param {!Window} win\n   */\n  constructor(win) {\n    /** @private @const {!Document} */\n    this.document_ = win.document;\n\n    /** @private @const {!Element} */\n    this.head_ = dev().assertElement(win.document.head);\n    /**\n     * Origin we've preconnected to and when that connection\n     * expires as a timestamp in MS.\n     * @private @const {!Object<string, number>}\n     */\n    this.origins_ = {};\n    /**\n     * Urls we've prefetched.\n     * @private @const {!Object<string, boolean>}\n     */\n    this.urls_ = {};\n    /** @private @const {!./service/platform-impl.Platform}  */\n    this.platform_ = platformFor(win);\n    // Mark current origin as preconnected.\n    this.origins_[parseUrl(win.location.href).origin] = true;\n\n    /**\n     * Detect support for the given resource hints.\n     * Unfortunately not all browsers support this, so this can only\n     * be used as an affirmative signal.\n     * @private @const {!PreconnectFeaturesDef}\n     */\n    this.features_ = getPreconnectFeatures(win);\n\n    /** @private @const {!./service/timer-impl.Timer} */\n    this.timer_ = timerFor(win);\n  }\n\n  /**\n   * Preconnects to a URL. Always also does a dns-prefetch because\n   * browser support for that is better.\n   * @param {!./service/viewer-impl.Viewer} viewer\n   * @param {string} url\n   * @param {boolean=} opt_alsoConnecting Set this flag if you also just\n   *    did or are about to connect to this host. This is for the case\n   *    where preconnect is issued immediate before or after actual connect\n   *    and preconnect is used to flatten a deep HTTP request chain.\n   *    E.g. when you preconnect to a host that an embed will connect to\n   *    when it is more fully rendered, you already know that the connection\n   *    will be used very soon.\n   */\n  url(viewer, url, opt_alsoConnecting) {\n    if (!this.isInterestingUrl_(url)) {\n      return;\n    }\n    const origin = parseUrl(url).origin;\n    const now = Date.now();\n    const lastPreconnectTimeout = this.origins_[origin];\n    if (lastPreconnectTimeout && now < lastPreconnectTimeout) {\n      if (opt_alsoConnecting) {\n        this.origins_[origin] = now + ACTIVE_CONNECTION_TIMEOUT_MS ;\n      }\n      return;\n    }\n    // If we are about to use the connection, don't re-preconnect for\n    // 180 seconds.\n    const timeout = opt_alsoConnecting\n        ? ACTIVE_CONNECTION_TIMEOUT_MS\n        : PRECONNECT_TIMEOUT_MS;\n    this.origins_[origin] = now + timeout;\n    // If we know that preconnect is supported, there is no need to do\n    // dedicated dns-prefetch.\n    let dns;\n    if (!this.features_.preconnect) {\n      dns = this.document_.createElement('link');\n      dns.setAttribute('rel', 'dns-prefetch');\n      dns.setAttribute('href', origin);\n      this.head_.appendChild(dns);\n    }\n    const preconnect = this.document_.createElement('link');\n    preconnect.setAttribute('rel', 'preconnect');\n    preconnect.setAttribute('href', origin);\n    preconnect.setAttribute('referrerpolicy', 'origin');\n    this.head_.appendChild(preconnect);\n\n    // Remove the tags eventually to free up memory.\n    this.timer_.delay(() => {\n      if (dns && dns.parentNode) {\n        dns.parentNode.removeChild(dns);\n      }\n      if (preconnect.parentNode) {\n        preconnect.parentNode.removeChild(preconnect);\n      }\n    }, 10000);\n\n    this.preconnectPolyfill_(viewer, origin);\n  }\n\n  /**\n   * Asks the browser to preload a URL. Always also does a preconnect\n   * because browser support for that is better.\n   *\n   * @param {!./service/viewer-impl.Viewer} viewer\n   * @param {string} url\n   * @param {string=} opt_preloadAs\n   */\n  preload(viewer, url, opt_preloadAs) {\n    if (!this.isInterestingUrl_(url)) {\n      return;\n    }\n    if (this.urls_[url]) {\n      return;\n    }\n    const command = this.features_.preload ? 'preload' : 'prefetch';\n    this.urls_[url] = true;\n    this.url(viewer, url, /* opt_alsoConnecting */ true);\n    viewer.whenFirstVisible().then(() => {\n      const preload = this.document_.createElement('link');\n      preload.setAttribute('rel', command);\n      preload.setAttribute('href', url);\n      preload.setAttribute('referrerpolicy', 'origin');\n      // Do not set 'as' attribute for now, for 2 reasons\n      // - document value is not yet supported and dropped\n      // - script is blocked due to CSP.\n      // if (opt_preloadAs) {\n      //  preload.setAttribute('as', opt_preloadAs);\n      // }\n      this.head_.appendChild(preload);\n      // As opposed to preconnect we do not clean this tag up, because there is\n      // no expectation as to it having an immediate effect.\n    });\n  }\n\n  /**\n   * Skips over non HTTP/HTTPS URL.\n   * @param {string} url\n   * @return {boolean}\n   */\n  isInterestingUrl_(url) {\n    if (url.indexOf('https:') == 0 || url.indexOf('http:') == 0) {\n      return true;\n    }\n    return false;\n  }\n\n  /**\n   * Safari does not support preconnecting, but due to its significant\n   * performance benefits we implement this crude polyfill.\n   *\n   * We make an image connection to a \"well-known\" file on the origin adding\n   * a random query string to bust the cache (no caching because we do want to\n   * actually open the connection).\n   *\n   * This should get us an open SSL connection to these hosts and significantly\n   * speed up the next connections.\n   *\n   * The actual URL is expected to 404. If you see errors for\n   * amp_preconnect_polyfill in your DevTools console or server log:\n   * This is expected and fine to leave as is. Its fine to send a non 404\n   * response, but please make it small :)\n   *\n   * @param {!./service/viewer-impl.Viewer} viewer\n   * @param {string} origin\n   * @private\n   */\n  preconnectPolyfill_(viewer, origin) {\n    // Unfortunately there is no reliable way to feature detect whether\n    // preconnect is supported, so we do this only in Safari, which is\n    // the most important browser without support for it.\n    if (this.features_.preconnect || !this.platform_.isSafari()) {\n      return;\n    }\n\n    viewer.whenFirstVisible().then(() => {\n      // Don't attempt to preconnect for ACTIVE_CONNECTION_TIMEOUT_MS since\n      // we effectively create an active connection.\n      // TODO(@cramforce): Confirm actual http2 timeout in Safari.\n      this.origins_[origin] = Date.now() + ACTIVE_CONNECTION_TIMEOUT_MS;\n      const url = origin +\n          '/amp_preconnect_polyfill_404_or_other_error_expected.' +\n          '_Do_not_worry_about_it?' + Math.random();\n      // We use an XHR without withCredentials(true), so we do not send cookies\n      // to the host and the host cannot set cookies.\n      const xhr = new XMLHttpRequest();\n      xhr.open('HEAD', url, true);\n\n      xhr.send();\n    });\n  }\n}\n\n\nexport class Preconnect {\n  /**\n   * @param {!PreconnectService} preconnectService\n   * @param {!Element} element\n   */\n  constructor(preconnectService, element) {\n    /** @const @private {!PreconnectService} */\n    this.preconnectService_ = preconnectService;\n\n    /** @const @private {!Element} */\n    this.element_ = element;\n\n    /** @private {?./service/viewer-impl.Viewer} */\n    this.viewer_ = null;\n  }\n\n  /**\n   * @return {!./service/viewer-impl.Viewer}\n   * @private\n   */\n  getViewer_() {\n    if (!this.viewer_) {\n      this.viewer_ = viewerForDoc(this.element_);\n    }\n    return this.viewer_;\n  }\n\n  /**\n   * Preconnects to a URL. Always also does a dns-prefetch because\n   * browser support for that is better.\n   * @param {string} url\n   * @param {boolean=} opt_alsoConnecting Set this flag if you also just\n   *    did or are about to connect to this host. This is for the case\n   *    where preconnect is issued immediate before or after actual connect\n   *    and preconnect is used to flatten a deep HTTP request chain.\n   *    E.g. when you preconnect to a host that an embed will connect to\n   *    when it is more fully rendered, you already know that the connection\n   *    will be used very soon.\n   */\n  url(url, opt_alsoConnecting) {\n    this.preconnectService_.url(this.getViewer_(), url, opt_alsoConnecting);\n  }\n\n  /**\n   * Asks the browser to preload a URL. Always also does a preconnect\n   * because browser support for that is better.\n   *\n   * @param {string} url\n   * @param {string=} opt_preloadAs\n   */\n  preload(url, opt_preloadAs) {\n    this.preconnectService_.preload(this.getViewer_(), url, opt_preloadAs);\n  }\n}\n\n\n/**\n * @param {!Window} window\n * @return {!PreconnectService}\n */\nfunction preconnectFor(window) {\n  return fromClass(window, 'preconnect', PreconnectService);\n}\n\n\n/**\n * @param {!Element} element\n * @return {!Preconnect}\n */\nexport function preconnectForElement(element) {\n  const preconnectService = preconnectFor(element.ownerDocument.defaultView);\n  return new Preconnect(preconnectService, element);\n}\n","/**\n * Copyright 2016 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {dev} from './log';\nimport {getServicePromise} from './service';\nimport {timerFor} from './timer';\n\n/**\n * A map of services that delay rendering. The key is the name of the service\n * and the value is a DOM query which is used to check if the service is needed\n * in the current document.\n * Do not add a service unless absolutely necessary.\n * @const {!Object<string, string>}\n */\nconst SERVICES = {\n  'amp-accordion': '[custom-element=amp-accordion]',\n  'amp-dynamic-css-classes': '[custom-element=amp-dynamic-css-classes]',\n  'variant': 'amp-experiment',\n};\n\n/**\n * Maximum milliseconds to wait for all extensions to load before erroring.\n * @const\n */\nconst LOAD_TIMEOUT = 3000;\n\n/**\n * Detects any render delaying services that are required on the page,\n * and returns a promise with a timeout.\n * @param {!Window} win\n * @return {!Promise<!Array<*>>} resolves to an Array that has the same length as\n *     the detected render delaying services\n */\nexport function waitForServices(win) {\n  const promises = includedServices(win).map(service => {\n    return timerFor(win).timeoutPromise(\n      LOAD_TIMEOUT,\n      getServicePromise(win, service),\n      `Render timeout waiting for service ${service} to be ready.`\n    );\n  });\n  return Promise.all(promises);\n}\n\n/**\n * Detects which, if any, render-delaying extensions are included on the page.\n * @param {!Window} win\n * @return {!Array<string>}\n * @private\n */\nfunction includedServices(win) {\n  /** @const {!Document} */\n  const doc = win.document;\n  dev().assert(doc.body);\n\n  return Object.keys(SERVICES).filter(service => {\n    return doc.querySelector(SERVICES[service]);\n  });\n}\n","/**\n * Copyright 2015 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {getExistingServiceForDoc} from './service';\n\n\n/**\n * @param {!Node|!./service/ampdoc-impl.AmpDoc} nodeOrDoc\n * @return {!./service/resources-impl.Resources}\n */\nexport function resourcesForDoc(nodeOrDoc) {\n  return /** @type {!./service/resources-impl.Resources} */ (\n      getExistingServiceForDoc(nodeOrDoc, 'resources'));\n};\n","/**\n * Copyright 2016 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {calculateExtensionScriptUrl} from '../service/extensions-impl';\n\n/**\n * Import the \"core\" entry point for the AMP CDN Service Worker. This shell\n * file is kept intentionally small, so that checking if it has changed (and\n * thus, if a new SW must be installed) will be very fast.\n */\nconst url = calculateExtensionScriptUrl(self.location, 'cache-service-worker');\nimportScripts(url);\n","/**\n * Copyright 2015 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n// Requires polyfills in immediate side effect.\nimport './polyfills';\nimport {dev} from './log';\n\n/**\n * Holds info about a service.\n * - obj: Actual service implementation when available.\n * - promise: Promise for the obj.\n * - resolve: Function to resolve the promise with the object.\n * @typedef {{\n *   obj: (?Object),\n *   promise: (?Promise|undefined),\n *   resolve: (?function(!Object)|undefined),\n * }}\n */\nlet ServiceHolderDef;\n\n\n/**\n * This interface provides a `dispose` method that will be called by\n * runtime when a service needs to be disposed of.\n * @interface\n */\nexport class Disposable {\n\n  /**\n   * Instructs the service to release any resources it might be holding. Can\n   * be called only once in the lifecycle of a service.\n   */\n  dispose() {}\n}\n\n\n/**\n * Returns a service with the given id. Assumes that it has been constructed\n * already.\n * @param {!Window} win\n * @param {string} id\n * @return {!Object} The service.\n */\nexport function getExistingServiceForWindow(win, id) {\n  win = getTopWindow(win);\n  const exists = win.services && win.services[id] && win.services[id].obj;\n  return dev().assert(exists, `${id} service not found. Make sure it is ` +\n      `installed.`);\n}\n\n\n/**\n * Returns a service with the given id. Assumes that it has been constructed\n * already.\n * @param {!Window} win\n * @param {string} id\n * @return {!Object} The service.\n */\nexport function getExistingServiceForWindowInEmbedScope(win, id) {\n  // First, try to resolve via local (embed) window.\n  const local = getLocalExistingServiceForEmbedWinOrNull(win, id);\n  if (local) {\n    return local;\n  }\n  // Fallback to top-level window.\n  return getExistingServiceForWindow(win, id);\n}\n\n\n/**\n * Returns a service with the given id. Assumes that it has been constructed\n * already.\n * @param {!Node|!./service/ampdoc-impl.AmpDoc} nodeOrDoc\n * @param {string} id\n * @return {!Object} The service.\n */\nexport function getExistingServiceForDoc(nodeOrDoc, id) {\n  const serviceHolder = getAmpdocServiceHolder(nodeOrDoc);\n  const exists = serviceHolder && serviceHolder.services &&\n      serviceHolder.services[id] && serviceHolder.services[id].obj;\n  return dev().assert(exists, `${id} doc service not found. Make sure it is ` +\n      `installed.`);\n}\n\n\n/**\n * Returns a service with the given id. Assumes that it has been constructed\n * already.\n * @param {!Node|!./service/ampdoc-impl.AmpDoc} nodeOrDoc\n * @param {string} id\n * @return {!Object} The service.\n */\nexport function getExistingServiceForDocInEmbedScope(nodeOrDoc, id) {\n  // First, try to resolve via local (embed) window.\n  if (nodeOrDoc.nodeType) {\n    // If a node is passed, try to resolve via this node.\n    const win = /** @type {!Document} */ (\n        nodeOrDoc.ownerDocument || nodeOrDoc).defaultView;\n    const local = getLocalExistingServiceForEmbedWinOrNull(win, id);\n    if (local) {\n      return local;\n    }\n  }\n  // Fallback to ampdoc.\n  return getExistingServiceForDoc(nodeOrDoc, id);\n}\n\n\n/**\n * Installs a service override on amp-doc level.\n * @param {!Window} embedWin\n * @param {string} id\n * @param {!Object} service The service.\n */\nexport function installServiceInEmbedScope(embedWin, id, service) {\n  const topWin = getTopWindow(embedWin);\n  dev().assert(embedWin != topWin,\n      'Service override can only be installed in embed window: %s', id);\n  dev().assert(!getLocalExistingServiceForEmbedWinOrNull(embedWin, id),\n      'Service override has already been installed: %s', id);\n  getServiceInternal(embedWin, embedWin, id, () => service);\n}\n\n\n/**\n * @param {!Window} embedWin\n * @param {string} id\n * @return {?Object}\n */\nfunction getLocalExistingServiceForEmbedWinOrNull(embedWin, id) {\n  // Note that this method currently only resolves against the given window.\n  // It does not try to go all the way up the parent window chain. We can change\n  // this in the future, but for now this gives us a better performance.\n  const topWin = getTopWindow(embedWin);\n  if (embedWin != topWin &&\n          embedWin.services &&\n          embedWin.services[id] &&\n          embedWin.services[id].obj) {\n    return embedWin.services[id].obj;\n  }\n  return null;\n}\n\n\n/**\n * Returns a service for the given id and window (a per-window singleton).\n * If the service is not yet available the factory function is invoked and\n * expected to return the service.\n * Users should typically wrap this as a special purpose function (e.g.\n * `vsyncFor(win)`) for type safety and because the factory should not be\n * passed around.\n * @param {!Window} win\n * @param {string} id of the service.\n * @param {function(!Window):T=} opt_factory Should create the service\n *     if it does not exist yet. If the factory is not given, it is an error\n *     if the service does not exist yet.\n * @template T\n * @return {T}\n */\nexport function getService(win, id, opt_factory) {\n  win = getTopWindow(win);\n  return getServiceInternal(win, win, id,\n      opt_factory ? opt_factory : undefined);\n}\n\n\n/**\n * Returns a service and registers it given a class to be used as\n * implementation.\n * @param {!Window} win\n * @param {string} id of the service.\n * @param {function(new:T, !Window)} constructor\n * @return {T}\n * @template T\n */\nexport function fromClass(win, id, constructor) {\n  win = getTopWindow(win);\n  return getServiceInternal(win, win, id, undefined, constructor);\n}\n\n\n/**\n * Returns a promise for a service for the given id and window. Also expects\n * an element that has the actual implementation. The promise resolves when\n * the implementation loaded.\n * Users should typically wrap this as a special purpose function (e.g.\n * `vsyncFor(win)`) for type safety and because the factory should not be\n * passed around.\n * @param {!Window} win\n * @param {string} id of the service.\n * @return {!Promise<!Object>}\n */\nexport function getServicePromise(win, id) {\n  return getServicePromiseInternal(win, id);\n}\n\n\n/**\n * Like getServicePromise but returns null if the service was never registered.\n * @param {!Window} win\n * @param {string} id of the service.\n * @return {?Promise<!Object>}\n */\nexport function getServicePromiseOrNull(win, id) {\n  return getServicePromiseOrNullInternal(win, id);\n}\n\n\n/**\n * Returns a service for the given id and ampdoc (a per-ampdoc singleton).\n * If the service is not yet available the factory function is invoked and\n * expected to return the service.\n * @param {!Node|!./service/ampdoc-impl.AmpDoc} nodeOrDoc\n * @param {string} id of the service.\n * @param {function(!./service/ampdoc-impl.AmpDoc):T=} opt_factory\n *     Should create the service if it does not exist yet. If the factory is\n *     not given, it is an error if the service does not exist yet.\n * @return {T}\n * @template T\n */\nexport function getServiceForDoc(nodeOrDoc, id, opt_factory) {\n  const ampdoc = getAmpdoc(nodeOrDoc);\n  return getServiceInternal(\n      getAmpdocServiceHolder(ampdoc),\n      ampdoc,\n      id,\n      opt_factory);\n}\n\n\n/**\n * Returns a service and registers it given a class to be used as\n * implementation.\n * @param {!Node|!./service/ampdoc-impl.AmpDoc} nodeOrDoc\n * @param {string} id of the service.\n * @param {function(new:T, !./service/ampdoc-impl.AmpDoc)} constructor\n * @return {T}\n * @template T\n */\nexport function fromClassForDoc(nodeOrDoc, id, constructor) {\n  const ampdoc = getAmpdoc(nodeOrDoc);\n  return getServiceInternal(\n      getAmpdocServiceHolder(ampdoc),\n      ampdoc,\n      id,\n      undefined,\n      constructor);\n}\n\n\n/**\n * Returns a promise for a service for the given id and ampdoc. Also expects\n * a service that has the actual implementation. The promise resolves when\n * the implementation loaded.\n * @param {!Node|!./service/ampdoc-impl.AmpDoc} nodeOrDoc\n * @param {string} id of the service.\n * @return {!Promise<!Object>}\n */\nexport function getServicePromiseForDoc(nodeOrDoc, id) {\n  return getServicePromiseInternal(\n      getAmpdocServiceHolder(nodeOrDoc),\n      id);\n}\n\n\n/**\n * Like getServicePromiseForDoc but returns null if the service was never\n * registered for this ampdoc.\n * @param {!Node|!./service/ampdoc-impl.AmpDoc} nodeOrDoc\n * @param {string} id of the service.\n * @return {?Promise<!Object>}\n */\nexport function getServicePromiseOrNullForDoc(nodeOrDoc, id) {\n  return getServicePromiseOrNullInternal(\n      getAmpdocServiceHolder(nodeOrDoc),\n      id);\n}\n\n\n/**\n * Set the parent and top windows on a child window (friendly iframe).\n * @param {!Window} win\n * @param {!Window} parentWin\n */\nexport function setParentWindow(win, parentWin) {\n  win.__AMP_PARENT = parentWin;\n  win.__AMP_TOP = getTopWindow(parentWin);\n}\n\n\n/**\n * Returns the parent window for a child window (friendly iframe).\n * @param {!Window} win\n * @return {!Window}\n */\nexport function getParentWindow(win) {\n  return win.__AMP_PARENT || win;\n}\n\n\n/**\n * Returns the top window where AMP Runtime is installed for a child window\n * (friendly iframe).\n * @param {!Window} win\n * @return {!Window}\n */\nexport function getTopWindow(win) {\n  return win.__AMP_TOP || win;\n}\n\n\n/**\n * Returns the parent \"friendly\" iframe if the node belongs to a child window.\n * @param {!Node} node\n * @param {!Window} topWin\n * @return {?HTMLIFrameElement}\n */\nexport function getParentWindowFrameElement(node, topWin) {\n  const childWin = (node.ownerDocument || node).defaultView;\n  if (childWin && childWin != topWin && getTopWindow(childWin) == topWin) {\n    try {\n      return /** @type {?HTMLIFrameElement} */ (childWin.frameElement);\n    } catch (e) {\n      // Ignore the error.\n    }\n  }\n  return null;\n}\n\n\n/**\n * @param {!Node|!./service/ampdoc-impl.AmpDoc} nodeOrDoc\n * @return {!./service/ampdoc-impl.AmpDoc}\n */\nexport function getAmpdoc(nodeOrDoc) {\n  if (nodeOrDoc.nodeType) {\n    const win = /** @type {!Document} */ (\n        nodeOrDoc.ownerDocument || nodeOrDoc).defaultView;\n    return getAmpdocService(win).getAmpDoc(/** @type {!Node} */ (nodeOrDoc));\n  }\n  return /** @type {!./service/ampdoc-impl.AmpDoc} */ (nodeOrDoc);\n}\n\n\n/**\n * @param {!Node|!./service/ampdoc-impl.AmpDoc} nodeOrDoc\n * @return {!./service/ampdoc-impl.AmpDoc|!Window}\n */\nfunction getAmpdocServiceHolder(nodeOrDoc) {\n  const ampdoc = getAmpdoc(nodeOrDoc);\n  return ampdoc.isSingleDoc() ? ampdoc.win : ampdoc;\n}\n\n\n/**\n * This is essentially a duplicate of `ampdoc.js`, but necessary to avoid\n * circular dependencies.\n * @param {!Window} win\n * @return {!./service/ampdoc-impl.AmpDocService}\n */\nfunction getAmpdocService(win) {\n  return /** @type {!./service/ampdoc-impl.AmpDocService} */ (\n      getService(win, 'ampdoc'));\n}\n\n\n/**\n * @param {!Object} holder Object holding the service instance.\n * @param {!Window|!./service/ampdoc-impl.AmpDoc} context Win or AmpDoc.\n * @param {string} id of the service.\n * @param {function(?):T=} opt_factory\n *     Should create the service if it does not exist yet. If the factory\n *     is not given, it is an error if the service does not exist yet.\n *     Called with context.\n * @param {function(new:T, ?)=} opt_constructor\n *     Constructor function to new the service. Called with context.\n * @return {*}\n * @template T\n */\nfunction getServiceInternal(holder, context, id, opt_factory,\n    opt_constructor) {\n  const services = getServices(holder);\n  let s = services[id];\n  if (!s) {\n    s = services[id] = {\n      obj: null,\n      promise: null,\n      resolve: null,\n    };\n  }\n\n  if (!s.obj) {\n    dev().assert(opt_factory || opt_constructor,\n        'Factory or class not given and service missing %s', id);\n    s.obj = opt_constructor\n        ? new opt_constructor(context)\n        : opt_factory(context);\n    // The service may have been requested already, in which case we have a\n    // pending promise we need to fulfill.\n    if (s.resolve) {\n      s.resolve(s.obj);\n    }\n  }\n  return s.obj;\n}\n\n\n/**\n * @param {!Object} holder\n * @param {string} id of the service.\n * @return {!Promise<!Object>}\n */\nfunction getServicePromiseInternal(holder, id) {\n  const cached = getServicePromiseOrNullInternal(holder, id);\n  if (cached) {\n    return cached;\n  }\n  const services = getServices(holder);\n\n  // TODO(@cramforce): Add a check that if the element is eventually registered\n  // that the service is actually provided and this promise resolves.\n  let resolve;\n  const p = new Promise(r => {\n    resolve = r;\n  });\n  services[id] = {\n    obj: null,\n    promise: p,\n    resolve,\n  };\n\n  return p;\n}\n\n\n/**\n * @param {!Object} holder\n * @param {string} id of the service.\n * @return {?Promise<!Object>}\n */\nfunction getServicePromiseOrNullInternal(holder, id) {\n  const services = getServices(holder);\n  const s = services[id];\n  if (s) {\n    const p = s.promise;\n    if (p) {\n      return p;\n    }\n    if (s.obj) {\n      return s.promise = Promise.resolve(s.obj);\n    }\n    dev().assert(false, 'Expected object or promise to be present');\n  }\n  return null;\n}\n\n\n/**\n * Returns the object that holds the services registered in a holder.\n * @param {!Object} holder\n * @return {!Object<string,!ServiceHolderDef>}\n */\nfunction getServices(holder) {\n  let services = holder.services;\n  if (!services) {\n    services = holder.services = {};\n  }\n  return services;\n}\n\n\n/**\n * Whether the specified service implements `Disposable` interface.\n * @param {!Object} service\n * @return {boolean}\n */\nexport function isDisposable(service) {\n  return typeof service.dispose == 'function';\n}\n\n\n/**\n * Asserts that the specified service implements `Disposable` interface and\n * typecasts the instance to `Disposable`.\n * @param {!Object} service\n * @return {!Disposable}\n */\nexport function assertDisposable(service) {\n  dev().assert(isDisposable(service), 'required to implement Disposable');\n  return /** @type {!Disposable} */ (service);\n}\n\n\n/**\n * Disposes all disposable (implements `Disposable` interface) services in\n * ampdoc scope.\n * @param {!./service/ampdoc-impl.AmpDoc} ampdoc\n */\nexport function disposeServicesForDoc(ampdoc) {\n  disposeServicesInternal(ampdoc);\n}\n\n\n/**\n * Disposes all disposable (implements `Disposable` interface) services in\n * embed scope.\n * @param {!Window} embedWin\n */\nexport function disposeServicesForEmbed(embedWin) {\n  disposeServicesInternal(embedWin);\n}\n\n\n/**\n * @param {!Object} holder Object holding the service instances.\n */\nfunction disposeServicesInternal(holder) {\n  // TODO(dvoytenko): Consider marking holder as destroyed for later-arriving\n  // service to be canceled automatically.\n  const services = getServices(holder);\n  for (const id in services) {\n    if (!Object.prototype.hasOwnProperty.call(services, id)) {\n      continue;\n    }\n    const serviceHolder = services[id];\n    if (serviceHolder.obj) {\n      disposeServiceInternal(id, serviceHolder.obj);\n    } else if (serviceHolder.promise) {\n      serviceHolder.promise.then(\n          instance => disposeServiceInternal(id, instance));\n    }\n  }\n}\n\n\n/**\n * @param {string} id\n * @param {!Object} service\n */\nfunction disposeServiceInternal(id, service) {\n  if (!isDisposable(service)) {\n    return;\n  }\n  try {\n    assertDisposable(service).dispose();\n  } catch (e) {\n    // Ensure that a failure to dispose a service does not disrupt other\n    // services.\n    dev().error('SERVICE', 'failed to dispose service', id, e);\n  }\n}\n\n\n/**\n * Resets a single service, so it gets recreated on next getService invocation.\n * @param {!Object} holder\n * @param {string} id of the service.\n */\nexport function resetServiceForTesting(holder, id) {\n  if (holder.services) {\n    holder.services[id] = null;\n  }\n}\n","/**\n * Copyright 2016 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  copyElementToChildWindow,\n  stubElementIfNotKnown,\n} from '../custom-element';\nimport {cssText} from '../../build/css';\nimport {dev, rethrowAsync} from '../log';\nimport {getMode} from '../mode';\nimport {fromClass, setParentWindow} from '../service';\nimport installCustomElements from\n    'document-register-element/build/document-register-element.node';\nimport {install as installDocContains} from '../polyfills/document-contains';\nimport {installImg} from '../../builtins/amp-img';\nimport {installPixel} from '../../builtins/amp-pixel';\nimport {installStyles} from '../style-installer';\nimport {installVideo} from '../../builtins/amp-video';\nimport {urls} from '../config';\n\n\nconst TAG = 'extensions';\nconst UNKNOWN_EXTENSION = '_UNKNOWN_';\n\n/**\n * The structure that contains the declaration of a custom element.\n *\n * @typedef {{\n *   implementationClass:\n *       function(new:../base-element.BaseElement, !Element),\n *   css: (?string|undefined),\n * }}\n */\nlet ExtensionElementDef;\n\n\n/**\n * The structure that contains the resources declared by an extension.\n * Currently only limitted to elements.\n *\n * @typedef {{\n *   elements: !Object<string, !ExtensionElementDef>,\n * }}\n */\nlet ExtensionDef;\n\n\n/**\n * Internal structure that maintains the state of an extension through loading.\n *\n * @typedef {{\n *   extension: !ExtensionDef,\n *   docFactories: !Array<function(!./ampdoc-impl.AmpDoc)>,\n *   shadowRootFactories: !Array<function(!ShadowRoot)>,\n *   promise: (!Promise<!ExtensionDef>|undefined),\n *   resolve: (function(!ExtensionDef)|undefined),\n *   reject: (function(!Error)|undefined),\n *   loaded: (boolean|undefined),\n *   error: (!Error|undefined),\n *   scriptPresent: (boolean|undefined),\n * }}\n * @private\n */\nlet ExtensionHolderDef;\n\n\n/**\n * Install extensions service.\n * @param {!Window} window\n * @return {!Extensions}\n * @restricted\n */\nexport function installExtensionsService(window) {\n  return fromClass(window, 'extensions', Extensions);\n}\n\n\n/**\n * Register and process the specified extension. The factory is called\n * immediately, which in turn is expected to register elements, templates,\n * services and document factories.\n * @param {!Extensions} extensions\n * @param {string} extensionId\n * @param {function(!Object)} factory\n * @param {!Object} arg\n * @restricted\n */\nexport function registerExtension(extensions, extensionId, factory, arg) {\n  extensions.registerExtension_(extensionId, factory, arg);\n}\n\n\n/**\n * Apply all registered factories to the specified ampdoc.\n * @param {!Extensions} extensions\n * @param {!./ampdoc-impl.AmpDoc} ampdoc\n * @param {!Array<string>} extensionIds\n * @return {!Promise}\n * @restricted\n */\nexport function installExtensionsInShadowDoc(extensions, ampdoc, extensionIds) {\n  return extensions.installExtensionsInShadowDoc_(ampdoc, extensionIds);\n}\n\n\n/**\n * Add an element to the extension currently being registered. This is a\n * restricted method and it's allowed to be called only during the overall\n * extension registration.\n * @param {!Extensions} extensions\n * @param {string} name\n * @param {function(new:../base-element.BaseElement, !Element)}\n *     implementationClass\n * @param {?string|undefined} css\n * @restricted\n */\nexport function addElementToExtension(\n    extensions, name, implementationClass, css) {\n  extensions.addElement_(name, implementationClass, css);\n}\n\n\n/**\n * Add a ampdoc factory to the extension currently being registered. This is a\n * restricted method and it's allowed to be called only during the overall\n * extension registration.\n * @param {!Extensions} extensions\n * @param {function(!./ampdoc-impl.AmpDoc)} factory\n * @param {string=} opt_forName\n * @restricted\n */\nexport function addDocFactoryToExtension(extensions, factory, opt_forName) {\n  extensions.addDocFactory_(factory, opt_forName);\n}\n\n\n/**\n * Add a shadow-root factory to the extension currently being registered. This\n * is a restricted method and it's allowed to be called only during the overall\n * extension registration.\n * @param {!Extensions} extensions\n * @param {function(!ShadowRoot)} factory\n * @param {string=} opt_forName\n * @restricted\n */\nexport function addShadowRootFactoryToExtension(extensions, factory,\n    opt_forName) {\n  extensions.addShadowRootFactory_(factory, opt_forName);\n}\n\n\n/**\n * The services that manages extensions in the runtime.\n * @visibleForTesting\n */\nexport class Extensions {\n\n  /**\n   * @param {!Window} win\n   */\n  constructor(win) {\n    /** @const {!Window} */\n    this.win = win;\n\n    /** @private @const {!Object<string, !ExtensionHolderDef>} */\n    this.extensions_ = {};\n\n    /** @private {?string} */\n    this.currentExtensionId_ = null;\n  }\n\n  /**\n   * Registers a new extension. This method is called by the extension's script\n   * itself when it's loaded using the regular `AMP.push()` callback.\n   * @param {string} extensionId\n   * @param {function(!Object)} factory\n   * @param {!Object} arg\n   * @private\n   * @restricted\n   */\n  registerExtension_(extensionId, factory, arg) {\n    const holder = this.getExtensionHolder_(extensionId);\n    try {\n      this.currentExtensionId_ = extensionId;\n      factory(arg);\n      if (getMode().localDev || getMode().test) {\n        if (Object.freeze) {\n          const m = holder.extension;\n          m.elements = Object.freeze(m.elements);\n          holder.extension = Object.freeze(m);\n        }\n      }\n      holder.loaded = true;\n      if (holder.resolve) {\n        holder.resolve(holder.extension);\n      }\n    } catch (e) {\n      holder.error = e;\n      if (holder.reject) {\n        holder.reject(e);\n      }\n      throw e;\n    } finally {\n      this.currentExtensionId_ = null;\n    }\n  }\n\n  /**\n   * Waits for the previously included extension to complete\n   * loading/registration.\n   * @param {string} extensionId\n   * @return {!Promise<!ExtensionDef>}\n   */\n  waitForExtension(extensionId) {\n    return this.waitFor_(this.getExtensionHolder_(extensionId));\n  }\n\n  /**\n   * Returns the promise that will be resolved when the extension has been\n   * loaded. If necessary, adds the extension script to the page.\n   * @param {string} extensionId\n   * @param {boolean=} stubElement\n   * @return {!Promise<!ExtensionDef>}\n   */\n  loadExtension(extensionId, stubElement = true) {\n    if (extensionId == 'amp-embed') {\n      extensionId = 'amp-ad';\n    }\n    const holder = this.getExtensionHolder_(extensionId);\n    this.insertExtensionScriptIfNeeded_(extensionId, holder, stubElement);\n    return this.waitFor_(holder);\n  }\n\n  /**\n   * Returns the promise that will be resolved with the extension element's\n   * class when the extension has been loaded. If necessary, adds the extension\n   * script to the page.\n   * @param {string} elementName\n   * @return {!Promise<function(new:../base-element.BaseElement, !Element)>}\n   */\n  loadElementClass(elementName) {\n    return this.loadExtension(elementName).then(extension => {\n      const element = dev().assert(extension.elements[elementName],\n          'Element not found: %s', elementName);\n      return element.implementationClass;\n    });\n  }\n\n  /**\n   * Registers the element implementation with the current extension.\n   * @param {string} name\n   * @param {!Function} implementationClass\n   * @param {?string|undefined} css\n   * @private\n   * @restricted\n   */\n  addElement_(name, implementationClass, css) {\n    const holder = this.getCurrentExtensionHolder_(name);\n    holder.extension.elements[name] = {implementationClass, css};\n  }\n\n  /**\n   * Registers an ampdoc factory.\n   * @param {function(!./ampdoc-impl.AmpDoc)} factory\n   * @param {string=} opt_forName\n   * @private\n   * @restricted\n   */\n  addDocFactory_(factory, opt_forName) {\n    const holder = this.getCurrentExtensionHolder_(opt_forName);\n    holder.docFactories.push(factory);\n  }\n\n  /**\n   * Registers a shadow-root factory.\n   * @param {function(!ShadowRoot)} factory\n   * @param {string=} opt_forName\n   * @private\n   * @restricted\n   */\n  addShadowRootFactory_(factory, opt_forName) {\n    const holder = this.getCurrentExtensionHolder_(opt_forName);\n    holder.shadowRootFactories.push(factory);\n  }\n\n  /**\n   * Installs all ampdoc factories previously registered with\n   * `addDocFactory_`.\n   * @param {!./ampdoc-impl.AmpDoc} ampdoc\n   * @param {!Array<string>} extensionIds\n   * @return {!Promise}\n   * @private\n   * @restricted\n   */\n  installExtensionsInShadowDoc_(ampdoc, extensionIds) {\n    const promises = [];\n    extensionIds.forEach(extensionId => {\n      const holder = this.getExtensionHolder_(extensionId);\n      promises.push(this.waitFor_(holder).then(() => {\n        holder.shadowRootFactories.forEach(factory => {\n          try {\n            factory(/** @type {!ShadowRoot} */ (ampdoc.getRootNode()));\n          } catch (e) {\n            rethrowAsync('ShadowRoot factory failed: ', e, extensionId);\n          }\n        });\n        holder.docFactories.forEach(factory => {\n          try {\n            factory(ampdoc);\n          } catch (e) {\n            rethrowAsync('Doc factory failed: ', e, extensionId);\n          }\n        });\n      }));\n    });\n    return Promise.all(promises);\n  }\n\n  /**\n   * Installs all shadow-root factories previously registered with\n   * `addShadowRootFactory_`.\n   * @param {!ShadowRoot} shadowRoot\n   * @param {!Array<string>} extensionIds\n   * @return {!Promise}\n   * @restricted\n   */\n  installFactoriesInShadowRoot(shadowRoot, extensionIds) {\n    const promises = [];\n    extensionIds.forEach(extensionId => {\n      const holder = this.getExtensionHolder_(extensionId);\n      promises.push(this.waitFor_(holder).then(() => {\n        holder.shadowRootFactories.forEach(factory => {\n          try {\n            factory(/** @type {!ShadowRoot} */ (shadowRoot));\n          } catch (e) {\n            rethrowAsync('ShadowRoot factory failed: ', e, extensionId);\n          }\n        });\n      }));\n    });\n    return Promise.all(promises);\n  }\n\n  /**\n   * Install extensions in the child window (friendly iframe). The pre-install\n   * callback, if specified, is executed after polyfills have been configured\n   * but before the first extension is installed.\n   * @param {!Window} childWin\n   * @param {!Array<string>} extensionIds\n   * @param {function(!Window)=} opt_preinstallCallback\n   * @return {!Promise}\n   * @restricted\n   */\n  installExtensionsInChildWindow(childWin, extensionIds,\n      opt_preinstallCallback) {\n    const topWin = this.win;\n    const parentWin = childWin.frameElement.ownerDocument.defaultView;\n    setParentWindow(childWin, parentWin);\n\n    // Install necessary polyfills.\n    installPolyfillsInChildWindow(childWin);\n\n    // Install runtime styles.\n    installStyles(childWin.document, cssText, () => {},\n        /* opt_isRuntimeCss */ true, /* opt_ext */ 'amp-runtime');\n\n    // Run pre-install callback.\n    if (opt_preinstallCallback) {\n      opt_preinstallCallback(childWin);\n    }\n\n    // Install built-ins.\n    copyBuiltinElementsToChildWindow(childWin);\n\n    const promises = [];\n    extensionIds.forEach(extensionId => {\n      // This will extend automatic upgrade of custom elements from top\n      // window to the child window.\n      stubElementIfNotKnown(topWin, extensionId);\n      copyElementToChildWindow(childWin, extensionId);\n\n      // Install CSS.\n      const promise = this.loadExtension(extensionId).then(extension => {\n        const elementDef = extension.elements[extensionId];\n        if (elementDef && elementDef.css) {\n          installStyles(childWin.document, elementDef.css, () => {},\n              /* isRuntime */ false, extensionId);\n        }\n      });\n      promises.push(promise);\n    });\n    return Promise.all(promises);\n  }\n\n  /**\n   * Creates or returns an existing extension holder.\n   * @param {string} extensionId\n   * @return {!ExtensionHolderDef}\n   * @private\n   */\n  getExtensionHolder_(extensionId) {\n    let holder = this.extensions_[extensionId];\n    if (!holder) {\n      const extension = {\n        elements: {},\n      };\n      holder = /** @type {ExtensionHolderDef} */ ({\n        extension,\n        docFactories: [],\n        shadowRootFactories: [],\n        promise: undefined,\n        resolve: undefined,\n        reject: undefined,\n        loaded: undefined,\n        error: undefined,\n        scriptPresent: undefined,\n      });\n      this.extensions_[extensionId] = holder;\n    }\n    return holder;\n  }\n\n  /**\n   * Returns the holder for the extension currently being registered.\n   * @param {string=} opt_forName Used for logging only.\n   * @return {!ExtensionHolderDef}\n   * @private\n   */\n  getCurrentExtensionHolder_(opt_forName) {\n    if (!this.currentExtensionId_ && !getMode().test) {\n      dev().error(TAG, 'unknown extension for ', opt_forName);\n    }\n    return this.getExtensionHolder_(\n        this.currentExtensionId_ || UNKNOWN_EXTENSION);\n  }\n\n  /**\n   * Creates or returns an existing promise that will yield as soon as the\n   * extension has been loaded.\n   * @param {!ExtensionHolderDef} holder\n   * @return {!Promise<!ExtensionDef>}\n   * @private\n   */\n  waitFor_(holder) {\n    if (!holder.promise) {\n      if (holder.loaded) {\n        holder.promise = Promise.resolve(holder.extension);\n      } else if (holder.error) {\n        holder.promise = Promise.reject(holder.error);\n      } else {\n        holder.promise = new Promise((resolve, reject) => {\n          holder.resolve = resolve;\n          holder.reject = reject;\n        });\n      }\n    }\n    return holder.promise;\n  }\n\n  /**\n   * Ensures that the script has already been injected in the page.\n   * @param {string} extensionId\n   * @param {!ExtensionHolderDef} holder\n   * @param {boolean} stubElement\n   * @private\n   */\n  insertExtensionScriptIfNeeded_(extensionId, holder, stubElement) {\n    if (this.isExtensionScriptRequired_(extensionId, holder)) {\n      const scriptElement = this.createExtensionScript_(extensionId);\n      this.win.document.head.appendChild(scriptElement);\n      holder.scriptPresent = true;\n      if (stubElement) {\n        stubElementIfNotKnown(this.win, extensionId);\n      }\n    }\n  }\n\n  /**\n   * Determine the need to add amp extension script to document.\n   * @param {string} extensionId\n   * @param {!ExtensionHolderDef} holder\n   * @return {boolean}\n   * @private\n   */\n  isExtensionScriptRequired_(extensionId, holder) {\n    if (holder.loaded || holder.error) {\n      return false;\n    }\n    if (holder.scriptPresent === undefined) {\n      const scriptInHead = this.win.document.head.querySelector(\n          `[custom-element=\"${extensionId}\"]`);\n      holder.scriptPresent = !!scriptInHead;\n    }\n    return !holder.scriptPresent;\n  }\n\n  /**\n   * Create the missing amp extension HTML script element.\n   * @param {string} extensionId\n   * @return {!Element} Script object\n   * @private\n   */\n  createExtensionScript_(extensionId) {\n    const scriptElement = this.win.document.createElement('script');\n    scriptElement.async = true;\n    scriptElement.setAttribute('custom-element', extensionId);\n    scriptElement.setAttribute('data-script', extensionId);\n    const loc = this.win.location;\n    const useCompiledJs = shouldUseCompiledJs();\n    const scriptSrc = calculateExtensionScriptUrl(loc, extensionId,\n        getMode().localDev, getMode().test, useCompiledJs);\n    scriptElement.src = scriptSrc;\n    return scriptElement;\n  }\n}\n\n\n/**\n * Calculate the base url for any scripts.\n * @param {!Location} location The window's location\n * @param {boolean=} isLocalDev\n * @param {boolean=} isTest\n * @return {string}\n */\nexport function calculateScriptBaseUrl(location, isLocalDev, isTest) {\n  if (isLocalDev) {\n    if (isTest || isMax(location) || isMin(location)) {\n      return `${location.protocol}//${location.host}/dist`;\n    }\n  }\n  return urls.cdn;\n}\n\n/**\n * Calculate script url for amp-ad.\n * @param {!Location} location The window's location\n * @param {string} extensionId\n * @param {boolean=} isLocalDev\n * @param {boolean=} isTest\n * @param {boolean=} isUsingCompiledJs\n * @return {string}\n */\nexport function calculateExtensionScriptUrl(location, extensionId, isLocalDev,\n    isTest, isUsingCompiledJs) {\n  const base = calculateScriptBaseUrl(location, isLocalDev, isTest);\n  if (isLocalDev) {\n    if ((isTest && !isUsingCompiledJs) || isMax(location)) {\n      return `${base}/v0/${extensionId}-0.1.max.js`;\n    }\n    return `${base}/v0/${extensionId}-0.1.js`;\n  }\n  return `${base}/rtv/${getMode().rtvVersion}/v0/${extensionId}-0.1.js`;\n}\n\n\n/**\n * Is this path to a max (unminified) version?\n * @param {!Location} location\n * @return {boolean}\n */\nfunction isMax(location) {\n  const path = location.pathname;\n  return path.indexOf('.max') >= 0 || path.substr(0, 5) == '/max/';\n}\n\n/**\n * Is this path to a minified version?\n * @param {!Location} location\n * @return {boolean}\n */\nfunction isMin(location) {\n  const path = location.pathname;\n  return path.indexOf('.min') >= 0 || path.substr(0, 5) == '/min/';\n}\n\n\n/**\n * @return {boolean}\n */\nfunction shouldUseCompiledJs() {\n  return getMode().test && self.ampTestRuntimeConfig &&\n      self.ampTestRuntimeConfig.useCompiledJs;\n}\n\n\n/**\n * Install builtins.\n * @param {!Window} win\n * @restricted\n */\nexport function installBuiltinElements(win) {\n  installImg(win);\n  installPixel(win);\n  installVideo(win);\n}\n\n/**\n * Copy builtins to a child window.\n * @param {!Window} childWin\n */\nfunction copyBuiltinElementsToChildWindow(childWin) {\n  copyElementToChildWindow(childWin, 'amp-img');\n  copyElementToChildWindow(childWin, 'amp-pixel');\n  copyElementToChildWindow(childWin, 'amp-video');\n}\n\n/**\n * Install polyfills in the child window (friendly iframe).\n * @param {!Window} childWin\n */\nfunction installPolyfillsInChildWindow(childWin) {\n  installDocContains(childWin);\n  installCustomElements(childWin);\n}\n","/**\n * Copyright 2015 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {assertLength, assertLengthOrPercent} from './layout';\nimport {user} from './log';\n\n\n/**\n * A single option within a SizeList.\n * @typedef {{\n *   mediaQuery: (string|undefined),\n *   size: (!./layout.LengthDef)\n * }}\n */\nlet SizeListOptionDef;\n\n\n/**\n * Parses the text representation of \"sizes\" into SizeList object.\n *\n * There could be any number of size options within the SizeList. They are tried\n * in the order they were defined. The final size option must not have \"media\"\n * condition specified. All other size options must have \"media\" condition\n * specified.\n *\n * See https://developer.mozilla.org/en-US/docs/Web/HTML/Element/img#Attributes\n * See http://www.w3.org/html/wg/drafts/html/master/semantics.html#attr-img-sizes\n * @param {string} s\n * @param {boolean=} opt_allowPercentAsLength when parsing heights\n * @return {!SizeList}\n */\nexport function parseSizeList(s, opt_allowPercentAsLength) {\n  const sSizes = s.split(',');\n  user().assert(sSizes.length > 0, 'sizes has to have at least one size');\n  const sizes = [];\n  sSizes.forEach(sSize => {\n    sSize = sSize.replace(/\\s+/g, ' ').trim();\n    if (sSize.length == 0) {\n      return;\n    }\n\n    let mediaStr;\n    let sizeStr;\n\n    // Process the expression from the end.\n    const lastChar = sSize.charAt(sSize.length - 1);\n    let div;\n    let func = false;\n    if (lastChar == ')') {\n      // Value is the CSS function, e.g. `calc(50vw + 10px)`.\n      func = true;\n\n      // First, skip to the opening paren.\n      let parens = 1;\n      div = sSize.length - 2;\n      for (; div >= 0; div--) {\n        const c = sSize.charAt(div);\n        if (c == '(') {\n          parens--;\n        } else if (c == ')') {\n          parens++;\n        }\n        if (parens == 0) {\n          break;\n        }\n      }\n\n      // Then, skip to the begining to the function's name.\n      const funcEnd = div - 1;\n      if (div > 0) {\n        div--;\n        for (; div >= 0; div--) {\n          const c = sSize.charAt(div);\n          if (!(c == '%' || c == '-' || c == '_' ||\n                (c >= 'a' && c <= 'z') ||\n                (c >= 'A' && c <= 'Z') ||\n                (c >= '0' && c <= '9'))) {\n            break;\n          }\n        }\n      }\n      user().assert(div < funcEnd, 'Invalid CSS function in \"%s\"', sSize);\n    } else {\n      // Value is the length or a percent: accept a wide range of values,\n      // including invalid values - they will be later asserted to conform\n      // to exact CSS length or percent value.\n      div = sSize.length - 2;\n      for (; div >= 0; div--) {\n        const c = sSize.charAt(div);\n        if (!(c == '%' || c == '.' ||\n              (c >= 'a' && c <= 'z') ||\n              (c >= 'A' && c <= 'Z') ||\n              (c >= '0' && c <= '9'))) {\n          break;\n        }\n      }\n    }\n    if (div >= 0) {\n      mediaStr = sSize.substring(0, div + 1).trim();\n      sizeStr = sSize.substring(div + 1).trim();\n    } else {\n      sizeStr = sSize;\n      mediaStr = undefined;\n    }\n    sizes.push({mediaQuery: mediaStr,\n      size: func ? sizeStr :\n          opt_allowPercentAsLength ?\n              assertLengthOrPercent(sizeStr) :\n              assertLength(sizeStr)});\n  });\n  return new SizeList(sizes);\n};\n\n\n/**\n * A SizeList object contains one or more sizes as typically seen in \"sizes\"\n * attribute.\n *\n * See \"select\" method for details on how the size selection is performed.\n *\n * See https://developer.mozilla.org/en-US/docs/Web/HTML/Element/img#Attributes\n * See http://www.w3.org/html/wg/drafts/html/master/semantics.html#attr-img-sizes\n */\nexport class SizeList {\n  /**\n   * @param {!Array<!SizeListOptionDef>} sizes\n   */\n  constructor(sizes) {\n    user().assert(sizes.length > 0, 'SizeList must have at least one option');\n    /** @private @const {!Array<!SizeListOptionDef>} */\n    this.sizes_ = sizes;\n\n    // All sources except for last must have a media query. The last one must\n    // not.\n    for (let i = 0; i < sizes.length; i++) {\n      const option = sizes[i];\n      if (i < sizes.length - 1) {\n        user().assert(option.mediaQuery,\n            'All options except for the last must have a media condition');\n      } else {\n        user().assert(!option.mediaQuery,\n            'The last option must not have a media condition');\n      }\n    }\n  }\n\n  /**\n   * Selects the first size that matches media conditions. If no options match,\n   * the last option is returned.\n   *\n   * See http://www.w3.org/html/wg/drafts/html/master/semantics.html#attr-img-sizes\n   * @param {!Window} win\n   * @return {!./layout.LengthDef|string}\n   */\n  select(win) {\n    for (let i = 0; i < this.sizes_.length - 1; i++) {\n      const option = this.sizes_[i];\n      if (option.mediaQuery && win.matchMedia(option.mediaQuery).matches) {\n        return option.size;\n      }\n    }\n    return this.getLast();\n  }\n\n  /**\n   * Returns the last size in the SizeList, which is the default.\n   * @return {!./layout.LengthDef|string}\n   */\n  getLast() {\n    return this.sizes_[this.sizes_.length - 1].size;\n  }\n}\n","/**\n * Copyright 2015 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {dev, user} from './log';\n\n\n/**\n * A single source within a srcset. Only one: width or DPR can be specified at\n * a time.\n * @typedef {{\n *   url: string,\n *   width: (number|undefined),\n *   dpr: (number|undefined)\n * }}\n */\nlet SrcsetSourceDef;\n\n\n/**\n * Extracts `srcset` and fallbacks to `src` if not available.\n * @param {!Element} element\n * @return {!Srcset}\n */\nexport function srcsetFromElement(element) {\n  const srcsetAttr = element.getAttribute('srcset');\n  if (srcsetAttr) {\n    return parseSrcset(srcsetAttr);\n  }\n  // We can't push `src` via `parseSrcset` because URLs in `src` are not always\n  // RFC compliant and can't be easily parsed as an `srcset`. For instance,\n  // they sometimes contain space characters.\n  const srcAttr = user().assert(element.getAttribute('src'),\n      'Either non-empty \"srcset\" or \"src\" attribute must be specified: %s',\n      element);\n  return new Srcset([{url: srcAttr, width: undefined, dpr: 1}]);\n}\n\n\n/**\n * Parses the text representation of srcset into Srcset object.\n * See https://developer.mozilla.org/en-US/docs/Web/HTML/Element/img#Attributes.\n * See http://www.w3.org/html/wg/drafts/html/master/semantics.html#attr-img-srcset.\n * @param {string} s\n * @param {!Element=} opt_element\n * @return {!Srcset}\n */\nexport function parseSrcset(s, opt_element) {\n  // General grammar: (URL [NUM[w|x]],)*\n  // Example 1: \"image1.png 100w, image2.png 50w\"\n  // Example 2: \"image1.png 2x, image2.png\"\n  // Example 3: \"image1,100w.png 100w, image2.png 50w\"\n  const sSources = s.match(\n      /\\s*(?:[\\S]*)(?:\\s+(?:-?(?:\\d+(?:\\.(?:\\d+)?)?|\\.\\d+)[a-zA-Z]))?(?:\\s*,)?/g\n  );\n  user().assert(sSources.length > 0,\n      'srcset has to have at least one source: %s',\n      opt_element);\n  const sources = [];\n  for (let i = 0; i < sSources.length; i++) {\n    let sSource = sSources[i].trim();\n    if (sSource.substr(-1) == ',') {\n      sSource = sSource.substr(0, sSource.length - 1).trim();\n    }\n    const parts = sSource.split(/\\s+/, 2);\n    if (parts.length == 0 ||\n          parts.length == 1 && !parts[0] ||\n          parts.length == 2 && !parts[0] && !parts[1]) {\n      continue;\n    }\n    const url = parts[0];\n    if (parts.length == 1 || parts.length == 2 && !parts[1]) {\n      // If no \"w\" or \"x\" specified, we assume it's \"1x\".\n      sources.push({url, width: undefined, dpr: 1});\n    } else {\n      const spec = parts[1].toLowerCase();\n      const lastChar = spec.substring(spec.length - 1);\n      if (lastChar == 'w') {\n        sources.push({url, width: parseFloat(spec), dpr: undefined});\n      } else if (lastChar == 'x') {\n        sources.push({url, width: undefined, dpr: parseFloat(spec)});\n      }\n    }\n  }\n  return new Srcset(sources);\n}\n\n\n/**\n * A srcset object contains one or more sources.\n *\n * There are two types of sources: width-based and DPR-based. Only one type\n * of sources allowed to be specified within a single srcset. Depending on a\n * usecase, the components are free to choose any source that best corresponds\n * to the required rendering quality and network and CPU conditions. See\n * \"select\" method for details on how this selection is performed.\n *\n * See https://developer.mozilla.org/en-US/docs/Web/HTML/Element/img#Attributes\n */\nexport class Srcset {\n\n  /**\n   * @param {!Array<!SrcsetSourceDef>} sources\n   */\n  constructor(sources) {\n    user().assert(sources.length > 0, 'Srcset must have at least one source');\n    /** @private @const {!Array<!SrcsetSourceDef>} */\n    this.sources_ = sources;\n\n    // Only one type of source specified can be used - width or DPR.\n    let hasWidth = false;\n    let hasDpr = false;\n    for (let i = 0; i < this.sources_.length; i++) {\n      const source = this.sources_[i];\n      user().assert(\n          (source.width || source.dpr) && (!source.width || !source.dpr),\n          'Either dpr or width must be specified');\n      hasWidth = hasWidth || !!source.width;\n      hasDpr = hasDpr || !!source.dpr;\n    }\n    user().assert(!hasWidth || !hasDpr,\n        'Srcset cannot have both width and dpr sources');\n\n    // Source and assert duplicates.\n    if (hasWidth) {\n      this.sources_.sort(sortByWidth);\n    } else {\n      this.sources_.sort(sortByDpr);\n    }\n\n    /** @private @const {boolean} */\n    this.widthBased_ = hasWidth;\n\n    /** @private @const {boolean} */\n    this.dprBased_ = hasDpr;\n  }\n\n  /**\n   * Performs selection for specified width and DPR. Here, width is the width\n   * in screen pixels and DPR is the device-pixel-ratio or pixel density of\n   * the device. Depending on the circumstances, such as low network conditions,\n   * it's possible to manipulate the result of this method by passing a lower\n   * DPR value.\n   *\n   * The source selection depends on whether this is width-based or DPR-based\n   * srcset.\n   *\n   * In a width-based source, the source's width is the physical width of a\n   * resource (e.g. an image). Depending on the provided DPR, this width is\n   * converted to the screen pixels as following:\n   *   pixelWidth = sourceWidth / DPR\n   *\n   * Then, the source closest to the requested \"width\" is selected using\n   * the \"pixelWidth\". The slight preference is given to the bigger sources to\n   * ensure the most optimal quality.\n   *\n   * In a DPR-based source, the source's DPR is used to return the source that\n   * is closest to the requested DPR.\n   *\n   * Based on\n   * http://www.w3.org/html/wg/drafts/html/master/semantics.html#attr-img-srcset.\n   * @param {number} width\n   * @param {number} dpr\n   * @return {!SrcsetSourceDef}\n   */\n  select(width, dpr) {\n    dev().assert(width, 'width=%s', width);\n    dev().assert(dpr, 'dpr=%s', dpr);\n    let index = -1;\n    if (this.widthBased_) {\n      index = this.selectByWidth_(width, dpr);\n    } else if (this.dprBased_) {\n      index = this.selectByDpr_(width, dpr);\n    }\n    if (index != -1) {\n      return this.sources_[index];\n    }\n    return this.getLast();\n  }\n\n  /**\n   * @param {number} width\n   * @param {number} dpr\n   * @return {number}\n   * @private\n   */\n  selectByWidth_(width, dpr) {\n    let minIndex = -1;\n    let minWidth = 1000000;\n    let minScore = 1000000;\n    for (let i = 0; i < this.sources_.length; i++) {\n      const source = this.sources_[i];\n      let sourceWidth;\n      if (source.width) {\n        sourceWidth = source.width / dpr;\n      } else {\n        // Default source: no width: assume values are half of of the\n        // minimum values seen.\n        sourceWidth = minWidth / 2;\n      }\n      minWidth = Math.min(minWidth, sourceWidth);\n      // The calculation is slightly biased toward higher width by offsetting\n      // score by negative 0.2.\n      const score = Math.abs((sourceWidth - width) / width - 0.2);\n      if (score < minScore) {\n        minScore = score;\n        minIndex = i;\n      }\n    }\n    return minIndex;\n  }\n\n  /**\n   * @param {number} _width\n   * @param {number} dpr\n   * @return {number}\n   * @private\n   */\n  selectByDpr_(_width, dpr) {\n    let minIndex = -1;\n    let minScore = 1000000;\n    for (let i = 0; i < this.sources_.length; i++) {\n      const source = this.sources_[i];\n      // Default DPR = 1.\n      const sourceDpr = source.dpr || 1;\n      const score = Math.abs(sourceDpr - dpr);\n      if (score < minScore) {\n        minScore = score;\n        minIndex = i;\n      }\n    }\n    return minIndex;\n  }\n\n  /**\n   * Returns the last source in the srcset, which is the default source.\n   * @return {!SrcsetSourceDef}\n   */\n  getLast() {\n    return this.sources_[this.sources_.length - 1];\n  }\n\n  /**\n   * Returns all sources in the srcset.\n   * @return {!Array<!SrcsetSourceDef>}\n   */\n  getSources() {\n    return this.sources_;\n  }\n\n  /**\n   * Reconstructs the string expression for this srcset.\n   * @return {string}\n   */\n  stringify() {\n    const res = [];\n    for (let i = 0; i < this.sources_.length; i++) {\n      const source = this.sources_[i];\n      if (source.width) {\n        res.push(`${source.url} ${source.width}w`);\n      } else if (source.dpr) {\n        res.push(`${source.url} ${source.dpr}x`);\n      } else {\n        res.push(`${source.url}`);\n      }\n    }\n    return res.join(', ');\n  }\n}\n\nfunction sortByWidth(s1, s2) {\n  user().assert(s1.width != s2.width, 'Duplicate width: %s', s1.width);\n  return s2.width - s1.width;\n}\n\nfunction sortByDpr(s1, s2) {\n  user().assert(s1.dpr != s2.dpr, 'Duplicate dpr: %s', s1.dpr);\n  return s2.dpr - s1.dpr;\n}\n","/**\n * Copyright 2015 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * @param {string} name Attribute name with dashes\n * @return {string} Dashes removed and character after to upper case.\n * visibleForTesting\n */\nexport function dashToCamelCase(name) {\n  return name.replace(/-([a-z])/g, function(_all, character) {\n    return character.toUpperCase();\n  });\n}\n\n/**\n * Polyfill for String.prototype. endsWith.\n * @param {string} string\n * @param {string} suffix\n * @return {boolean}\n */\nexport function endsWith(string, suffix) {\n  const index = string.length - suffix.length;\n  return index >= 0 && string.indexOf(suffix, index) == index;\n}\n\n/**\n * Polyfill for String.prototype. startsWith.\n * @param {string} string\n * @param {string} prefix\n * @return {boolean}\n */\nexport function startsWith(string, prefix) {\n  if (prefix.length > string.length) {\n    return false;\n  }\n  return string.lastIndexOf(prefix, 0) == 0;\n}\n\n/**\n * Expands placeholders in a given template string with values.\n *\n * Placeholders use ${key-name} syntax and are replaced with the value\n * returned from the given getter function.\n *\n * @param {string} template The template string to expand.\n * @param {!function(string):*} getter Function used to retrieve a value for a\n *   placeholder. Returns values will be coerced into strings.\n * @param {number=} opt_maxIterations Number of times to expand the template.\n *   Defaults to 1, but should be set to a larger value your placeholder tokens\n *   can be expanded to other placeholder tokens. Take caution with large values\n *   as recursively expanding a string can be exponentially expensive.\n */\nexport function expandTemplate(template, getter, opt_maxIterations) {\n  const maxIterations = opt_maxIterations || 1;\n  for (let i = 0; i < maxIterations; i++) {\n    let matches = 0;\n    template = template.replace(/\\${([^}]*)}/g, (_a, b) => {\n      matches++;\n      return getter(b);\n    });\n    if (!matches) {\n      break;\n    }\n  }\n  return template;\n}\n\n","/**\n * Copyright 2015 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {dev, rethrowAsync} from './log';\nimport {documentStateFor} from './document-state';\nimport {performanceFor} from './performance';\nimport {setStyles} from './style';\nimport {waitForServices} from './render-delaying-services';\nimport {resourcesForDoc} from './resources';\n\n\nconst bodyVisibleSentinel = '__AMP_BODY_VISIBLE';\n\n/**\n * Adds the given css text to the given document.\n *\n * The style tags will be at the beginning of the head before all author\n * styles. One element can be the main runtime CSS. This is guaranteed\n * to always be the first stylesheet in the doc.\n *\n * @param {!Document} doc The document that should get the new styles.\n * @param {string} cssText\n * @param {function()} cb Called when the new styles are available.\n *     Not using a promise, because this is synchronous when possible.\n *     for better performance.\n * @param {boolean=} opt_isRuntimeCss If true, this style tag will be inserted\n *     as the first element in head and all style elements will be positioned\n *     after.\n * @param {string=} opt_ext\n * @return {!Element}\n */\nexport function installStyles(doc, cssText, cb, opt_isRuntimeCss, opt_ext) {\n  const style = insertStyleElement(\n      doc,\n      dev().assertElement(doc.head),\n      cssText,\n      opt_isRuntimeCss || false,\n      opt_ext || null);\n\n  // Styles aren't always available synchronously. E.g. if there is a\n  // pending style download, it will have to finish before the new\n  // style is visible.\n  // For this reason we poll until the style becomes available.\n  // Sync case.\n  if (styleLoaded(doc, style)) {\n    cb();\n    return style;\n  }\n  // Poll until styles are available.\n  const interval = setInterval(() => {\n    if (styleLoaded(doc, style)) {\n      clearInterval(interval);\n      cb();\n    }\n  }, 4);\n  return style;\n}\n\n\n/**\n * Creates the properly configured style element.\n * @param {?Document} doc\n * @param {!Element|!ShadowRoot} cssRoot\n * @param {string} cssText\n * @param {boolean} isRuntimeCss\n * @param {?string} ext\n * @return {!Element}\n */\nexport function insertStyleElement(doc, cssRoot, cssText, isRuntimeCss, ext) {\n  const style = doc.createElement('style');\n  style./*OK*/textContent = cssText;\n  let afterElement = null;\n  // Make sure that we place style tags after the main runtime CSS. Otherwise\n  // the order is random.\n  if (isRuntimeCss) {\n    style.setAttribute('amp-runtime', '');\n    cssRoot.runtimeStyleElement = style;\n  } else if (ext == 'amp-custom') {\n    style.setAttribute('amp-custom', '');\n    afterElement = cssRoot.lastChild;\n  } else {\n    style.setAttribute('amp-extension', ext || '');\n    afterElement = cssRoot.runtimeStyleElement;\n  }\n  insertAfterOrAtStart(cssRoot, style, afterElement);\n  return style;\n}\n\n\n/**\n * Sets the document's body opacity to 1.\n * If the body is not yet available (because our script was loaded\n * synchronously), polls until it is.\n * @param {!Document} doc The document who's body we should make visible.\n * @param {boolean=} opt_waitForServices Whether the body visibility should\n *     be blocked on key services being loaded.\n */\nexport function makeBodyVisible(doc, opt_waitForServices) {\n  const set = () => {\n    setStyles(dev().assertElement(doc.body), {\n      opacity: 1,\n      visibility: 'visible',\n      animation: 'none',\n    });\n  };\n  try {\n    /** @const {!Window} */\n    const win = doc.defaultView;\n    documentStateFor(win).onBodyAvailable(() => {\n      if (win[bodyVisibleSentinel]) {\n        return;\n      }\n      win[bodyVisibleSentinel] = true;\n      if (opt_waitForServices) {\n        waitForServices(win).catch(reason => {\n          rethrowAsync(reason);\n          return [];\n        }).then(services => {\n          set();\n          if (services.length > 0) {\n            resourcesForDoc(doc)./*OK*/schedulePass(1, /* relayoutAll */ true);\n          }\n          try {\n            const perf = performanceFor(win);\n            perf.tick('mbv');\n            perf.flush();\n          } catch (e) {}\n        });\n      } else {\n        set();\n      }\n    });\n  } catch (e) {\n    // If there was an error during the logic above (such as service not\n    // yet installed, definitely try to make the body visible.\n    set();\n    // Avoid errors in the function to break execution flow as this is\n    // often called as a last resort.\n    rethrowAsync(e);\n  }\n}\n\n/**\n * Checks whether a style element was registered in the DOM.\n * @param {!Document} doc\n * @param {!Element} style\n * @return {boolean}\n */\nfunction styleLoaded(doc, style) {\n  const sheets = doc.styleSheets;\n  for (let i = 0; i < sheets.length; i++) {\n    const sheet = sheets[i];\n    if (sheet.ownerNode == style) {\n      return true;\n    }\n  }\n  return false;\n};\n\n/**\n * Insert the element in the root after the element named after or\n * if that is null at the beginning.\n * @param {!Element|!ShadowRoot} root\n * @param {!Element} element\n * @param {?Element} after\n */\nfunction insertAfterOrAtStart(root, element, after) {\n  if (after) {\n    if (after.nextSibling) {\n      root.insertBefore(element, after.nextSibling);\n    } else {\n      root.appendChild(element);\n    }\n  } else {\n    // Add at the start.\n    root.insertBefore(element, root.firstChild);\n  }\n}\n","/**\n * Copyright 2015 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n// Note: loaded by 3p system. Cannot rely on babel polyfills.\n\n/** @type {Object<string, string>} */\nlet propertyNameCache;\n\n/** @const {!Array<string>} */\nconst vendorPrefixes = ['Webkit', 'webkit', 'Moz', 'moz', 'ms', 'O', 'o'];\n\n\n/**\n * @export\n * @param {string} camelCase camel cased string\n * @return {string} title cased string\n */\nexport function camelCaseToTitleCase(camelCase) {\n  return camelCase.charAt(0).toUpperCase() + camelCase.slice(1);\n}\n\n/**\n * Checks the style if a prefixed version of a property exists and returns\n * it or returns an empty string.\n * @private\n * @param {!CSSStyleDeclaration|!HTMLDocument} style\n * @param {string} titleCase the title case version of a css property name\n * @return {string} the prefixed property name or null.\n */\nfunction getVendorJsPropertyName_(style, titleCase) {\n  for (let i = 0; i < vendorPrefixes.length; i++) {\n    const propertyName = vendorPrefixes[i] + titleCase;\n    if (style[propertyName] !== undefined) {\n      return propertyName;\n    }\n  }\n  return '';\n}\n\n/**\n * Returns the possibly prefixed JavaScript property name of a style property\n * (ex. WebkitTransitionDuration) given a camelCase'd version of the property\n * (ex. transitionDuration).\n * @export\n * @param {!CSSStyleDeclaration|!HTMLDocument} style\n * @param {string} camelCase the camel cased version of a css property name\n * @param {boolean=} opt_bypassCache bypass the memoized cache of property\n *   mapping\n * @return {string}\n */\nexport function getVendorJsPropertyName(style, camelCase, opt_bypassCache) {\n  if (!propertyNameCache) {\n    propertyNameCache = Object.create(null);\n  }\n  let propertyName = propertyNameCache[camelCase];\n  if (!propertyName || opt_bypassCache) {\n    propertyName = camelCase;\n    if (style[camelCase] === undefined) {\n      const titleCase = camelCaseToTitleCase(camelCase);\n      const prefixedPropertyName = getVendorJsPropertyName_(style, titleCase);\n\n      if (style[prefixedPropertyName] !== undefined) {\n        propertyName = prefixedPropertyName;\n      }\n    }\n    if (!opt_bypassCache) {\n      propertyNameCache[camelCase] = propertyName;\n    }\n  }\n  return propertyName;\n}\n\n\n/**\n * Sets the CSS style of the specified element with optional units, e.g. \"px\".\n * @param {Element} element\n * @param {string} property\n * @param {*} value\n * @param {string=} opt_units\n * @param {boolean=} opt_bypassCache\n */\nexport function setStyle(element, property, value, opt_units, opt_bypassCache) {\n  const propertyName = getVendorJsPropertyName(element.style, property,\n      opt_bypassCache);\n  if (propertyName) {\n    element.style[propertyName] = opt_units ? value + opt_units : value;\n  }\n}\n\n\n/**\n * Returns the value of the CSS style of the specified element.\n * @param {!Element} element\n * @param {string} property\n * @param {boolean=} opt_bypassCache\n * @return {*}\n */\nexport function getStyle(element, property, opt_bypassCache) {\n  const propertyName = getVendorJsPropertyName(element.style, property,\n      opt_bypassCache);\n  if (!propertyName) {\n    return undefined;\n  }\n  return element.style[propertyName];\n}\n\n\n/**\n * Sets the CSS styles of the specified element. The styles\n * a specified as a map from CSS property names to their values.\n * @param {!Element} element\n * @param {!Object<string, *>} styles\n */\nexport function setStyles(element, styles) {\n  for (const k in styles) {\n    setStyle(element, k, styles[k]);\n  }\n}\n\n\n/**\n * Shows or hides the specified element.\n * @param {!Element} element\n * @param {boolean=} opt_display\n */\nexport function toggle(element, opt_display) {\n  if (opt_display === undefined) {\n    opt_display = getStyle(element, 'display') == 'none';\n  }\n  setStyle(element, 'display', opt_display ? '' : 'none');\n}\n\n\n/**\n * Returns a pixel value.\n * @param {number} value\n * @return {string}\n */\nexport function px(value) {\n  return value + 'px';\n}\n\n\n/**\n * Returns a \"translateX\" for CSS \"transform\" property.\n * @param {number|string} value\n * @return {string}\n */\nexport function translateX(value) {\n  if (typeof value == 'string') {\n    return `translateX(${value})`;\n  }\n  return `translateX(${px(value)})`;\n}\n\n\n/**\n * Returns a \"translateX\" for CSS \"transform\" property.\n * @param {number|string} x\n * @param {(number|string)=} opt_y\n * @return {string}\n */\nexport function translate(x, opt_y) {\n  if (typeof x == 'number') {\n    x = px(x);\n  }\n  if (opt_y === undefined) {\n    return `translate(${x})`;\n  }\n  if (typeof opt_y == 'number') {\n    opt_y = px(opt_y);\n  }\n  return `translate(${x},${opt_y})`;\n}\n\n\n/**\n * Returns a \"scale\" for CSS \"transform\" property.\n * @param {number|string} value\n * @return {string}\n */\nexport function scale(value) {\n  return `scale(${value})`;\n}\n\n/**\n * Remove alpha value from a rgba color value.\n * Return the new color property with alpha equals if has the alpha value.\n * Caller needs to make sure the input color value is a valid rgba/rgb value\n * @param {string} rgbaColor\n * @return {string}\n */\nexport function removeAlphaFromColor(rgbaColor) {\n  return rgbaColor.replace(\n      /\\(([^,]+),([^,]+),([^,)]+),[^)]+\\)/g, '($1,$2,$3, 1)');\n}\n","/**\n * Copyright 2015 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {getExistingServiceForWindow} from './service';\n\n/**\n * @param {!Window} window\n * @return {!./service/timer-impl.Timer}\n */\nexport function timerFor(window) {\n  return /** @type {!./service/timer-impl.Timer} */ (\n      getExistingServiceForWindow(window, 'timer'));\n};\n","/**\n * Copyright 2015 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* @const */\nconst toString_ = Object.prototype.toString;\n\n/**\n * Returns the ECMA [[Class]] of a value\n * @param {*} value\n * @return {string}\n */\nfunction toString(value) {\n  return toString_.call(value);\n}\n\n/**\n * Determines if value is actually an Array.\n * @param {*} value\n * @return {boolean}\n */\nexport function isArray(value) {\n  return Array.isArray(value);\n}\n\n/**\n * Converts an array-like object to an array.\n * @param {?IArrayLike<T>|string} arrayLike\n * @return {!Array<T>}\n * @template T\n */\nexport function toArray(arrayLike) {\n  if (!arrayLike) {\n    return [];\n  }\n  const array = new Array(arrayLike.length);\n  for (let i = 0; i < arrayLike.length; i++) {\n    array[i] = arrayLike[i];\n  }\n  return array;\n}\n\n/**\n * Returns a map-like object.\n * If opt_initial is provided, copies its own properties into the\n * newly created object.\n * @param {T=} opt_initial This should typically be an object literal.\n * @return {T}\n * @template T\n */\nexport function map(opt_initial) {\n  const obj = Object.create(null);\n  if (opt_initial) {\n    Object.assign(obj, opt_initial);\n  }\n  return obj;\n}\n\n/**\n * Determines if value is actually an Object.\n * @param {*} value\n * @return {boolean}\n */\nexport function isObject(value) {\n  return toString(value) === '[object Object]';\n}\n\n/**\n * Determines if value is of number type and finite.\n * NaN and Infinity are not considered a finite number.\n * String numbers are not considered numbers.\n * @param {*} value\n * @return {boolean}\n */\nexport function isFiniteNumber(value) {\n  return (typeof value === 'number' && isFinite(value));\n}\n\n/**\n * Determines if value is of FormData type.\n * @param {*} value\n * @return {boolean}\n */\nexport function isFormData(value) {\n  return toString(value) === '[object FormData]';\n}\n","/**\n * Copyright 2015 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {getExistingServiceForDocInEmbedScope} from './service';\n\n\n/**\n * @param {!Node|!./service/ampdoc-impl.AmpDoc} nodeOrDoc\n * @return {!./service/url-replacements-impl.UrlReplacements}\n */\nexport function urlReplacementsForDoc(nodeOrDoc) {\n  return /** @type {!./service/url-replacements-impl.UrlReplacements} */ (\n      getExistingServiceForDocInEmbedScope(nodeOrDoc, 'url-replace'));\n}\n","/**\n * Copyright 2015 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {endsWith} from './string';\nimport {user} from './log';\nimport {getMode} from './mode';\nimport {urls} from './config';\nimport {isArray} from './types';\n\n/**\n * Cached a-tag to avoid memory allocation during URL parsing.\n * @type {HTMLAnchorElement}\n */\nlet a;\n\n/**\n * We cached all parsed URLs. As of now there are no use cases\n * of AMP docs that would ever parse an actual large number of URLs,\n * but we often parse the same one over and over again.\n * @type {Object<string, !Location>}\n */\nlet cache;\n\n/** @private @const Matches amp_js_* paramters in query string. */\nconst AMP_JS_PARAMS_REGEX = /[?&]amp_js[^&]*/;\n\n/** @const {string} */\nexport const SOURCE_ORIGIN_PARAM = '__amp_source_origin';\n\n/**\n * Returns a Location-like object for the given URL. If it is relative,\n * the URL gets resolved.\n * Consider the returned object immutable. This is enforced during\n * testing by freezing the object.\n * @param {string} url\n * @param {boolean=} opt_nocache\n * @return {!Location}\n */\nexport function parseUrl(url, opt_nocache) {\n  if (!a) {\n    a = /** @type {!HTMLAnchorElement} */ (self.document.createElement('a'));\n    cache = self.UrlCache || (self.UrlCache = Object.create(null));\n  }\n\n  const fromCache = cache[url];\n  if (fromCache) {\n    return fromCache;\n  }\n  a.href = url;\n  // IE11 doesn't provide full URL components when parsing relative URLs.\n  // Assigning to itself again does the trick.\n  // TODO(lannka, #3449): Remove all the polyfills once we don't support IE11\n  // and it passes tests in all browsers.\n  if (!a.protocol) {\n    a.href = a.href;\n  }\n\n  const info = /** @type {!Location} */({\n    href: a.href,\n    protocol: a.protocol,\n    host: a.host,\n    hostname: a.hostname,\n    port: a.port == '0' ? '' : a.port,\n    pathname: a.pathname,\n    search: a.search,\n    hash: a.hash,\n    origin: null,  // Set below.\n  });\n\n  // Some IE11 specific polyfills.\n  // 1) IE11 strips out the leading '/' in the pathname.\n  if (info.pathname[0] !== '/') {\n    info.pathname = '/' + info.pathname;\n  }\n\n  // 2) For URLs with implicit ports, IE11 parses to default ports while\n  // other browsers leave the port field empty.\n  if ((info.protocol == 'http:' && info.port == 80)\n      || (info.protocol == 'https:' && info.port == 443)) {\n    info.port = '';\n    info.host = info.hostname;\n  }\n\n  // For data URI a.origin is equal to the string 'null' which is not useful.\n  // We instead return the actual origin which is the full URL.\n  if (a.origin && a.origin != 'null') {\n    info.origin = a.origin;\n  } else if (info.protocol == 'data:' || !info.host) {\n    info.origin = info.href;\n  } else {\n    info.origin = info.protocol + '//' + info.host;\n  }\n  // Freeze during testing to avoid accidental mutation.\n  const frozen = (getMode().test && Object.freeze) ? Object.freeze(info) : info;\n\n  if (opt_nocache) {\n    return frozen;\n  }\n  return cache[url] = frozen;\n}\n\n/**\n * Appends the string just before the fragment part (or optionally\n * to the front of the query string) of the URL.\n * @param {string} url\n * @param {string} paramString\n * @param {boolean=} opt_addToFront\n * @return {string}\n */\nexport function appendEncodedParamStringToUrl(url, paramString,\n  opt_addToFront) {\n  if (!paramString) {\n    return url;\n  }\n  const mainAndFragment = url.split('#', 2);\n  const mainAndQuery = mainAndFragment[0].split('?', 2);\n\n  let newUrl = mainAndQuery[0] + (\n      mainAndQuery[1]\n          ? (opt_addToFront\n              ? `?${paramString}&${mainAndQuery[1]}`\n              : `?${mainAndQuery[1]}&${paramString}`)\n          : `?${paramString}`);\n  newUrl += mainAndFragment[1] ? `#${mainAndFragment[1]}` : '';\n  return newUrl;\n}\n/**\n * Appends a query string field and value to a url. `key` and `value`\n * will be ran through `encodeURIComponent` before appending.\n * @param {string} url\n * @param {string} key\n * @param {string} value\n * @param {boolean=} opt_addToFront\n * @return {string}\n */\nexport function addParamToUrl(url, key, value, opt_addToFront) {\n  const field = `${encodeURIComponent(key)}=${encodeURIComponent(value)}`;\n  return appendEncodedParamStringToUrl(url, field, opt_addToFront);\n}\n\n/**\n * Appends query string fields and values to a url. The `params` objects'\n * `key`s and `value`s will be transformed into query string keys/values.\n * @param {string} url\n * @param {!Object<string, string|!Array<string>>} params\n * @return {string}\n */\nexport function addParamsToUrl(url, params) {\n  return appendEncodedParamStringToUrl(url, serializeQueryString(params));\n}\n\n/**\n * Serializes the passed parameter map into a query string with both keys\n * and values encoded.\n * @param {!Object<string, string|!Array<string>>} params\n * @return {string}\n */\nexport function serializeQueryString(params) {\n  const s = [];\n  for (const k in params) {\n    const v = params[k];\n    if (v == null) {\n      continue;\n    } else if (isArray(v)) {\n      for (let i = 0; i < v.length; i++) {\n        const sv = /** @type {string} */ (v[i]);\n        s.push(`${encodeURIComponent(k)}=${encodeURIComponent(sv)}`);\n      }\n    } else {\n      const sv = /** @type {string} */ (v);\n      s.push(`${encodeURIComponent(k)}=${encodeURIComponent(sv)}`);\n    }\n  }\n  return s.join('&');\n}\n\n/**\n * Returns `true` if the URL is secure: either HTTPS or localhost (for testing).\n * @param {string|!Location} url\n * @return {boolean}\n */\nexport function isSecureUrl(url) {\n  if (typeof url == 'string') {\n    url = parseUrl(url);\n  }\n  return (url.protocol == 'https:' ||\n      url.hostname == 'localhost' ||\n      endsWith(url.hostname, '.localhost'));\n}\n\n/**\n * Asserts that a given url is HTTPS or protocol relative. It's a user-level\n * assert.\n *\n * Provides an exception for localhost.\n *\n * @param {?string|undefined} urlString\n * @param {!Element|string} elementContext Element where the url was found.\n * @param {string=} sourceName Used for error messages.\n * @return {string}\n */\nexport function assertHttpsUrl(\n    urlString, elementContext, sourceName = 'source') {\n  user().assert(urlString != null, '%s %s must be available',\n      elementContext, sourceName);\n  // (erwinm, #4560): type cast necessary until #4560 is fixed.\n  const theUrlString = /** @type {string} */ (urlString);\n  user().assert(isSecureUrl(theUrlString) || /^(\\/\\/)/.test(theUrlString),\n      '%s %s must start with ' +\n      '\"https://\" or \"//\" or be relative and served from ' +\n      'either https or from localhost. Invalid value: %s',\n      elementContext, sourceName, theUrlString);\n  return theUrlString;\n}\n\n/**\n * Asserts that a given url is an absolute HTTP or HTTPS URL.\n * @param {string} urlString\n * @return {string}\n */\nexport function assertAbsoluteHttpOrHttpsUrl(urlString) {\n  user().assert(/^https?\\:/i.test(urlString),\n      'URL must start with \"http://\" or \"https://\". Invalid value: %s',\n      urlString);\n  return parseUrl(urlString).href;\n}\n\n\n/**\n * Parses the query string of an URL. This method returns a simple key/value\n * map. If there are duplicate keys the latest value is returned.\n * @param {string} queryString\n * @return {!Object<string>}\n */\nexport function parseQueryString(queryString) {\n  const params = Object.create(null);\n  if (!queryString) {\n    return params;\n  }\n  if (queryString.indexOf('?') == 0 || queryString.indexOf('#') == 0) {\n    queryString = queryString.substr(1);\n  }\n  const pairs = queryString.split('&');\n  for (let i = 0; i < pairs.length; i++) {\n    const pair = pairs[i];\n    const eqIndex = pair.indexOf('=');\n    let name;\n    let value;\n    if (eqIndex != -1) {\n      name = decodeURIComponent(pair.substring(0, eqIndex)).trim();\n      value = decodeURIComponent(pair.substring(eqIndex + 1)).trim();\n    } else {\n      name = decodeURIComponent(pair).trim();\n      value = '';\n    }\n    if (name) {\n      params[name] = value;\n    }\n  }\n  return params;\n}\n\n\n/**\n * Returns the URL without fragment. If URL doesn't contain fragment, the same\n * string is returned.\n * @param {string} url\n * @return {string}\n */\nexport function removeFragment(url) {\n  const index = url.indexOf('#');\n  if (index == -1) {\n    return url;\n  }\n  return url.substring(0, index);\n}\n\n\n/**\n * Returns whether the URL has the origin of a proxy.\n * @param {string|!Location} url URL of an AMP document.\n * @return {boolean}\n */\nexport function isProxyOrigin(url) {\n  if (typeof url == 'string') {\n    url = parseUrl(url);\n  }\n  return urls.cdnProxyRegex.test(url.origin);\n}\n\n/**\n * Returns whether the URL origin is localhost.\n * @param {string|!Location} url URL of an AMP document.\n * @return {boolean}\n */\nexport function isLocalhostOrigin(url) {\n  if (typeof url == 'string') {\n    url = parseUrl(url);\n  }\n  return urls.localhostRegex.test(url.origin);\n}\n\n/**\n * Removes parameters that start with amp js parameter pattern and returns the new\n * search string.\n * @param {string} urlSearch\n * @return {string}\n */\nfunction removeAmpJsParams(urlSearch) {\n  if (!urlSearch || urlSearch == '?') {\n    return '';\n  }\n  const search = urlSearch\n      .replace(AMP_JS_PARAMS_REGEX, '')\n      .replace(/^[?&]/, '');  // Removes first ? or &.\n  return search ? '?' + search : '';\n}\n\n/**\n * Returns the source URL of an AMP document for documents served\n * on a proxy origin or directly.\n * @param {string|!Location} url URL of an AMP document.\n * @return {string}\n */\nexport function getSourceUrl(url) {\n  if (typeof url == 'string') {\n    url = parseUrl(url);\n  }\n\n  // Not a proxy URL - return the URL itself.\n  if (!isProxyOrigin(url)) {\n    return url.href;\n  }\n\n  // A proxy URL.\n  // Example path that is being matched here.\n  // https://cdn.ampproject.org/c/s/www.origin.com/foo/\n  // The /s/ is optional and signals a secure origin.\n  const path = url.pathname.split('/');\n  const prefix = path[1];\n  user().assert(prefix == 'c' || prefix == 'v',\n      'Unknown path prefix in url %s', url.href);\n  const domainOrHttpsSignal = path[2];\n  const origin = domainOrHttpsSignal == 's'\n      ? 'https://' + decodeURIComponent(path[3])\n      : 'http://' + decodeURIComponent(domainOrHttpsSignal);\n  // Sanity test that what we found looks like a domain.\n  user().assert(origin.indexOf('.') > 0, 'Expected a . in origin %s', origin);\n  path.splice(1, domainOrHttpsSignal == 's' ? 3 : 2);\n  return origin + path.join('/') + removeAmpJsParams(url.search) +\n      (url.hash || '');\n}\n\n/**\n * Returns the source origin of an AMP document for documents served\n * on a proxy origin or directly.\n * @param {string|!Location} url URL of an AMP document.\n * @return {string} The source origin of the URL.\n */\nexport function getSourceOrigin(url) {\n  return parseUrl(getSourceUrl(url)).origin;\n}\n\n/**\n * Returns absolute URL resolved based on the relative URL and the base.\n * @param {string} relativeUrlString\n * @param {string|!Location} baseUrl\n * @return {string}\n */\nexport function resolveRelativeUrl(relativeUrlString, baseUrl) {\n  if (typeof baseUrl == 'string') {\n    baseUrl = parseUrl(baseUrl);\n  }\n  if (typeof URL == 'function') {\n    return new URL(relativeUrlString, baseUrl.href).toString();\n  }\n  return resolveRelativeUrlFallback_(relativeUrlString, baseUrl);\n}\n\n/**\n * Fallback for URL resolver when URL class is not available.\n * @param {string} relativeUrlString\n * @param {string|!Location} baseUrl\n * @return {string}\n * @private Visible for testing.\n */\nexport function resolveRelativeUrlFallback_(relativeUrlString, baseUrl) {\n  if (typeof baseUrl == 'string') {\n    baseUrl = parseUrl(baseUrl);\n  }\n  relativeUrlString = relativeUrlString.replace(/\\\\/g, '/');\n  const relativeUrl = parseUrl(relativeUrlString);\n\n  // Absolute URL.\n  if (relativeUrlString.toLowerCase().indexOf(relativeUrl.protocol) == 0) {\n    return relativeUrl.href;\n  }\n\n  // Protocol-relative URL.\n  if (relativeUrlString.indexOf('//') == 0) {\n    return baseUrl.protocol + relativeUrlString;\n  }\n\n  // Absolute path.\n  if (relativeUrlString.indexOf('/') == 0) {\n    return baseUrl.origin + relativeUrlString;\n  }\n\n  // Relative path.\n  const basePath = baseUrl.pathname.split('/');\n  return baseUrl.origin +\n      (basePath.length > 1 ?\n          basePath.slice(0, basePath.length - 1).join('/') :\n          '') +\n      '/' + relativeUrlString;\n}\n\n\n/**\n * Add \"__amp_source_origin\" query parameter to the URL.\n * @param {!Window} win\n * @param {string} url\n * @return {string}\n */\nexport function getCorsUrl(win, url) {\n  checkCorsUrl(url);\n  const sourceOrigin = getSourceOrigin(win.location.href);\n  return addParamToUrl(url, SOURCE_ORIGIN_PARAM, sourceOrigin);\n}\n\n\n/**\n * Checks if the url have __amp_source_origin and throws if it does.\n * @param {string} url\n */\nexport function checkCorsUrl(url) {\n  const parsedUrl = parseUrl(url);\n  const query = parseQueryString(parsedUrl.search);\n  user().assert(!(SOURCE_ORIGIN_PARAM in query),\n      'Source origin is not allowed in %s', url);\n}\n","/**\n * Copyright 2016 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * A bit like Array#filter, but removes elements that filter false from the\n * array. Returns the filtered items.\n *\n * @param {!Array<T>} array\n * @param {function(T, number, !Array<T>):boolean} filter\n * @return {!Array<T>}\n * @template T\n */\nexport function filterSplice(array, filter) {\n  const splice = [];\n  for (let i = 0; i < array.length; i++) {\n    const item = array[i];\n    if (!filter(item, i, array)) {\n      splice.push(item);\n      array.splice(i, 1);\n      i--;\n    }\n  }\n  return splice;\n}\n\n/**\n * Returns the index of the first element matching the predicate.\n * Like Array#findIndex.\n *\n * @param {!Array<T>} array\n * @param {function(T, number, !Array<T>):boolean} predicate\n * @return {number}\n * @template T\n */\nexport function findIndex(array, predicate) {\n  for (let i = 0; i < array.length; i++) {\n    if (predicate(array[i], i, array)) {\n      return i;\n    }\n  }\n  return -1;\n}\n","/**\n * Copyright 2016 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n\n/**\n * VideoInterface defines a common video API which any AMP component that plays\n * videos is expected to implement.\n *\n * AMP runtime uses this common API to provide consistent video experience and\n * analytics across all video players.\n *\n * Components implementing this interface must also extend\n * {@link ./base-element.BaseElement} and register with the\n * Video Manager {@link ./service/video-manager-impl.VideoManager} during\n * their `builtCallback`.\n *\n * @interface\n */\nexport class VideoInterface {\n\n  /**\n   * Whether the component supports video playback in the current platform.\n   * If false, component will be not treated as a video component.\n   * @return {boolean}\n   */\n  supportsPlatform() {}\n\n  /**\n   * Whether users can interact with the video such as pausing it.\n   * Example of non-interactive videos include design background videos where\n   * all controls are hidden from the user.\n   *\n   * @return {boolean}\n   */\n  isInteractive() {}\n\n  /**\n   * Plays the video..\n   *\n   * @param {boolean} unusedIsAutoplay Whether the call to the `play` method is\n   * triggered by the autoplay functionality. Video players can use this hint\n   * to make decisions such as not playing pre-roll video ads.\n   */\n  play(unusedIsAutoplay) {}\n\n  /**\n   * Pauses the video.\n   */\n  pause() {}\n\n  /**\n   * Mutes the video.\n   */\n  mute() {}\n\n  /**\n   * Unmutes the video.\n   */\n  unmute() {}\n\n  /**\n   * Makes the video UI controls visible.\n   *\n   * AMP will not call this method if `controls` attribute is not set.\n   */\n  showControls() {}\n\n  /**\n   * Hides the video UI controls.\n   *\n   * AMP will not call this method if `controls` attribute is not set.\n   */\n  hideControls() {}\n\n  /**\n   * Automatically comes from {@link ./base-element.BaseElement}\n   *\n   * @return {!AmpElement}\n   */\n  get element() {}\n\n  /**\n   * Automatically comes from {@link ./base-element.BaseElement}\n   *\n   * @return {boolean}\n   */\n  isInViewport() {}\n}\n\n\n/**\n * Attributes\n *\n * Components implementing the VideoInterface are expected to support\n * the following attributes.\n *\n * @constant {!Object<string, string>}\n */\nexport const VideoAttributes = {\n  /**\n   * autoplay\n   *\n   * Whether the developer has configured autoplay on the component.\n   * This is normally done by setting `autoplay` attribute on the component.\n   *\n   * AMP runtime manages autoplay behaviour itself using methods such as `play`,\n   * `pause`, `showControls`, `hideControls`, `mute`, etc.. therefore components\n   * should not propagate the autoplay attribute to the underlying player\n   * implementation.\n   *\n   * When a video is requested to autoplay, AMP will automatically\n   * mute and hide the controls for the video, when video is 75% visible in\n   * the viewport, AMP will play the video and later pauses it when 25%\n   * or more of the video exits the viewport. If an auto-playing video also has\n   * controls, AMP will install a tap\n   * handler on the video, and when an end-user taps the video, AMP will show\n   * the controls.\n   *\n   */\n  AUTOPLAY: 'autoplay',\n};\n\n\n/**\n * Events\n *\n * Components implementing the VideoInterface are expected to dispatch\n * the following DOM events.\n *\n * @constant {!Object<string, string>}\n */\nexport const VideoEvents = {\n  /**\n   * load\n   *\n   * Fired when the video player is loaded and calls to methods such as `play()`\n   * are allowed.\n   *\n   * @event load\n   */\n  LOAD: 'load',\n\n  /**\n   * play\n   *\n   * Fired when the video plays.\n   *\n   * @event play\n   */\n  PLAY: 'play',\n\n  /**\n   * pause\n   *\n   * Fired when the video pauses.\n   *\n   * @event pause\n   */\n  PAUSE: 'pause',\n\n  /**\n   * amp:video:visibility\n   *\n   * Fired when the video's visibility changes. Normally fired\n   * from `viewportCallback`.\n   *\n   * @event amp:video:visibility\n   * @property {boolean} visible Whether the video player is visible or not.\n   */\n  VISIBILITY: 'amp:video:visibility',\n};\n","/**\n * Copyright 2016 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {getExistingServiceForDoc} from './service';\n\n\n/**\n * @param {!Node|!./service/ampdoc-impl.AmpDoc} nodeOrDoc\n * @return {!./service/video-manager-impl.VideoManager}\n */\nexport function videoManagerForDoc(nodeOrDoc) {\n  return /** @type {!./service/video-manager-impl.VideoManager} */ (\n      getExistingServiceForDoc(nodeOrDoc, 'video-manager'));\n};\n","/**\n * Copyright 2015 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {getExistingServiceForDoc, getServicePromiseForDoc} from './service';\n\n\n/**\n * @param {!Node|!./service/ampdoc-impl.AmpDoc} nodeOrDoc\n * @return {!./service/viewer-impl.Viewer}\n */\nexport function viewerForDoc(nodeOrDoc) {\n  return /** @type {!./service/viewer-impl.Viewer} */ (\n      getExistingServiceForDoc(nodeOrDoc, 'viewer'));\n}\n\n\n/**\n * Returns promise for the viewer. This is an unusual case and necessary only\n * for services that need reference to the viewer before it has been\n * initialized. Most of the code, however, just should use `viewerForDoc`.\n * @param {!Node|!./service/ampdoc-impl.AmpDoc} nodeOrDoc\n * @return {!Promise<!./service/viewer-impl.Viewer>}\n */\nexport function viewerPromiseForDoc(nodeOrDoc) {\n  return /** @type {!Promise<!./service/viewer-impl.Viewer>} */ (\n      getServicePromiseForDoc(nodeOrDoc, 'viewer'));\n}\n","/**\n * Copyright 2015 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {getExistingServiceForDoc} from './service';\n\n/**\n * @param {!Node|!./service/ampdoc-impl.AmpDoc} nodeOrDoc\n * @return {!./service/viewport-impl.Viewport}\n */\nexport function viewportForDoc(nodeOrDoc) {\n  return /** @type {!./service/viewport-impl.Viewport} */ (\n      getExistingServiceForDoc(nodeOrDoc, 'viewport'));\n}\n","/**\n * Copyright 2015 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {getExistingServiceForWindow} from './service';\n\n\n/**\n * @param {!Window} window\n * @return {!./service/vsync-impl.Vsync}\n */\nexport function vsyncFor(window) {\n  return /** @type {!./service/vsync-impl.Vsync} */ (\n      getExistingServiceForWindow(window, 'vsync'));\n};\n","/*! https://mths.be/cssescape v1.5.1 by @mathias | MIT license */\n\n\n/**\n * https://drafts.csswg.org/cssom/#serialize-an-identifier\n * @param {string} value\n * @return {string}\n */\nexport function cssEscape(value) {\n\t\tif (arguments.length == 0) {\n\t\t\tthrow new TypeError('`CSS.escape` requires an argument.');\n\t\t}\n\t\tvar string = String(value);\n\t\tvar length = string.length;\n\t\tvar index = -1;\n\t\tvar codeUnit;\n\t\tvar result = '';\n\t\tvar firstCodeUnit = string.charCodeAt(0);\n\t\twhile (++index < length) {\n\t\t\tcodeUnit = string.charCodeAt(index);\n\t\t\t// Note: there’s no need to special-case astral symbols, surrogate\n\t\t\t// pairs, or lone surrogates.\n\n\t\t\t// If the character is NULL (U+0000), then the REPLACEMENT CHARACTER\n\t\t\t// (U+FFFD).\n\t\t\tif (codeUnit == 0x0000) {\n\t\t\t\tresult += '\\uFFFD';\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\t// If the character is in the range [\\1-\\1F] (U+0001 to U+001F) or is\n\t\t\t\t// U+007F, […]\n\t\t\t\t(codeUnit >= 0x0001 && codeUnit <= 0x001F) || codeUnit == 0x007F ||\n\t\t\t\t// If the character is the first character and is in the range [0-9]\n\t\t\t\t// (U+0030 to U+0039), […]\n\t\t\t\t(index == 0 && codeUnit >= 0x0030 && codeUnit <= 0x0039) ||\n\t\t\t\t// If the character is the second character and is in the range [0-9]\n\t\t\t\t// (U+0030 to U+0039) and the first character is a `-` (U+002D), […]\n\t\t\t\t(\n\t\t\t\t\tindex == 1 &&\n\t\t\t\t\tcodeUnit >= 0x0030 && codeUnit <= 0x0039 &&\n\t\t\t\t\tfirstCodeUnit == 0x002D\n\t\t\t\t)\n\t\t\t) {\n\t\t\t\t// https://drafts.csswg.org/cssom/#escape-a-character-as-code-point\n\t\t\t\tresult += '\\\\' + codeUnit.toString(16) + ' ';\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\t// If the character is the first character and is a `-` (U+002D), and\n\t\t\t\t// there is no second character, […]\n\t\t\t\tindex == 0 &&\n\t\t\t\tlength == 1 &&\n\t\t\t\tcodeUnit == 0x002D\n\t\t\t) {\n\t\t\t\tresult += '\\\\' + string.charAt(index);\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// If the character is not handled by one of the above rules and is\n\t\t\t// greater than or equal to U+0080, is `-` (U+002D) or `_` (U+005F), or\n\t\t\t// is in one of the ranges [0-9] (U+0030 to U+0039), [A-Z] (U+0041 to\n\t\t\t// U+005A), or [a-z] (U+0061 to U+007A), […]\n\t\t\tif (\n\t\t\t\tcodeUnit >= 0x0080 ||\n\t\t\t\tcodeUnit == 0x002D ||\n\t\t\t\tcodeUnit == 0x005F ||\n\t\t\t\tcodeUnit >= 0x0030 && codeUnit <= 0x0039 ||\n\t\t\t\tcodeUnit >= 0x0041 && codeUnit <= 0x005A ||\n\t\t\t\tcodeUnit >= 0x0061 && codeUnit <= 0x007A\n\t\t\t) {\n\t\t\t\t// the character itself\n\t\t\t\tresult += string.charAt(index);\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// Otherwise, the escaped character.\n\t\t\t// https://drafts.csswg.org/cssom/#escape-a-character\n\t\t\tresult += '\\\\' + string.charAt(index);\n\n\t\t}\n\t\treturn result;\n}\n"]}