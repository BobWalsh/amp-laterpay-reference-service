(self.AMP = self.AMP || []).push({n:"amp-access-laterpay", f:(function(AMP) {Date.now();self.log=self.log||{user:null,dev:null};var h=self.log;function k(){if(h.user)return h.user;throw Error("failed to call initLogConstructor");};function l(a,b,c){if(b(a))c();else{var d=a.ownerDocument.defaultView;if(d.MutationObserver){var e=new d.MutationObserver(function(){b(a)&&(e.disconnect(),c())});e.observe(a,{childList:!0})}else var g=d.setInterval(function(){b(a)&&(d.clearInterval(g),c())},5)}}function m(a,b){l(a.documentElement,function(){return!!a.body},b)}function n(a){return new Promise(function(b){m(a,b)})};function p(a,b){a=a.__AMP_TOP||a;var c=a.services&&a.services[b]&&a.services[b].obj;return c}function q(a){var b=r(a);if(b)return b;a=t(a);var c,d=new Promise(function(a){c=a});a.access={obj:null,promise:d,resolve:c};return d}function r(a){if(a=t(a).access){var b=a.promise;if(b)return b;if(a.obj)return a.promise=Promise.resolve(a.obj)}return null}function t(a){var b=a.services;b||(b=a.services={});return b};function v(a){var b="amp-access";return w(a,b).then(function(a){return k().assert(a,"Service %s was requested to be provided through %s, but %s is not loaded in the current page. To fix this problem load the JavaScript file for %s in this page.","access",b,b,b)})}function w(a,b){var c=r(a);return c?c:Promise.resolve().then(function(){return a.ampExtendedElements&&a.ampExtendedElements[b]?q(a):n(a.document).then(function(){return a.ampExtendedElements&&a.ampExtendedElements[b]?q(a):null})})};function x(a,b,c){var d,e=d||!1;a.addEventListener(b,c,e);return function(){a&&a.removeEventListener(b,c,e);a=c=null}};function y(a){this.c=a;this.i=this.c.win;this.a=this.i.document;this.f=this.c.getAdapterConfig();this.j=this.b=null;this.m=[];this.g=this.h=null;var b=this.f.configUrl;this.l=b+"/api/public/amp?article_url=CANONICAL_URL&amp_reader_id=READER_ID&return_url=RETURN_URL";var c=this.f.articleId;c&&(this.l+="&article_id="+c);this.u=p(this.i,"timer");this.v=p(this.i,"vsync");this.w=p(this.i,"xhr")}
y.prototype.authorize=function(){var a=this;return z(this).then(function(b){if(204===b.status)throw k().createError("No merchant domains have been matched for this article, or no paid content configurations are setup.");A(a);window.scrollTo(0,0);return{access:b.access}},function(b){var c=b.response.status;if(402===c)a.b=b.responseJson,B(a);else throw b;return{access:b.responseJson.access}})};
function z(a){var b=a.l+"&article_title="+a.a.querySelector(a.f.articleTitleSelector).textContent.trim(),c=a.c.buildUrl(b,!1);return c.then(function(b){return a.u.timeoutPromise(3E3,a.w.fetchJson(b,{credentials:"include",requireAmpResponseSourceOrigin:!0}))})}function A(a){for(var b;b=a.m.shift();)b();a.j&&a.j();a.v.mutate(function(){for(var b=a.a.querySelector("amp-access-laterpay-list");b.firstChild;)b.removeChild(b.firstChild)})}
function B(a){var b=a.a.querySelector("amp-access-laterpay-list"),c=a.a.createElement("ul");a.b.premiumcontent.title="Buy only this article";a.b.premiumcontent.description=a.a.querySelector(a.f.articleTitleSelector).textContent.trim();c.appendChild(C(a,a.b.premiumcontent,"Buy Now, Pay Later"));a.b.timepasses.forEach(function(b){c.appendChild(C(a,b,"Buy Now"))});var d=a.a.createElement("button");d.textContent="Buy Now";d.disabled=!0;a.g=d;a.j=x(d,"click",a.s.bind(a));b.appendChild(c);b.appendChild(d)}
function C(a,b,c){var d=a.a.createElement("li"),e=a.a.createElement("label");e.for=b.title;e.appendChild(D(a,b,c));var g=a.a.createElement("div"),f=a.a.createElement("span");f.textContent=b.title;g.appendChild(f);f=a.a.createElement("p");f.textContent=b.description;g.appendChild(f);e.appendChild(g);d.appendChild(e);var u=a.a.createElement("p");a=b.price;f=Object.keys(a)[0];u.textContent=a[f]+f;d.appendChild(u);return d}
function D(a,b,c){var d=a.a.createElement("input");d.name="purchaseOption";d.type="radio";d.id=b.title;d.value=b.purchase_url;d.setAttribute("data-purchase-action-label",c);a.m.push(x(d,"change",a.o.bind(a)));return d}y.prototype.o=function(a){a.preventDefault();var b="amp-access-laterpay-selected",c=this.h,d=a.target.dataset.purchaseActionLabel;c&&c.classList.contains(b)&&c.classList.remove(b);this.h=a.target;this.h.classList.add(b);this.g.disabled&&(this.g.disabled=!1);this.g.textContent=d};
y.prototype.s=function(){var a=this.h.value;this.c.loginWithUrl(a)};(function(a){return v(a)})(AMP.win).then(function(a){a.registerVendor("laterpay",new y(a))});
})});
//# sourceMappingURL=amp-access-laterpay-0.1.js.map

