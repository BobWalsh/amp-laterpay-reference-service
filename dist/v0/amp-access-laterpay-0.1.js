(self.AMP = self.AMP || []).push({n:"amp-access-laterpay", f:(function(AMP) {Date.now();self.log=self.log||{user:null,dev:null};var h=self.log;function k(){if(h.user)return h.user;throw Error("failed to call initLogConstructor");};function l(a,b,c){if(b(a))c();else{var d=a.ownerDocument.defaultView;if(d.MutationObserver){var e=new d.MutationObserver(function(){b(a)&&(e.disconnect(),c())});e.observe(a,{childList:!0})}else var g=d.setInterval(function(){b(a)&&(d.clearInterval(g),c())},5)}}function m(a,b){l(a.documentElement,function(){return!!a.body},b)}function n(a){return new Promise(function(b){m(a,b)})};function p(a,b){a=a.__AMP_TOP||a;var c=a.services&&a.services[b]&&a.services[b].obj;return c}function q(a){var b=r(a);if(b)return b;a=t(a);var c,d=new Promise(function(a){c=a});a.access={obj:null,promise:d,resolve:c};return d}function r(a){if(a=t(a).access){var b=a.promise;if(b)return b;if(a.obj)return a.promise=Promise.resolve(a.obj)}return null}function t(a){var b=a.services;b||(b=a.services={});return b};function u(a){var b="amp-access";return v(a,b).then(function(a){return k().assert(a,"Service %s was requested to be provided through %s, but %s is not loaded in the current page. To fix this problem load the JavaScript file for %s in this page.","access",b,b,b)})}function v(a,b){var c=r(a);return c?c:Promise.resolve().then(function(){return a.ampExtendedElements&&a.ampExtendedElements[b]?q(a):n(a.document).then(function(){return a.ampExtendedElements&&a.ampExtendedElements[b]?q(a):null})})};function w(a,b,c){var d,e=d||!1;a.addEventListener(b,c,e);return function(){a&&a.removeEventListener(b,c,e);a=c=null}};var x={decimalDelimeter:".",premiumContentTitle:"Buy only this article",ppuButton:"Buy Now, Pay Later",sisButton:"Buy Now",defaultButton:"Buy Now",alreadyPurchasedLink:"I already bought this"};
function y(a){this.f=a;this.j=this.f.win;this.a=this.j.document;this.b=this.f.getAdapterConfig();this.l=this.o=this.c=null;this.u=[];this.m=!0;this.h=this.i=null;var b=this.b.configUrl;this.v=this.b.locale||"en";this.g=Object.assign(x,this.b.localeMessages||{});this.s=b+"/api/public/amp?article_url=CANONICAL_URL&amp_reader_id=READER_ID&return_url=RETURN_URL";var c=this.b.articleId;c&&(this.s+="&article_id="+c);this.B=p(this.j,"timer");this.C=p(this.j,"vsync");this.D=p(this.j,"xhr")}
y.prototype.authorize=function(){var a=this;return z(this).then(function(b){if(204===b.status)throw k().createError("No merchant domains have been matched for this article, or no paid content configurations are setup.");window.scrollTo(0,0);A(a);return{access:b.access}},function(b){var c=b&&b.response&&b.response.status;if(402===c)a.c=b.responseJson,A(a).then(a.A.bind(a));else throw b;return{access:b.responseJson.access}})};
function z(a){var b=a.s+"&article_title="+a.a.querySelector(a.b.articleTitleSelector).textContent.trim(),c=a.f.buildUrl(b,!1);return c.then(function(b){return a.B.timeoutPromise(3E3,a.D.fetchJson(b,{credentials:"include",requireAmpResponseSourceOrigin:!0}))})}function A(a){if(a.m)return Promise.resolve();for(var b;b=a.u.shift();)b();a.o&&a.o();a.l&&a.l();return a.C.mutatePromise(function(){a.m=!0;for(var b=a.a.querySelector("amp-access-laterpay-list");b.firstChild;)b.removeChild(b.firstChild)})}
y.prototype.A=function(){var a=this,b=this.a.querySelector("amp-access-laterpay-list"),c=this.a.createElement("ul");this.c.premiumcontent.tp_title=this.g.premiumContentTitle;this.c.premiumcontent.description=this.a.querySelector(this.b.articleTitleSelector).textContent.trim();c.appendChild(B(this,this.c.premiumcontent,this.g.ppuButton));this.c.timepasses.forEach(function(b){c.appendChild(B(a,b,a.g.sisButton))});var d=this.a.createElement("button");d.className="amp-access-laterpay-purchase-button";
d.textContent=this.g.defaultButton;d.disabled=!0;this.h=d;this.o=w(d,"click",function(b){C(a,b,a.i.value)});b.appendChild(c);b.appendChild(d);b.appendChild(D(this,this.c.apl));this.m=!1};
function B(a,b,c){var d=a.a.createElement("li"),e=a.a.createElement("label");e.for=b.tp_title;e.appendChild(E(a,b,c));var g=a.a.createElement("div");g.className="amp-access-laterpay-metadata";var f=a.a.createElement("span");f.className="amp-access-laterpay-title";f.textContent=b.tp_title;g.appendChild(f);f=a.a.createElement("p");f.className="amp-access-laterpay-description";f.textContent=b.description;g.appendChild(f);e.appendChild(g);d.appendChild(e);d.appendChild(F(a,b.price));return d}
function E(a,b,c){var d=a.a.createElement("input");d.name="purchaseOption";d.type="radio";d.id=b.tp_title;d.value=b.purchase_url;d.setAttribute("data-purchase-action-label",c);a.u.push(w(d,"change",a.w.bind(a)));return d}
function F(a,b){var c=Object.keys(b)[0],d=(b[c]/100).toLocaleString(a.v,{style:"decimal",minimumFractionDigits:0}),e=a.a.createElement("span");e.className="amp-access-laterpay-price";e.textContent=d;var g=a.a.createElement("sup");g.className="amp-access-laterpay-currency";g.textContent=c;var f=a.a.createElement("p");f.className="amp-access-laterpay-price-container";f.appendChild(e);f.appendChild(g);return f}
function D(a,b){var c=a.a.createElement("p");c.className="amp-access-laterpay-already-purchased-container";var d=a.a.createElement("a");d.href=b;d.textContent=a.g.alreadyPurchasedLink;a.l=w(d,"click",function(c){C(a,c,b)});c.appendChild(d);return c}
y.prototype.w=function(a){a.preventDefault();var b="amp-access-laterpay-selected",c=this.i,d=a.target.dataset.purchaseActionLabel;c&&c.classList.contains(b)&&c.classList.remove(b);this.i=a.target;this.i.classList.add(b);this.h.disabled&&(this.h.disabled=!1);this.h.textContent=d};function C(a,b,c){b.preventDefault();var d=c+"?return_url=RETURN_URL&article_url=SOURCE_URL&amp_reader_id=READER_ID";a.f.buildUrl(d,!1).then(function(b){a.f.loginWithUrl(b)})}
(function(a){return u(a)})(AMP.win).then(function(a){a.registerVendor("laterpay",new y(a))});
})});
//# sourceMappingURL=amp-access-laterpay-0.1.js.map

