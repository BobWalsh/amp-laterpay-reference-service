(self.AMP = self.AMP || []).push({n:"amp-access-laterpay", f:(function(AMP) {var k="";function l(a){var b=Object.create(null);if(!a)return b;if(0==a.indexOf("?")||0==a.indexOf("#"))a=a.substr(1);for(var c=a.split("&"),d=0;d<c.length;d++){var f=c[d],e=f.indexOf("="),g,h;-1!=e?(g=decodeURIComponent(f.substring(0,e)).trim(),h=decodeURIComponent(f.substring(e+1)).trim()):(g=decodeURIComponent(f).trim(),h="");g&&(b[g]=h)}return b};Date.now();self.log=self.log||{user:null,dev:null};var m=self.log;function n(){if(m.user)return m.user;throw Error("failed to call initLogConstructor");};function q(a,b,c){if(b(a))c();else{var d=a.ownerDocument.defaultView;if(d.MutationObserver){var f=new d.MutationObserver(function(){b(a)&&(f.disconnect(),c())});f.observe(a,{childList:!0})}else var e=d.setInterval(function(){b(a)&&(d.clearInterval(e),c())},5)}}function r(a,b){q(a.documentElement,function(){return!!a.body},b)}function t(a){return new Promise(function(b){r(a,b)})};function u(a,b){a=a.__AMP_TOP||a;var c=a.services&&a.services[b]&&a.services[b].obj;return c}function v(a){var b=w(a);if(b)return b;a=x(a);var c,d=new Promise(function(a){c=a});a.access={obj:null,promise:d,resolve:c};return d}function w(a){if(a=x(a).access){var b=a.promise;if(b)return b;if(a.obj)return a.promise=Promise.resolve(a.obj)}return null}function x(a){var b=a.services;b||(b=a.services={});return b};function y(a){var b="amp-access";return z(a,b).then(function(a){return n().assert(a,"Service %s was requested to be provided through %s, but %s is not loaded in the current page. To fix this problem load the JavaScript file for %s in this page.","access",b,b,b)})}function z(a,b){var c=w(a);return c?c:Promise.resolve().then(function(){return a.ampExtendedElements&&a.ampExtendedElements[b]?v(a):t(a.document).then(function(){return a.ampExtendedElements&&a.ampExtendedElements[b]?v(a):null})})};var A;
function B(a){var b="amp-access-laterpay",c=A||(A=Object.create(null)),d;if(b in c)d=c[b];else{d=b;var f=b,e;if(a._experimentCookie)e=a._experimentCookie;else{c:{d:{try{e=a.document.cookie;break d}catch(I){}e=void 0}if(e){e=e.split(";");for(var g=0;g<e.length;g++){var h=e[g].trim(),p=h.indexOf("=");if(-1!=p&&"AMP_EXP"==decodeURIComponent(h.substring(0,p).trim())){e=decodeURIComponent(h.substring(p+1).trim());break c}}}e=null}e=a._experimentCookie=e?e.split(/\s*,\s*/g):[]}a=-1!=e.indexOf(f)?!0:a.AMP_CONFIG&&
a.AMP_CONFIG.hasOwnProperty(f)?Math.random()<a.AMP_CONFIG[f]:!1;d=c[d]=a}return d};function C(a,b,c){var d,f=d||!1;a.addEventListener(b,c,f);return function(){a&&a.removeEventListener(b,c,f);a=c=null}};function D(a){this.f=a;this.c=this.f.win;this.a=this.c.document;this.g=this.f.getAdapterConfig();this.i=this.b=null;this.m=[];this.j=this.h=null;var b=self;if(b.AMP_MODE)b=b.AMP_MODE;else{var c;if(b.context&&b.context.mode)c=b.context.mode;else{c=l(b.location.originalHash||b.location.hash);var d=l(b.location.search);k||(k=b.AMP_CONFIG&&b.AMP_CONFIG.v?b.AMP_CONFIG.v:"011480695002348");c={localDev:!1,development:!("1"!=c.development&&!b.AMP_DEV_MODE),filter:c.filter,minified:!0,lite:void 0!=
d.amp_lite,test:!1,log:c.log,version:"1480695002348",rtvVersion:k}}b=b.AMP_MODE=c}var f=b.development&&this.g.configUrl?this.g.configUrl:"https://connector.laterpay.net";this.l=f+"/api/public/amp?article_url=CANONICAL_URL&amp_reader_id=READER_ID&return_url=RETURN_URL";var e=this.g.articleId;e&&(this.l+="&article_id="+e);this.u=u(this.c,"timer");this.w=u(this.c,"vsync");this.A=u(this.c,"xhr")}
D.prototype.authorize=function(){var a=this;n().assert(B(this.c),'Enable "amp-access-laterpay" experiment');return E(this).then(function(b){if(204===b.status)throw n().createError("No merchant domains have been matched for this article, or no paid content configurations are setup.");F(a);return{access:b.access}},function(b){var c=b.response.status;if(402===c)a.b=b.responseJson,G(a);else throw b;return{access:b.responseJson.access}})};
function E(a){var b=a.l+"&article_title="+a.a.querySelector(a.g.articleTitleSelector).textContent.trim(),c=a.f.B(b,!1);return c.then(function(b){return a.u.timeoutPromise(3E3,a.A.fetchJson(b,{credentials:"include",requireAmpResponseSourceOrigin:!0}))})}function F(a){for(var b;b=a.m.shift();)b();a.i&&a.i();a.w.mutate(function(){for(var b=a.a.querySelector("amp-access-laterpay-list");b.firstChild;)b.removeChild(b.firstChild)})}
function G(a){var b=a.a.querySelector("amp-access-laterpay-list"),c=a.a.createElement("ul");a.b.premiumcontent.title="Buy this article";a.b.premiumcontent.description="title of the article should go here";c.appendChild(H(a,a.b.premiumcontent));a.b.timepasses.forEach(function(b){c.appendChild(H(a,b))});var d=a.a.createElement("button");d.textContent="Confirm your selection";d.disabled=!0;a.j=d;a.i=C(d,"click",a.s.bind(a));b.appendChild(c);b.appendChild(d)}
function H(a,b){var c=a.a.createElement("li"),d=a.a.createElement("label");d.for=b.title;d.textContent=b.title;var f=a.a.createElement("input");f.name="purchaseOption";f.type="radio";f.id=b.title;f.value=b.purchase_url;a.m.push(C(f,"change",a.o.bind(a)));d.appendChild(f);c.appendChild(d);d=a.a.createElement("p");d.textContent=b.description;var e=a.a.createElement("p");a=b.price;var g=Object.keys(a)[0];e.textContent=a[g]+g;c.appendChild(d);c.appendChild(e);return c}
D.prototype.o=function(a){var b="amp-access-laterpay-selected",c=this.h;a.preventDefault();c&&c.classList.contains(b)&&c.classList.remove(b);this.h=a.target;this.h.classList.add(b);this.j.disabled&&(this.j.disabled=!1)};D.prototype.s=function(){var a=this.h.value;this.f.loginWithUrl(a)};(function(a){return y(a)})(AMP.win).then(function(a){a.registerVendor("laterpay",new D(a))});
})});
//# sourceMappingURL=amp-access-laterpay-0.1.js.map

