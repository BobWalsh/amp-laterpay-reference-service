(self.AMP = self.AMP || []).push({n:"amp-live-list", f:(function(AMP) {var g;function k(a,b){function c(){}c.prototype=b.prototype;a.prototype=new c;a.prototype.constructor=a;for(var d in b)if(Object.defineProperties){var e=Object.getOwnPropertyDescriptor(b,d);e&&Object.defineProperty(a,d,e)}else a[d]=b[d]};Date.now();self.log=self.log||{user:null,dev:null};var m=self.log;function p(){if(m.user)return m.user;throw Error("failed to call initLogConstructor");};function q(a,b){for(var c=a.firstElementChild;c;c=c.nextElementSibling)if(b(c))return c;return null}var r;function t(a,b){if(null==r)try{a.ownerDocument.querySelector(":scope"),r=!0}catch(c){r=!1}return r?a.querySelector(":scope > ["+b+"]"):q(a,function(a){return a.hasAttribute(b)})};function u(a,b){a=a.__AMP_TOP||a;var c=a.services&&a.services[b]&&a.services[b].obj;return c}function v(a){var b=a;if(b.nodeType)var c=(b.ownerDocument||b).defaultView,c=c.__AMP_TOP||c,b=w(c,c,"ampdoc").getAmpDoc(b);var d=b.isSingleDoc()?b.win:b;return d&&d.services&&d.services.viewer&&d.services.viewer.obj}function x(a){var b=y;a=a.__AMP_TOP||a;return w(a,a,"liveListManager",b)}
function w(a,b,c,d){var e=a,f=e.services;f||(f=e.services={});var h=f;(e=h[c])||(e=h[c]={obj:null,promise:null,resolve:null});e.obj||(e.obj=d?new d(b):(void 0)(b),e.resolve&&e.resolve(e.obj));return e.obj};function z(){var a=0;return function(){var b=Math.pow(2,a++),b=b+B(b);return 1E3*b}}function B(a,b){b=b||.3;var c=a*b*Math.random();.5<Math.random()&&(c*=-1);return c};function C(a){return"loading"!=a.readyState&&"uninitialized"!=a.readyState}function D(a,b){var c=C,d=c(a);if(d)b(a);else{var e=function(){c(a)&&(d||(d=!0,b(a)),a.removeEventListener("readystatechange",e))};a.addEventListener("readystatechange",e)}}function E(a){return new Promise(function(b){D(a,b)})};function F(a,b,c){this.win=a;this.M=b;this.H=c;this.u=null;this.j=!1;this.R=this.i=null}function G(a){return a.i?a.i():a.M+B(a.M,.2)}F.prototype.isRunning=function(){return this.j};F.prototype.start=function(a){this.j||(this.j=!0,H(this,a))};F.prototype.stop=function(){this.j&&(this.j=!1,this.u&&(u(this.win,"timer").cancel(this.u),this.u=null))};
function H(a,b){if(a.j){var c=function(){a.R=a.H().then(function(){a.i&&(a.i=null);H(a)}).catch(function(b){if(b.retriable)a.i||(a.i=z()),H(a);else throw b;})};b?c():a.u=u(a.win,"timer").delay(c,G(a))}};function y(a){var b=this;this.win=a;this.b=Object.create(null);this.G=v(this.win.document);this.C=15E3;this.I=[this.C];this.s=null;this.U=this.win.location.href;this.v=0;this.H=this.O.bind(this);E(this.win.document).then(function(){b.C=Math.min.apply(Math,b.I);var a=Object.keys(b.b).map(function(a){return b.b[a].getUpdateTime()});b.v=Math.max.apply(Math,a);b.s=new F(b.win,b.C,b.H);b.G.isVisible()&&I(b)&&b.s.start();J(b)})}
function I(a){return Object.keys(a.b).some(function(b){return a.b[b].isEnabled()})}y.prototype.O=function(){var a=this.U;if(0<this.v){var b=a,a=String(this.v),a=encodeURIComponent("amp_latest_update_time")+"="+encodeURIComponent(a);if(a)var b=b.split("#",2),c=b[0].split("?",2),a=c[0]+(c[1]?"?"+c[1]+"&"+a:"?"+a),a=a+(b[1]?"#"+b[1]:"");else a=b}return u(this.win,"xhr").fetchDocument(a).then(this.P.bind(this))};
y.prototype.P=function(a){var b=Array.prototype.slice.call(a.getElementsByTagName("amp-live-list")),c=b.map(this.T.bind(this)),d=Math.max.apply(Math,[0].concat(c));0<d&&(this.v=d);I(this)||this.s.stop()};y.prototype.T=function(a){var b=a.getAttribute("id");p().assert(b,"amp-live-list must have an id.");p().assert(b in this.b,"amp-live-list#"+b+" found but did not exist on original page load.");var c=this.b[b];c.toggle(!a.hasAttribute("disabled"));return c.isEnabled()?c.update(a):0};
y.prototype.register=function(a,b){var c=!(a in this.b);c&&(this.b[a]=b,this.I.push(b.getInterval()))};function J(a){a.G.onVisibilityChanged(function(){a.G.isVisible()?a.s.start(!0):a.s.stop()})};function K(a,b){return Math.max(parseInt(a,10)||0,b)}function L(a){AMP.BaseElement.call(this,a);this.A=this.o=this.F=this.J=this.m=null;this.w="";this.h=this.K=this.L=0;this.a=Object.create(null);this.l=[];this.f=[];this.g=[];this.B=null;this.c=0;this.N=this.S.bind(this)}k(L,AMP.BaseElement);g=L.prototype;g.isLayoutSupported=function(a){return"container"==a||"fixed-height"==a};
g.buildCallback=function(){this.m=this.getViewport();this.J=x(this.win);this.F=p().assert(t(this.element,"update"),'amp-live-list must have an "update" slot.');this.o=p().assert(t(this.element,"items"),'amp-live-list must have an "items" slot.');this.A=t(this.element,"pagination");this.w=p().assert(this.element.getAttribute("id"),"amp-live-list must have an id.");this.L=K(this.element.getAttribute("data-poll-interval"),15E3);var a=this.element.getAttribute("data-max-items-per-page");p().assert(0<
Number(a),"amp-live-list#"+this.w+" must have data-max-items-per-page attribute with numeric value. "+("Found "+a));var b=[].slice.call(this.o.children).filter(function(a){return!a.hasAttribute("data-tombstone")}).length;this.K=Math.max(K(a,1),b);this.J.register(this.w,this);M(this,!1);N(this.o,function(a){a.classList.add("amp-live-list-item")});this.c=O(this,this.o,!0);this.registerAction("update",this.D.bind(this))};g.isEnabled=function(){return!this.element.hasAttribute("disabled")};
g.toggle=function(a){a?this.element.removeAttribute("disabled"):this.element.setAttribute("disabled","")};g.activate=function(){this.D()};g.update=function(a){var b=this,c=t(a,"items");if(!c)return this.h;O(this,c);var d=P(this,c);Q(this,d.insert);R(this,d.replace);this.g.push.apply(this.g,d.tombstone);this.B=t(a,"pagination");0<this.l.length?this.deferMutate(function(){M(b,!0);b.m.updateFixedLayer()}):(0<this.f.length||0<this.g.length)&&this.D();return this.h};
g.D=function(){var a=this,b=0<this.l.length,c=0<this.g.length,d=this.mutateElement(function(){var d=p().assertElement(a.o);b&&(N(d,function(a){a.classList.remove("amp-live-list-item-new")}),a.c+=S(a,d,a.l),a.l.length=0);0<a.f.length&&(T(d,a.f),a.f.length=0);0<a.g.length&&(a.c-=U(d,a.g),a.g.length=0);(b||c)&&a.A&&a.B&&(a.element.replaceChild(a.B,a.A),a.A=t(a.element,"pagination"));M(a,!1);a.B=null;return V(a,d)});b&&(d=d.then(function(){return a.m.animateScrollIntoView(a.element)}));return d};
function M(a,b){a.F.classList.toggle("amp-hidden",!b);a.F.classList.toggle("amp-active",b)}function S(a,b,c){var d=0,e=a.win.document.createDocumentFragment();c.forEach(function(a){e.insertBefore(a,e.firstElementChild);d++});b.insertBefore(e,b.firstElementChild);return d}function T(a,b){var c=0;b.forEach(function(b){var d=b.getAttribute("id"),f=a.querySelector("#"+d);f&&(a.replaceChild(b,f),c++)})}
function U(a,b){var c=0;b.forEach(function(b){b=b.getAttribute("id");if(b=a.querySelector("#"+b))b.setAttribute("data-tombstone",""),b.textContent="",c++});return c}
function V(a,b){var c=a.c-a.K;if(1>c)return Promise.resolve();for(var d=[],e=[],f=b.lastElementChild;f&&!(d.length>=c);f=f.previousElementSibling)f.hasAttribute("data-tombstone")||d.push(f);return a.getVsync().runPromise({measure:function(){for(var b=0;b<d.length;b++){var c=d[b];if(!(a.m.getLayoutRect(c).top>a.m.getScrollTop()+a.m.getSize().height))break;e.push(c)}},mutate:function(){e.forEach(function(c){b.removeChild(c);a.c--})}})}
function Q(a,b){b.sort(a.N).forEach(function(a){a.classList.add("amp-live-list-item");a.classList.add("amp-live-list-item-new")});a.l.push.apply(a.l,b)}function R(a,b){b.forEach(function(b){var c;a:{c=a.f;for(var e=0;e<c.length;e++)if(c[e].getAttribute("id")==b.getAttribute("id")){c=e;break a}c=-1}var f=c;b.classList.add("amp-live-list-item");-1==f?a.f.push(b):a.f[f]=b})}g.getInterval=function(){return this.L};
function P(a,b){var c=[],d=[],e=[];for(b=b.firstElementChild;b;b=b.nextElementSibling){var f=b.getAttribute("id"),h=a,n=b,l=n.getAttribute("id");if(n.hasAttribute("data-tombstone")||l in h.a)if(h=a,l=b,!l.hasAttribute("data-update-time")||l.hasAttribute("data-tombstone")?h=!1:(n=l.getAttribute("id"),l=W(l),h=n in h.a&&-1!=h.a[n]&&l>h.a[n]),h){var A=W(b);a.a[f]=A;f=a.win.document.importNode(b,!0);A>a.h&&(a.h=A);d.push(f)}else b.hasAttribute("data-tombstone")&&-1!=a.a[f]&&(a.a[f]=-1,e.push(b));else f=
a.win.document.importNode(b,!0),c.push(f),X(a,b)}return{insert:c,replace:d,tombstone:e}}function X(a,b){var c=b.getAttribute("id");b=W(b);b>a.h&&(a.h=b);a.a[c]=b}g.V=function(a){delete this.a[a]};
function O(a,b,c){var d=0,e=!1;N(b,function(b){b.hasAttribute("id")&&0<Number(b.getAttribute("data-sort-time"))?c&&X(a,b):e=!0;d++});p().assert(!e,"All amp-live-list-items under amp-live-list#"+a.w+" children must have id and data-sort-time attributes. data-sort-time must be a Number greater than 0.");return d}function N(a,b){for(a=a.firstElementChild;a;a=a.nextElementSibling)b(a)}g.S=function(a,b){return Y(a,"data-sort-time")-Y(b,"data-sort-time")};
function W(a){return a.hasAttribute("data-update-time")?Y(a,"data-update-time"):Y(a,"data-sort-time")}function Y(a,b){var c=Number(a.getAttribute(b));p().assert(0<c,'"'+b+'" attribute must exist and value '+("must be a number greater than 0. Found "+c+" on ")+(a.getAttribute("id")+" instead."));return c}g.getUpdateTime=function(){return this.h};AMP.registerElement("amp-live-list",L,"amp-live-list>[update]{position:relative;z-index:1000!important}amp-live-list>.amp-active[update]{display:block}amp-live-list>[items]>[data-tombstone]{display:none}@-webkit-keyframes amp-live-list-item-highlight{0%{box-shadow:0 0 5px 2px #51cbee}to{box-shadow:0}}@keyframes amp-live-list-item-highlight{0%{box-shadow:0 0 5px 2px #51cbee}to{box-shadow:0}}\n/*# sourceURL=/extensions/amp-live-list/0.1/amp-live-list.css*/");
})});
//# sourceMappingURL=amp-live-list-0.1.js.map

