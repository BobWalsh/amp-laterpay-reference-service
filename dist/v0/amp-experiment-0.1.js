(self.AMP = self.AMP || []).push({n:"amp-experiment", f:(function(AMP) {function g(a,b){function c(){}c.prototype=b.prototype;a.prototype=new c;a.prototype.constructor=a;for(var d in b)if(Object.defineProperties){var e=Object.getOwnPropertyDescriptor(b,d);e&&Object.defineProperty(a,d,e)}else a[d]=b[d]};Date.now();self.log=self.log||{user:null,dev:null};var h=self.log;function k(){if(h.user)return h.user;throw Error("failed to call initLogConstructor");};var l=Object.prototype.toString;function m(a,b,c){if(b(a))c();else{var d=a.ownerDocument.defaultView;if(d.MutationObserver){var e=new d.MutationObserver(function(){b(a)&&(e.disconnect(),c())});e.observe(a,{childList:!0})}else var f=d.setInterval(function(){b(a)&&(d.clearInterval(f),c())},5)}}function n(a,b){m(a.documentElement,function(){return!!a.body},b)}function p(a){return new Promise(function(b){n(a,b)})};function q(a){var b=a,b=b.nodeType?r((b.ownerDocument||b).defaultView,"ampdoc").getAmpDoc(b):b,c=b.isSingleDoc()?b.win:b;return c&&c.services&&c.services.viewer&&c.services.viewer.obj}function r(a,b,c){var d=a=a.__AMP_TOP||a,e=c?c:void 0;a=t(a);var f=a[b];f||(f=a[b]={obj:null,promise:null,resolve:null});f.obj||(f.obj=e(d),f.resolve&&f.resolve(f.obj));return f.obj}function v(a,b){var c=w(a,b);if(c)return c;a=t(a);var d,e=new Promise(function(a){d=a});a[b]={obj:null,promise:e,resolve:d};return e}
function w(a,b){if(a=t(a)[b]){if(b=a.promise)return b;if(a.obj)return a.promise=Promise.resolve(a.obj)}return null}function t(a){var b=a.services;b||(b=a.services={});return b};function x(a,b,c){return y(a,b,c).then(function(a){return k().assert(a,"Service %s was requested to be provided through %s, but %s is not loaded in the current page. To fix this problem load the JavaScript file for %s in this page.",b,c,c,c)})}function y(a,b,c){var d=w(a,b);return d?d:Promise.resolve().then(function(){return a.ampExtendedElements&&a.ampExtendedElements[c]?v(a,b):p(a.document).then(function(){return a.ampExtendedElements&&a.ampExtendedElements[c]?v(a,b):null})})};var z=/^[\w-]+$/;
function A(a,b,c){B(b);C(c);var d=q(a),e=d.getParam("amp-x-"+b);if(e&&c.variants.hasOwnProperty(e))return Promise.resolve(e);var f=!1!==c.sticky,E=c.cidScope||"amp-experiment",u=Promise.resolve(!0);f&&c.consentNotificationId&&(u=x(a.win,"userNotificationManager","amp-user-notification").then(function(a){return a.getNotification(c.consentNotificationId)}).then(function(a){k().assert(a,"Notification not found: "+c.consentNotificationId);return a.isDismissed()}));return u.then(function(e){if(!e)return null;var d=
c.group||b;return D(a,d,f?E:null).then(function(a){for(var b=0,e=Object.keys(c.variants).sort(),d=0;d<e.length;d++)if(b+=c.variants[e[d]],a<b)return e[d];return null})})}
function C(a){var b=a.variants;k().assert("[object Object]"===l.call(b)&&0<Object.keys(b).length,"Missing experiment variants config.");a.group&&B(a.group);var c=0,d;for(d in b)if(b.hasOwnProperty(d)){B(d);var e=b[d];k().assert("number"===typeof e&&0<e&&100>e,"Invalid percentage %s:%s. Has to be greater than 0 and less than 100",d,e);c+=e}k().assert(100>=c.toFixed(6),"Total percentage is bigger than 100: "+c)}
function D(a,b,c){if(!c)return Promise.resolve(100*a.win.Math.random());var d=x(a.win,"cid","amp-analytics").then(function(a){return a.get({scope:c,createCookieIfNotPresent:!0},Promise.resolve())});return Promise.all([d,x(a.win,"crypto","amp-analytics")]).then(function(a){return a[1].uniform(b+":"+a[0])}).then(function(a){return 100*a})}function B(a){k().assert(z.test(a),"Invalid name "+a+": %s. Allowed chars are [a-zA-Z0-9-_].")};function F(a){AMP.BaseElement.apply(this,arguments)}g(F,AMP.BaseElement);F.prototype.isLayoutSupported=function(a){return"nodisplay"==a||"container"==a};F.prototype.buildCallback=function(){var a=this,b=G(this),c=Object.create(null),d=Object.keys(b).map(function(d){return A(a.getAmpDoc(),d,b[d]).then(function(a){c[d]=a})});this.b=Promise.all(d).then(function(){return c}).then(this.a.bind(this));r(this.win,"variant",function(){return a.b})};
function G(a){a=a.element.children;k().assert(1==a.length&&"SCRIPT"==a[0].tagName&&"APPLICATION/JSON"==a[0].getAttribute("type").toUpperCase(),'<amp-experiment> should contain exactly one <script type="application/json"> child.');return JSON.parse(a[0].textContent)}F.prototype.a=function(a){var b=this.win.document;return p(b).then(function(){for(var c in a)a[c]&&b.body.setAttribute("amp-x-"+c,a[c]);return a})};AMP.registerElement("amp-experiment",F);
})});
//# sourceMappingURL=amp-experiment-0.1.js.map

