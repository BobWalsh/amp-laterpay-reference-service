{"version":3,"sources":["node_modules/browser-pack/_prelude.js","src/config.js","src/service-worker/core.js","third_party/babel/custom-babel-helpers.js"],"names":[],"mappings":"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","file":"cache-service-worker-0.1.max.js","sourceRoot":"/source/","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","/**\n * Copyright 2016 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * Allows for runtime configuration. Internally, the runtime should\n * use the src/config.js module for various constants. We can use the\n * AMP_CONFIG global to translate user-defined configurations to this\n * module.\n * @type {!Object<string, string>}\n */\nconst env = self.AMP_CONFIG || {};\n\nconst thirdPartyFrameRegex = typeof env['thirdPartyFrameRegex'] == 'string' ?\n    new RegExp(env['thirdPartyFrameRegex']) : env['thirdPartyFrameRegex'];\n\n/** @type {!Object<string, string|boolean|RegExp>} */\nexport const urls = {\n  thirdParty: env['thirdPartyUrl'] || 'https://3p.ampproject.net',\n  thirdPartyFrameHost: env['thirdPartyFrameHost'] || 'ampproject.net',\n  thirdPartyFrameRegex: thirdPartyFrameRegex || /^d-\\d+\\.ampproject\\.net$/,\n  cdn: env['cdnUrl'] || 'https://cdn.ampproject.org',\n  cdnProxyRegex: /^https:\\/\\/([a-zA-Z0-9_-]+\\.)?cdn\\.ampproject\\.org/,\n  localhostRegex: /^https?:\\/\\/localhost(:\\d+)?$/,\n  errorReporting: env['errorReportingUrl'] ||\n      'https://amp-error-reporting.appspot.com/r',\n  localDev: env['localDev'] || false,\n};\n","/**\n * Copyright 2016 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport '../../third_party/babel/custom-babel-helpers';\nimport {urls} from '../config';\n\n/**\n * An AMP Release version, not to be confused with an RTV version\n * @typedef {string}\n */\nexport let AmpVersion;\n\n/**\n * An RTV version, not to be confused with an AMP Release version.\n * @typedef {string}\n */\nexport let RtvVersion;\n\n/** @const */\nconst TAG = 'cache-service-worker';\n\n/**\n * A list of blacklisted AMP versions that must never be served from\n * cache. Versions may be blacklisted if they contain a significant\n * implementation bug.\n * @type {!Array<AmpVersion>}\n */\nconst BLACKLIST = self.AMP_CONFIG[`${TAG}-blacklist`] || [];\n\n/**\n * The SW's current version.\n * @const\n * @type {RtvVersion}\n */\nconst BASE_RTV_VERSION = self.AMP_CONFIG.v;\n\n/**\n * A regex that matches every CDN JS URL we care to cache.\n * The \"experiments\" JS is explicitly disallowed.\n *\n * The RTV will be the first capture group, if it is present.\n * The pathname will be the second capture group.\n *\n * Matched URLS include:\n *  - https://cdn.ampproject.org/v0.js\n *  - https://cdn.ampproject.org/v0/amp-comp.js\n *  - https://cdn.ampproject.org/rtv/123456789012345/v0.js\n *  - https://cdn.ampproject.org/rtv/123456789012345/v0/amp-comp.js\n *\n * Unmatched URLS include:\n *  - https://cdn.ampproject.org/v0/experiments.js\n */\nconst CDN_JS_REGEX = new RegExp(\n    // Require the CDN URL origin at the beginning.\n    `^${urls.cdn.replace(/\\./g, '\\\\.')}` +\n    // Allow, but don't require, RTV.\n    `(?:/rtv/(\\\\d{2}\\\\d{13,}))?` +\n    // Require text \"/v0\"\n    `(/v0` +\n      // Allow, but don't require, an extension under the v0 directory.\n      // We explicitly forbid the `experiments` \"extension\".\n      `(?:/(?!experiments).+)?` +\n    // Require text \".js\" at the end.\n    `\\\\.js)$`);\n\n/**\n * Returns the version of a given versioned JS file.\n *\n * @param {string} url\n * @return {RtvVersion}\n * @visibleForTesting\n */\nexport function rtvVersion(url) {\n  // RTVs are 2 digit prefixes followed by the timestamp of the release.\n  const match = CDN_JS_REGEX.exec(url);\n  return (match && match[1]) || '';\n}\n\n/**\n * Returns the pathname of a url, used to key a url (since\n * our JS filenames are unique).\n *\n * @param {string} url\n * @return {string}\n */\nfunction pathname(url) {\n  const match = CDN_JS_REGEX.exec(url);\n  return match ? match[2] : '';\n}\n\n/**\n * Returns the url with the requested version changed to `version`.\n *\n * @param {string} url\n * @param {RtvVersion} version\n * @return {string}\n * @visibleForTesting\n */\nexport function urlWithVersion(url, version) {\n  const currentVersion = rtvVersion(url);\n  if (currentVersion) {\n    return url.replace(currentVersion, version);\n  }\n  const location = new URL(url);\n  location.pathname = `/rtv/${version}${location.pathname}`;\n  return location.href;\n}\n\n/**\n * Normalizes the request to a new RTV version. This handles changing the\n * request from one version to another, or rewriting an unversioned request to\n * a versioned.\n *\n * @param {!Request} request\n * @param {RtvVersion} version\n * @return {!Request}\n */\nfunction normalizedRequest(request, version) {\n  const url = request.url;\n  if (rtvVersion(url) === version) {\n    return request;\n  }\n\n  return new Request(urlWithVersion(url, version), request);\n}\n\n/**\n * Determines if a url is a request to a CDN JS file.\n * @param {string} url\n * @return {boolean}\n * @visibleForTesting\n */\nexport function isCdnJsFile(url) {\n  return CDN_JS_REGEX.test(url);\n}\n\n/**\n * Determines if a AMP version is blacklisted.\n * @param {RtvVersion} version\n * @return {boolean}\n * @visibleForTesting\n */\nexport function isBlacklisted(version) {\n  /**\n   * Trim the RTV perfix.\n   * @type {AmpVersion}\n   */\n  const ampVersion = version.substr(2);\n  return BLACKLIST.indexOf(ampVersion) > -1;\n}\n\n/**\n * A mapping from a Client's (unique per tab _and_ refresh) ID to the AMP\n * release version we are serving it.\n *\n * @type {!Object<string, RtvVersion>}\n */\nconst clientsMap = Object.create(null);\n\n/**\n * Our cache of CDN JS files.\n *\n * @type {!Cache}\n */\nlet cache;\n\n/**\n * A promise to open up our CDN JS cache, which will be resolved before any\n * requests are intercepted by the SW.\n *\n * @type {!Promise}\n */\nconst cachePromise = self.caches.open('cdn-js').then(result => {\n  cache = result;\n});\n\n/**\n * Fetches the request, and stores it in the cache. Since we only store one\n * version of each file, we'll prune all older versions after we cache this.\n *\n * @param {!Cache} cache\n * @param {!Request} request\n * @param {string} requestPath the pathname of the request\n * @param {RtvVersion} requestVersion the version of the request\n * @return {!Promise<!Response>}\n * @visibleForTesting\n */\nexport function fetchAndCache(cache, request, requestPath, requestVersion) {\n  // TODO(jridgewell): we should also fetch this requestVersion for all files\n  // we know about.\n  return fetch(request).then(response => {\n    // Did we receive a valid response (200 <= status < 300)?\n    if (response && response.ok) {\n      // You must clone to prevent double reading the body.\n      cache.put(request, response.clone());\n\n      // Prune old versions of this file from the cache.\n      // This intentionally does not block the request resolution to speed\n      // things up. This is likely fine since you don't have multiple\n      // `<script>`s with the same `src` on a page.\n      cache.keys().then(requests => {\n        for (let i = 0; i < requests.length; i++) {\n          const request = requests[i];\n          const url = request.url;\n          if (requestPath !== pathname(url)) {\n            continue;\n          }\n          if (requestVersion === rtvVersion(url)) {\n            continue;\n          }\n\n          cache.delete(request);\n        }\n      });\n    }\n\n    return response;\n  });\n}\n\n\n/**\n * Gets the version we have cached for this file. It's either:\n *  - The requestVersion, meaning we have this explicit version cached.\n *  - Some older version\n *  - An empty string, meaning we have nothing cached for this file.\n *\n * @param {!Cache} cache\n * @param {string} requestPath\n * @return {!Promise<RtvVersion>}\n * @visibleForTesting\n */\nexport function getCachedVersion(cache, requestPath) {\n  // TODO(jridgewell): We should make this a bit smarter, so that it selects\n  // the version that has a lot of matches, not just this request file.\n  return cache.keys().then(requests => {\n    for (let i = 0; i < requests.length; i++) {\n      const url = requests[i].url;\n      if (requestPath === pathname(url)) {\n        return rtvVersion(url);\n      }\n    }\n\n    return '';\n  });\n}\n\n/**\n * Handles fetching the request from Cache, or fetching and caching from the\n * Cache CDN, if we care about the request.\n * My assumptions:\n *   - Doc requests one uniform AMP release version for all files, anything\n *     else is malarkey.\n *   - The requested version is always the newest AMP version.\n *\n * @param {!Request} request\n * @param {string|undefined} maybeClientId\n * @return {?Promise<!Response>}\n * @visibleForTesting\n */\nexport function handleFetch(request, maybeClientId) {\n  const url = request.url;\n\n  // We only cache CDN JS files, and we need a clientId to do our magic.\n  if (!maybeClientId || !isCdnJsFile(url)) {\n    return null;\n  }\n\n  // Closure Compiler!\n  const clientId = /** @type {string} */(maybeClientId);\n\n  const requestPath = pathname(url);\n  const requestVersion = rtvVersion(url) || BASE_RTV_VERSION;\n  // Rewrite unversioned requests to the versioned RTV URL. This is a noop if\n  // it's already versioned.\n  request = normalizedRequest(request, requestVersion);\n\n  // Wait for the cachePromise to resolve. This is necessary\n  // since the SW thread may be killed and restarted at any time.\n  return cachePromise.then(() => {\n    // If we already registered this client, we must always use the same\n    // version.\n    if (clientsMap[clientId]) {\n      return clientsMap[clientId];\n    }\n\n    // If not, do we have this version cached?\n    return getCachedVersion(cache, requestPath).then(version => {\n      // We have a cached version! Serve it up!\n      if (version && !isBlacklisted(version)) {\n        return version;\n      }\n\n      // Tears! We have nothing cached, so we'll have to make a request.\n      return requestVersion;\n    }).then(version => {\n      // Determining the version to serve is racey, since there are parallel\n      // requests coming in for all the CDN JS files. If one of them \"won\"\n      // the race, respect the winner.\n      if (clientsMap[clientId]) {\n        return clientsMap[clientId];\n      }\n\n      clientsMap[clientId] = version;\n      return version;\n    });\n  }).then(version => {\n    const versionedRequest = normalizedRequest(request, version);\n\n    return cache.match(versionedRequest).then(response => {\n      // Cache hit!\n      if (response) {\n        // Now, was it because we served an old cached version or because\n        // they requested this exact version; If we served an old version,\n        // let's get the new one.\n        if (version !== requestVersion && requestVersion == BASE_RTV_VERSION) {\n          fetchAndCache(cache, request, requestPath, requestVersion);\n        }\n\n        return response;\n      }\n\n      // If not, let's fetch and cache the request.\n      return fetchAndCache(cache, versionedRequest, requestPath, version);\n    });\n  });\n}\n\nself.addEventListener('install', install => {\n  install.waitUntil(cachePromise);\n  // Registers the SW for Foreign Fetch events, if they are supported.\n  if (install.registerForeignFetch) {\n    install.registerForeignFetch({\n      scopes: [/** @type {!ServiceWorkerGlobalScope} */(\n          self).registration.scope],\n      origins: ['*'],\n    });\n  }\n});\n\n// Setup the Fetch listener, for when the client is on the CDN origin.\nself.addEventListener('fetch', event => {\n  const response = handleFetch(event.request, event.clientId);\n\n  // We only get a response promise back if it's a request we care to cache.\n  if (!response) {\n    return;\n  }\n\n  event.respondWith(response);\n});\n\n// Setup the Foreign Fetch listener, for when the client is on a Publisher\n// origin.\nself.addEventListener('foreignfetch', event => {\n  const response = handleFetch(event.request, event.clientId);\n\n  // We only get a response promise back if it's a request we care to cache.\n  if (!response) {\n    return;\n  }\n\n  event.respondWith(response.then(resp => {\n    // Foreign Fetch requires a { response: !Response } object.\n    return {\n      response: resp,\n      // This allows CORS requests, if one were to come in.\n      origin: event.origin,\n    };\n  }));\n});\n","(function (global) {\n  var babelHelpers = global.babelHelpers = {};\n\n  babelHelpers.inherits = function (subClass, superClass) {\n    if (typeof superClass !== \"function\" && superClass !== null) {\n      throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass);\n    }\n\n    subClass.prototype = Object.create(superClass && superClass.prototype, {\n      constructor: {\n        value: subClass,\n        enumerable: false,\n        writable: true,\n        configurable: true\n      }\n    });\n    if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;\n  };\n\n  babelHelpers.createClass = (function () {\n    function defineProperties(target, props) {\n      for (var i = 0; i < props.length; i++) {\n        var descriptor = props[i];\n        descriptor.enumerable = descriptor.enumerable || false;\n        descriptor.configurable = true;\n        if (\"value\" in descriptor) descriptor.writable = true;\n        Object.defineProperty(target, descriptor.key, descriptor);\n      }\n    }\n\n    return function (Constructor, protoProps, staticProps) {\n      if (protoProps) defineProperties(Constructor.prototype, protoProps);\n      if (staticProps) defineProperties(Constructor, staticProps);\n      return Constructor;\n    };\n  })();\n\n  babelHelpers.slice = Array.prototype.slice;\n  babelHelpers.bind = Function.prototype.bind;\n\n  babelHelpers.interopRequireWildcard = function (obj) {\n    if (obj && obj.__esModule) {\n      return obj;\n    } else {\n      var newObj = {};\n\n      if (obj != null) {\n        for (var key in obj) {\n          if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key];\n        }\n      }\n\n      newObj[\"default\"] = obj;\n      return newObj;\n    }\n  };\n\n  babelHelpers.interopRequireDefault = function (obj) {\n    return obj && obj.__esModule ? obj : { default: obj };\n  };\n\n  babelHelpers.get = function get(object, property, receiver) {\n    if (object === null) object = Function.prototype;\n    var desc = Object.getOwnPropertyDescriptor(object, property);\n\n    if (desc === undefined) {\n      var parent = Object.getPrototypeOf(object);\n\n      if (parent === null) {\n        return undefined;\n      } else {\n        return get(parent, property, receiver);\n      }\n    } else if (\"value\" in desc) {\n      return desc.value;\n    } else {\n      var getter = desc.get;\n\n      if (getter === undefined) {\n        return undefined;\n      }\n\n      return getter.call(receiver);\n    }\n  };\n\n  babelHelpers.classCallCheck = function (instance, Constructor) {\n    if (!(instance instanceof Constructor)) {\n      throw new TypeError(\"Cannot call a class as a function\");\n    }\n  };\n\n  babelHelpers.defineProperty = function(obj, key, value) {\n      obj[key] = value;\n  };\n})(typeof global === \"undefined\" ? self : global);\n"]}