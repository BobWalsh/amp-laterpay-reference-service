(self.AMP = self.AMP || []).push({n:"amp-share-tracking", f:(function(AMP) {function h(a,b){function c(){}c.prototype=b.prototype;a.prototype=new c;a.prototype.constructor=a;for(var e in b)if(Object.defineProperties){var d=Object.getOwnPropertyDescriptor(b,e);d&&Object.defineProperty(a,e,d)}else a[e]=b[e]};Date.now();self.log=self.log||{user:null,dev:null};var k=self.log;function l(){if(k.user)return k.user;throw Error("failed to call initLogConstructor");};function p(a){a=a.__AMP_TOP||a;var b=a.services&&a.services.xhr&&a.services.xhr.obj;return b}function q(a){var b=a,b=b.nodeType?r((b.ownerDocument||b).defaultView,"ampdoc").getAmpDoc(b):b,c=b.isSingleDoc()?b.win:b;return c&&c.services&&c.services.viewer&&c.services.viewer.obj}function r(a,b,c){a=a.__AMP_TOP||a;var e=a.services;e||(e=a.services={});var d=e[b];d||(d=e[b]={obj:null,promise:null,resolve:null});d.obj||(d.obj=(c?c:void 0)(a),d.resolve&&d.resolve(d.obj));return d.obj};var t={"+":"-","/":"_","=":"."};function u(a){a=String.fromCharCode.apply(String,a);return btoa(a).replace(/[+/=]/g,function(a){return t[a]})};var v;
function w(a){var b="amp-share-tracking",c=v||(v=Object.create(null)),e;if(b in c)e=c[b];else{e=b;var d=b,f;if(a._experimentCookie)f=a._experimentCookie;else{c:{d:{try{f=a.document.cookie;break d}catch(C){}f=void 0}if(f){f=f.split(";");for(var g=0;g<f.length;g++){var m=f[g].trim(),n=m.indexOf("=");if(-1!=n&&"AMP_EXP"==decodeURIComponent(m.substring(0,n).trim())){f=decodeURIComponent(m.substring(n+1).trim());break c}}}f=null}f=a._experimentCookie=f?f.split(/\s*,\s*/g):[]}a=-1!=f.indexOf(d)?!0:a.AMP_CONFIG&&
a.AMP_CONFIG.hasOwnProperty(d)?Math.random()<a.AMP_CONFIG[d]:!1;e=c[e]=a}return e};function x(a){AMP.BaseElement.call(this,a);this.b="";this.c=null;this.a=""}h(x,AMP.BaseElement);x.prototype.isLayoutSupported=function(a){return"nodisplay"==a||"container"==a};
x.prototype.buildCallback=function(){var a=this;w(this.win)||(r(this.win,"share-tracking",function(){return Promise.reject(l().createError("amp-share-tracking disabled"))}),l().assert(!1,"amp-share-tracking experiment is disabled"));this.b=this.element.getAttribute("data-href");this.c=Promise.all([y(this),this.b?z(this,this.b):Promise.resolve(u(A(this)))]).then(function(b){var c=b[0],e=b[1];if(e){var d=c,d=d?a.a.substr(d.length+1):a.a,f="."+e;d&&("&"!=d[0]&&(f+="&"),f+=d);var g=f;q(a.getAmpDoc()).updateFragment("#"+
g)}return{incomingFragment:c,outgoingFragment:e}});r(this.win,"share-tracking",function(){return a.c})};function y(a){return B(a).then(function(a){var b=a.match(/^\.([^&]*)/);return b?b[1]:""})}function B(a){return q(a.getAmpDoc()).getFragment().then(function(b){return a.a=b})}
function z(a,b){var c={method:"POST",credentials:"include",requireAmpResponseSourceOrigin:!0,body:{}};return p(a.win).fetchJson(b,c).then(function(a){if(a.fragment)return a.fragment;l().error("amp-share-tracking","The response from ["+b+"] does not have a fragment value.");return""},function(a){l().error("amp-share-tracking","The request to share-tracking endpoint failed:"+a);return""})}
function A(a){a=a.win;if(a.crypto&&a.crypto.getRandomValues){var b=new Uint8Array(6);a.crypto.getRandomValues(b);a=b}else a=null;if(!a){a=new Uint8Array(6);for(var c=Math.random(),b=0;6>b;b++)c*=256,a[b]=Math.floor(c),c-=a[b]}return a}AMP.registerElement("amp-share-tracking",x);
})});
//# sourceMappingURL=amp-share-tracking-0.1.js.map

