(self.AMP = self.AMP || []).push({n:"amp-lightbox", f:(function(AMP) {var f;function h(a,b){function c(){}c.prototype=b.prototype;a.prototype=new c;a.prototype.constructor=a;for(var d in b)if(Object.defineProperties){var e=Object.getOwnPropertyDescriptor(b,d);e&&Object.defineProperty(a,d,e)}else a[d]=b[d]};Date.now();self.log=self.log||{user:null,dev:null};function l(a,b){a=a.__AMP_TOP||a;var c=a.services&&a.services[b]&&a.services[b].obj;return c}function m(a){var b=a;if(b.nodeType){var c=(b.ownerDocument||b).defaultView,d=c=c.__AMP_TOP||c,e=c.services;e||(e=c.services={});c=e;(e=c.ampdoc)||(e=c.ampdoc={obj:null,promise:null,resolve:null});e.obj||(e.obj=(void 0)(d),e.resolve&&e.resolve(e.obj));b=e.obj.getAmpDoc(b)}var g=b.isSingleDoc()?b.win:b;return g&&g.services&&g.services.history&&g.services.history.obj};function n(){this.i=[]}f=n.prototype;f.add=function(a){var b=this;this.i.push(a);return function(){b.remove(a)}};f.remove=function(a){a=this.i.indexOf(a);-1<a&&this.i.splice(a,1)};f.removeAll=function(){this.i.length=0};f.fire=function(a){for(var b=this.i,c=0;c<b.length;c++)(0,b[c])(a)};f.getHandlerCount=function(){return this.i.length};var p,q="Webkit webkit Moz moz ms O o".split(" ");function r(a,b,c){var d,e=a.style;p||(p=Object.create(null));var g=p[b];if(!g){g=b;if(void 0===e[b]){var k=b.charAt(0).toUpperCase()+b.slice(1);a:{for(var t=0;t<q.length;t++){var B=q[t]+k;if(void 0!==e[B]){k=B;break a}}k=""}void 0!==e[k]&&(g=k)}p[b]=g}(b=g)&&(a.style[b]=d?c+d:c)}function u(a,b){for(var c in b)r(a,c,b[c])};function v(a,b,c){var d=this;this.Z=l(a,"timer");this.ca=b;this.ba=c||0;this.s=-1;this.K=0;this.R=!1;this.$=function(){return d.G()}}v.prototype.isPending=function(){return-1!=this.s};v.prototype.schedule=function(a){var b=a||this.ba;this.R&&10>b&&(b=10);var c=Date.now()+b;return!this.isPending()||-10>c-this.K?(this.cancel(),this.K=c,this.s=this.Z.delay(this.$,b),!0):!1};v.prototype.G=function(){this.s=-1;this.K=0;this.R=!0;this.ca();this.R=!1};
v.prototype.cancel=function(){this.isPending()&&(this.Z.cancel(this.s),this.s=-1)};function w(a,b,c,d){this.type=a;this.data=b;this.time=c;this.event=d}
function x(a,b){this.g=a;this.b=[];this.w=[];this.f=[];this.a=[];this.c=null;this.ha=b;this.I=!1;this.G=new v(a.ownerDocument.defaultView,this.W.bind(this));this.X=new n;this.L=Object.create(null);this.V=this.ga.bind(this);this.T=this.ea.bind(this);this.U=this.fa.bind(this);this.S=this.da.bind(this);this.g.addEventListener("touchstart",this.V);this.g.addEventListener("touchend",this.T);this.g.addEventListener("touchmove",this.U);this.g.addEventListener("touchcancel",this.S);this.M=!1}
function y(a){var b=a.__AMP_Gestures;b||(b=new x(a,!1),a.__AMP_Gestures=b);return b}f=x.prototype;f.cleanup=function(){this.g.removeEventListener("touchstart",this.V);this.g.removeEventListener("touchend",this.T);this.g.removeEventListener("touchmove",this.U);this.g.removeEventListener("touchcancel",this.S);delete this.g.__AMP_Gestures;this.G.cancel()};f.onGesture=function(a,b){var c=new a(this),d=c.getType(),e=this.L[d];e||(this.b.push(c),e=new n,this.L[d]=e);return e.add(b)};f.onPointerDown=function(a){return this.X.add(a)};
f.ga=function(a){var b=Date.now();this.I=!1;this.X.fire(a);for(var c=0;c<this.b.length;c++)if(!this.f[c]&&(this.a[c]&&this.a[c]<b&&z(this,c),this.b[c].onTouchStart(a))){var d=c;this.w[d]=!0;this.a[d]=0}A(this,a)};f.fa=function(a){for(var b=Date.now(),c=0;c<this.b.length;c++)this.w[c]&&(this.a[c]&&this.a[c]<b?z(this,c):this.b[c].onTouchMove(a)||z(this,c));A(this,a)};
f.ea=function(a){for(var b=Date.now(),c=0;c<this.b.length;c++)this.w[c]&&(this.a[c]&&this.a[c]<b?z(this,c):(this.b[c].onTouchEnd(a),(!this.a[c]||this.a[c]<b)&&z(this,c)));A(this,a)};f.da=function(a){for(var b=0;b<this.b.length;b++){var c=b;this.f[c]=0;z(this,c)}A(this,a)};function A(a,b){var c=!!a.c||a.I;a.I=!1;if(!c)for(var d=Date.now(),e=0;e<a.b.length;e++)if(a.f[e]||a.a[e]&&a.a[e]>=d){c=!0;break}c&&(b.stopPropagation(),a.ha||b.preventDefault());a.M&&(a.M=!1,a.W())}
f.W=function(){for(var a=Date.now(),b=-1,c=0;c<this.b.length;c++)if(!this.f[c])this.a[c]&&this.a[c]<a&&z(this,c);else if(-1==b||this.f[c]>this.f[b])b=c;if(-1!=b){for(var d=0,c=0;c<this.b.length;c++)!this.f[c]&&this.w[c]&&(d=Math.max(d,this.a[c]-a));if(2>d){for(var a=b,c=this.b[a],e=0;e<this.b.length;e++)if(e!=a){var g=e;this.f[g]=0;z(this,g)}this.f[a]=0;this.a[a]=0;this.c=c;c.acceptStart()}else this.G.schedule(d)}};function z(a,b){a.w[b]=!1;a.a[b]=0;a.f[b]||a.b[b].acceptCancel()}
function C(a,b){this.ia=a;this.F=b}f=C.prototype;f.getType=function(){return this.ia};f.signalReady=function(a){var b=this.F;if(b.c)this.acceptCancel();else{for(var c=Date.now(),d=0;d<b.b.length;d++)b.b[d]==this&&(b.f[d]=c+a,b.a[d]=0);b.M=!0}};f.signalPending=function(a){var b=this.F;if(b.c)this.acceptCancel();else for(var c=Date.now(),d=0;d<b.b.length;d++)b.b[d]==this&&(b.a[d]=c+a)};f.signalEnd=function(){var a=this.F;a.c==this&&(a.c=null,a.I=!0)};
f.signalEmit=function(a,b){var c=this.F.L[this.getType()];c&&c.fire(new w(this.getType(),a,Date.now(),b))};f.acceptStart=function(){};f.acceptCancel=function(){};f.onTouchStart=function(){return!1};f.onTouchMove=function(){return!1};f.onTouchEnd=function(){};function D(a,b,c){1>b&&(b=1);var d=a/b,e=.5+Math.min(b/33.34,.5);return d*e+c*(1-e)};function E(a,b,c,d){C.call(this,a,b);this.C=c;this.H=d;this.c=!1;this.l=this.j=this.N=this.D=this.Y=this.P=this.O=this.o=this.m=this.v=this.u=0}h(E,C);f=E.prototype;f.onTouchStart=function(a){a=a.touches;if(!a||1!=a.length)return!1;this.Y=Date.now();this.u=a[0].clientX;this.v=a[0].clientY;return!0};
f.onTouchMove=function(a){var b=a.changedTouches||a.touches;if(b&&1==b.length){var c=b[0].clientX,b=b[0].clientY;this.m=c;this.o=b;if(this.c)F(this,!1,!1,a);else if(a=Math.abs(c-this.u),c=Math.abs(b-this.v),this.C&&this.H)(8<=a||8<=c)&&this.signalReady(-10);else if(this.C)if(8<=a&&a>c)this.signalReady(-10);else{if(8<=c)return!1}else if(this.H)if(8<=c&&c>a)this.signalReady(-10);else{if(8<=a)return!1}else return!1}return!0};f.onTouchEnd=function(a){this.c&&(this.c=!1,F(this,!1,!0,a),this.signalEnd())};
f.acceptStart=function(){this.c=!0;this.O=this.u;this.P=this.v;this.N=this.Y;this.u=this.m;this.v=this.o;F(this,!0,!1,null)};f.acceptCancel=function(){this.c=!1};function F(a,b,c,d){a.D=Date.now();var e=a.D-a.N;if(!c&&4<e||c&&16<e)a.j=D(a.m-a.O,e,a.j),a.l=D(a.o-a.P,e,a.l),a.j=1E-4<Math.abs(a.j)?a.j:0,a.l=1E-4<Math.abs(a.l)?a.l:0,a.O=a.m,a.P=a.o,a.N=a.D;a.signalEmit({first:b,last:c,time:a.D,deltaX:a.C?a.m-a.u:0,deltaY:a.H?a.o-a.v:0,velocityX:a.C?a.j:0,velocityY:a.H?a.l:0},d)}
function G(a){E.call(this,"swipe-xy",a,!0,!0)}h(G,E);function H(a){AMP.BaseElement.call(this,a);this.h=null;this.J=-1;this.A=!1;this.B=null}h(H,AMP.BaseElement);f=H.prototype;f.isLayoutSupported=function(a){return"nodisplay"==a};
function I(a){if(!a.h){u(a.element,{position:"fixed",zIndex:1E3,top:0,left:0,bottom:0,right:0});var b=a.getRealChildren();a.h=a.element.ownerDocument.createElement("div");a.applyFillContent(a.h);a.element.appendChild(a.h);b.forEach(function(b){a.h.appendChild(b)});a.registerAction("open",a.activate.bind(a));a.registerAction("close",a.close.bind(a));var c=y(a.element);c.onGesture(G,function(){})}}f.layoutCallback=function(){return Promise.resolve()};
f.activate=function(){var a=this;this.A||(I(this),this.B=this.aa.bind(this),this.win.document.documentElement.addEventListener("keydown",this.B),this.getViewport().enterLightboxMode(),this.mutateElement(function(){u(a.element,{display:"",opacity:0,transition:"opacity 0.1s ease-in"});l(a.win,"vsync").mutate(function(){r(a.element,"opacity","")})}).then(function(){var b=a.h;a.updateInViewport(b,!0);a.scheduleLayout(b);a.scheduleResume(b)}),m(this.getAmpDoc()).push(this.close.bind(this)).then(function(b){a.J=
b}),this.A=!0)};f.aa=function(a){27==a.keyCode&&this.close()};f.close=function(){this.A&&(this.getViewport().leaveLightboxMode(),this.collapse(),-1!=this.J&&m(this.getAmpDoc()).pop(this.J),this.win.document.documentElement.removeEventListener("keydown",this.B),this.B=null,this.schedulePause(this.h),this.A=!1)};AMP.registerElement("amp-lightbox",H);
})});
//# sourceMappingURL=amp-lightbox-0.1.js.map

