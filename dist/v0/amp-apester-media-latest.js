(self.AMP = self.AMP || []).push({n:"amp-apester-media", f:(function(AMP) {var f;function h(a,b){function c(){}c.prototype=b.prototype;a.prototype=new c;a.prototype.constructor=a;for(var e in b)if(Object.defineProperties){var g=Object.getOwnPropertyDescriptor(b,e);g&&Object.defineProperty(a,e,g)}else a[e]=b[e]};Date.now();self.log=self.log||{user:null,dev:null};var n=self.log;function p(){if(n.user)return n.user;throw Error("failed to call initLogConstructor");};function q(a,b){a=a.__AMP_TOP||a;var c=a.services&&a.services[b]&&a.services[b].obj;return c};var r;
function t(a){var b="amp-apester-media",c=r||(r=Object.create(null)),e;if(b in c)e=c[b];else{e=b;var g=b,d;if(a._experimentCookie)d=a._experimentCookie;else{c:{d:{try{d=a.document.cookie;break d}catch(z){}d=void 0}if(d){d=d.split(";");for(var k=0;k<d.length;k++){var l=d[k].trim(),m=l.indexOf("=");if(-1!=m&&"AMP_EXP"==decodeURIComponent(l.substring(0,m).trim())){d=decodeURIComponent(l.substring(m+1).trim());break c}}}d=null}d=a._experimentCookie=d?d.split(/\s*,\s*/g):[]}a=-1!=d.indexOf(g)?!0:a.AMP_CONFIG&&
a.AMP_CONFIG.hasOwnProperty(g)?Math.random()<a.AMP_CONFIG[g]:!1;e=c[e]=a}return e};function u(a){a=parseFloat(a);return"number"===typeof a&&isFinite(a)?a:void 0};function v(a){AMP.BaseElement.apply(this,arguments)}h(v,AMP.BaseElement);f=v.prototype;f.preconnectCallback=function(a){this.preconnect.url(this.c,a);this.preconnect.url(this.h,a)};f.isLayoutSupported=function(a){return"fixed"==a||"fixed-height"==a||"responsive"==a||"fill"==a||"flex-item"==a};f.viewportCallback=function(a){a&&!this.i&&this.a&&(this.i=!0,this.a.contentWindow.postMessage("interaction seen","*"))};
f.buildCallback=function(){p().assert(t(this.win),"Enable amp-apester-media experiment");var a=this.element.getAttribute("width"),b=this.element.getAttribute("height");this.l=u(a);this.b=u(b);this.h="https://renderer.qmerce.com";this.c="https://display.apester.com";this.g=!1;this.j=p().assert(this.element.getAttribute("data-apester-media-id")||(this.g=this.element.getAttribute("data-apester-channel-token")),"Either the data-apester-media-id or the data-apester-channel-token attributes must be specified for <amp-apester-media> %s",
this.element);this.f=this.a=null;this.i=!1};f.firstLayoutCompleted=function(){this.viewportCallback(this.isInViewport())};function w(a){var b=encodeURIComponent(a.j),b=""+a.c+(a.g?"/tokens/"+b+"/interactions/random":"/interactions/"+b+"/display");return q(a.win,"xhr").fetchJson(b)}
function x(a,b){var c=a.element.ownerDocument.createElement("iframe");c.setAttribute("frameborder","0");c.setAttribute("allowtransparency","true");c.setAttribute("scrolling","no");c.src=b;c.height=a.b;c.width=a.l;c.classList.add("amp-apester-iframe");a.applyFillContent(c);return c}
function y(a){var b=a.element.ownerDocument.createElement("div");b.setAttribute("overflow","");b.className="amp-apester-overflow";var c=a.element.ownerDocument.createElement("button");c.textContent="Full Size";b.appendChild(c);return b}
f.layoutCallback=function(){var a=this;this.element.classList.add("amp-apester-container");return w(this).then(function(b){function c(a){a.element.classList.add("-amp-apester-iframe-ready")}var e=b.payload;b=a.h+"/interaction/"+encodeURIComponent(e.interactionId);b=x(a,b);var g=y(a),d={element:b,mutator:c};a.a=b;a.element.appendChild(g);a.element.appendChild(b);return a.f=a.loadPromise(b).then(function(){q(a.win,"vsync").runPromise({mutate:c},d);return e})},function(a){var b;if(n.dev)b=n.dev;else throw Error("failed to call initLogConstructor");
b.error("amp-apester-media","Display",a)}).then(function(b){a.togglePlaceholder(!1);b=b.data.size.height;b!=a.b&&(a.b=b,a.attemptChangeHeight(b))})};f.unlayoutOnPause=function(){return!0};f.unlayoutCallback=function(){if(this.a){var a=this.a;a.parentElement&&a.parentElement.removeChild(a);this.f=this.a=null}return!0};AMP.registerElement("amp-apester-media",v,".amp-apester-iframe{-webkit-transition:opacity 0.4s;transition:opacity 0.4s;opacity:0}.-amp-apester-iframe-ready{opacity:1!important}.amp-apester-loader{height:100px;width:100px;top:50%;left:50%;-webkit-transform:translate(-50%,-50%);transform:translate(-50%,-50%);margin-top:-22px}.amp-apester-loader-container{background-color:#fff}.amp-apester-container{max-width:700px;margin:0 auto;display:block;position:relative;width:100%}.amp-apester-overflow{position:absolute;margin:auto;top:50%;left:50%;-webkit-transform:translate(-50%,-50%);transform:translate(-50%,-50%)}.amp-apester-overflow button{border:none;background:#fff;cursor:pointer;padding:25px 80px;text-transform:uppercase;letter-spacing:1px;font-weight:700;outline:none;position:relative}\n/*# sourceURL=/extensions/amp-apester-media/0.1/amp-apester-media.css*/");
})});
//# sourceMappingURL=amp-apester-media-0.1.js.map

