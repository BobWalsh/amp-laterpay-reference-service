(self.AMP = self.AMP || []).push({n:"amp-app-banner", f:(function(AMP) {function f(a,b){function d(){}d.prototype=b.prototype;a.prototype=new d;a.prototype.constructor=a;for(var c in b)if(Object.defineProperties){var e=Object.getOwnPropertyDescriptor(b,c);e&&Object.defineProperty(a,c,e)}else a[c]=b[c]};Date.now();function h(a){for(var b=null,d="",c=0;c<arguments.length;c++){var e=arguments[c];e instanceof Error&&!b?b=e:(d&&(d+=" "),d+=e)}b?d&&(b.message=d+": "+b.message):b=Error(d);return b}function l(a){var b=h.apply(null,arguments);setTimeout(function(){throw b;})}self.log=self.log||{user:null,dev:null};var m=self.log;function n(){if(m.user)return m.user;throw Error("failed to call initLogConstructor");}function p(){if(m.dev)return m.dev;throw Error("failed to call initLogConstructor");};function t(a,b){var d,c;try{c=a.open(b,"_top",d)}catch(e){p().error("DOM","Failed to open url on target: ","_top",e)}};function u(a,b){a=a.__AMP_TOP||a;var d=a.services&&a.services[b]&&a.services[b].obj;return d}function v(a,b){var d=w(a);return d&&d.services&&d.services[b]&&d.services[b].obj}function w(a){if(a.nodeType){var b=(a.ownerDocument||a).defaultView,d=b=b.__AMP_TOP||b,b=x(b),c=b.ampdoc;c||(c=b.ampdoc={obj:null,promise:null,resolve:null});c.obj||(c.obj=(void 0)(d),c.resolve&&c.resolve(c.obj));a=c.obj.getAmpDoc(a)}return a.isSingleDoc()?a.win:a}
function y(a){var b=z(a);if(b)return b;a=x(a);var d,c=new Promise(function(a){d=a});a.storage={obj:null,promise:c,resolve:d};return c}function z(a){if(a=x(a).storage){var b=a.promise;if(b)return b;if(a.obj)return a.promise=Promise.resolve(a.obj)}return null}function x(a){var b=a.services;b||(b=a.services={});return b};var A=/^https:\/\/([a-zA-Z0-9_-]+\.)?cdn\.ampproject\.org/;var B,C;
function D(a){var b;B||(B=self.document.createElement("a"),C=self.UrlCache||(self.UrlCache=Object.create(null)));var d=C[a];if(d)return d;B.href=a;B.protocol||(B.href=B.href);var c={href:B.href,protocol:B.protocol,host:B.host,hostname:B.hostname,port:"0"==B.port?"":B.port,pathname:B.pathname,search:B.search,hash:B.hash,origin:null};"/"!==c.pathname[0]&&(c.pathname="/"+c.pathname);if("http:"==c.protocol&&80==c.port||"https:"==c.protocol&&443==c.port)c.port="",c.host=c.hostname;c.origin=B.origin&&"null"!=
B.origin?B.origin:"data:"!=c.protocol&&c.host?c.protocol+"//"+c.host:c.href;var e=c;return b?e:C[a]=e}function E(a){"string"==typeof a&&(a=D(a));var b;(b="https:"==a.protocol||"localhost"==a.hostname)||(a=a.hostname,b=a.length-10,b=0<=b&&a.indexOf(".localhost",b)==b);return b};var G,H="Webkit webkit Moz moz ms O o".split(" ");function J(a,b){for(var d in b){var c=a,e=b[d],g;g=c.style;var q=d;G||(G=Object.create(null));var r=G[q];if(!r){r=q;if(void 0===g[q]){var k;k=q;k=k.charAt(0).toUpperCase()+k.slice(1);a:{for(var F=0;F<H.length;F++){var I=H[F]+k;if(void 0!==g[I]){k=I;break a}}k=""}void 0!==g[k]&&(r=k)}G[q]=r}(g=r)&&(c.style[g]=e)}};function K(a){AMP.BaseElement.call(this,a);this.f=null;this.a=!1}f(K,AMP.BaseElement);K.prototype.isLayoutSupported=function(a){return"nodisplay"==a};function L(a,b,d,c){b.addEventListener("click",function(){M(a,d,c)})}function M(a,b,d){u(a.win,"timer").delay(function(){a.win.top.location.assign(d)},1500);t(a.win,b)}K.prototype.i=function(){this.getVsync().run({measure:void 0,mutate:N},{element:this.element,viewport:this.getViewport(),storagePromise:y(w(this.getAmpDoc())),storageKey:O(this)})};
function O(a){var b=n().assert(a.element.id,"amp-app-banner should have an id.");return"amp-app-banner:"+b}K.prototype.isDismissed=function(){var a=this;return y(w(this.getAmpDoc())).then(function(b){return b.get(O(a))}).then(function(a){return!!a},function(a){p().error("amp-app-banner","Failed to read storage",a);return!1})};
function P(a){a.isDismissed().then(function(b){if(b)Q(a);else{J(a.element,{visibility:""});var d=a.win.document.createElement("i-amp-app-banner-top-padding");a.element.appendChild(d);d=a.win.document.createElement("button");d.classList.add("amp-app-banner-dismiss-button");d.setAttribute("aria-label",a.element.getAttribute("data-dismiss-button-aria-label")||"Dismiss");var c=a.i.bind(a);d.addEventListener("click",c);a.element.appendChild(d);a.getVsync().run({measure:R,mutate:S},{element:a.element,viewport:a.getViewport()})}})}
function Q(a){return a.getVsync().runPromise({measure:void 0,mutate:T},{element:a.element,viewport:a.getViewport()})}function U(a){K.call(this,a)}f(U,K);U.prototype.upgradeCallback=function(){var a=u(this.win,"platform");return a.isIos()?new V(this.element):a.isAndroid()?new W(this.element):null};U.prototype.layoutCallback=function(){p().info("amp-app-banner","Only iOS or Android platforms are currently supported.");return Q(this)};function V(a){K.call(this,a);this.c=null}f(V,K);
V.prototype.preconnectCallback=function(a){this.element.parentNode&&this.preconnect.url("https://itunes.apple.com",a)};
V.prototype.buildCallback=function(){J(this.element,{display:"",visibility:"hidden"});var a=u(this.win,"platform"),b=v(this.getAmpDoc(),"viewer");(this.a=!b.isEmbedded()&&a.isSafari())?(p().info("amp-app-banner","Browser supports builtin banners. Not rendering amp-app-banner."),Q(this)):(this.c=this.win.document.head.querySelector("meta[name=apple-itunes-app]"))?(this.f=n().assert(this.element.querySelector("button[open-button]"),"<button open-button> is required inside %s: %s","amp-app-banner",this.element),
P(this)):Q(this)};V.prototype.layoutCallback=function(){if(!this.c||this.a)return Promise.resolve();X(this,this.c.getAttribute("content"));return Promise.resolve()};function X(a,b){var d={};b.replace(/\s/,"").split(",").forEach(function(a){var b=a.split("=");d[b[0]]=b[1]});var c=d["app-id"],e=d["app-argument"],g="https://itunes.apple.com/us/app/id"+c;L(a,a.f,e||g,g)}function W(a){K.call(this,a);this.g=null;this.b="";this.h=!1}f(W,K);
W.prototype.preconnectCallback=function(a){this.element.parentNode&&(this.preconnect.url("https://play.google.com",a),this.b&&this.preconnect.preload(this.b))};
W.prototype.buildCallback=function(){J(this.element,{display:"",visibility:"hidden"});var a=v(this.getAmpDoc(),"viewer");this.g=this.win.document.head.querySelector("link[rel=manifest],link[rel=amp-manifest]");var b=u(this.win,"platform"),d=b.isAndroid()&&b.isChrome(),c=this.win.location;"string"==typeof c&&(c=D(c));(this.a=!A.test(c.origin)&&!a.isEmbedded()&&d)?(p().info("amp-app-banner","Browser supports builtin banners. Not rendering amp-app-banner."),Q(this)):(this.h=b.isAndroid()&&!this.g)?Q(this):
(a=this.b=this.g.getAttribute("href"),b=this.element,c="manifest href",c=void 0===c?"source":c,n().assert(null!=a,"%s %s must be available",b,c),n().assert(E(a)||/^(\/\/)/.test(a),'%s %s must start with "https://" or "//" or be relative and served from either https or from localhost. Invalid value: %s',b,c,a),this.f=n().assert(this.element.querySelector("button[open-button]"),"<button open-button> is required inside %s: %s","amp-app-banner",this.element),P(this))};
W.prototype.layoutCallback=function(){var a=this;return this.h||this.a?Promise.resolve():u(this.win,"xhr").fetchJson(this.b).then(function(b){return Y(a,b)}).catch(function(b){Q(a);l(b)})};
function Y(a,b){var d=b.related_applications;if(d){var c=d.find(function(a){return"play"==a.platform});if(c){var e="https://play.google.com/store/apps/details?id="+c.id,g=Z(a,c.id);L(a,a.f,g,e)}else p().warn("amp-app-banner","Could not find a platform=play app in manifest: %s",a.element)}else p().warn("amp-app-banner","related_applications is missing from manifest.json file: %s",a.element)}
function Z(a,b){var d=v(a.element,"documentInfo").get().canonicalUrl;a=D(d);var c=a.protocol.replace(":",""),e=a.host,g=a.pathname;return"android-app://"+b+"/"+c+"/"+e+g}function N(a){T(a);a.storagePromise.then(function(b){b.set(a.storageKey,!0)})}function T(a){a.viewport.removeFromFixedLayer(a.element);var b=a.element;b.parentElement&&b.parentElement.removeChild(b);a.viewport.updatePaddingBottom(0)}function R(a){a.bannerHeight=a.viewport.getLayoutRect(a.element).height}
function S(a){a.viewport.updatePaddingBottom(a.bannerHeight);a.viewport.addToFixedLayer(a.element)}AMP.registerElement("amp-app-banner",U,"amp-app-banner{position:fixed!important;bottom:0!important;left:0;width:100%;max-height:100px!important;box-sizing:border-box;background:#fff;z-index:13!important;box-shadow:0 0 5px 0 rgba(0,0,0,.2)!important}i-amp-app-banner-top-padding{position:absolute;top:0;left:0;right:0;background:#fff;height:4px;z-index:15!important}.amp-app-banner-dismiss-button{position:absolute;width:28px;height:28px;top:-28px;right:0;background-image:url('data:image/svg+xml;utf8,%3Csvg%20width%3D%2213px%22%20height%3D%2213px%22%20viewBox%3D%22341%208%2013%2013%22%20version%3D%221.1%22%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20xmlns%3Axlink%3D%22http%3A//www.w3.org/1999/xlink%22%3E%3Cg%20id%3D%22ic_close_black_24dp%22%20stroke%3D%22none%22%20stroke-width%3D%221%22%20fill%3D%22none%22%20fill-rule%3D%22evenodd%22%20transform%3D%22translate%28341.000000%2C%208.000000%29%22%3E%3Cpolygon%20id%3D%22Shape%22%20fill%3D%22%234F4F4F%22%20points%3D%2213%201.30928571%2011.6907143%200%206.5%205.19071429%201.30928571%200%200%201.30928571%205.19071429%206.5%200%2011.6907143%201.30928571%2013%206.5%207.80928571%2011.6907143%2013%2013%2011.6907143%207.80928571%206.5%22%3E%3C/polygon%3E%3C/g%3E%3C/svg%3E');background-size:13px 13px;background-position:9px center;background-color:#fff;background-repeat:no-repeat;z-index:14!important;box-shadow:0 0 5px 0 rgba(0,0,0,.2);border:none;border-top-left-radius:12px}.amp-app-banner-dismiss-button:before{position:absolute;content:'';top:-20px;right:0;left:-20px;bottom:0}[dir=rtl] .amp-app-banner-dismiss-button{right:auto;left:0;border-top-left-radius:0;border-top-right-radius:12px;background-position:6px center}[dir=rtl] .amp-app-banner-dismiss-button:before{right:-20px;left:0}\n/*# sourceURL=/extensions/amp-app-banner/0.1/amp-app-banner.css*/");
})});
//# sourceMappingURL=amp-app-banner-0.1.js.map

